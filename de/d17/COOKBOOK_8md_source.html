<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Framework/Core/COOKBOOK.md Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('de/d17/COOKBOOK_8md.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/travis/build/AliceO2Group/AliceO2/Framework/Core/COOKBOOK.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../de/d17/COOKBOOK_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;!-- doxy</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;\page refFrameworkCoreCOOKBOOK Core COOKBOOK</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;/doxy --&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# Data Processing Layer Cookbook</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;This is a work in progress entrypoint for common DPL related tasks.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;#### Utilities for working with `DataRef`</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;Get payload size:</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;```cpp</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;size_t payloadSize = DataRefUtils::getPayloadSize(ref);</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;```</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;Extract a header from the header stack:</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;```cpp</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;const HeaderType* header = DataRefUtils::getHeader&lt;HeaderType*&gt;(ref);</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;```</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;Get the payload of messageable type as `gsl::span`</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;```cpp</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;auto data = DataRefUtils::as&lt;T&gt;(ref);</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;for (const auto&amp; element : data) {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  // do something on element, remember it&#39;s const</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;```</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;#### How do I report failure for a given Algorithm?</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;Whenever the driver process spots an error message, i.e. an error printed via `LOG(ERROR)` facility, when the driver process quits, it will exit with a exit code of 1. This includes any exception reported by the default exception handler.</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;This comes handy, for example in tests.</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;### Debugging on your laptop</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;The way the DPL currently works is that the driver executable you launch,</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;will then take care of spawning one device per `DataProcessorSpec` in</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;a separate process. This means that in order to debug your code you need to</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;make sure gdb / lldb are actually debugging the right child process.</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;For `gdb` you can use the `follow-fork-mode` setting. See</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;[here](https://sourceware.org/gdb/onlinedocs/gdb/Forks.html) for the full</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;documentation. This is unfortunately not available in</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;[lldb](https://bugs.llvm.org/show_bug.cgi?id=17972).</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;Alternatively you can start your driver executable with the `-s` / `--stop`</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;command line option which will immediately stop execution of the children after</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;the fork, allowing you to attach to them, e.g. for gdb using:</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;```bash</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;attach &lt;pid&gt;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;```</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;or the `lldb` equivalent:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;```bash</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;attach -pid &lt;pid&gt;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;```</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;Note: On some systems, attaching might fail due to missing permission, and `gdb`</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;has to be started with `sudo`.</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;In case you are building the DPL with the support for the debug GUI, you can</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;also attach a debugger to the running process by clicking on the</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;DataProcessorSpec you want to debug, which will show the Device inspector on</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;the right, and there click on the &quot;Attach debugger&quot; button. By default this</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;will start lldb in a Terminal.app window on mac, or GDB in an xterm elsewhere.</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;You can customise this behavior by setting the environment variable</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;`O2DPLDEBUG` to the command you want to run for the debugger and use the</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;environment variable `O2DEBUGGEDPID` to get the PID of the DataProcessor</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;currently selected. You can do this multiple times for all the devices you</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;wish to debug, but remember that you will need to quit the debugger if you want</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;DPL to exit.</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;On linux you might need to start the debugger with `sudo` to have the permission</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;to attach, e.g. set O2DPLDEBUG to</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;```bash</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;export O2DPLDEBUG=&#39;xterm -hold -e sudo gdb attach $O2DEBUGGEDPID &amp;&#39;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;```</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;Be sure to use single quotes to avoid direct expansion of O2DEBUGGEDPID variable.</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;The `&amp;` character add the end is needed to start gdb in a separate process.</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;### Debug GUI</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;The demonstator also includes a simple GUI to help debugging problems:</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;![](https://user-images.githubusercontent.com/10544/29307499-75bb8550-81a2-11e7-9aa6-96b7613288b5.png)</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;The GUI provides the following facilities:</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;* Graph view with all the connections between DataProcessors</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;* One log window  per DataProcessor, allowing filtering and  triggering on log</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  messages</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;* Metrics inspector</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;### Integrating with non-DPL devices</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;Given the Data Processing Layer comes somewhat later in the design of O2, it&#39;s possible that you already have some topology of devices which you want to integrate, without having to port them to the DPL itself. Alternatively, your devices might not satisfy the requirements of the Data Processing Layer and therefore require a &quot;raw&quot; `FairMQDevice`, fully customised to your needs. This is fully supported and we provide means to ingest foreign, non-DPL FairMQDevices produced, messages into a DPL workflow. This is done via the help of a &quot;proxy&quot; data processor which connects to the foreign device, receives its inputs, optionally converts them to a format understood by the Data Processing Layer, and then pumps them to the right Data Processor Specs. In order to have such a device in your workflow, you can use the [`specifyExternalFairMQDeviceProxy`][specifyExternalFairMQDeviceProxy] helper to instanciate it. For an example of how to use it you can look at</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;[`Framework/TestWorkflows/src/test_RawDeviceInjector.cxx`][rawDeviceInjectorExample]. The `specifyExternalFairMQDeviceProxy` takes four arguments:</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;```cpp</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;specifyExternalFairMQDeviceProxy(&quot;foreign-source&quot;,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                {outspec},</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                &quot;type=sub,method=connect,address=tcp://localhost:5450,rateLogging=1&quot;,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                o2DataModelAdaptor(outspec, 0, 1)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;               ),</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;```</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;the first one is the usual `DataProcessorSpec` name, the second one is a list of outputs which we will create from the non-DPL device, the third one is a string to connect to the existing topology and a the fourth one is a function of the kind `o2::framework::InjectorFunction` which does the actual conversion. In this particular case we use the `o2DataModelAdaptor()` helper to create such an translation function since we know that our input is already respecting the O2 Data Model and most of the heavylifing can be done automatically.</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;Sending out the results of a computation can be done in a similar manner. Use</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;```cpp</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;ConfigParamSpec{&quot;channel-config&quot;, VariantType::String, &quot;&lt;channel-configuration&gt;&quot;, &quot;Out-of-band channel config&quot;}</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;```</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;to create an out-of-band channel as specified in `channel-configuration` and hen use the `RawDeviceService` to get the raw FairMQDevice and send data hrough such a channel.</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;## Customizing workflows creation (WIP)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;Sometimes it&#39;s handy to customise or generalise the workflow creation based on</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;external inputs. For example you might want to change the number of workers for</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;a given task or disable part of the topology if a given detector should not be</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;enabled. </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;This can be done by implementing the function:</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;```cpp</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;void customize(std::vector&lt;o2::framework::ConfigParamSpec&gt; &amp;workflowOptions)</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;```</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;**before** including the `Framework/runDataProcessing.h` (this will most likely </div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;change in the future). Each ConfigParamSpec will be added to the configuration</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;mechanism (e.g. the command line options) allowing you to modify them. Such options</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;will then be made available at workflow creation time via the `ConfigContext`</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;passed to the `defineDataProcessing` function, using the `ConfigContext::options()`</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;getter.</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;## Completion policies (WIP)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;By default the data processing of a given record happens when all the fields of</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;that record are present. So if your Data Processor declares it will consume</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;`TRACKS` and `CLUSTERS`, for any given time interval both need to be produced</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;by some other data processor before the computation declared in yours can happen.</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;Sometimes it&#39;s however desirable to customise such a behavior, so that some action</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;on the record can happen even if it&#39;s not complete. For example you might want</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;to start computing some quantity as a given message arrives and then complete the</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;computation once the record is complete. This is done by specifying by customising </div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;the data processing CompletionPolicy. This can be done using the usual **Customization</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;mechanism** where a:</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;```cpp</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;void customize(std::vector&lt;CompletionPolicy&gt; &amp;policies);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;```</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;function is provided before including `runDataProcessing.h`.</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;Each `CompletionPolicy` requires the user to specify the `matcher` to select</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;which device is affected by it, and a `callback` to decide what action</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;expressed by a `CompletionOp` to take on a given input record.</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;Possible actions include:</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;* `CompletionPolicy::CompletionOp::Consume`: run the data processing callback and </div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  mark the available fields in the input as consumed.</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;* `CompletionPolicy::CompletionOp::Process`: run the data processing callback, but do</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  not consume the field, which will be available when the next message for the field</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;* `CompletionPolicy::CompletionOp::Wait`: hold on the record but do not process it yet.</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;* `CompletionPolicy::CompletionOp::Drop`: drop the current available fields from the record.</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;The default completion policy is to consume all inputs when they are all present.</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;When the computation is dispatched with a partially completea `InputRecord`,</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;the user can check for the validity of any of its parts via the `InputRecord::isValid()`</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;API.</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;## Customizing deployment configuration (WIP)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;By default every device instanciated by the Data Processing Layer connects to</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;the others using the PUB/SUB paradigm. This might or might not be desiderable</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;for some or even all of the connections. For this reason there is now a way to</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;customise the connections based on the ids of the devices being instanciated.</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;In order to do so, one needs to implement the function</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;```cpp</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;customize(std::vector&lt;o2::framework::ChannelConfigurationPolicy&gt; &amp;policies)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;```</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;**before** including `Framework/runDataProcessing.h` (this will most likely</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;change in the future). You can then extend the policies vector with your own </div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;`ChannelConfigurationPolicy`. For each device to device edge, the system will</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;invoke the `ChannelConfigurationPolicy::match` callback with the ids of the</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;producer and of the consumer as arguments. If the callback returns `true`,</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;the `ChannelConfigurationPolicy::modifyInput` and</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;`ChannelConfigurationPolicy::modifyOutput` will be invoked passing the input and </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;output channel associated to the two devices, giving the opportunity to modify </div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;the matching channels.</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;## Getting objects from the CCDB</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;In order to get objects from the CCDB one can specify the `Lifetime::Condition`</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;for the required input spec. That will retrieve the object not from another</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;data processor but it will do a request to a CCDB server. The actual URL for</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;the server can be specified via the `--condition-backend &lt;backend-url&gt;` option.</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;It is also possible to specify a given timestamp for the object via the option</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;`--condition-timestamp &lt;timestamp&gt;`. The final url is completed by the value of</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;the the Origin and Description of the `InputSpec` to be:</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;```bash</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;&lt;backend-url&gt;/&lt;origin&gt;/&lt;description&gt;/&lt;timestamp&gt;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;```</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;If the timestamp is not specified, DPL will look it up in the `DataProcessingHeader`.</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;# Future features</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;## Lifetime support</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;While initially foreseen in the design, Lifetime for Inputs / Outputs has not</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;yet being implemented correctly. However, once that happens, the following behaviors </div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;will be implemented (naming foreseen to change). Once implemented it will be possible</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;to specify the following Lifetime types:</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;* Timeframe: an input that gets processed only once.</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;* Condition: an input that is cache on considered valid for multiple computations,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;             according to its IOV.</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;* Transient: an output which is not actually sent. Useful to use the same mechanism</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;             of the Message Passing API to create</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;* QA: an output which once send is also proposed as input to the subsequent computation,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      allowing for accumulating data (e.g. histograms).</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;* SubTimeframe: an input which gets processed only once which has a</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                granularity of less than a timeframe. Within one computation</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                multiple of these can be created. They get sent as soon as</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                they go out of scope.</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;## Wildcard support for InputSpec / OutputSpec</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;In order to reduce the amount of code which one has to write to define inputs</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;and outputs, we plan to make the InputSpecs and OutputSpecs as veritable</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;matchers, supporting wildcards. For example if your Algorithm supports</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;processing clusters coming from multiple detectors, it will be possible to</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;specify:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;```cpp</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;InputSpec{&quot;*&quot;, &quot;CLUSTERS&quot;}</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;```</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;If the user wants to get both clusters and tracks coming from the same detector,</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;it will be possible to write:</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;```cpp</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;InputSpec{&quot;*&quot;, &quot;CLUSTERS&quot;}, InputSpec{&quot;*&quot;, &quot;TRACKS&quot;}</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;```</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;i.e. the first message which arrives will define the wildcard for all the other input</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;spec in the definition.</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;### Data flow parallelism</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;Data flow parallelism is simply expressed by tuning the data flow, adding explicitly the parallel data paths, using the appropriate `InputSpec` and `OutputSpec`.</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;E.g.:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;```cpp</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;DataProcessorSpec{</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  &quot;tpc_processor_1&quot;,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  Inputs{},</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  Outputs{{&quot;TPC&quot;, &quot;CLUSTERS&quot;, SubSpec(0)}},</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  // ...</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;},</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;DataProcessorSpec{</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  &quot;tpc_processor_2&quot;,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  Inputs{},</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  Outputs{{&quot;TPC&quot;, &quot;CLUSTERS&quot;, SubSpec(1)}},</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  // ...</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;// ...</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;DataProcessorSpec{</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  &quot;tpc_processor_18&quot;,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  Inputs{},</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  Outputs{{&quot;TPC&quot;, &quot;CLUSTERS&quot;, SubSpec(17)}},</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  // ...</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;```</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;or alternatively the parallel workflows part could be generated programmatically:</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;```cpp</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;parallel(</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  DataProcessorSpec{</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    &quot;tpc_processor&quot;,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    {InputSpec{&quot;c&quot;, &quot;TPC&quot;, &quot;CLUSTERS&quot;}}</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  },</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  18,</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  [](DataProcessorSpec &amp;spec, size_t idx) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    spec.outputs[0].subSpec = idx; // Each of the 18 DataProcessorSpecs should have a different subSpec</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;```</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;Similarly this can be done for a component that merges inputs from multiple parallel devices, this time by modifying programmatically the `Inputs`:</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;```cpp</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;// ...</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;DataProcessorSpec{</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  &quot;merger&quot;,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  mergeInputs({&quot;a&quot;, &quot;TST&quot;, &quot;A&quot;, 0, Lifetime::Timeframe},</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;              4,</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;              [](InputSpec &amp;input, size_t index) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                 input.subSpec = index;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;              }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          ),</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  {},</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  AlgorithmSpec{[](InitContext &amp;setup) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;     return [](ProcessingContext &amp;ctx) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  // Create a single output.</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    LOG(DEBUG) &lt;&lt; &quot;Invoked&quot; &lt;&lt; std::endl;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  };</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;}</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;// ...</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;```</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;When one declares a parallel set of devices you can retrieve the rank (i.e. parallel id) or the number of parallel devices by using the `ParalleContext`, which can be retrieved from the `ServiceRegistry` (see also the `Services` section below), e.g.:</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;```cpp</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;size_t whoAmI = services.get&lt;ParallelContext&gt;().index1D();</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;size_t howManyAreWe = services.get&lt;ParallelContext&gt;().index1DSize();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;```</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;### Time pipelining</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;A second type of parallelism is time based pipelining. This assumes that the data can be subdivided in subsequent &quot;time periods&quot; that are independent one from the other and which are each identified by some timestamp entity. In this particular case it could result handy that some part of the workflow are actually processing different time periods. This can be expressed via the `timePipeline`, directive, e.g.:</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;```cpp</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;// ...</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;timePipeline(DataProcessorSpec{</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  &quot;processor&quot;,</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  {InputSpec{&quot;a&quot;, &quot;TST&quot;, &quot;A&quot;}},</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  {OutputSpec{&quot;TST&quot;, &quot;B&quot;}},</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  AlgorithmSpec{[](ProcessingContext &amp;ctx) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    };</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}, 2);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;// ...</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;```</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;which will result in two devices, one for even time periods, the other one for</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;odd timeperiods.</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;### Disabling monitoring</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;Sometimes (e.g. when running a child inside valgrind) it might be useful to disable metrics which might pollute STDOUT. In order to disable monitoring you can use the `no-op://` backend:</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;```bash</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;some-workflow --monitoring-backend=no-op://</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;```</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;notice that the GUI will not function properly if you do so.</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;### Vectorised input</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;Sometimes data processing requires to group together multiple messages in one single multipart vector, so that they can be multiplexed on the same InputSpec. This is in particular the case for the RAW data coming out of the (Sub)TFBuilder.</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;In order to do so you need to make sure that the sender sends all the parts to be multiplexed in a single go. On the receiving side, you will get a single entry in the InputRecord and you can get the number of combined parts via `InputRecord::getNoParts()`. You can each of the parts by providing the entra parameter parts to the `InputRecord::get()` method.</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;### Using command line options in DataProcessorSpec</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;Command line options for a given DataProcessorSpec are defined as a std::vector&lt;ConfigParamSpec&gt;.</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;A ConfigParamSpec is defined by the 4 arguments</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  * name</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  * type</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  * default</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  * help</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;or with a constructor using only 3 arguments (without the default value).</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;E.g.</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;```cpp</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  { {&quot;opt1&quot;, VariantType::String, &quot;def1&quot;, {&quot;Command line option 1&quot;}},    // constructor with default value def1</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    {&quot;opt2&quot;, VariantType::Int, {&quot;Command line option 2&quot;}},               // constructor without default value  </div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {&quot;opt3&quot;, VariantType::Float, 10., {&quot;Command line option 3&quot;}} }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;```</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    </div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;(the available VariantType are listed in Framework/Variant.h).</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;The options are internally filled into an object of type ConfigParamRegistry and forwarded to the InitCallback of the respective AlgorithmSpec as part of the argument of type InitContext. The ConfigParamRegistry is finally accessed with InitContext::options().</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;E.g.</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;```cpp</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;ConfigParamRegistry opts = ic.options();  // with InitContext ic;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;```</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;ConfigParamRegistry has the two methods `isSet(key)` and `get&lt;T&gt;(key)`.  </div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;To read the option value use the `get&lt;T&gt;` method with the appropriate type `T`, e.g.</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;```cpp</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  auto vopt1 = ic.options().get&lt;std::string&gt;(&quot;opt1&quot;);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  auto vopt2 = ic.options().get&lt;std::int&gt;(&quot;opt2&quot;);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;```</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;To test wether the option `key` was set on the command line the method `isSet(key)` can be used. However be aware that the method `isSet(key)` with an option defined with a default value (constructor with</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;4 arguments) will always return `true`. If the option was set on the command line, then it will have the respective set value. If it is not set on the command line then it will have the default value. On</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;the other hand an option defined without a default value (constructor with 3 arguments) will only be recognized as set if it indeed was set on the command line. If it was not set, then its value will be</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;undefined. Thus to read an option without default value do e.g.</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;```cpp</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  std::string vopt1(&quot;&quot;);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  if (ic.options().isSet(&quot;opt1&quot;)) {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    vopt1 = ic.options().get&lt;std::string&gt;(&quot;opt1&quot;);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../de/d17/COOKBOOK_8md.html">COOKBOOK.md</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:32 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
