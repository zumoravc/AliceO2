<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/GlobalTracking/src/MatchTOF.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db/d6a/MatchTOF_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MatchTOF.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../db/d6a/MatchTOF_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;TTree.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;FairLogger.h&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/MagneticField_8h.html">Field/MagneticField.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/df4/MagFieldFast_8h.html">Field/MagFieldFast.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d54/Geo_8h.html">TOFBase/Geo.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d14/MCTruthContainer_8h.html">SimulationDataFormat/MCTruthContainer.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/df9/Propagator_8h.html">DetectorsBase/Propagator.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d76/Cartesian3D_8h.html">MathUtils/Cartesian3D.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h.html">MathUtils/Utils.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d84/MathConstants_8h.html">CommonConstants/MathConstants.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d9d/PhysicsConstants_8h.html">CommonConstants/PhysicsConstants.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dcc/Detectors_2Base_2include_2DetectorsBase_2GeometryManager_8h.html">DetectorsBase/GeometryManager.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;Math/SMatrix.h&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;Math/SVector.h&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;TFile.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;TGeoGlobalMagField.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d28/GRPObject_8h.html">DataFormatsParameters/GRPObject.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d08/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2PID_8h.html">ReconstructionDataFormats/PID.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/db1/TrackLTIntegral_8h.html">ReconstructionDataFormats/TrackLTIntegral.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d74/MatchTOF_8h.html">GlobalTracking/MatchTOF.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dac/MatchTPCITS_8h.html">GlobalTracking/MatchTPCITS.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d3/dc3/namespaceo2_1_1globaltracking.html">o2::globaltracking</a>;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="../../db/d6a/MatchTOF_8cxx.html#aaf742de12e0be6f72e850bf4d6c2cc69">   40</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d3/dbf/classo2_1_1dataformats_1_1TimeStampWithError.html">timeEst</a> = <a class="code" href="../../d3/dbf/classo2_1_1dataformats_1_1TimeStampWithError.html">o2::dataformats::TimeStampWithError&lt;float, float&gt;</a>;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../db/d6a/MatchTOF_8cxx.html#ab3d9b302efc2139b9468f807d69fcb7d">   41</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d2/d74/classo2_1_1dataformats_1_1EvIndex.html">evIdx</a> = <a class="code" href="../../d2/d74/classo2_1_1dataformats_1_1EvIndex.html">o2::dataformats::EvIndex&lt;int, int&gt;</a>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<a class="code" href="../../db/d6a/MatchTOF_8cxx.html#a8e1cead182581d0df38827ed861f8a77">ClassImp</a>(<a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html">MatchTOF</a>);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#aa248bc53fcffebe08560a48450b3dac5">   46</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#aa248bc53fcffebe08560a48450b3dac5">MatchTOF::run</a>()</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (!mInitDone) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;init() was not done yet&quot;</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  mTimerTot.Start();</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// we load all TOF clusters (to be checked if we need to split per time frame)</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  prepareTOFClusters();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  mTimerTot.Stop();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  printf(<span class="stringliteral">&quot;Timing:\n&quot;</span>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  printf(<span class="stringliteral">&quot;prepareTOFCluster:        &quot;</span>);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  mTimerTot.Print();</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  mTimerTot.Start();</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">if</span> (mIsworkflowON) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Number of entries in track tree = &quot;</span> &lt;&lt; mCurrTracksTreeEntry;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    mMatchedTracks.clear();</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    mOutTOFLabels.clear();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    mOutTPCLabels.clear();</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    mOutITSLabels.clear();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    prepareTracks();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    mTimerTot.Stop();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    printf(<span class="stringliteral">&quot;Timing:\n&quot;</span>);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    printf(<span class="stringliteral">&quot;prepare tracks:        &quot;</span>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    mTimerTot.Print();</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    mTimerTot.Start();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sec = <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>; sec--;) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Doing matching for sector &quot;</span> &lt;&lt; sec &lt;&lt; <span class="stringliteral">&quot;...&quot;</span>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      doMatching(sec);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;...done. Now check the best matches&quot;</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      selectBestMatches();</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (0) { <span class="comment">// enabling this creates very verbose output</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      mTimerTot.Stop();</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a950065742d8303a17ba6100fdc2ea219">printCandidatesTOF</a>();</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      mTimerTot.Start(<span class="keyword">false</span>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// we do the matching per entry of the TPCITS matched tracks tree</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">while</span> (!mIsworkflowON &amp;&amp; mCurrTracksTreeEntry + 1 &lt; mInputTreeTracks-&gt;GetEntries()) { <span class="comment">// we add &quot;+1&quot; because mCurrTracksTreeEntry starts from -1, and it is incremented in loadTracksNextChunk which is called by prepareTracks</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Number of entries in track tree = &quot;</span> &lt;&lt; mCurrTracksTreeEntry;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    mMatchedTracks.clear();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    mOutTOFLabels.clear();</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    mOutTPCLabels.clear();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    mOutITSLabels.clear();</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    prepareTracks();</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    mTimerTot.Stop();</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    printf(<span class="stringliteral">&quot;Timing:\n&quot;</span>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    printf(<span class="stringliteral">&quot;prepare tracks:        &quot;</span>);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    mTimerTot.Print();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    mTimerTot.Start();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">/* Uncomment for local debug </span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">    Printf(&quot;*************** Printing the tracks before starting the matching&quot;);</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">    // printing the tracks    </span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">    std::array&lt;float, 3&gt; globalPosTmp;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">    int totTracks = 0; </span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">    </span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">    for (int sec = o2::constants::math::NSectors; sec--;) {</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">     Printf(&quot;\nsector %d&quot;, sec);</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">      auto&amp; cacheTrkTmp = mTracksSectIndexCache[sec];   // array of cached tracks indices for this sector; reminder: they are ordered in time!</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">      for (int itrk = 0; itrk &lt; cacheTrkTmp.size(); itrk++){</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  auto&amp; trc = mTracksWork[cacheTrkTmp[itrk]];</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">        trc.getXYZGlo(globalPosTmp);</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Track&quot; &lt;&lt; totTracks &lt;&lt; &quot; [in this sector it is the &quot; &lt;&lt; itrk &lt;&lt; &quot;]: Global coordinates After propagating to 371 cm: globalPos[0] = &quot; &lt;&lt; globalPosTmp[0] &lt;&lt; &quot;, globalPos[1] = &quot; &lt;&lt; globalPosTmp[1] &lt;&lt; &quot;, globalPos[2] = &quot; &lt;&lt; globalPosTmp[2];</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;The phi angle is &quot; &lt;&lt; TMath::ATan2(globalPosTmp[1], globalPosTmp[0]);</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">  totTracks++;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sec = <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>; sec--;) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Doing matching for sector &quot;</span> &lt;&lt; sec &lt;&lt; <span class="stringliteral">&quot;...&quot;</span>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      doMatching(sec);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;...done. Now check the best matches&quot;</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      selectBestMatches();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span> (0) { <span class="comment">// enabling this creates very verbose output</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      mTimerTot.Stop();</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a950065742d8303a17ba6100fdc2ea219">printCandidatesTOF</a>();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      mTimerTot.Start(<span class="keyword">false</span>);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a61a54ae5c247e70fa930e6128bfa2be3">fill</a>();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#ifdef _ALLOW_TOF_DEBUG_</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (mDBGFlags)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    mDBGOut.reset();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  mTimerTot.Stop();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  printf(<span class="stringliteral">&quot;Timing:\n&quot;</span>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  printf(<span class="stringliteral">&quot;Do Matching:        &quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  mTimerTot.Print();</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a61a54ae5c247e70fa930e6128bfa2be3">  153</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a61a54ae5c247e70fa930e6128bfa2be3">MatchTOF::fill</a>()</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  mOutputTree-&gt;Fill();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">if</span> (mOutputTreeCalib)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    mOutputTreeCalib-&gt;Fill();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#ab3a774b6e47e1545f3e6c2bf2ee31561">  161</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#ab3a774b6e47e1545f3e6c2bf2ee31561">MatchTOF::initWorkflow</a>(<span class="keyword">const</span> gsl::span&lt;const o2::dataformats::TrackTPCITS&gt;&amp; trackArray, <span class="keyword">const</span> gsl::span&lt;const Cluster&gt;&amp; clusterArray, <span class="keyword">const</span> <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;o2::MCCompLabel&gt;</a>&amp; toflab, <span class="keyword">const</span> gsl::span&lt;const o2::MCCompLabel&gt;&amp; itslab, <span class="keyword">const</span> gsl::span&lt;const o2::MCCompLabel&gt;&amp; tpclab)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (mInitDone) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Initialization was already done&quot;</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  mTracksArrayInp = trackArray;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  mTOFClustersArrayInp = clusterArray;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  mIsworkflowON = kTRUE;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  mTOFClusLabels = toflab;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  mTPCLabels = tpclab;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  mITSLabels = itslab;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  mMCTruthON = (mTOFClusLabels.<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a277aa132a845e6e466139f1d5041c933">getNElements</a>() &amp;&amp; mTPCLabels.size() &amp;&amp; mITSLabels.size());</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  mInitDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#ae4d3785b8297554926927e4e468fb03b">  182</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#ae4d3785b8297554926927e4e468fb03b">MatchTOF::init</a>()</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">if</span> (mInitDone) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Initialization was already done&quot;</span>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  attachInputTrees();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// create output branch with track-tof matching</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (mOutputTree) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    mOutputTree-&gt;Branch(mOutTracksBranchName.data(), &amp;mMatchedTracks);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Matched tracks will be stored in &quot;</span> &lt;&lt; mOutTracksBranchName &lt;&lt; <span class="stringliteral">&quot; branch of tree &quot;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;              &lt;&lt; mOutputTree-&gt;GetName();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      mOutputTree-&gt;Branch(mOutTPCMCTruthBranchName.data(), &amp;mOutTPCLabels);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;ITS Tracks Labels branch: &quot;</span> &lt;&lt; mOutITSMCTruthBranchName;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      mOutputTree-&gt;Branch(mOutITSMCTruthBranchName.data(), &amp;mOutITSLabels);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;TPC Tracks Labels branch: &quot;</span> &lt;&lt; mOutTPCMCTruthBranchName;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      mOutputTree-&gt;Branch(mOutTOFMCTruthBranchName.data(), &amp;mOutTOFLabels);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;TOF Tracks Labels branch: &quot;</span> &lt;&lt; mOutTOFMCTruthBranchName;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Output tree is not attached, matched tracks will not be stored&quot;</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">// create output branch for calibration info</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (mOutputTreeCalib) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    mOutputTreeCalib-&gt;Branch(mOutCalibBranchName.data(), &amp;mCalibInfoTOF);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Calib infos will be stored in &quot;</span> &lt;&lt; mOutCalibBranchName &lt;&lt; <span class="stringliteral">&quot; branch of tree &quot;</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;              &lt;&lt; mOutputTreeCalib-&gt;GetName();</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Calib Output tree is not attached, calib infos will not be stored&quot;</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="preprocessor">#ifdef _ALLOW_TOF_DEBUG_</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// debug streamer</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">if</span> (mDBGFlags) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    mDBGOut = std::make_unique&lt;o2::utils::TreeStreamRedirector&gt;(mDebugTreeFileName.data(), <span class="stringliteral">&quot;recreate&quot;</span>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  mInitDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    mTimerTot.Stop();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    mTimerTot.Reset();</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a25b72cc0622c171c482143cd74cef5d8">print</a>();</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a25b72cc0622c171c482143cd74cef5d8">  238</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a25b72cc0622c171c482143cd74cef5d8">MatchTOF::print</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;****** component for the matching of tracks to TOF clusters ******&quot;</span>;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">if</span> (!mInitDone) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;init is not done yet - nothing to print&quot;</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;MC truth: &quot;</span> &lt;&lt; (mMCTruthON ? <span class="stringliteral">&quot;on&quot;</span> : <span class="stringliteral">&quot;off&quot;</span>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Time tolerance: &quot;</span> &lt;&lt; mTimeTolerance;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Space tolerance: &quot;</span> &lt;&lt; mSpaceTolerance;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;SigmaTimeCut: &quot;</span> &lt;&lt; mSigmaTimeCut;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;**********************************************************************&quot;</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a950065742d8303a17ba6100fdc2ea219">  257</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a950065742d8303a17ba6100fdc2ea219">MatchTOF::printCandidatesTOF</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="keywordtype">void</span> MatchTOF::attachInputTrees()</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  printf(<span class="stringliteral">&quot;attachInputTrees\n&quot;</span>);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span> (!mInputTreeTracks) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;Input tree with tracks is not set&quot;</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">if</span> (!mTreeTPCTracks) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;TPC tracks data input tree is not set&quot;</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">if</span> (!mTreeTOFClusters) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;TOF clusters data input tree is not set&quot;</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// input tracks (this is the pais of ITS-TPC matches)</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">if</span> (!mInputTreeTracks-&gt;GetBranch(mTracksBranchName.data())) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;Did not find tracks branch &quot;</span> &lt;&lt; mTracksBranchName &lt;&lt; <span class="stringliteral">&quot; in the input tree&quot;</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  mInputTreeTracks-&gt;SetBranchAddress(mTracksBranchName.data(), &amp;mTracksArrayInpVect);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Attached tracks &quot;</span> &lt;&lt; mTracksBranchName &lt;&lt; <span class="stringliteral">&quot; branch with &quot;</span> &lt;&lt; mInputTreeTracks-&gt;GetEntries()</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// input TOF clusters</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">if</span> (!mTreeTOFClusters-&gt;GetBranch(mTOFClusterBranchName.data())) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;Did not find TOF clusters branch &quot;</span> &lt;&lt; mTOFClusterBranchName &lt;&lt; <span class="stringliteral">&quot; in the input tree&quot;</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  mTreeTOFClusters-&gt;SetBranchAddress(mTOFClusterBranchName.data(), &amp;mTOFClustersArrayInpVect);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Attached TOF clusters &quot;</span> &lt;&lt; mTOFClusterBranchName &lt;&lt; <span class="stringliteral">&quot; branch with &quot;</span> &lt;&lt; mTreeTOFClusters-&gt;GetEntries()</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// is there MC info available ?</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  mMCTruthON = <span class="keyword">true</span>;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordflow">if</span> (mTreeTOFClusters-&gt;GetBranch(mTOFMCTruthBranchName.data())) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    mTOFClusLabelsPtr = &amp;mTOFClusLabels;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    mTreeTOFClusters-&gt;SetBranchAddress(mTOFMCTruthBranchName.data(), &amp;mTOFClusLabelsPtr);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Found TOF Clusters MCLabels branch &quot;</span> &lt;&lt; mTOFMCTruthBranchName;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    mMCTruthON = <span class="keyword">false</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">if</span> (mInputTreeTracks-&gt;GetBranch(mTPCMCTruthBranchName.data())) {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    mInputTreeTracks-&gt;SetBranchAddress(mTPCMCTruthBranchName.data(), &amp;mTPCLabelsVect);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Found TPC tracks MCLabels branch &quot;</span> &lt;&lt; mTPCMCTruthBranchName.data();</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    mMCTruthON = <span class="keyword">false</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span> (mInputTreeTracks-&gt;GetBranch(mITSMCTruthBranchName.data())) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    mInputTreeTracks-&gt;SetBranchAddress(mITSMCTruthBranchName.data(), &amp;mITSLabelsVect);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Found ITS tracks MCLabels branch &quot;</span> &lt;&lt; mITSMCTruthBranchName.data();</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    mMCTruthON = <span class="keyword">false</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  mCurrTracksTreeEntry = -1;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  mCurrTOFClustersTreeEntry = -1;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keywordtype">bool</span> MatchTOF::prepareTracks()</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span> (!mIsworkflowON &amp;&amp; !loadTracksNextChunk()) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  mNumOfTracks = mTracksArrayInp.size();</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordflow">if</span> (mNumOfTracks == 0)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no tracks to be matched</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  mMatchedTracksIndex.resize(mNumOfTracks);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  std::fill(mMatchedTracksIndex.begin(), mMatchedTracksIndex.end(), -1); <span class="comment">// initializing all to -1</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// copy the track params, propagate to reference X and build sector tables</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  mTracksWork.clear();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  mTracksWork.reserve(mNumOfTracks);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    mTracksLblWork.clear();</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    mTracksLblWork.reserve(mNumOfTracks);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sec = <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>; sec--;) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    mTracksSectIndexCache[sec].clear();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    mTracksSectIndexCache[sec].reserve(100 + 1.2 * mNumOfTracks / <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// getting Bz (mag field)</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keyword">auto</span> o2field = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da0/classo2_1_1field_1_1MagneticField.html">o2::field::MagneticField</a>*<span class="keyword">&gt;</span>(TGeoGlobalMagField::Instance()-&gt;GetField());</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordtype">float</span> bzField = o2field-&gt;<a class="code" href="../../d2/da0/classo2_1_1field_1_1MagneticField.html#af81094cbf8b590f954df3ec5f58612f8">solenoidField</a>(); <span class="comment">// magnetic field in kGauss</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  Printf(<span class="stringliteral">&quot;\n\nWe have %d tracks to try to match to TOF&quot;</span>, mNumOfTracks);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordtype">int</span> nNotPropagatedToTOF = 0;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> it = 0; it &lt; mNumOfTracks; it++) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d6/d67/classo2_1_1dataformats_1_1TrackTPCITS.html">o2::dataformats::TrackTPCITS</a>&amp; trcOrig = mTracksArrayInp[it]; <span class="comment">// TODO: check if we cannot directly use the o2::track::TrackParCov class instead of o2::dataformats::TrackTPCITS, and then avoid the casting below; this is the track at the vertex</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    std::array&lt;float, 3&gt; globalPos;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// create working copy of track param</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    mTracksWork.emplace_back(trcOrig); <span class="comment">//, mCurrTracksTreeEntry, it);</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">// make a copy of the TPC track that we have to propagate</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">//o2::tpc::TrackTPC* trc = new o2::tpc::TrackTPC(trcTPCOrig); // this would take the TPCout track</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">//auto&amp; trc = mTracksWork.back(); // with this we take the TPCITS track propagated to the vertex</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keyword">auto</span>&amp; trc = mTracksWork.back().getParamOut();        <span class="comment">// with this we take the TPCITS track propagated to the vertex</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keyword">auto</span>&amp; intLT = mTracksWork.back().getLTIntegralOut(); <span class="comment">// we get the integrated length from TPC-ITC outward propagation</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (trc.getX() &lt; <a class="code" href="../../d5/dcf/classo2_1_1globaltracking_1_1MatchTPCITS.html#a7b79acb98e69d6f77543ff90185d1f9e">o2::globaltracking::MatchTPCITS::XTPCOuterRef</a> - 1.) { <span class="comment">// tpc-its track outward propagation did not reach outer ref.radius, skip this track</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      nNotPropagatedToTOF++;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// propagate to matching Xref</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    trc.getXYZGlo(globalPos);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Global coordinates Before propagating to 371 cm: globalPos[0] = &quot;</span> &lt;&lt; globalPos[0] &lt;&lt; <span class="stringliteral">&quot;, globalPos[1] = &quot;</span> &lt;&lt; globalPos[1] &lt;&lt; <span class="stringliteral">&quot;, globalPos[2] = &quot;</span> &lt;&lt; globalPos[2];</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Radius xy Before propagating to 371 cm = &quot;</span> &lt;&lt; TMath::Sqrt(globalPos[0] * globalPos[0] + globalPos[1] * globalPos[1]);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Radius xyz Before propagating to 371 cm = &quot;</span> &lt;&lt; TMath::Sqrt(globalPos[0] * globalPos[0] + globalPos[1] * globalPos[1] + globalPos[2] * globalPos[2]);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (!propagateToRefXWithoutCov(trc, mXRef, 2, bzField)) { <span class="comment">// we first propagate to 371 cm without considering the covariance matrix</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      nNotPropagatedToTOF++;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// the &quot;rough&quot; propagation worked; now we can propagate considering also the cov matrix</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (!propagateToRefX(trc, mXRef, 2, intLT) || <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(trc.getZ()) &gt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a89db56f98f43548aa547bb5f77071319">Geo::MAXHZTOF</a>) { <span class="comment">// we check that the propagation with the cov matrix worked; CHECK: can it happen that it does not if the propagation without the errors succeeded?</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      nNotPropagatedToTOF++;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    trc.getXYZGlo(globalPos);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Global coordinates After propagating to 371 cm: globalPos[0] = &quot;</span> &lt;&lt; globalPos[0] &lt;&lt; <span class="stringliteral">&quot;, globalPos[1] = &quot;</span> &lt;&lt; globalPos[1] &lt;&lt; <span class="stringliteral">&quot;, globalPos[2] = &quot;</span> &lt;&lt; globalPos[2];</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Radius xy After propagating to 371 cm = &quot;</span> &lt;&lt; TMath::Sqrt(globalPos[0] * globalPos[0] + globalPos[1] * globalPos[1]);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Radius xyz After propagating to 371 cm = &quot;</span> &lt;&lt; TMath::Sqrt(globalPos[0] * globalPos[0] + globalPos[1] * globalPos[1] + globalPos[2] * globalPos[2]);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;The track will go to sector &quot;</span> &lt;&lt; <a class="code" href="../../d0/d28/namespaceo2_1_1utils.html#ad632aa7dc83da980942e6fdb2d27efcc">o2::utils::Angle2Sector</a>(TMath::ATan2(globalPos[1], globalPos[0]));</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    mTracksSectIndexCache[<a class="code" href="../../d0/d28/namespaceo2_1_1utils.html#ad632aa7dc83da980942e6fdb2d27efcc">o2::utils::Angle2Sector</a>(TMath::ATan2(globalPos[1], globalPos[0]))].push_back(it);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">//delete trc; // Check: is this needed?</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Total number of tracks = &quot;</span> &lt;&lt; mNumOfTracks &lt;&lt; <span class="stringliteral">&quot;, Number of tracks that failed to be propagated to TOF = &quot;</span> &lt;&lt; nNotPropagatedToTOF;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// sort tracks in each sector according to their time (increasing in time)</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sec = <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>; sec--;) {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">auto</span>&amp; indexCache = mTracksSectIndexCache[sec];</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Sorting sector&quot;</span> &lt;&lt; sec &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; indexCache.size() &lt;&lt; <span class="stringliteral">&quot; tracks&quot;</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (!indexCache.size())</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    std::sort(indexCache.begin(), indexCache.end(), [<span class="keyword">this</span>](<span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keyword">auto</span>&amp; trcA = mTracksWork[<a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>];</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keyword">auto</span>&amp; trcB = mTracksWork[<a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>];</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">return</span> ((trcA.getTimeMUS().getTimeStamp() - mSigmaTimeCut * trcA.getTimeMUS().getTimeStampError()) - (trcB.getTimeMUS().getTimeStamp() - mSigmaTimeCut * trcB.getTimeMUS().getTimeStampError()) &lt; 0.);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    });</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  } <span class="comment">// loop over tracks of single sector</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">// Uncomment for local debug</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">/* </span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">  // printing the tracks</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">  std::array&lt;float, 3&gt; globalPos;</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">  int itmp = 0;</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">  for (int sec = o2::constants::math::NSectors; sec--;) {</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">    Printf(&quot;sector %d&quot;, sec);</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">    auto&amp; cacheTrk = mTracksSectIndexCache[sec];   // array of cached tracks indices for this sector; reminder: they are ordered in time!</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">    for (int itrk = 0; itrk &lt; cacheTrk.size(); itrk++){</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">      itmp++; </span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">      auto&amp; trc = mTracksWork[cacheTrk[itrk]];</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">      trc.getXYZGlo(globalPos);</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">      printf(&quot;Track %d: Global coordinates After propagating to 371 cm: globalPos[0] = %f, globalPos[1] = %f, globalPos[2] = %f\n&quot;, itrk, globalPos[0], globalPos[1], globalPos[2]);</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">      //      Printf(&quot;The phi angle is %f&quot;, TMath::ATan2(globalPos[1], globalPos[0]));</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">  Printf(&quot;we have %d tracks&quot;,itmp);      </span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;}</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordtype">bool</span> MatchTOF::prepareTOFClusters()</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;{</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="comment">// copy the track params, propagate to reference X and build sector tables</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  mTOFClusWork.clear();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">//  mTOFClusWork.reserve(mNumOfClusters); // we cannot do this, we don&#39;t have mNumOfClusters yet</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="comment">//  if (mMCTruthON) {</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="comment">//    mTOFClusLblWork.clear();</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="comment">//    mTOFClusLblWork.reserve(mNumOfClusters);</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="comment">//  }</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sec = <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>; sec--;) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    mTOFClusSectIndexCache[sec].clear();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">//mTOFClusSectIndexCache[sec].reserve(100 + 1.2 * mNumOfClusters / o2::constants::math::NSectors); // we cannot do this, we don&#39;t have mNumOfClusters yet</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  mNumOfClusters = 0;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">while</span> (!mIsworkflowON &amp;&amp; loadTOFClustersNextChunk()) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">int</span> nClusterInCurrentChunk = mTOFClustersArrayInp.size();</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;nClusterInCurrentChunk = &quot;</span> &lt;&lt; nClusterInCurrentChunk;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    mNumOfClusters += nClusterInCurrentChunk;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> it = 0; it &lt; nClusterInCurrentChunk; it++) {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html">Cluster</a>&amp; clOrig = mTOFClustersArrayInp[it];</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="comment">// create working copy of track param</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      mTOFClusWork.emplace_back(clOrig);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keyword">auto</span>&amp; cl = mTOFClusWork.back();</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      cl.setEntryInTree(mCurrTOFClustersTreeEntry);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="comment">// cache work track index</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      mTOFClusSectIndexCache[cl.getSector()].push_back(mTOFClusWork.size() - 1);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">if</span> (mIsworkflowON) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">int</span> nClusterInCurrentChunk = mTOFClustersArrayInp.size();</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;nClusterInCurrentChunk = &quot;</span> &lt;&lt; nClusterInCurrentChunk;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    mNumOfClusters += nClusterInCurrentChunk;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> it = 0; it &lt; nClusterInCurrentChunk; it++) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html">Cluster</a>&amp; clOrig = mTOFClustersArrayInp[it];</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">// create working copy of track param</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      mTOFClusWork.emplace_back(clOrig);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keyword">auto</span>&amp; cl = mTOFClusWork.back();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      cl.setEntryInTree(mCurrTOFClustersTreeEntry);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">// cache work track index</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      mTOFClusSectIndexCache[cl.getSector()].push_back(mTOFClusWork.size() - 1);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// sort clusters in each sector according to their time (increasing in time)</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sec = <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a>; sec--;) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keyword">auto</span>&amp; indexCache = mTOFClusSectIndexCache[sec];</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Sorting sector&quot;</span> &lt;&lt; sec &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; indexCache.size() &lt;&lt; <span class="stringliteral">&quot; TOF clusters&quot;</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span> (!indexCache.size())</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    std::sort(indexCache.begin(), indexCache.end(), [<span class="keyword">this</span>](<span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>) {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keyword">auto</span>&amp; clA = mTOFClusWork[<a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>];</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keyword">auto</span>&amp; clB = mTOFClusWork[<a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>];</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">return</span> (clA.getTime() - clB.getTime()) &lt; 0.;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    });</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  } <span class="comment">// loop over TOF clusters of single sector</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (mMatchedClustersIndex)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">delete</span>[] mMatchedClustersIndex;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  mMatchedClustersIndex = <span class="keyword">new</span> <span class="keywordtype">int</span>[mNumOfClusters];</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  std::fill_n(mMatchedClustersIndex, mNumOfClusters, -1); <span class="comment">// initializing all to -1</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">//_____________________________________________________</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="keywordtype">bool</span> MatchTOF::loadTracksNextChunk()</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;{</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordflow">while</span> (++mCurrTracksTreeEntry &lt; mInputTreeTracks-&gt;GetEntries()) {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    mInputTreeTracks-&gt;GetEntry(mCurrTracksTreeEntry);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    mTracksArrayInp = gsl::span&lt;const o2::dataformats::TrackTPCITS&gt;{*mTracksArrayInpVect};</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Loading tracks entry &quot;</span> &lt;&lt; mCurrTracksTreeEntry &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; mTracksArrayInp.size()</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; tracks&quot;</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (!mTracksArrayInp.size()) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      mITSLabels = gsl::span&lt;const o2::MCCompLabel&gt;{*mITSLabelsVect};</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      mTPCLabels = gsl::span&lt;const o2::MCCompLabel&gt;{*mTPCLabelsVect};</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  --mCurrTracksTreeEntry;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;}</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="keywordtype">bool</span> MatchTOF::loadTOFClustersNextChunk()</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  printf(<span class="stringliteral">&quot;Loat clusters next chunck\n&quot;</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  printf(<span class="stringliteral">&quot;Loading TOF clusters: number of entries in tree = %lld\n&quot;</span>, mTreeTOFClusters-&gt;GetEntries());</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordflow">while</span> (++mCurrTOFClustersTreeEntry &lt; mTreeTOFClusters-&gt;GetEntries()) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    mTreeTOFClusters-&gt;GetEntry(mCurrTOFClustersTreeEntry);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    mTOFClustersArrayInp = gsl::span&lt;const Cluster&gt;{*mTOFClustersArrayInpVect};</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Loading TOF clusters entry &quot;</span> &lt;&lt; mCurrTOFClustersTreeEntry &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; mTOFClustersArrayInp.size()</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; clusters&quot;</span>;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Loading TOF clusters entry &quot;</span> &lt;&lt; mCurrTOFClustersTreeEntry &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; mTOFClustersArrayInp.size()</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; clusters&quot;</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> (!mTOFClustersArrayInp.size()) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  --mCurrTOFClustersTreeEntry;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keywordtype">void</span> MatchTOF::doMatching(<span class="keywordtype">int</span> sec)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;{</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  mMatchedTracksPairs.clear(); <span class="comment">// new sector</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">//uncomment for local debug</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">  // printing the tracks</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">  std::array&lt;float, 3&gt; globalPosTmp;</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">  Printf(&quot;sector %d&quot;, sec);</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">  auto&amp; cacheTrkTmp = mTracksSectIndexCache[sec];   // array of cached tracks indices for this sector; reminder: they are ordered in time!</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">  for (int itrk = 0; itrk &lt; cacheTrkTmp.size(); itrk++){</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">    auto&amp; trc = mTracksWork[cacheTrkTmp[itrk]];</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">    trc.getXYZGlo(globalPosTmp);</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">    printf(&quot;Track %d: Global coordinates After propagating to 371 cm: globalPos[0] = %f, globalPos[1] = %f, globalPos[2] = %f\n&quot;, itrk, globalPosTmp[0], globalPosTmp[1], globalPosTmp[2]);</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">    Printf(&quot;The phi angle is %f&quot;, TMath::ATan2(globalPosTmp[1], globalPosTmp[0]));</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keyword">auto</span>&amp; cacheTOF = mTOFClusSectIndexCache[sec]; <span class="comment">// array of cached TOF cluster indices for this sector; reminder: they are ordered in time!</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keyword">auto</span>&amp; cacheTrk = mTracksSectIndexCache[sec];  <span class="comment">// array of cached tracks indices for this sector; reminder: they are ordered in time!</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordtype">int</span> nTracks = cacheTrk.size(), nTOFCls = cacheTOF.size();</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Matching sector &quot;</span> &lt;&lt; sec &lt;&lt; <span class="stringliteral">&quot;: number of tracks: &quot;</span> &lt;&lt; nTracks &lt;&lt; <span class="stringliteral">&quot;, number of TOF clusters: &quot;</span> &lt;&lt; nTOFCls;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">if</span> (!nTracks || !nTOFCls) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordtype">int</span> itof0 = 0;                          <span class="comment">// starting index in TOF clusters for matching of the track</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordtype">int</span> detId[2][5];                        <span class="comment">// at maximum one track can fall in 2 strips during the propagation; the second dimention of the array is the TOF det index</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordtype">float</span> deltaPos[2][3];                   <span class="comment">// at maximum one track can fall in 2 strips during the propagation; the second dimention of the array is the residuals</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html">o2::track::TrackLTIntegral</a> trkLTInt[2]; <span class="comment">// Here we store the integrated track length and time for the (max 2) matched strips</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordtype">int</span> nStepsInsideSameStrip[2] = {0, 0};  <span class="comment">// number of propagation steps in the same strip (since we have maximum 2 strips, it has dimention = 2)</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordtype">float</span> deltaPosTemp[3];</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  std::array&lt;float, 3&gt; pos;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  std::array&lt;float, 3&gt; posBeforeProp;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordtype">float</span> posFloat[3];</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Trying to match %d tracks&quot;</span> &lt;&lt; cacheTrk.size();</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> itrk = 0; itrk &lt; cacheTrk.size(); itrk++) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; 2; ii++) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      detId[ii][2] = -1; <span class="comment">// before trying to match, we need to inizialize the detId corresponding to the strip number to -1; this is the array that we will use to save the det id of the maximum 2 strips matched</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      nStepsInsideSameStrip[ii] = 0;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">int</span> nStripsCrossedInPropagation = 0; <span class="comment">// how many strips were hit during the propagation</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">auto</span>&amp; trackWork = mTracksWork[cacheTrk[itrk]];</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keyword">auto</span>&amp; trefTrk = trackWork.getParamOut();</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keyword">auto</span>&amp; intLT = trackWork.getLTIntegralOut();</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">//    Printf(&quot;intLT (before doing anything): length = %f, time (Pion) = %f&quot;, intLT.getL(), intLT.getTOF(o2::track::PID::Pion));</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">float</span> minTrkTime = (trackWork.getTimeMUS().getTimeStamp() - mSigmaTimeCut * trackWork.getTimeMUS().getTimeStampError()) * 1.E6; <span class="comment">// minimum time in ps</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">float</span> maxTrkTime = (trackWork.getTimeMUS().getTimeStamp() + mSigmaTimeCut * trackWork.getTimeMUS().getTimeStampError()) * 1.E6; <span class="comment">// maximum time in ps</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordtype">int</span> istep = 1;                                                                                                                  <span class="comment">// number of steps</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">float</span> step = 1.0;                                                                                                               <span class="comment">// step size in cm</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                                                                                                                    <span class="comment">//uncomment for local debug</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                                                                                                                                    <span class="comment">/*</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">                                //trefTrk.getXYZGlo(posBeforeProp);</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">                                //float posBeforeProp[3] = {trefTrk.getX(), trefTrk.getY(), trefTrk.getZ()}; // in local ref system</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">                                //printf(&quot;Global coordinates: posBeforeProp[0] = %f, posBeforeProp[1] = %f, posBeforeProp[2] = %f\n&quot;, posBeforeProp[0], posBeforeProp[1], posBeforeProp[2]);</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">                                //Printf(&quot;Radius xy = %f&quot;, TMath::Sqrt(posBeforeProp[0]*posBeforeProp[0] + posBeforeProp[1]*posBeforeProp[1]));</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">                                //Printf(&quot;Radius xyz = %f&quot;, TMath::Sqrt(posBeforeProp[0]*posBeforeProp[0] + posBeforeProp[1]*posBeforeProp[1] + posBeforeProp[2]*posBeforeProp[2]));</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">                                */</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#ifdef _ALLOW_TOF_DEBUG_</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span> (mDBGFlags) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      (*mDBGOut) &lt;&lt; <span class="stringliteral">&quot;propOK&quot;</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;track=&quot;</span> &lt;&lt; trefTrk &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    }</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">// initializing</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; 2; ii++) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iii = 0; iii &lt; 5; iii++) {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        detId[ii][iii] = -1;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordtype">int</span> detIdTemp[5] = {-1, -1, -1, -1, -1}; <span class="comment">// TOF detector id at the current propagation point</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordtype">double</span> reachedPoint = mXRef + istep * step;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">while</span> (propagateToRefX(trefTrk, reachedPoint, step, intLT) &amp;&amp; nStripsCrossedInPropagation &lt;= 2 &amp;&amp; reachedPoint &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a000efecc96630d8606c3506b0f04e6fa">Geo::RMAX</a>) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">// while (o2::base::Propagator::Instance()-&gt;PropagateToXBxByBz(trefTrk,  mXRef + istep * step, o2::constants::physics::MassPionCharged, MAXSNP, step, 1, &amp;intLT) &amp;&amp; nStripsCrossedInPropagation &lt;= 2 &amp;&amp; mXRef + istep * step &lt; Geo::RMAX) {</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      trefTrk.getXYZGlo(pos);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; 3; ii++) { <span class="comment">// we need to change the type...</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        posFloat[ii] = pos[ii];</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="comment">// uncomment below only for local debug; this will produce A LOT of output - one print per propagation step</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">      Printf(&quot;posFloat[0] = %f, posFloat[1] = %f, posFloat[2] = %f&quot;, posFloat[0], posFloat[1], posFloat[2]);</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">      Printf(&quot;radius xy = %f&quot;, TMath::Sqrt(posFloat[0]*posFloat[0] + posFloat[1]*posFloat[1]));</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">      Printf(&quot;radius xyz = %f&quot;, TMath::Sqrt(posFloat[0]*posFloat[0] + posFloat[1]*posFloat[1] + posFloat[2]*posFloat[2]));</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idet = 0; idet &lt; 5; idet++)</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        detIdTemp[idet] = -1;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a28112f1c44aa9ed486cb34f29b1b87ef">Geo::getPadDxDyDz</a>(posFloat, detIdTemp, deltaPosTemp);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">if</span> (detIdTemp[2] == -1) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        reachedPoint += step;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="comment">// to reduce the active region of the strip -&gt; uncomment these lines</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">// float yresidual = TMath::Abs(deltaPosTemp[1]);</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="comment">// if(yresidual &gt; 0.55){</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="comment">//  reachedPoint += step;</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">//  continue;</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="comment">// }</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="comment">//      printf(&quot;res %f %f %f -- %f %f %f (%d)\n&quot;,deltaPosTemp[0],deltaPosTemp[1],deltaPosTemp[2],pos[0],pos[1],pos[2],detIdTemp[2]);</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="comment">// if you want to exit from the strip matched uncomment this line</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="comment">//      reachedPoint += 3.0; // go out from the strip at the next step</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="comment">//      printf(&quot;idet: %d %d %d %d %d\n&quot;,detIdTemp[0],detIdTemp[1],detIdTemp[2],detIdTemp[3],detIdTemp[4]);</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="comment">// uncomment below only for local debug; this will produce A LOT of output - one print per propagation step</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">//Printf(&quot;detIdTemp[0] = %d, detIdTemp[1] = %d, detIdTemp[2] = %d, detIdTemp[3] = %d, detIdTemp[4] = %d&quot;, detIdTemp[0], detIdTemp[1], detIdTemp[2], detIdTemp[3], detIdTemp[4]);</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="comment">// if (nStripsCrossedInPropagation == 0) { // print in case you have a useful propagation</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;*********** We have crossed a strip during propagation!*********&quot;;</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;Global coordinates: pos[0] = &quot; &lt;&lt; pos[0] &lt;&lt; &quot;, pos[1] = &quot; &lt;&lt; pos[1] &lt;&lt; &quot;, pos[2] = &quot; &lt;&lt; pos[2];</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;detIdTemp[0] = &quot; &lt;&lt; detIdTemp[0] &lt;&lt; &quot;, detIdTemp[1] = &quot; &lt;&lt; detIdTemp[1] &lt;&lt; &quot;, detIdTemp[2] = &quot; &lt;&lt; detIdTemp[2] &lt;&lt; &quot;, detIdTemp[3] = &quot; &lt;&lt; detIdTemp[3] &lt;&lt; &quot;, detIdTemp[4] = &quot; &lt;&lt; detIdTemp[4];</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;deltaPosTemp[0] = &quot; &lt;&lt; deltaPosTemp[0] &lt;&lt; &quot;, deltaPosTemp[1] = &quot; &lt;&lt; deltaPosTemp[1] &lt;&lt; &quot; deltaPosTemp[2] = &quot; &lt;&lt; deltaPosTemp[2];</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// } else {</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;*********** We have NOT crossed a strip during propagation!*********&quot;;</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;Global coordinates: pos[0] = &quot; &lt;&lt; pos[0] &lt;&lt; &quot;, pos[1] = &quot; &lt;&lt; pos[1] &lt;&lt; &quot;, pos[2] = &quot; &lt;&lt; pos[2];</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;detIdTemp[0] = &quot; &lt;&lt; detIdTemp[0] &lt;&lt; &quot;, detIdTemp[1] = &quot; &lt;&lt; detIdTemp[1] &lt;&lt; &quot;, detIdTemp[2] = &quot; &lt;&lt; detIdTemp[2] &lt;&lt; &quot;, detIdTemp[3] = &quot; &lt;&lt; detIdTemp[3] &lt;&lt; &quot;, detIdTemp[4] = &quot; &lt;&lt; detIdTemp[4];</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;deltaPosTemp[0] = &quot; &lt;&lt; deltaPosTemp[0] &lt;&lt; &quot;, deltaPosTemp[1] = &quot; &lt;&lt; deltaPosTemp[1] &lt;&lt; &quot; deltaPosTemp[2] = &quot; &lt;&lt; deltaPosTemp[2];</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="comment">// }</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="comment">// check if after the propagation we are in a TOF strip</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">// we ended in a TOF strip</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">// LOG(DEBUG) &lt;&lt; &quot;nStripsCrossedInPropagation = &quot; &lt;&lt; nStripsCrossedInPropagation &lt;&lt; &quot;, detId[nStripsCrossedInPropagation][0] = &quot; &lt;&lt; detId[nStripsCrossedInPropagation][0] &lt;&lt; &quot;, detIdTemp[0] = &quot; &lt;&lt; detIdTemp[0] &lt;&lt; &quot;, detId[nStripsCrossedInPropagation][1] = &quot; &lt;&lt; detId[nStripsCrossedInPropagation][1] &lt;&lt; &quot;, detIdTemp[1] = &quot; &lt;&lt; detIdTemp[1] &lt;&lt; &quot;, detId[nStripsCrossedInPropagation][2] = &quot; &lt;&lt; detId[nStripsCrossedInPropagation][2] &lt;&lt; &quot;, detIdTemp[2] = &quot; &lt;&lt; detIdTemp[2];</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordflow">if</span> (nStripsCrossedInPropagation == 0 ||                                                                                                                                                                                            <span class="comment">// we are crossing a strip for the first time...</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;          (nStripsCrossedInPropagation &gt;= 1 &amp;&amp; (detId[nStripsCrossedInPropagation - 1][0] != detIdTemp[0] || detId[nStripsCrossedInPropagation - 1][1] != detIdTemp[1] || detId[nStripsCrossedInPropagation - 1][2] != detIdTemp[2]))) { <span class="comment">// ...or we are crossing a new strip</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">if</span> (nStripsCrossedInPropagation == 0)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          <span class="comment">// LOG(DEBUG) &lt;&lt; &quot;We cross a strip for the first time&quot;;</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          <span class="keywordflow">if</span> (nStripsCrossedInPropagation == 2) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="keywordflow">break</span>; <span class="comment">// we have already matched 2 strips, we cannot match more</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;          }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        nStripsCrossedInPropagation++;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="comment">//Printf(&quot;nStepsInsideSameStrip[nStripsCrossedInPropagation-1] = %d&quot;, nStepsInsideSameStrip[nStripsCrossedInPropagation - 1]);</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">if</span> (nStepsInsideSameStrip[nStripsCrossedInPropagation - 1] == 0) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        detId[nStripsCrossedInPropagation - 1][0] = detIdTemp[0];</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        detId[nStripsCrossedInPropagation - 1][1] = detIdTemp[1];</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        detId[nStripsCrossedInPropagation - 1][2] = detIdTemp[2];</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        detId[nStripsCrossedInPropagation - 1][3] = detIdTemp[3];</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        detId[nStripsCrossedInPropagation - 1][4] = detIdTemp[4];</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        deltaPos[nStripsCrossedInPropagation - 1][0] = deltaPosTemp[0];</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        deltaPos[nStripsCrossedInPropagation - 1][1] = deltaPosTemp[1];</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        deltaPos[nStripsCrossedInPropagation - 1][2] = deltaPosTemp[2];</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        trkLTInt[nStripsCrossedInPropagation - 1] = intLT;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="comment">//          Printf(&quot;intLT (after matching to strip %d): length = %f, time (Pion) = %f&quot;, nStripsCrossedInPropagation - 1, trkLTInt[nStripsCrossedInPropagation - 1].getL(), trkLTInt[nStripsCrossedInPropagation - 1].getTOF(o2::track::PID::Pion));</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        nStepsInsideSameStrip[nStripsCrossedInPropagation - 1]++;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">// a further propagation step in the same strip -&gt; update info (we sum up on all matching with strip - we will divide for the number of steps a bit below)</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="comment">// N.B. the integrated length and time are taken (at least for now) from the first time we crossed the strip, so here we do nothing with those</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        deltaPos[nStripsCrossedInPropagation - 1][0] += deltaPosTemp[0] + (detIdTemp[4] - detId[nStripsCrossedInPropagation - 1][4]) * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>; <span class="comment">// residual in x</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        deltaPos[nStripsCrossedInPropagation - 1][1] += deltaPosTemp[1];                                                                          <span class="comment">// residual in y</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        deltaPos[nStripsCrossedInPropagation - 1][2] += deltaPosTemp[2] + (detIdTemp[3] - detId[nStripsCrossedInPropagation - 1][3]) * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>; <span class="comment">// residual in z</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        nStepsInsideSameStrip[nStripsCrossedInPropagation - 1]++;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="comment">//    LOG(DEBUG) &lt;&lt; &quot;while done, we propagated track &quot; &lt;&lt; itrk &lt;&lt; &quot; in %d strips&quot; &lt;&lt; nStripsCrossedInPropagation;</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="comment">//    LOG(INFO) &lt;&lt; &quot;while done, we propagated track &quot; &lt;&lt; itrk &lt;&lt; &quot; in %d strips&quot; &lt;&lt; nStripsCrossedInPropagation;</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// uncomment for debug purposes, to check tracks that did not cross any strip</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">    if (nStripsCrossedInPropagation == 0) {</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">      auto labelTPCNoStripsCrossed = mTPCLabels-&gt;at(mTracksSectIndexCache[sec][itrk]);    </span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">      Printf(&quot;The current track (index = %d) never crossed a strip&quot;, cacheTrk[itrk]);</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">      Printf(&quot;TrackID = %d, EventID = %d, SourceID = %d&quot;, labelTPCNoStripsCrossed.getTrackID(), labelTPCNoStripsCrossed.getEventID(), labelTPCNoStripsCrossed.getSourceID());</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">      printf(&quot;Global coordinates: pos[0] = %f, pos[1] = %f, pos[2] = %f\n&quot;, pos[0], pos[1], pos[2]);</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">      printf(&quot;detIdTemp[0] = %d, detIdTemp[1] = %d, detIdTemp[2] = %d, detIdTemp[3] = %d, detIdTemp[4] = %d\n&quot;, detIdTemp[0], detIdTemp[1], detIdTemp[2], detIdTemp[3], detIdTemp[4]);</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">      printf(&quot;deltaPosTemp[0] = %f, deltaPosTemp[1] = %f, deltaPosTemp[2] = %f\n&quot;, deltaPosTemp[0], deltaPosTemp[1], deltaPosTemp[2]);</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">for</span> (Int_t imatch = 0; imatch &lt; nStripsCrossedInPropagation; imatch++) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">// we take as residual the average of the residuals along the propagation in the same strip</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      deltaPos[imatch][0] /= nStepsInsideSameStrip[imatch];</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      deltaPos[imatch][1] /= nStepsInsideSameStrip[imatch];</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      deltaPos[imatch][2] /= nStepsInsideSameStrip[imatch];</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="comment">//   LOG(DEBUG) &lt;&lt; &quot;matched strip &quot; &lt;&lt; imatch &lt;&lt; &quot;: deltaPos[0] = &quot; &lt;&lt; deltaPos[imatch][0] &lt;&lt; &quot;, deltaPos[1] = &quot; &lt;&lt; deltaPos[imatch][1] &lt;&lt; &quot;, deltaPos[2] = &quot; &lt;&lt; deltaPos[imatch][2] &lt;&lt; &quot;, residual (x, z) = &quot; &lt;&lt; TMath::Sqrt(deltaPos[imatch][0] * deltaPos[imatch][0] + deltaPos[imatch][2] * deltaPos[imatch][2]);</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (nStripsCrossedInPropagation == 0) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// the track never hit a TOF strip during the propagation</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordtype">bool</span> foundCluster = <span class="keyword">false</span>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itof = itof0; itof &lt; nTOFCls; itof++) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">//      printf(&quot;itof = %d\n&quot;, itof);</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keyword">auto</span>&amp; trefTOF = mTOFClusWork[cacheTOF[itof]];</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">// compare the times of the track and the TOF clusters - remember that they both are ordered in time!</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">//Printf(&quot;trefTOF.getTime() = %f, maxTrkTime = %f, minTrkTime = %f&quot;, trefTOF.getTime(), maxTrkTime, minTrkTime);</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordflow">if</span> (trefTOF.getTime() &lt; minTrkTime) { <span class="comment">// this cluster has a time that is too small for the current track, we will get to the next one</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="comment">//Printf(&quot;In trefTOF.getTime() &lt; minTrkTime&quot;);</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        itof0 = itof + 1; <span class="comment">// but for the next track that we will check, we will ignore this cluster (the time is anyway too small)</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordflow">if</span> (trefTOF.getTime() &gt; maxTrkTime) { <span class="comment">// no more TOF clusters can be matched to this track</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="keywordtype">int</span> mainChannel = trefTOF.getMainContributingChannel();</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>[5];</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#aae11e8cb08553dfe32144fd30d96772f">Geo::getVolumeIndices</a>(mainChannel, indices);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="comment">// compute fine correction using cluster position instead of pad center</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// this because in case of multiple-hit cluster position is averaged on all pads contributing to the cluster (then error position matrix can be used for Chi2 if nedeed)</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordtype">int</span> ndigits = 1;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordtype">float</span> posCorr[3] = {0, 0, 0};</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a86f9f24e1c0be1bcec9d48510c73f8a3">Cluster::kLeft</a>))</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        posCorr[0] += <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>, ndigits++;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a82254aeef8a3fa166f14746d732a6bbd">Cluster::kUpLeft</a>))</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        posCorr[0] += <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>, posCorr[2] -= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>, ndigits++;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639ac5975ababc183f62dde2f0a6571cac1f">Cluster::kDownLeft</a>))</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        posCorr[0] += <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>, posCorr[2] += <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>, ndigits++;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a88aaa69cdf7b51c6fc94000ebe716210">Cluster::kUp</a>))</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        posCorr[2] -= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>, ndigits++;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639ac698a0e79dcc7db29fe5f7aaeedc1aa7">Cluster::kDown</a>))</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        posCorr[2] += <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>, ndigits++;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639aa158566cc0fb948b50d01cda667d72e5">Cluster::kRight</a>))</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        posCorr[0] -= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>, ndigits++;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639aafdcaf151e613d069d5a11114f4cf86b">Cluster::kUpRight</a>))</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        posCorr[0] -= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>, posCorr[2] -= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>, ndigits++;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="keywordflow">if</span> (trefTOF.isBitSet(<a class="code" href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a562cb0ccfc2d527272d6fbbfd41c2315">Cluster::kDownRight</a>))</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        posCorr[0] -= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a>, posCorr[2] += <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a>, ndigits++;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">if</span> (ndigits &gt; 1) {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        posCorr[0] /= ndigits;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        posCorr[1] /= ndigits;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        posCorr[2] /= ndigits;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordtype">int</span> trackIdTOF;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordtype">int</span> eventIdTOF;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordtype">int</span> sourceIdTOF;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> iPropagation = 0; iPropagation &lt; nStripsCrossedInPropagation; iPropagation++) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;TOF Cluster [&quot;</span> &lt;&lt; itof &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cacheTOF[itof] &lt;&lt; <span class="stringliteral">&quot;]:      indices   = &quot;</span> &lt;&lt; indices[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; indices[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; indices[2] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; indices[3] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; indices[4];</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Propagated Track [&quot;</span> &lt;&lt; itrk &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cacheTrk[itrk] &lt;&lt; <span class="stringliteral">&quot;]: detId[&quot;</span> &lt;&lt; iPropagation &lt;&lt; <span class="stringliteral">&quot;]  = &quot;</span> &lt;&lt; detId[iPropagation][0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; detId[iPropagation][1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; detId[iPropagation][2] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; detId[iPropagation][3] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; detId[iPropagation][4];</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordtype">float</span> resX = deltaPos[iPropagation][0] - (indices[4] - detId[iPropagation][4]) * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">Geo::XPAD</a> + posCorr[0]; <span class="comment">// readjusting the residuals due to the fact that the propagation fell in a pad that was not exactly the one of the cluster</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordtype">float</span> resZ = deltaPos[iPropagation][2] - (indices[3] - detId[iPropagation][3]) * <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">Geo::ZPAD</a> + posCorr[2]; <span class="comment">// readjusting the residuals due to the fact that the propagation fell in a pad that was not exactly the one of the cluster</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordtype">float</span> res = TMath::Sqrt(resX * resX + resZ * resZ);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;resX = &quot;</span> &lt;&lt; resX &lt;&lt; <span class="stringliteral">&quot;, resZ = &quot;</span> &lt;&lt; resZ &lt;&lt; <span class="stringliteral">&quot;, res = &quot;</span> &lt;&lt; res;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#ifdef _ALLOW_TOF_DEBUG_</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a91bb4fd179a351fc61650c40127ce49a">fillTOFmatchTree</a>(<span class="stringliteral">&quot;match0&quot;</span>, cacheTOF[itof], indices[0], indices[1], indices[2], indices[3], indices[4], cacheTrk[itrk], iPropagation, detId[iPropagation][0], detId[iPropagation][1], detId[iPropagation][2], detId[iPropagation][3], detId[iPropagation][4], resX, resZ, res, trackWork, trkLTInt[iPropagation].getL(), trkLTInt[iPropagation].getTOF(<a class="code" href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a>), trefTOF.getTime());</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordtype">int</span> tofLabelTrackID[3] = {-1, -1, -1};</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordtype">int</span> tofLabelEventID[3] = {-1, -1, -1};</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordtype">int</span> tofLabelSourceID[3] = {-1, -1, -1};</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span>&amp; labelsTOF = mTOFClusLabels.<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">getLabels</a>(mTOFClusSectIndexCache[indices[0]][itof]);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilabel = 0; ilabel &lt; labelsTOF.size(); ilabel++) {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            tofLabelTrackID[ilabel] = labelsTOF[ilabel].getTrackID();</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            tofLabelEventID[ilabel] = labelsTOF[ilabel].getEventID();</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            tofLabelSourceID[ilabel] = labelsTOF[ilabel].getSourceID();</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <span class="keyword">auto</span> labelTPC = mTPCLabels[mTracksSectIndexCache[sec][itrk]];</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          <span class="keyword">auto</span> labelITS = mITSLabels[mTracksSectIndexCache[indices[0]][itrk]];</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a523b32e5a47b14511faffe311a9af094">fillTOFmatchTreeWithLabels</a>(<span class="stringliteral">&quot;matchPossibleWithLabels&quot;</span>, cacheTOF[itof], indices[0], indices[1], indices[2], indices[3], indices[4], cacheTrk[itrk], iPropagation, detId[iPropagation][0], detId[iPropagation][1], detId[iPropagation][2], detId[iPropagation][3], detId[iPropagation][4], resX, resZ, res, trackWork, labelTPC.getTrackID(), labelTPC.getEventID(), labelTPC.getSourceID(), labelITS.getTrackID(), labelITS.getEventID(), labelITS.getSourceID(), tofLabelTrackID[0], tofLabelEventID[0], tofLabelSourceID[0], tofLabelTrackID[1], tofLabelEventID[1], tofLabelSourceID[1], tofLabelTrackID[2], tofLabelEventID[2], tofLabelSourceID[2], trkLTInt[iPropagation].<a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#ab45082e158199df11e8935082a1ee6fc">getL</a>(), trkLTInt[iPropagation].<a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#a73a8177aefca6b7ced28d90e64967ffc">getTOF</a>(<a class="code" href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a>), trefTOF.getTime());</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">if</span> (indices[0] != detId[iPropagation][0])</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">if</span> (indices[1] != detId[iPropagation][1])</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span> (indices[2] != detId[iPropagation][2])</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordtype">float</span> chi2 = res; <span class="comment">// TODO: take into account also the time!</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="preprocessor">#ifdef _ALLOW_TOF_DEBUG_</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a91bb4fd179a351fc61650c40127ce49a">fillTOFmatchTree</a>(<span class="stringliteral">&quot;match1&quot;</span>, cacheTOF[itof], indices[0], indices[1], indices[2], indices[3], indices[4], cacheTrk[itrk], iPropagation, detId[iPropagation][0], detId[iPropagation][1], detId[iPropagation][2], detId[iPropagation][3], detId[iPropagation][4], resX, resZ, res, trackWork, trkLTInt[iPropagation].getL(), trkLTInt[iPropagation].getTOF(<a class="code" href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a>), trefTOF.getTime());</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          <span class="keyword">auto</span> labelTPC = mTPCLabels[mTracksSectIndexCache[sec][itrk]];</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          <span class="keyword">auto</span> labelITS = mITSLabels[mTracksSectIndexCache[indices[0]][itrk]];</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a523b32e5a47b14511faffe311a9af094">fillTOFmatchTreeWithLabels</a>(<span class="stringliteral">&quot;matchOkWithLabels&quot;</span>, cacheTOF[itof], indices[0], indices[1], indices[2], indices[3], indices[4], cacheTrk[itrk], iPropagation, detId[iPropagation][0], detId[iPropagation][1], detId[iPropagation][2], detId[iPropagation][3], detId[iPropagation][4], resX, resZ, res, trackWork, labelTPC.getTrackID(), labelTPC.getEventID(), labelTPC.getSourceID(), labelITS.getTrackID(), labelITS.getEventID(), labelITS.getSourceID(), tofLabelTrackID[0], tofLabelEventID[0], tofLabelSourceID[0], tofLabelTrackID[1], tofLabelEventID[1], tofLabelSourceID[1], tofLabelTrackID[2], tofLabelEventID[2], tofLabelSourceID[2], trkLTInt[iPropagation].<a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#ab45082e158199df11e8935082a1ee6fc">getL</a>(), trkLTInt[iPropagation].<a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#a73a8177aefca6b7ced28d90e64967ffc">getTOF</a>(<a class="code" href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a>), trefTOF.getTime());</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        }</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">if</span> (res &lt; mSpaceTolerance) { <span class="comment">// matching ok!</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;MATCHING FOUND: We have a match! between track &quot;</span> &lt;&lt; mTracksSectIndexCache[indices[0]][itrk] &lt;&lt; <span class="stringliteral">&quot; and TOF cluster &quot;</span> &lt;&lt; mTOFClusSectIndexCache[indices[0]][itof];</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          foundCluster = <span class="keyword">true</span>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;          <span class="comment">// set event indexes (to be checked)</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;          <a class="code" href="../../d2/d74/classo2_1_1dataformats_1_1EvIndex.html">evIdx</a> eventIndexTOFCluster(trefTOF.getEntryInTree(), mTOFClusSectIndexCache[indices[0]][itof]);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          <a class="code" href="../../d2/d74/classo2_1_1dataformats_1_1EvIndex.html">evIdx</a> eventIndexTracks(mCurrTracksTreeEntry, mTracksSectIndexCache[indices[0]][itrk]);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          mMatchedTracksPairs.emplace_back(<a class="code" href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html">o2::dataformats::MatchInfoTOF</a>(eventIndexTOFCluster, chi2, trkLTInt[iPropagation], eventIndexTracks)); <span class="comment">// TODO: check if this is correct!</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#ifdef _ALLOW_TOF_DEBUG_</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; labelsTOF = mTOFClusLabels.<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">getLabels</a>(mTOFClusSectIndexCache[indices[0]][itof]);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keyword">auto</span> labelTPC = mTPCLabels[mTracksSectIndexCache[sec][itrk]];</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="keyword">auto</span> labelITS = mITSLabels[mTracksSectIndexCache[indices[0]][itrk]];</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilabel = 0; ilabel &lt; labelsTOF.size(); ilabel++) {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;              <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;TOF label &quot;</span> &lt;&lt; ilabel &lt;&lt; labelsTOF[ilabel];</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;TPC label &quot;</span> &lt;&lt; labelTPC;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;ITS label &quot;</span> &lt;&lt; labelITS;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a523b32e5a47b14511faffe311a9af094">fillTOFmatchTreeWithLabels</a>(<span class="stringliteral">&quot;matchOkWithLabelsInSpaceTolerance&quot;</span>, cacheTOF[itof], indices[0], indices[1], indices[2], indices[3], indices[4], cacheTrk[itrk], iPropagation, detId[iPropagation][0], detId[iPropagation][1], detId[iPropagation][2], detId[iPropagation][3], detId[iPropagation][4], resX, resZ, res, trackWork, labelTPC.getTrackID(), labelTPC.getEventID(), labelTPC.getSourceID(), labelITS.getTrackID(), labelITS.getEventID(), labelITS.getSourceID(), tofLabelTrackID[0], tofLabelEventID[0], tofLabelSourceID[0], tofLabelTrackID[1], tofLabelEventID[1], tofLabelSourceID[1], tofLabelTrackID[2], tofLabelEventID[2], tofLabelSourceID[2], trkLTInt[iPropagation].<a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#ab45082e158199df11e8935082a1ee6fc">getL</a>(), trkLTInt[iPropagation].<a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#a73a8177aefca6b7ced28d90e64967ffc">getTOF</a>(<a class="code" href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a>), trefTOF.getTime());</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          }</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        }</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (!foundCluster &amp;&amp; mMCTruthON) {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="keyword">auto</span> labelTPC = mTPCLabels[mTracksSectIndexCache[sec][itrk]];</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;We did not find any TOF cluster for track &quot;</span> &lt;&lt; cacheTrk[itrk] &lt;&lt; <span class="stringliteral">&quot; (label = &quot;</span> &lt;&lt; labelTPC &lt;&lt; <span class="stringliteral">&quot;, pt = &quot;</span> &lt;&lt; trefTrk.getPt();</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;}</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a904fd6012a0417eedecd3a6b2e18e492">  857</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a904fd6012a0417eedecd3a6b2e18e492">MatchTOF::findFITIndex</a>(<span class="keywordtype">int</span> bc)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;{</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">if</span> (mFITRecPoints.size() == 0) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a> = -1;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordtype">int</span> distMax = 5; <span class="comment">// require bc distance below 5</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mFITRecPoints.size(); <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d1/d21/structo2_1_1InteractionRecord.html">o2::InteractionRecord</a> ir = mFITRecPoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getInteractionRecord();</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordtype">int</span> bct0 = ir.<a class="code" href="../../d1/d21/structo2_1_1InteractionRecord.html#a2b9e5a5520c4d6dfd8d8df796b50291a">orbit</a> * o2::constants::lhc::LHCMaxBunches + ir.<a class="code" href="../../d1/d21/structo2_1_1InteractionRecord.html#a4dd7d03ed59d92173589ba61165873ab">bc</a>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordtype">int</span> dist = bc - bct0;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">if</span> (dist &lt; 0 || dist &gt; distMax)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    distMax = dist;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    index = <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;}</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keywordtype">void</span> MatchTOF::selectBestMatches()</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;{</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  printf(<span class="stringliteral">&quot;Number of pair matched = %lu\n&quot;</span>, mMatchedTracksPairs.size());</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// first, we sort according to the chi2</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  std::sort(mMatchedTracksPairs.begin(), mMatchedTracksPairs.end(), [<span class="keyword">this</span>](<a class="code" href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html">o2::dataformats::MatchInfoTOF</a>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <a class="code" href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html">o2::dataformats::MatchInfoTOF</a>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>) { <span class="keywordflow">return</span> (a.<a class="code" href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html#ab30f6949ee1044db93886da6852205f2">getChi2</a>() &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>.getChi2()); });</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="comment">// then we take discard the pairs if their track or cluster was already matched (since they are ordered in chi2, we will take the best matching)</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html">o2::dataformats::MatchInfoTOF</a>&amp; matchingPair : mMatchedTracksPairs) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span> (mMatchedTracksIndex[matchingPair.getTrackIndex()] != -1) { <span class="comment">// the track was already filled</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">if</span> (mMatchedClustersIndex[matchingPair.getTOFClIndex()] != -1) { <span class="comment">// the track was already filled</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    mMatchedTracksIndex[matchingPair.getTrackIndex()] = mMatchedTracks.size();                               <span class="comment">// index of the MatchInfoTOF correspoding to this track</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    mMatchedClustersIndex[matchingPair.getTOFClIndex()] = mMatchedTracksIndex[matchingPair.getTrackIndex()]; <span class="comment">// index of the track that was matched to this cluster</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    mMatchedTracks.push_back(matchingPair);                                                                  <span class="comment">// array of MatchInfoTOF</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="comment">// get fit info</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordtype">double</span> t0info = 0;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> (mFITRecPoints.size() &gt; 0) {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a> = <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a904fd6012a0417eedecd3a6b2e18e492">findFITIndex</a>(mTOFClusWork[matchingPair.getTOFClIndex()].getBC());</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">if</span> (index &gt; -1) {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <a class="code" href="../../d1/d21/structo2_1_1InteractionRecord.html">o2::InteractionRecord</a> ir = mFITRecPoints[<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>].getInteractionRecord();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        t0info = ir.<a class="code" href="../../d1/d21/structo2_1_1InteractionRecord.html#a609f431faab116789c96d3f8ef1cd703">bc2ns</a>() * 1E3;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="comment">// add also calibration infos</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    mCalibInfoTOF.emplace_back(mTOFClusWork[matchingPair.getTOFClIndex()].getMainContributingChannel(),</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                               <a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>(mTOFClusWork[matchingPair.getTOFClIndex()].getTimeRaw() * 1E12), <span class="comment">// add time stamp</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                               mTOFClusWork[matchingPair.getTOFClIndex()].getTimeRaw() - matchingPair.getLTIntegralOut().getTOF(<a class="code" href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a>) - t0info,</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                               mTOFClusWork[matchingPair.getTOFClIndex()].getTot());</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">if</span> (mMCTruthON) {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; labelsTOF = mTOFClusLabels.<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">getLabels</a>(matchingPair.getTOFClIndex());</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; labelTPC = mTPCLabels[matchingPair.getTrackIndex()];</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; labelITS = mITSLabels[matchingPair.getTrackIndex()];</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="comment">// we want to store positive labels independently of how they are flagged from TPC,ITS people</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="comment">//    o2::MCCompLabel labelTPC(abs(labelTPCor.getTrackID()), labelTPCor.getEventID(), labelTPCor.getSourceID());</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="comment">//    o2::MCCompLabel labelITS(abs(labelITSor.getTrackID()), labelITSor.getEventID(), labelITSor.getSourceID());</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;TPC label&quot;</span> &lt;&lt; labelTPC;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;ITS label&quot;</span> &lt;&lt; labelITS;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordtype">bool</span> labelOk = <span class="keyword">false</span>; <span class="comment">// whether we have found or not the same TPC label of the track among the labels of the TOF cluster</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilabel = 0; ilabel &lt; labelsTOF.size(); ilabel++) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;TOF label &quot;</span> &lt;&lt; ilabel &lt;&lt; labelsTOF[ilabel];</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">if</span> (labelsTOF[ilabel].getTrackID() == labelTPC.getTrackID() &amp;&amp; labelsTOF[ilabel].getEventID() == labelTPC.getEventID() &amp;&amp; labelsTOF[ilabel].getSourceID() == labelTPC.getSourceID() &amp;&amp; !labelOk) { <span class="comment">// if we find one TOF cluster label that is the same as the TPC one, we are happy - even if it is not the first one</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          mOutTOFLabels.push_back(labelsTOF[ilabel]);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;          labelOk = <span class="keyword">true</span>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        }</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      }</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordflow">if</span> (!labelOk) {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">// we have not found the track label among those associated to the TOF cluster --&gt; fake match! We will associate the label of the main channel, but negative</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="comment">//assert(labelsTOF.size());</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span> (!labelsTOF.size())</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;          <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;TOF label not found since size of label is zero. This should not happen!!!!&quot;</span>);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        mOutTOFLabels.emplace_back(labelsTOF[0].getTrackID(), labelsTOF[0].getEventID(), labelsTOF[0].getSourceID(), <span class="keyword">true</span>);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      }</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      mOutTPCLabels.push_back(labelTPC);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      mOutITSLabels.push_back(labelITS);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    i++;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;}</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="keywordtype">bool</span> MatchTOF::propagateToRefX(<a class="code" href="../../de/dea/classo2_1_1track_1_1TrackParCov.html">o2::track::TrackParCov</a>&amp; trc, <span class="keywordtype">float</span> xRef, <span class="keywordtype">float</span> stepInCm, <a class="code" href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html">o2::track::TrackLTIntegral</a>&amp; intLT)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;{</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">// propagate track to matching reference X</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> matCorr = 1; <span class="comment">// material correction method</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> tanHalfSector = tan(<a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a516697a93488937eacca106d81549190">o2::constants::math::SectorSpanRad</a> / 2);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordtype">bool</span> refReached = <span class="keyword">false</span>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordtype">float</span> xStart = trc.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">getX</a>();</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="comment">// the first propagation will be from 2m, if the track is not at least at 2m</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keywordflow">if</span> (xStart &lt; 50.)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    xStart = 50.;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordtype">int</span> istep = 1;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordtype">bool</span> hasPropagated = <a class="code" href="../../da/d02/classo2_1_1base_1_1Propagator.html#a576b7b1cbb8cba5aac51864e44838715">o2::base::Propagator::Instance</a>()-&gt;<a class="code" href="../../da/d02/classo2_1_1base_1_1Propagator.html#a7344af8e3f34fcd3c5d55769c12af67d">PropagateToXBxByBz</a>(trc, xStart + istep * stepInCm, <a class="code" href="../../d7/df9/namespaceo2_1_1constants_1_1physics.html#a3d71e0c604f1baec02d3f1ac76b07fdf">o2::constants::physics::MassPionCharged</a>, MAXSNP, stepInCm, matCorr, &amp;intLT);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keywordflow">while</span> (hasPropagated) {</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordflow">if</span> (trc.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">getX</a>() &gt; xRef) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      refReached = <span class="keyword">true</span>; <span class="comment">// we reached the 371cm reference</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    }</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    istep++;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">if</span> (fabs(trc.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#af652798c666d6a27ae08b3b8471b1fb2">getY</a>()) &gt; trc.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">getX</a>() * tanHalfSector) { <span class="comment">// we are still in the same sector</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="comment">// we need to rotate the track to go to the new sector</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="comment">//Printf(&quot;propagateToRefX: changing sector&quot;);</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="keyword">auto</span> alphaNew = <a class="code" href="../../d0/d28/namespaceo2_1_1utils.html#a2748d6e3cfed410c77bab14937344c1b">o2::utils::Angle2Alpha</a>(trc.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a5ec46402e2549dab234a63ba9b104070">getPhiPos</a>());</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="keywordflow">if</span> (!trc.<a class="code" href="../../de/dea/classo2_1_1track_1_1TrackParCov.html#ac380d046f56fca7e064879c67bb6e59e">rotate</a>(alphaNew) != 0) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="comment">//  Printf(&quot;propagateToRefX: failed to rotate&quot;);</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordflow">break</span>; <span class="comment">// failed (this line is taken from MatchTPCITS and the following comment too: RS: check effect on matching tracks to neighbouring sector)</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">if</span> (refReached)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    hasPropagated = <a class="code" href="../../da/d02/classo2_1_1base_1_1Propagator.html#a576b7b1cbb8cba5aac51864e44838715">o2::base::Propagator::Instance</a>()-&gt;<a class="code" href="../../da/d02/classo2_1_1base_1_1Propagator.html#a7344af8e3f34fcd3c5d55769c12af67d">PropagateToXBxByBz</a>(trc, xStart + istep * stepInCm, <a class="code" href="../../d7/df9/namespaceo2_1_1constants_1_1physics.html#a3d71e0c604f1baec02d3f1ac76b07fdf">o2::constants::physics::MassPionCharged</a>, MAXSNP, stepInCm, matCorr, &amp;intLT);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="comment">//  if (std::abs(trc.getSnp()) &gt; MAXSNP) Printf(&quot;propagateToRefX: condition on snp not ok, returning false&quot;);</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">//Printf(&quot;propagateToRefX: snp of teh track is %f (--&gt; %f grad)&quot;, trc.getSnp(), TMath::ASin(trc.getSnp())*TMath::RadToDeg());</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">return</span> refReached &amp;&amp; std::abs(trc.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#ac698f8aec46327dace416c5b1a7f3ffa">getSnp</a>()) &lt; 0.95; <span class="comment">// Here we need to put MAXSNP</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;}</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="keywordtype">bool</span> MatchTOF::propagateToRefXWithoutCov(<a class="code" href="../../de/dea/classo2_1_1track_1_1TrackParCov.html">o2::track::TrackParCov</a>&amp; trc, <span class="keywordtype">float</span> xRef, <span class="keywordtype">float</span> stepInCm, <span class="keywordtype">float</span> bzField)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;{</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">// propagate track to matching reference X without using the covariance matrix</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="comment">// we create the copy of the track in a TrackPar object (no cov matrix)</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html">o2::track::TrackPar</a> trcNoCov(trc);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> tanHalfSector = tan(<a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a516697a93488937eacca106d81549190">o2::constants::math::SectorSpanRad</a> / 2);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">bool</span> refReached = <span class="keyword">false</span>;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">float</span> xStart = trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">getX</a>();</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// the first propagation will be from 2m, if the track is not at least at 2m</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordflow">if</span> (xStart &lt; 50.)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    xStart = 50.;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordtype">int</span> istep = 1;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keywordtype">bool</span> hasPropagated = trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a584c78e159e907de6980abc859c3c22a">propagateParamTo</a>(xStart + istep * stepInCm, bzField);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keywordflow">while</span> (hasPropagated) {</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">if</span> (trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">getX</a>() &gt; xRef) {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      refReached = <span class="keyword">true</span>; <span class="comment">// we reached the 371cm reference</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    istep++;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">if</span> (fabs(trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#af652798c666d6a27ae08b3b8471b1fb2">getY</a>()) &gt; trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">getX</a>() * tanHalfSector) { <span class="comment">// we are still in the same sector</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <span class="comment">// we need to rotate the track to go to the new sector</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="comment">//Printf(&quot;propagateToRefX: changing sector&quot;);</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <span class="keyword">auto</span> alphaNew = <a class="code" href="../../d0/d28/namespaceo2_1_1utils.html#a2748d6e3cfed410c77bab14937344c1b">o2::utils::Angle2Alpha</a>(trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a5ec46402e2549dab234a63ba9b104070">getPhiPos</a>());</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordflow">if</span> (!trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a993c99db1579c9d65a490bf44d00da59">rotateParam</a>(alphaNew) != 0) {</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="comment">//  Printf(&quot;propagateToRefX: failed to rotate&quot;);</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">break</span>; <span class="comment">// failed (this line is taken from MatchTPCITS and the following comment too: RS: check effect on matching tracks to neighbouring sector)</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">if</span> (refReached)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    hasPropagated = trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a584c78e159e907de6980abc859c3c22a">propagateParamTo</a>(xStart + istep * stepInCm, bzField);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">//  if (std::abs(trc.getSnp()) &gt; MAXSNP) Printf(&quot;propagateToRefX: condition on snp not ok, returning false&quot;);</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="comment">//Printf(&quot;propagateToRefX: snp of teh track is %f (--&gt; %f grad)&quot;, trcNoCov.getSnp(), TMath::ASin(trcNoCov.getSnp())*TMath::RadToDeg());</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordflow">return</span> refReached &amp;&amp; std::abs(trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#ac698f8aec46327dace416c5b1a7f3ffa">getSnp</a>()) &lt; 0.95 &amp;&amp; <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(trcNoCov.<a class="code" href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a160031f72507d8777787fb8a1c0c6844">getZ</a>()) &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a89db56f98f43548aa547bb5f77071319">Geo::MAXHZTOF</a>; <span class="comment">// Here we need to put MAXSNP</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;}</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">//______________________________________________</span></div><div class="line"><a name="l01027"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#abf90e112ba5438a799232d7c7fe619c7"> 1027</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#abf90e112ba5438a799232d7c7fe619c7">MatchTOF::setDebugFlag</a>(UInt_t flag, <span class="keywordtype">bool</span> on)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;{</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">if</span> (on) {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    mDBGFlags |= flag;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    mDBGFlags &amp;= ~flag;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;}</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">//_________________________________________________________</span></div><div class="line"><a name="l01038"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a91bb4fd179a351fc61650c40127ce49a"> 1038</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a91bb4fd179a351fc61650c40127ce49a">MatchTOF::fillTOFmatchTree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* trname, <span class="keywordtype">int</span> cacheTOF, <span class="keywordtype">int</span> sectTOF, <span class="keywordtype">int</span> plateTOF, <span class="keywordtype">int</span> stripTOF, <span class="keywordtype">int</span> padXTOF, <span class="keywordtype">int</span> padZTOF, <span class="keywordtype">int</span> cacheeTrk, <span class="keywordtype">int</span> crossedStrip, <span class="keywordtype">int</span> sectPropagation, <span class="keywordtype">int</span> platePropagation, <span class="keywordtype">int</span> stripPropagation, <span class="keywordtype">int</span> padXPropagation, <span class="keywordtype">int</span> padZPropagation, <span class="keywordtype">float</span> resX, <span class="keywordtype">float</span> resZ, <span class="keywordtype">float</span> res, <a class="code" href="../../d6/d67/classo2_1_1dataformats_1_1TrackTPCITS.html">o2::dataformats::TrackTPCITS</a>&amp; trk, <span class="keywordtype">float</span> intLength, <span class="keywordtype">float</span> intTimePion, <span class="keywordtype">float</span> timeTOF)</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;{</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  mTimerDBG.Start(<span class="keyword">false</span>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="comment">//  Printf(&quot;************** Filling the debug tree with %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %f, %f, %f&quot;, cacheTOF, sectTOF, plateTOF, stripTOF, padXTOF, padZTOF, cacheeTrk, crossedStrip, sectPropagation, platePropagation, stripPropagation, padXPropagation, padZPropagation, resX, resZ, res);</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">if</span> (mDBGFlags) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    (*mDBGOut) &lt;&lt; trname</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;clusterTOF=&quot;</span> &lt;&lt; cacheTOF &lt;&lt; <span class="stringliteral">&quot;sectTOF=&quot;</span> &lt;&lt; sectTOF &lt;&lt; <span class="stringliteral">&quot;plateTOF=&quot;</span> &lt;&lt; plateTOF &lt;&lt; <span class="stringliteral">&quot;stripTOF=&quot;</span> &lt;&lt; stripTOF &lt;&lt; <span class="stringliteral">&quot;padXTOF=&quot;</span> &lt;&lt; padXTOF &lt;&lt; <span class="stringliteral">&quot;padZTOF=&quot;</span> &lt;&lt; padZTOF</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;crossedStrip=&quot;</span> &lt;&lt; crossedStrip &lt;&lt; <span class="stringliteral">&quot;sectPropagation=&quot;</span> &lt;&lt; sectPropagation &lt;&lt; <span class="stringliteral">&quot;platePropagation=&quot;</span> &lt;&lt; platePropagation &lt;&lt; <span class="stringliteral">&quot;stripPropagation=&quot;</span> &lt;&lt; stripPropagation &lt;&lt; <span class="stringliteral">&quot;padXPropagation=&quot;</span> &lt;&lt; padXPropagation</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;resX=&quot;</span> &lt;&lt; resX &lt;&lt; <span class="stringliteral">&quot;resZ=&quot;</span> &lt;&lt; resZ &lt;&lt; <span class="stringliteral">&quot;res=&quot;</span> &lt;&lt; res &lt;&lt; <span class="stringliteral">&quot;track=&quot;</span> &lt;&lt; trk &lt;&lt; <span class="stringliteral">&quot;intLength=&quot;</span> &lt;&lt; intLength &lt;&lt; <span class="stringliteral">&quot;intTimePion=&quot;</span> &lt;&lt; intTimePion &lt;&lt; <span class="stringliteral">&quot;timeTOF=&quot;</span> &lt;&lt; timeTOF &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  mTimerDBG.Stop();</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;}</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">//_________________________________________________________</span></div><div class="line"><a name="l01056"></a><span class="lineno"><a class="line" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a523b32e5a47b14511faffe311a9af094"> 1056</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a523b32e5a47b14511faffe311a9af094">MatchTOF::fillTOFmatchTreeWithLabels</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* trname, <span class="keywordtype">int</span> cacheTOF, <span class="keywordtype">int</span> sectTOF, <span class="keywordtype">int</span> plateTOF, <span class="keywordtype">int</span> stripTOF, <span class="keywordtype">int</span> padXTOF, <span class="keywordtype">int</span> padZTOF, <span class="keywordtype">int</span> cacheeTrk, <span class="keywordtype">int</span> crossedStrip, <span class="keywordtype">int</span> sectPropagation, <span class="keywordtype">int</span> platePropagation, <span class="keywordtype">int</span> stripPropagation, <span class="keywordtype">int</span> padXPropagation, <span class="keywordtype">int</span> padZPropagation, <span class="keywordtype">float</span> resX, <span class="keywordtype">float</span> resZ, <span class="keywordtype">float</span> res, <a class="code" href="../../d6/d67/classo2_1_1dataformats_1_1TrackTPCITS.html">o2::dataformats::TrackTPCITS</a>&amp; trk, <span class="keywordtype">int</span> TPClabelTrackID, <span class="keywordtype">int</span> TPClabelEventID, <span class="keywordtype">int</span> TPClabelSourceID, <span class="keywordtype">int</span> ITSlabelTrackID, <span class="keywordtype">int</span> ITSlabelEventID, <span class="keywordtype">int</span> ITSlabelSourceID, <span class="keywordtype">int</span> TOFlabelTrackID0, <span class="keywordtype">int</span> TOFlabelEventID0, <span class="keywordtype">int</span> TOFlabelSourceID0, <span class="keywordtype">int</span> TOFlabelTrackID1, <span class="keywordtype">int</span> TOFlabelEventID1, <span class="keywordtype">int</span> TOFlabelSourceID1, <span class="keywordtype">int</span> TOFlabelTrackID2, <span class="keywordtype">int</span> TOFlabelEventID2, <span class="keywordtype">int</span> TOFlabelSourceID2, <span class="keywordtype">float</span> intLength, <span class="keywordtype">float</span> intTimePion, <span class="keywordtype">float</span> timeTOF)</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;{</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  mTimerDBG.Start(<span class="keyword">false</span>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="keywordflow">if</span> (mDBGFlags) {</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    (*mDBGOut) &lt;&lt; trname</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;clusterTOF=&quot;</span> &lt;&lt; cacheTOF &lt;&lt; <span class="stringliteral">&quot;sectTOF=&quot;</span> &lt;&lt; sectTOF &lt;&lt; <span class="stringliteral">&quot;plateTOF=&quot;</span> &lt;&lt; plateTOF &lt;&lt; <span class="stringliteral">&quot;stripTOF=&quot;</span> &lt;&lt; stripTOF &lt;&lt; <span class="stringliteral">&quot;padXTOF=&quot;</span> &lt;&lt; padXTOF &lt;&lt; <span class="stringliteral">&quot;padZTOF=&quot;</span> &lt;&lt; padZTOF</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;crossedStrip=&quot;</span> &lt;&lt; crossedStrip &lt;&lt; <span class="stringliteral">&quot;sectPropagation=&quot;</span> &lt;&lt; sectPropagation &lt;&lt; <span class="stringliteral">&quot;platePropagation=&quot;</span> &lt;&lt; platePropagation &lt;&lt; <span class="stringliteral">&quot;stripPropagation=&quot;</span> &lt;&lt; stripPropagation &lt;&lt; <span class="stringliteral">&quot;padXPropagation=&quot;</span> &lt;&lt; padXPropagation</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;resX=&quot;</span> &lt;&lt; resX &lt;&lt; <span class="stringliteral">&quot;resZ=&quot;</span> &lt;&lt; resZ &lt;&lt; <span class="stringliteral">&quot;res=&quot;</span> &lt;&lt; res &lt;&lt; <span class="stringliteral">&quot;track=&quot;</span> &lt;&lt; trk</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;TPClabelTrackID=&quot;</span> &lt;&lt; TPClabelTrackID &lt;&lt; <span class="stringliteral">&quot;TPClabelEventID=&quot;</span> &lt;&lt; TPClabelEventID &lt;&lt; <span class="stringliteral">&quot;TPClabelSourceID=&quot;</span> &lt;&lt; TPClabelSourceID</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;ITSlabelTrackID=&quot;</span> &lt;&lt; ITSlabelTrackID &lt;&lt; <span class="stringliteral">&quot;ITSlabelEventID=&quot;</span> &lt;&lt; ITSlabelEventID &lt;&lt; <span class="stringliteral">&quot;ITSlabelSourceID=&quot;</span> &lt;&lt; ITSlabelSourceID</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;TOFlabelTrackID0=&quot;</span> &lt;&lt; TOFlabelTrackID0 &lt;&lt; <span class="stringliteral">&quot;TOFlabelEventID0=&quot;</span> &lt;&lt; TOFlabelEventID0 &lt;&lt; <span class="stringliteral">&quot;TOFlabelSourceID0=&quot;</span> &lt;&lt; TOFlabelSourceID0</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;TOFlabelTrackID1=&quot;</span> &lt;&lt; TOFlabelTrackID1 &lt;&lt; <span class="stringliteral">&quot;TOFlabelEventID1=&quot;</span> &lt;&lt; TOFlabelEventID1 &lt;&lt; <span class="stringliteral">&quot;TOFlabelSourceID1=&quot;</span> &lt;&lt; TOFlabelSourceID1</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;TOFlabelTrackID2=&quot;</span> &lt;&lt; TOFlabelTrackID2 &lt;&lt; <span class="stringliteral">&quot;TOFlabelEventID2=&quot;</span> &lt;&lt; TOFlabelEventID2 &lt;&lt; <span class="stringliteral">&quot;TOFlabelSourceID2=&quot;</span> &lt;&lt; TOFlabelSourceID2</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;intLength=&quot;</span> &lt;&lt; intLength &lt;&lt; <span class="stringliteral">&quot;intTimePion=&quot;</span> &lt;&lt; intTimePion &lt;&lt; <span class="stringliteral">&quot;timeTOF=&quot;</span> &lt;&lt; timeTOF</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  mTimerDBG.Stop();</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;}</div><div class="ttc" id="namespaceo2_1_1constants_1_1math_html_a516697a93488937eacca106d81549190"><div class="ttname"><a href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a516697a93488937eacca106d81549190">o2::constants::math::SectorSpanRad</a></div><div class="ttdeci">constexpr float SectorSpanRad</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d84/MathConstants_8h_source.html#l00036">MathConstants.h:36</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639aafdcaf151e613d069d5a11114f4cf86b"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639aafdcaf151e613d069d5a11114f4cf86b">o2::tof::Cluster::kUpRight</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00042">Cluster.h:42</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a94ae715eebfc1eb65456c0ab9b97f1e9"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a></div><div class="ttdeci">GLsizei GLenum const void * indices</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00400">glcorearb.h:400</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MatchInfoTOF_html"><div class="ttname"><a href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html">o2::dataformats::MatchInfoTOF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d70/MatchInfoTOF_8h_source.html#l00024">MatchInfoTOF.h:24</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackLTIntegral_html"><div class="ttname"><a href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html">o2::track::TrackLTIntegral</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db1/TrackLTIntegral_8h_source.html#l00029">TrackLTIntegral.h:29</a></div></div>
<div class="ttc" id="classo2_1_1field_1_1MagneticField_html_af81094cbf8b590f954df3ec5f58612f8"><div class="ttname"><a href="../../d2/da0/classo2_1_1field_1_1MagneticField.html#af81094cbf8b590f954df3ec5f58612f8">o2::field::MagneticField::solenoidField</a></div><div class="ttdeci">Double_t solenoidField() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/MagneticField_8h_source.html#l00175">MagneticField.h:175</a></div></div>
<div class="ttc" id="namespaceo2_1_1utils_html_a2748d6e3cfed410c77bab14937344c1b"><div class="ttname"><a href="../../d0/d28/namespaceo2_1_1utils.html#a2748d6e3cfed410c77bab14937344c1b">o2::utils::Angle2Alpha</a></div><div class="ttdeci">float Angle2Alpha(float phi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h_source.html#l00135">Utils.h:135</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_a993c99db1579c9d65a490bf44d00da59"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a993c99db1579c9d65a490bf44d00da59">o2::track::TrackPar::rotateParam</a></div><div class="ttdeci">bool rotateParam(float alpha)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d18/DataFormats_2Reconstruction_2src_2Track_8cxx_source.html#l00131">Track.cxx:131</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MatchInfoTOF_html_ab30f6949ee1044db93886da6852205f2"><div class="ttname"><a href="../../d7/d90/classo2_1_1dataformats_1_1MatchInfoTOF.html#ab30f6949ee1044db93886da6852205f2">o2::dataformats::MatchInfoTOF::getChi2</a></div><div class="ttdeci">float getChi2() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d70/MatchInfoTOF_8h_source.html#l00041">MatchInfoTOF.h:41</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00028">GPUCommonLogger.h:28</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTPCITS_html_a7b79acb98e69d6f77543ff90185d1f9e"><div class="ttname"><a href="../../d5/dcf/classo2_1_1globaltracking_1_1MatchTPCITS.html#a7b79acb98e69d6f77543ff90185d1f9e">o2::globaltracking::MatchTPCITS::XTPCOuterRef</a></div><div class="ttdeci">static constexpr float XTPCOuterRef</div><div class="ttdoc">reference radius to propagate outer TPC track </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dac/MatchTPCITS_8h_source.html#l00268">MatchTPCITS.h:268</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639a88aaa69cdf7b51c6fc94000ebe716210"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a88aaa69cdf7b51c6fc94000ebe716210">o2::tof::Cluster::kUp</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00041">Cluster.h:41</a></div></div>
<div class="ttc" id="classo2_1_1base_1_1Propagator_html_a7344af8e3f34fcd3c5d55769c12af67d"><div class="ttname"><a href="../../da/d02/classo2_1_1base_1_1Propagator.html#a7344af8e3f34fcd3c5d55769c12af67d">o2::base::Propagator::PropagateToXBxByBz</a></div><div class="ttdeci">bool PropagateToXBxByBz(o2::track::TrackParCov &amp;track, float x, float mass=o2::constants::physics::MassPionCharged, float maxSnp=0.85, float maxStep=2.0, int matCorr=1, o2::track::TrackLTIntegral *tofInfo=nullptr, int signCorr=0) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dee/Propagator_8cxx_source.html#l00054">Propagator.cxx:54</a></div></div>
<div class="ttc" id="MagFieldFast_8h_html"><div class="ttname"><a href="../../da/df4/MagFieldFast_8h.html">MagFieldFast.h</a></div><div class="ttdoc">Definition of the fast magnetic field parametrization MagFieldFast. </div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html">o2::globaltracking::MatchTOF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d74/MatchTOF_8h_source.html#l00071">MatchTOF.h:71</a></div></div>
<div class="ttc" id="MatchTOF_8h_html"><div class="ttname"><a href="../../d0/d74/MatchTOF_8h.html">MatchTOF.h</a></div><div class="ttdoc">Class to perform TOF matching to global tracks. </div></div>
<div class="ttc" id="glcorearb_8h_html_ac8729153468b5dcf13f971b21d84d4e5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a></div><div class="ttdeci">GLboolean GLboolean GLboolean GLboolean a</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="Cartesian3D_8h_html"><div class="ttname"><a href="../../dd/d76/Cartesian3D_8h.html">Cartesian3D.h</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1TrackTPCITS_html"><div class="ttname"><a href="../../d6/d67/classo2_1_1dataformats_1_1TrackTPCITS.html">o2::dataformats::TrackTPCITS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d1e/TrackTPCITS_8h_source.html#l00027">TrackTPCITS.h:27</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackLTIntegral_html_ab45082e158199df11e8935082a1ee6fc"><div class="ttname"><a href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#ab45082e158199df11e8935082a1ee6fc">o2::track::TrackLTIntegral::getL</a></div><div class="ttdeci">float getL() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db1/TrackLTIntegral_8h_source.html#l00038">TrackLTIntegral.h:38</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_aa248bc53fcffebe08560a48450b3dac5"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#aa248bc53fcffebe08560a48450b3dac5">o2::globaltracking::MatchTOF::run</a></div><div class="ttdeci">void run()</div><div class="ttdoc">&lt; perform matching for provided input </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00046">MatchTOF.cxx:46</a></div></div>
<div class="ttc" id="namespaceo2_1_1data__flow_html_a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873"><div class="ttname"><a href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">o2::data_flow::ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db0/TimeframeParser_8cxx_source.html#l00049">TimeframeParser.cxx:49</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html_a277aa132a845e6e466139f1d5041c933"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a277aa132a845e6e466139f1d5041c933">o2::dataformats::MCTruthContainer::getNElements</a></div><div class="ttdeci">size_t getNElements() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d14/MCTruthContainer_8h_source.html#l00140">MCTruthContainer.h:140</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_ad08a37964429d340d966dfa679443e8f"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events int</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00025">qconfigoptions.h:25</a></div></div>
<div class="ttc" id="Detectors_2Base_2include_2DetectorsBase_2GeometryManager_8h_html"><div class="ttname"><a href="../../db/dcc/Detectors_2Base_2include_2DetectorsBase_2GeometryManager_8h.html">GeometryManager.h</a></div></div>
<div class="ttc" id="namespaceo2_1_1globaltracking_html"><div class="ttname"><a href="../../d3/dc3/namespaceo2_1_1globaltracking.html">o2::globaltracking</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d74/MatchTOF_8h_source.html#l00056">MatchTOF.h:56</a></div></div>
<div class="ttc" id="structo2_1_1InteractionRecord_html_a2b9e5a5520c4d6dfd8d8df796b50291a"><div class="ttname"><a href="../../d1/d21/structo2_1_1InteractionRecord.html#a2b9e5a5520c4d6dfd8d8df796b50291a">o2::InteractionRecord::orbit</a></div><div class="ttdeci">uint32_t orbit</div><div class="ttdoc">LHC orbit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d80/InteractionRecord_8h_source.html#l00031">InteractionRecord.h:31</a></div></div>
<div class="ttc" id="MatchTPCITS_8h_html"><div class="ttname"><a href="../../d3/dac/MatchTPCITS_8h.html">MatchTPCITS.h</a></div><div class="ttdoc">Class to perform TPC ITS matching. </div></div>
<div class="ttc" id="MagneticField_8h_html"><div class="ttname"><a href="../../db/d4b/MagneticField_8h.html">MagneticField.h</a></div><div class="ttdoc">Definition of the MagF class. </div></div>
<div class="ttc" id="namespaceo2_1_1constants_1_1math_html_a0c4e106cb192dc65c6fd29e258f49e66"><div class="ttname"><a href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a></div><div class="ttdeci">constexpr int NSectors</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d84/MathConstants_8h_source.html#l00034">MathConstants.h:34</a></div></div>
<div class="ttc" id="DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2PID_8h_html"><div class="ttname"><a href="../../d5/d08/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2PID_8h.html">PID.h</a></div></div>
<div class="ttc" id="classo2_1_1field_1_1MagneticField_html"><div class="ttname"><a href="../../d2/da0/classo2_1_1field_1_1MagneticField.html">o2::field::MagneticField</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/MagneticField_8h_source.html#l00044">MagneticField.h:44</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackLTIntegral_html_a73a8177aefca6b7ced28d90e64967ffc"><div class="ttname"><a href="../../d2/d37/classo2_1_1track_1_1TrackLTIntegral.html#a73a8177aefca6b7ced28d90e64967ffc">o2::track::TrackLTIntegral::getTOF</a></div><div class="ttdeci">float getTOF(int id) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db1/TrackLTIntegral_8h_source.html#l00040">TrackLTIntegral.h:40</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackParCov_html_ac380d046f56fca7e064879c67bb6e59e"><div class="ttname"><a href="../../de/dea/classo2_1_1track_1_1TrackParCov.html#ac380d046f56fca7e064879c67bb6e59e">o2::track::TrackParCov::rotate</a></div><div class="ttdeci">bool rotate(float alpha)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d18/DataFormats_2Reconstruction_2src_2Track_8cxx_source.html#l00726">Track.cxx:726</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_a904fd6012a0417eedecd3a6b2e18e492"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a904fd6012a0417eedecd3a6b2e18e492">o2::globaltracking::MatchTOF::findFITIndex</a></div><div class="ttdeci">int findFITIndex(int bc)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00857">MatchTOF.cxx:857</a></div></div>
<div class="ttc" id="Common_2MathUtils_2include_2MathUtils_2Utils_8h_html"><div class="ttname"><a href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h.html">Utils.h</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_ab3a774b6e47e1545f3e6c2bf2ee31561"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#ab3a774b6e47e1545f3e6c2bf2ee31561">o2::globaltracking::MatchTOF::initWorkflow</a></div><div class="ttdeci">void initWorkflow(const gsl::span&lt; const o2::dataformats::TrackTPCITS &gt; &amp;trackArray, const gsl::span&lt; const Cluster &gt; &amp;clusterArray, const o2::dataformats::MCTruthContainer&lt; o2::MCCompLabel &gt; &amp;toflab, const gsl::span&lt; const o2::MCCompLabel &gt; &amp;itslab, const gsl::span&lt; const o2::MCCompLabel &gt; &amp;tpclab)</div><div class="ttdoc">set tree/chain containing tracks </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00161">MatchTOF.cxx:161</a></div></div>
<div class="ttc" id="PhysicsConstants_8h_html"><div class="ttname"><a href="../../d3/d9d/PhysicsConstants_8h.html">PhysicsConstants.h</a></div><div class="ttdoc">Header to collect physics constants. </div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_abf90e112ba5438a799232d7c7fe619c7"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#abf90e112ba5438a799232d7c7fe619c7">o2::globaltracking::MatchTOF::setDebugFlag</a></div><div class="ttdeci">void setDebugFlag(UInt_t flag, bool on=true)</div><div class="ttdoc">set the name of output debug file </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l01027">MatchTOF.cxx:1027</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_a160031f72507d8777787fb8a1c0c6844"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a160031f72507d8777787fb8a1c0c6844">o2::track::TrackPar::getZ</a></div><div class="ttdeci">float getZ() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00136">Track.h:136</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639a86f9f24e1c0be1bcec9d48510c73f8a3"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a86f9f24e1c0be1bcec9d48510c73f8a3">o2::tof::Cluster::kLeft</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00047">Cluster.h:47</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_a91bb4fd179a351fc61650c40127ce49a"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a91bb4fd179a351fc61650c40127ce49a">o2::globaltracking::MatchTOF::fillTOFmatchTree</a></div><div class="ttdeci">void fillTOFmatchTree(const char *tname, int cacheTOF, int sectTOF, int plateTOF, int stripTOF, int padXTOF, int padZTOF, int cacheeTrk, int crossedStrip, int sectPropagation, int platePropagation, int stripPropagation, int padXPropagation, int padZPropagation, float resX, float resZ, float res, o2::dataformats::TrackTPCITS &amp;trk, float intLength, float intTimePion, float timeTOF)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l01038">MatchTOF.cxx:1038</a></div></div>
<div class="ttc" id="TrackLTIntegral_8h_html"><div class="ttname"><a href="../../d6/db1/TrackLTIntegral_8h.html">TrackLTIntegral.h</a></div><div class="ttdoc">Track Length and TOF integral. </div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a023f7240e5818681ee9b4964c45a0d6b"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a023f7240e5818681ee9b4964c45a0d6b">o2::tof::Geo::ZPAD</a></div><div class="ttdeci">static constexpr Float_t ZPAD</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00101">Geo.h:101</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_ae4d3785b8297554926927e4e468fb03b"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#ae4d3785b8297554926927e4e468fb03b">o2::globaltracking::MatchTOF::init</a></div><div class="ttdeci">void init()</div><div class="ttdoc">perform all initializations </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00182">MatchTOF.cxx:182</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_a5ec46402e2549dab234a63ba9b104070"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a5ec46402e2549dab234a63ba9b104070">o2::track::TrackPar::getPhiPos</a></div><div class="ttdeci">float getPhiPos() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00392">Track.h:392</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_a61a54ae5c247e70fa930e6128bfa2be3"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a61a54ae5c247e70fa930e6128bfa2be3">o2::globaltracking::MatchTOF::fill</a></div><div class="ttdeci">void fill()</div><div class="ttdoc">perform all initializations </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00153">MatchTOF.cxx:153</a></div></div>
<div class="ttc" id="Geo_8h_html"><div class="ttname"><a href="../../d4/d54/Geo_8h.html">Geo.h</a></div></div>
<div class="ttc" id="structo2_1_1InteractionRecord_html_a609f431faab116789c96d3f8ef1cd703"><div class="ttname"><a href="../../d1/d21/structo2_1_1InteractionRecord.html#a609f431faab116789c96d3f8ef1cd703">o2::InteractionRecord::bc2ns</a></div><div class="ttdeci">static double bc2ns(int bc, unsigned int orbit)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d80/InteractionRecord_8h_source.html#l00062">InteractionRecord.h:62</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639a82254aeef8a3fa166f14746d732a6bbd"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a82254aeef8a3fa166f14746d732a6bbd">o2::tof::Cluster::kUpLeft</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00040">Cluster.h:40</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1EvIndex_html"><div class="ttname"><a href="../../d2/d74/classo2_1_1dataformats_1_1EvIndex.html">o2::dataformats::EvIndex&lt; int, int &gt;</a></div></div>
<div class="ttc" id="Propagator_8h_html"><div class="ttname"><a href="../../d2/df9/Propagator_8h.html">Propagator.h</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a6eba317e3cf44d6d26c04a5a8f197dcb"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a></div><div class="ttdeci">GLboolean GLboolean GLboolean b</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackParCov_html"><div class="ttname"><a href="../../de/dea/classo2_1_1track_1_1TrackParCov.html">o2::track::TrackParCov</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00217">Track.h:217</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_a4cad07d2379ed2cd66e58f88d2588195"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a4cad07d2379ed2cd66e58f88d2588195">o2::track::TrackPar::getX</a></div><div class="ttdeci">float getX() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00133">Track.h:133</a></div></div>
<div class="ttc" id="MatchTOF_8cxx_html_a8e1cead182581d0df38827ed861f8a77"><div class="ttname"><a href="../../db/d6a/MatchTOF_8cxx.html#a8e1cead182581d0df38827ed861f8a77">ClassImp</a></div><div class="ttdeci">ClassImp(MatchTOF)</div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt; o2::MCCompLabel &gt;</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_aae11e8cb08553dfe32144fd30d96772f"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#aae11e8cb08553dfe32144fd30d96772f">o2::tof::Geo::getVolumeIndices</a></div><div class="ttdeci">static void getVolumeIndices(Int_t index, Int_t *detId)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d39/Geo_8cxx_source.html#l00230">Geo.cxx:230</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_a950065742d8303a17ba6100fdc2ea219"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a950065742d8303a17ba6100fdc2ea219">o2::globaltracking::MatchTOF::printCandidatesTOF</a></div><div class="ttdeci">void printCandidatesTOF() const</div><div class="ttdoc">set time tolerance on track-TOF times comparison </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00257">MatchTOF.cxx:257</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639ac5975ababc183f62dde2f0a6571cac1f"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639ac5975ababc183f62dde2f0a6571cac1f">o2::tof::Cluster::kDownLeft</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00046">Cluster.h:46</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a28112f1c44aa9ed486cb34f29b1b87ef"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a28112f1c44aa9ed486cb34f29b1b87ef">o2::tof::Geo::getPadDxDyDz</a></div><div class="ttdeci">static void getPadDxDyDz(const Float_t *pos, Int_t *det, Float_t *DeltaPos)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d39/Geo_8cxx_source.html#l00437">Geo.cxx:437</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html">o2::track::TrackPar</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00121">Track.h:121</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_a25b72cc0622c171c482143cd74cef5d8"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a25b72cc0622c171c482143cd74cef5d8">o2::globaltracking::MatchTOF::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l00238">MatchTOF.cxx:238</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_a584c78e159e907de6980abc859c3c22a"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#a584c78e159e907de6980abc859c3c22a">o2::track::TrackPar::propagateParamTo</a></div><div class="ttdeci">bool propagateParamTo(float xk, float b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d18/DataFormats_2Reconstruction_2src_2Track_8cxx_source.html#l00278">Track.cxx:278</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a57f14e05b1900f16a2da82ade47d0c6d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a></div><div class="ttdeci">GLuint index</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="namespaceo2_1_1framework_html_ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">o2::framework::Abs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc2/BasicOps_8h_source.html#l00031">BasicOps.h:31</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639aa158566cc0fb948b50d01cda667d72e5"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639aa158566cc0fb948b50d01cda667d72e5">o2::tof::Cluster::kRight</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00043">Cluster.h:43</a></div></div>
<div class="ttc" id="namespaceo2_1_1utils_html_ad632aa7dc83da980942e6fdb2d27efcc"><div class="ttname"><a href="../../d0/d28/namespaceo2_1_1utils.html#ad632aa7dc83da980942e6fdb2d27efcc">o2::utils::Angle2Sector</a></div><div class="ttdeci">int Angle2Sector(float phi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h_source.html#l00117">Utils.h:117</a></div></div>
<div class="ttc" id="MCTruthContainer_8h_html"><div class="ttname"><a href="../../db/d14/MCTruthContainer_8h.html">MCTruthContainer.h</a></div><div class="ttdoc">Definition of a container to keep Monte Carlo truth external to simulation objects. </div></div>
<div class="ttc" id="GRPObject_8h_html"><div class="ttname"><a href="../../de/d28/GRPObject_8h.html">GRPObject.h</a></div><div class="ttdoc">Header of the General Run Parameters object. </div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639a562cb0ccfc2d527272d6fbbfd41c2315"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639a562cb0ccfc2d527272d6fbbfd41c2315">o2::tof::Cluster::kDownRight</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00044">Cluster.h:44</a></div></div>
<div class="ttc" id="structo2_1_1InteractionRecord_html"><div class="ttname"><a href="../../d1/d21/structo2_1_1InteractionRecord.html">o2::InteractionRecord</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d80/InteractionRecord_8h_source.html#l00024">InteractionRecord.h:24</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_af652798c666d6a27ae08b3b8471b1fb2"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#af652798c666d6a27ae08b3b8471b1fb2">o2::track::TrackPar::getY</a></div><div class="ttdeci">float getY() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00135">Track.h:135</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a1a9d9911a078883595c0699081f10ec5"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1a9d9911a078883595c0699081f10ec5">o2::tof::Geo::XPAD</a></div><div class="ttdeci">static constexpr Float_t XPAD</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00100">Geo.h:100</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html">o2::tof::Cluster</a></div><div class="ttdoc">Cluster class for TOF. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00031">Cluster.h:31</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Cluster_html_a754faa337daa487c36b8029cbcf17639ac698a0e79dcc7db29fe5f7aaeedc1aa7"><div class="ttname"><a href="../../d3/d81/classo2_1_1tof_1_1Cluster.html#a754faa337daa487c36b8029cbcf17639ac698a0e79dcc7db29fe5f7aaeedc1aa7">o2::tof::Cluster::kDown</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d50/DataFormats_2Detectors_2TOF_2include_2DataFormatsTOF_2Cluster_8h_source.html#l00045">Cluster.h:45</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1TimeStampWithError_html"><div class="ttname"><a href="../../d3/dbf/classo2_1_1dataformats_1_1TimeStampWithError.html">o2::dataformats::TimeStampWithError&lt; float, float &gt;</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1PID_html_a6db3f58ad4060aae142d35f3fbc8685f"><div class="ttname"><a href="../../d9/d0f/classo2_1_1track_1_1PID.html#a6db3f58ad4060aae142d35f3fbc8685f">o2::track::PID::Pion</a></div><div class="ttdeci">static constexpr ID Pion</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d08/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2PID_8h_source.html#l00033">PID.h:33</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a89db56f98f43548aa547bb5f77071319"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a89db56f98f43548aa547bb5f77071319">o2::tof::Geo::MAXHZTOF</a></div><div class="ttdeci">static constexpr Float_t MAXHZTOF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00088">Geo.h:88</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a000efecc96630d8606c3506b0f04e6fa"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a000efecc96630d8606c3506b0f04e6fa">o2::tof::Geo::RMAX</a></div><div class="ttdeci">static constexpr Float_t RMAX</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00095">Geo.h:95</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html_a47e20a65d29e6613e3deeedad9d7990f"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">o2::dataformats::MCTruthContainer::getLabels</a></div><div class="ttdeci">gsl::span&lt; TruthElement &gt; getLabels(uint32_t dataindex)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d14/MCTruthContainer_8h_source.html#l00144">MCTruthContainer.h:144</a></div></div>
<div class="ttc" id="structo2_1_1InteractionRecord_html_a4dd7d03ed59d92173589ba61165873ab"><div class="ttname"><a href="../../d1/d21/structo2_1_1InteractionRecord.html#a4dd7d03ed59d92173589ba61165873ab">o2::InteractionRecord::bc</a></div><div class="ttdeci">uint16_t bc</div><div class="ttdoc">bunch crossing ID of interaction </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d80/InteractionRecord_8h_source.html#l00030">InteractionRecord.h:30</a></div></div>
<div class="ttc" id="MathConstants_8h_html"><div class="ttname"><a href="../../d6/d84/MathConstants_8h.html">MathConstants.h</a></div><div class="ttdoc">useful math constants </div></div>
<div class="ttc" id="classo2_1_1base_1_1Propagator_html_a576b7b1cbb8cba5aac51864e44838715"><div class="ttname"><a href="../../da/d02/classo2_1_1base_1_1Propagator.html#a576b7b1cbb8cba5aac51864e44838715">o2::base::Propagator::Instance</a></div><div class="ttdeci">static Propagator * Instance()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00045">Propagator.h:45</a></div></div>
<div class="ttc" id="namespaceo2_1_1constants_1_1physics_html_a3d71e0c604f1baec02d3f1ac76b07fdf"><div class="ttname"><a href="../../d7/df9/namespaceo2_1_1constants_1_1physics.html#a3d71e0c604f1baec02d3f1ac76b07fdf">o2::constants::physics::MassPionCharged</a></div><div class="ttdeci">constexpr float MassPionCharged</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d9d/PhysicsConstants_8h_source.html#l00027">PhysicsConstants.h:27</a></div></div>
<div class="ttc" id="classo2_1_1globaltracking_1_1MatchTOF_html_a523b32e5a47b14511faffe311a9af094"><div class="ttname"><a href="../../d4/d8a/classo2_1_1globaltracking_1_1MatchTOF.html#a523b32e5a47b14511faffe311a9af094">o2::globaltracking::MatchTOF::fillTOFmatchTreeWithLabels</a></div><div class="ttdeci">void fillTOFmatchTreeWithLabels(const char *tname, int cacheTOF, int sectTOF, int plateTOF, int stripTOF, int padXTOF, int padZTOF, int cacheeTrk, int crossedStrip, int sectPropagation, int platePropagation, int stripPropagation, int padXPropagation, int padZPropagation, float resX, float resZ, float res, o2::dataformats::TrackTPCITS &amp;trk, int TPClabelTrackID, int TPClabelEventID, int TPClabelSourceID, int ITSlabelTrackID, int ITSlabelEventID, int ITSlabelSourceID, int TOFlabelTrackID0, int TOFlabelEventID0, int TOFlabelSourceID0, int TOFlabelTrackID1, int TOFlabelEventID1, int TOFlabelSourceID1, int TOFlabelTrackID2, int TOFlabelEventID2, int TOFlabelSourceID2, float intLength, float intTimePion, float timeTOF)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/MatchTOF_8cxx_source.html#l01056">MatchTOF.cxx:1056</a></div></div>
<div class="ttc" id="classo2_1_1track_1_1TrackPar_html_ac698f8aec46327dace416c5b1a7f3ffa"><div class="ttname"><a href="../../dd/de2/classo2_1_1track_1_1TrackPar.html#ac698f8aec46327dace416c5b1a7f3ffa">o2::track::TrackPar::getSnp</a></div><div class="ttdeci">float getSnp() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8b/DataFormats_2Reconstruction_2include_2ReconstructionDataFormats_2Track_8h_source.html#l00137">Track.h:137</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_18e0e8b4b629c3c13e7ad1457bcd5f89.html">GlobalTracking</a></li><li class="navelem"><a class="el" href="../../dir_a4cf5706394b5fe2435fe6f83bdb2959.html">src</a></li><li class="navelem"><a class="el" href="../../db/d6a/MatchTOF_8cxx.html">MatchTOF.cxx</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:23 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
