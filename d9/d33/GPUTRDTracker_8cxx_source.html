<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/GPU/GPUTracking/TRDTracking/GPUTRDTracker.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d9/d33/GPUTRDTracker_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GPUTRDTracker.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/d33/GPUTRDTracker_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//#define ENABLE_GPUTRDDEBUG</span></div><div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">   15</a></span>&#160;<span class="preprocessor">#define ENABLE_WARNING 0</span></div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">   16</a></span>&#160;<span class="preprocessor">#define ENABLE_INFO 0</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#ifdef GPUCA_ALIROOT_LIB</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#define ENABLE_GPUMC</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/GPUTRDTracker_8h.html">GPUTRDTracker.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d3c/GPUTRDTrackletWord_8h.html">GPUTRDTrackletWord.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d05/GPUTRDGeometry_8h.html">GPUTRDGeometry.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/da6/GPUTRDTrackerDebug_8h.html">GPUTRDTrackerDebug.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/de8/GPUReconstruction_8h.html">GPUReconstruction.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da6/GPUMemoryResource_8h.html">GPUMemoryResource.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/da2/GPUCommonMath_8h.html">GPUCommonMath.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html">GPUCommonAlgorithm.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dde/namespaceGPUCA__NAMESPACE_1_1gpu.html">GPUCA_NAMESPACE::gpu</a>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">class </span><a class="code" href="../../d0/d97/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTPCGMPolynomialField.html">GPUTPCGMPolynomialField</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#ifndef GPUCA_GPUCODE</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#ifndef __OPENCL__</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;omp.h&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#ifdef GPUCA_ALIROOT_LIB</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;TDatabasePDG.h&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;AliMCParticle.h&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;AliMCEvent.h&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> piMass = TDatabasePDG::Instance()-&gt;GetParticle(211)-&gt;Mass();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> piMass = 0.139f;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/ded/GPUChainTracking_8h.html">GPUChainTracking.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetMaxData</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d7f/structGPUCA__NAMESPACE_1_1gpu_1_1GPUTrackingInOutPointers.html">GPUTrackingInOutPointers</a>&amp; io)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  mNMaxTracks = io.nMergedTracks;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  mNMaxSpacePoints = io.nTRDTracklets;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (mRec-&gt;GetDeviceProcessingSettings().memoryAllocationStrategy == <a class="code" href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a284954b319bc158539f4c5f868d47d36a40246dd6ade2e6e83b4c45c2523e703b">GPUMemoryResource::ALLOCATION_GLOBAL</a>) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    mNMaxTracks = 50000;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    mNMaxSpacePoints = 100000;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a1eadedc3bf1e6948d5c2ab6638c35453">   66</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a1eadedc3bf1e6948d5c2ab6638c35453">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::RegisterMemoryAllocation</a>()</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;{</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  AllocateAndInitializeLate();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  mMemoryPermanent = mRec-&gt;RegisterMemoryAllocation(<span class="keyword">this</span>, &amp;<a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetPointersBase</a>, <a class="code" href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fa958db82784a89e22daaf3504ef1e93bc">GPUMemoryResource::MEMORY_PERMANENT</a>, <span class="stringliteral">&quot;TRDInitialize&quot;</span>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  mMemoryTracklets = mRec-&gt;RegisterMemoryAllocation(<span class="keyword">this</span>, &amp;<a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetPointersTracklets</a>, <a class="code" href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fad1a8b6c0306b39047269d18adf83b7be">GPUMemoryResource::MEMORY_INPUT</a>, <span class="stringliteral">&quot;TRDTracklets&quot;</span>);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">auto</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> = <a class="code" href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fa8ed7d1b38779edeb39ec963ac0f4f894">GPUMemoryResource::MEMORY_INOUT</a>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> (mRec-&gt;GetDeviceProcessingSettings().memoryAllocationStrategy == <a class="code" href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a284954b319bc158539f4c5f868d47d36a968ab40da0397c963a7d46f34a6bb096">GPUMemoryResource::ALLOCATION_INDIVIDUAL</a>) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> = <a class="code" href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fa60034a057fbcfa8c7146adaf61ac83b6">GPUMemoryResource::MEMORY_CUSTOM</a>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  mMemoryTracks = mRec-&gt;RegisterMemoryAllocation(<span class="keyword">this</span>, &amp;<a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetPointersTracks</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="stringliteral">&quot;TRDTracks&quot;</span>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a9f9bc08f2fa24b92d3889eaa0415e022">   79</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a9f9bc08f2fa24b92d3889eaa0415e022">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::InitializeProcessor</a>()</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  Init((<a class="code" href="../../dd/d44/GPUTRDTracker_8h.html#ab7291fe8893dd107e2154782242e60d5">TRD_GEOMETRY_CONST</a> <a class="code" href="../../d8/d19/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDGeometry.html">GPUTRDGeometry</a>*)GetConstantMem()-&gt;calibObjects.trdGeometry);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a2b307609e2a5d5363613f70b0cb6f902">   85</a></span>&#160;<span class="keywordtype">void</span>* <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a2b307609e2a5d5363613f70b0cb6f902">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetPointersBase</a>(<span class="keywordtype">void</span>* base)</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// Allocate memory for fixed size objects (needs to be done only once)</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  mMaxThreads = mRec-&gt;GetMaxThreads();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  computePointerWithAlignment(base, mR, kNChambers);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  computePointerWithAlignment(base, mNTrackletsInChamber, kNChambers);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  computePointerWithAlignment(base, mTrackletIndexArray, kNChambers);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  computePointerWithAlignment(base, mHypothesis, mNCandidates * mMaxThreads);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  computePointerWithAlignment(base, mCandidates, mNCandidates * 2 * mMaxThreads);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">return</span> base;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#af0aa78990c130b4b2faf379a885d25f4">  100</a></span>&#160;<span class="keywordtype">void</span>* <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#af0aa78990c130b4b2faf379a885d25f4">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetPointersTracklets</a>(<span class="keywordtype">void</span>* base)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// Allocate memory for tracklets and space points</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// (size might change for different events)</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  computePointerWithAlignment(base, mTracklets, mNMaxSpacePoints);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  computePointerWithAlignment(base, mSpacePoints, mNMaxSpacePoints);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  computePointerWithAlignment(base, mTrackletLabels, 3 * mNMaxSpacePoints);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordflow">return</span> base;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a1d08e652e6d0a35a32235432717073d7">  113</a></span>&#160;<span class="keywordtype">void</span>* <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a1d08e652e6d0a35a32235432717073d7">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetPointersTracks</a>(<span class="keywordtype">void</span>* base)</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// Allocate memory for tracks (this is done once per event)</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  computePointerWithAlignment(base, mTracks, mNMaxTracks);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">return</span> base;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a23d802b53f9b1fd6c9b5f451c8ba9569">  123</a></span>&#160;<a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a23d802b53f9b1fd6c9b5f451c8ba9569">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::GPUTRDTracker_t</a>()</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  : mR(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mIsInitialized(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a9fb99aa34f76f957d3f57fed6946e901">false</a>), mMemoryPermanent(-1), mMemoryTracklets(-1), mMemoryTracks(-1), mNMaxTracks(0), mNMaxSpacePoints(0), mTracks(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mNCandidates(1), mNTracks(0), mNEvents(0), mTracklets(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mMaxThreads(100), mNTracklets(0), mNTrackletsInChamber(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mTrackletIndexArray(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mHypothesis(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mCandidates(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mSpacePoints(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mTrackletLabels(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mGeo(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mDebugOutput(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a9fb99aa34f76f957d3f57fed6946e901">false</a>), mRadialOffset(-0.1), mMinPt(2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mMaxEta(0.84<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mExtraRoadY(2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mRoadZ(18.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mMaxChi2(15.0<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mMaxMissingLy(6), mChi2Penalty(12.0<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mZCorrCoefNRC(1.4<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>), mMCEvent(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mDebug(new <a class="code" href="../../dd/d07/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTrackerDebug.html">GPUTRDTrackerDebug</a>&lt;TRDTRK&gt;())</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;{</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// Default constructor</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a364236e5ff4c7cdd89615b681b46edaa">  132</a></span>&#160;<a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::~GPUTRDTracker_t</a>()</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;{</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// Destructor</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">delete</span> mDebug;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#ad8874d05fbeb0a39673a5368d88a9742">  141</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::Init</a>(<a class="code" href="../../dd/d44/GPUTRDTracker_8h.html#ab7291fe8893dd107e2154782242e60d5">TRD_GEOMETRY_CONST</a> <a class="code" href="../../d8/d19/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDGeometry.html">GPUTRDGeometry</a>* geo)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// Initialise tracker</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">if</span> (!geo) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    Error(<span class="stringliteral">&quot;Init&quot;</span>, <span class="stringliteral">&quot;TRD geometry must be provided externally&quot;</span>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  mGeo = geo;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#ifdef GPUCA_ALIROOT_LIB</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCandidate = 0; iCandidate &lt; mNCandidates * 2 * mMaxThreads; ++iCandidate) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">new</span> (&amp;mCandidates[iCandidate]) TRDTRK;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; kNChambers; ++iDet) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    mNTrackletsInChamber[iDet] = 0;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    mTrackletIndexArray[iDet] = -1;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">// obtain average radius of TRD chambers</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a98ac434677655cc8438bb72de2719f39">x0</a>[kNLayers] = {300.2f, 312.8f, 325.4f, 338.0f, 350.6f, 363.2f}; <span class="comment">// used as default value in case no transformation matrix can be obtained</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">auto</span>* matrix = mGeo-&gt;GetClusterMatrix(0);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> loc[3] = {mGeo-&gt;AnodePos(), 0.f, 0.f};</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> glb[3] = {0.f, 0.f, 0.f};</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; kNChambers; ++iDet) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    matrix = mGeo-&gt;GetClusterMatrix(iDet);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (!matrix) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      mR[iDet] = x0[mGeo-&gt;GetLayer(iDet)];</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    matrix-&gt;LocalToMaster(loc, glb);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    mR[iDet] = glb[0];</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  mDebug-&gt;ExpandVectors();</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  mIsInitialized = <span class="keyword">true</span>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a9419331c60a69260de8240e4eed9ed05">  185</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::Reset</a>(<span class="keywordtype">bool</span> fast)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// Reset tracker</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  mNTracklets = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  mNTracks = 0;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; kNChambers; ++iDet) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    mNTrackletsInChamber[iDet] = 0;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    mTrackletIndexArray[iDet] = -1;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordflow">if</span> (fast) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mNMaxSpacePoints; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    mTracklets[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0x0;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a393ffefe4b89f34b10c293d8d4089f6c">mR</a> = 0.f;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mX[0] = 0.f;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mX[1] = 0.f;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mCov[0] = 0.f;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mCov[1] = 0.f;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mCov[2] = 0.f;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mDy = 0.f;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mId = 0;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mLabel[0] = -1;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mLabel[1] = -1;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mLabel[2] = -1;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    mSpacePoints[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mVolumeId = 0;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#acc58be76789310c2b1a4c9ec38b8447d">  217</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::DoTracking</a>(<a class="code" href="../../d5/d5f/classGPUCA__NAMESPACE_1_1gpu_1_1GPUChainTracking.html">GPUChainTracking</a>* <a class="code" href="../../dc/df9/standalone_8cxx.html#ae3795b92d878ebf585413ec4dce002d0">chainTracking</a>)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// Steering function for the tracking</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// sort tracklets and fill index array</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  CAAlgo::sort(mTracklets, mTracklets + mNTracklets);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">int</span> trkltCounter = 0;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; kNChambers; ++iDet) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (mNTrackletsInChamber[iDet] != 0) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      mTrackletIndexArray[iDet] = trkltCounter;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      trkltCounter += mNTrackletsInChamber[iDet];</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (!CalculateSpacePoints()) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    Error(<span class="stringliteral">&quot;DoTracking&quot;</span>, <span class="stringliteral">&quot;Space points for at least one chamber could not be calculated&quot;</span>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">auto</span> timeStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">if</span> (mRec-&gt;GetRecoStepsGPU() &amp; <a class="code" href="../../d4/dc5/GPUDataTypes_8h.html#ae7b2b17b359872d7ec2cc61e99afba5f">GPUDataTypes::RecoStep::TRDTracking</a>) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    chainTracking-&gt;<a class="code" href="../../d5/d5f/classGPUCA__NAMESPACE_1_1gpu_1_1GPUChainTracking.html#a6b88ff84879e043607c2014cf4680df0">DoTRDGPUTracking</a>();</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">#ifdef WITH_OPENMP</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrk = 0; iTrk &lt; mNTracks; ++iTrk) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">if</span> (omp_get_num_threads() &gt; mMaxThreads) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        Error(<span class="stringliteral">&quot;DoTracking&quot;</span>, <span class="stringliteral">&quot;number of parallel threads too high, aborting tracking&quot;</span>);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">// break statement not possible in OpenMP for loop</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        iTrk = mNTracks;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      DoTrackingThread(iTrk, omp_get_thread_num());</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrk = 0; iTrk &lt; mNTracks; ++iTrk) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      DoTrackingThread(iTrk);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keyword">auto</span> duration = std::chrono::high_resolution_clock::now() - timeStart;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">  std::cout &lt;&lt; &quot;---&gt;  -----&gt; -------&gt; ---------&gt; &quot;;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">  std::cout &lt;&lt; &quot;Time for event &quot; &lt;&lt; mNEvents &lt;&lt; &quot;: &quot; &lt;&lt; std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(duration).count() &lt;&lt; &quot; us &quot;;</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">  std::cout &lt;&lt; &quot;nTracks: &quot; &lt;&lt; mNTracks;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  std::cout &lt;&lt; &quot; nTracklets: &quot; &lt;&lt; mNTracklets;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">  std::cout &lt;&lt; std::endl;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  DumpTracks();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  mNEvents++;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a7da59138749372be5d4417f04e3b5337">  273</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::SetNCandidates</a>(<span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0788d3762d0c3c76e4c094d8078b4c27">n</a>)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">// set the number of candidates to be used</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (!mIsInitialized) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    mNCandidates = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0788d3762d0c3c76e4c094d8078b4c27">n</a>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    Error(<span class="stringliteral">&quot;SetNCandidates&quot;</span>, <span class="stringliteral">&quot;Cannot change mNCandidates after initialization&quot;</span>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a245ed7bbd9c81976c69c05767d6674f7">  286</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::PrintSettings</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// print current settings to screen</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;##############################################################&quot;</span>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Current settings for GPU TRD tracker:&quot;</span>);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot; mMaxChi2(%.2f), mChi2Penalty(%.2f), nCandidates(%i), maxMissingLayers(%i)&quot;</span>, mMaxChi2, mChi2Penalty, mNCandidates, mMaxMissingLy);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot; ptCut = %.2f GeV, abs(eta) &lt; %.2f&quot;</span>, mMinPt, mMaxEta);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;##############################################################&quot;</span>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#afdbc61b4f1e932446162c43e07c83dd6">  299</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::CountMatches</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> trackID, std::vector&lt;int&gt;* matches)<span class="keyword"> const</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">// search in all TRD chambers for matching tracklets</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">// including all tracklets created by the track and its daughters</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">// important: tracklets far away / pointing in different direction of</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">// the track should be rejected (or this has to be done afterwards in analysis)</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">#ifndef GPUCA_GPUCODE</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUMC</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; kNChambers; k++) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a> = mGeo-&gt;GetLayer(k);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrklt = 0; iTrklt &lt; mNTrackletsInChamber[k]; iTrklt++) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordtype">int</span> trkltIdx = mTrackletIndexArray[k] + iTrklt;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordtype">bool</span> trkltStored = <span class="keyword">false</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> il = 0; il &lt; 3; il++) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordtype">int</span> lb = mSpacePoints[trkltIdx].mLabel[il];</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span> (lb &lt; 0) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          <span class="comment">// no more valid labels</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (lb == <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trackID)) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          matches[<a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a>].push_back(trkltIdx);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">if</span> (!mMCEvent) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">//continue; //FIXME uncomment to count only exact matches</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        AliMCParticle* mcPart = (AliMCParticle*)mMCEvent-&gt;GetTrack(lb);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">while</span> (mcPart) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;          lb = mcPart-&gt;GetMother();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          <span class="keywordflow">if</span> (lb == <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trackID)) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            matches[<a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a>].push_back(trkltIdx);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            trkltStored = <span class="keyword">true</span>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          mcPart = lb &gt;= 0 ? (AliMCParticle*)mMCEvent-&gt;GetTrack(lb) : 0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> (trkltStored) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::CheckTrackRefs</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> trackID, <span class="keywordtype">bool</span>* findableMC)<span class="keyword"> const</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUMC</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// loop over all track references for the input trackID and set</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">// findableMC to true for each layer in which a track hit  both</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// entering and exiting the TRD chamber exists</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// (in debug mode)</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  TParticle* particle;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  TClonesArray* trackRefs;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">int</span> nHits = mMCEvent-&gt;GetParticleAndTR(trackID, particle, trackRefs);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">if</span> (nHits &lt; 1) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">bool</span> isFindable[2 * kNLayers] = {<span class="keyword">false</span>};</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordtype">int</span> nHitsTrd = 0;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; nHits; ++iHit) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    AliTrackReference* trackReference = <span class="keyword">static_cast&lt;</span>AliTrackReference*<span class="keyword">&gt;</span>(trackRefs-&gt;UncheckedAt(iHit));</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (trackReference-&gt;DetectorId() != AliTrackReference::kTRD) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    nHitsTrd++;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordtype">float</span> xLoc = trackReference-&gt;LocalX();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (!((trackReference-&gt;TestBits(0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a> &lt;&lt; 18)) || (trackReference-&gt;TestBits(0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a> &lt;&lt; 17)))) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">//if (!trackReference-&gt;TestBits(0x1 &lt;&lt; 18)) {</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="comment">// bit 17 - entering; bit 18 - exiting</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a> = -1;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (xLoc &lt; 304.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      layer = 0;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xLoc &lt; 317.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      layer = 1;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xLoc &lt; 330.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      layer = 2;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xLoc &lt; 343.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      layer = 3;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xLoc &lt; 356.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      layer = 4;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xLoc &lt; 369.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      layer = 5;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span> (layer &lt; 0) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      Error(<span class="stringliteral">&quot;CheckTrackRefs&quot;</span>, <span class="stringliteral">&quot;No layer can be determined&quot;</span>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <a class="code" href="../../df/ddc/GPULogging_8h.html#a2700ed3728abe6f865af253f6ec5830f">GPUError</a>(<span class="stringliteral">&quot;x=%f, y=%f, z=%f, layer=%i&quot;</span>, xLoc, trackReference-&gt;LocalY(), trackReference-&gt;Z(), <a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (trackReference-&gt;TestBits(0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a> &lt;&lt; 18)) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      isFindable[layer * 2] = <span class="keyword">true</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (trackReference-&gt;TestBits(0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a> &lt;&lt; 17)) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      isFindable[layer * 2 + 1] = <span class="keyword">true</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLayer = 0; iLayer &lt; kNLayers; ++iLayer) {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span> (isFindable[iLayer * 2] &amp;&amp; isFindable[iLayer * 2 + 1]) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      findableMC[iLayer] = <span class="keyword">true</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      findableMC[iLayer] = <span class="keyword">false</span>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;}</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">#endif </span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">int</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::LoadTracklet</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d2b/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTrackletWord.html">GPUTRDTrackletWord</a>&amp; tracklet, <span class="keyword">const</span> <span class="keywordtype">int</span>* labels)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;{</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// Add single tracklet to tracker</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">if</span> (mNTracklets &gt;= mNMaxSpacePoints) {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    Error(<span class="stringliteral">&quot;LoadTracklet&quot;</span>, <span class="stringliteral">&quot;Running out of memory for tracklets, skipping tracklet(s). This should actually never happen.&quot;</span>);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">if</span> (labels) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      mTrackletLabels[3 * mNTracklets + <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = labels[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  mTracklets[mNTracklets++] = tracklet;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  mNTrackletsInChamber[tracklet.GetDetector()]++;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::DumpTracks</a>()</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;{</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="comment">// helper function (only for debugging purposes)</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;There are %i tracks loaded. mNMaxTracks(%i)\n&quot;</span>, mNTracks, mNMaxTracks);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mNTracks; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keyword">auto</span>* trk = &amp;(mTracks[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;track %i: x=%f, alpha=%f, nTracklets=%i, pt=%f&quot;</span>, <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, trk-&gt;getX(), trk-&gt;getAlpha(), trk-&gt;GetNtracklets(), trk-&gt;getPt());</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::DoTrackingThread</a>(<span class="keywordtype">int</span> iTrk, <span class="keywordtype">int</span> threadId)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// perform the tracking for one track (must be threadsafe)</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  PROP prop(&amp;<a class="code" href="../../d7/d16/classParam.html">Param</a>().polynomialField);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">auto</span> trkCopy = mTracks[iTrk];</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  prop.setTrack(&amp;trkCopy);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  prop.setFitInProjections(<span class="keyword">true</span>);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  FollowProlongation(&amp;prop, &amp;trkCopy, threadId);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  mTracks[iTrk] = trkCopy; <span class="comment">// copy back the resulting track</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">bool</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::CalculateSpacePoints</a>()</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;{</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="comment">// Calculates TRD space points in sector tracking coordinates</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// from online tracklets</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d6/d30/classuint64__t.html">result</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; kNChambers; ++iDet) {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">int</span> nTracklets = mNTrackletsInChamber[iDet];</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (nTracklets == 0) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keyword">auto</span>* matrix = mGeo-&gt;GetClusterMatrix(iDet);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (!matrix) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      Error(<span class="stringliteral">&quot;CalculateSpacePoints&quot;</span>, <span class="stringliteral">&quot;Invalid TRD cluster matrix, skipping detector  %i&quot;</span>, iDet);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      result = <span class="keyword">false</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d1/d29/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDpadPlane.html">GPUTRDpadPlane</a>* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a46f57654c7668c41e9478821a1c567cd">pp</a> = mGeo-&gt;GetPadPlane(iDet);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">float</span> tilt = CAMath::Tan(M_PI / 180.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * pp-&gt;GetTiltingAngle());</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordtype">float</span> t2 = tilt * tilt;      <span class="comment">// tan^2 (tilt)</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">float</span> c2 = 1.f / (1.f + t2); <span class="comment">// cos^2 (tilt)</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">float</span> sy2 = 0.1f * 0.1f;     <span class="comment">// sigma_rphi^2, currently assume sigma_rphi = 1 mm</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrklt = 0; iTrklt &lt; nTracklets; ++iTrklt) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordtype">int</span> trkltIdx = mTrackletIndexArray[iDet] + iTrklt;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordtype">int</span> trkltZbin = mTracklets[trkltIdx].GetZbin();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordtype">float</span> sz2 = pp-&gt;GetRowSize(trkltZbin) * pp-&gt;GetRowSize(trkltZbin) / 12.f; <span class="comment">// sigma_z = l_pad/sqrt(12) TODO try a larger z error</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> xTrkltDet[3] = {0.f};                                            <span class="comment">// trklt position in chamber coordinates</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> xTrkltSec[3] = {0.f};                                            <span class="comment">// trklt position in sector coordinates</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      xTrkltDet[0] = mGeo-&gt;AnodePos() + mRadialOffset;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      xTrkltDet[1] = mTracklets[trkltIdx].GetY();</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      xTrkltDet[2] = pp-&gt;GetRowPos(trkltZbin) - pp-&gt;GetRowSize(trkltZbin) / 2.f - pp-&gt;GetRowPos(pp-&gt;GetNrows() / 2);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="comment">//GPUInfo(&quot;Space point local %i: x=%f, y=%f, z=%f&quot;, iTrklt, xTrkltDet[0], xTrkltDet[1], xTrkltDet[2]);</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      matrix-&gt;LocalToMaster(xTrkltDet, xTrkltSec);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      mSpacePoints[trkltIdx].mR = xTrkltSec[0];</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      mSpacePoints[trkltIdx].mX[0] = xTrkltSec[1];</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      mSpacePoints[trkltIdx].mX[1] = xTrkltSec[2];</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      mSpacePoints[trkltIdx].mId = mTracklets[trkltIdx].GetId();</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        mSpacePoints[trkltIdx].mLabel[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mTrackletLabels[3 * mTracklets[trkltIdx].GetId() + <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      mSpacePoints[trkltIdx].mCov[0] = c2 * (sy2 + t2 * sz2);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      mSpacePoints[trkltIdx].mCov[1] = c2 * tilt * (sz2 - sy2);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      mSpacePoints[trkltIdx].mCov[2] = c2 * (t2 * sy2 + sz2);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      mSpacePoints[trkltIdx].mDy = 0.014f * mTracklets[trkltIdx].GetdY();</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordtype">int</span> modId = mGeo-&gt;GetSector(iDet) * <a class="code" href="../../d2/d76/namespaceo2_1_1trd.html#a8b425351cbe27ef04f7a127da61479b3">GPUTRDGeometry::kNstack</a> + mGeo-&gt;GetStack(iDet); <span class="comment">// global TRD stack number</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> volId = mGeo-&gt;GetGeomManagerVolUID(iDet, modId);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      mSpacePoints[trkltIdx].mVolumeId = volId;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="comment">//GPUInfo(&quot;Space point global %i: x=%f, y=%f, z=%f&quot;, iTrklt, mSpacePoints[trkltIdx].mR, mSpacePoints[trkltIdx].mX[0], mSpacePoints[trkltIdx].mX[1]);</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a321ff419cd5252e54cf95e64dc6687ee">result</a>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;}</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">bool</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::FollowProlongation</a>(PROP* prop, TRDTRK* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a2cdbb9508b46bd8f3a6039b702ebd16d">t</a>, <span class="keywordtype">int</span> threadId)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;{</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// Propagate TPC track layerwise through TRD and pick up closest</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// tracklet(s) on the way</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">// -&gt; returns false if prolongation could not be executed fully</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">//    or track does not fullfill threshold conditions</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Start track following for track %i at x=%f with pt=%f&quot;</span>, t-&gt;GetTPCtrackId(), t-&gt;getX(), t-&gt;getPt());</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  mDebug-&gt;Reset();</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordtype">int</span> iTrack = t-&gt;GetTPCtrackId();</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  t-&gt;SetChi2(0.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d1/d29/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDpadPlane.html">GPUTRDpadPlane</a>* pad = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUTRDDEBUG</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  TRDTRK trackNoUp(*t);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">// look for matching tracklets via MC label</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordtype">int</span> trackID = t-&gt;GetLabel();</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUMC</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  std::vector&lt;int&gt; matchAvailableAll[kNLayers]; <span class="comment">// all available MC tracklet matches for this track</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordflow">if</span> (mDebugOutput &amp;&amp; trackID &gt; 0 &amp;&amp; mMCEvent) {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    CountMatches(trackID, matchAvailableAll);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordtype">bool</span> findableMC[kNLayers] = {<span class="keyword">false</span>};</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    CheckTrackRefs(trackID, findableMC);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    mDebug-&gt;SetFindableMC(findableMC);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  }</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordtype">int</span> candidateIdxOffset = threadId * 2 * mNCandidates;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordtype">int</span> hypothesisIdxOffset = threadId * mNCandidates;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keyword">auto</span> trkWork = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a2cdbb9508b46bd8f3a6039b702ebd16d">t</a>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">if</span> (mNCandidates &gt; 1) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">// copy input track to first candidate</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    mCandidates[candidateIdxOffset] = *<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a2cdbb9508b46bd8f3a6039b702ebd16d">t</a>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordtype">int</span> nCandidates = 1;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">// search window</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordtype">float</span> roadY = 0.f;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordtype">float</span> roadZ = 0.f;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> nMaxChambersToSearch = 4;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  mDebug-&gt;SetGeneralInfo(mNEvents, mNTracks, iTrack, trackID, t-&gt;getPt());</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLayer = 0; iLayer &lt; kNLayers; ++iLayer) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordtype">int</span> nCurrHypothesis = 0;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">bool</span> isOK = <span class="keyword">false</span>; <span class="comment">// if at least one candidate could be propagated or the track was stopped this becomes true</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">int</span> currIdx = candidateIdxOffset + iLayer % 2;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordtype">int</span> nextIdx = candidateIdxOffset + (iLayer + 1) % 2;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    pad = mGeo-&gt;GetPadPlane(iLayer, 0);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">float</span> tilt = CAMath::Tan(M_PI / 180.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * pad-&gt;GetTiltingAngle()); <span class="comment">// tilt is signed!</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> zMaxTRD = pad-&gt;GetRow0();</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">// --------------------------------------------------------------------------------</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">// for each candidate, propagate to layer radius and look for close tracklets</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">// --------------------------------------------------------------------------------</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCandidate = 0; iCandidate &lt; nCandidates; iCandidate++) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordtype">int</span> det[nMaxChambersToSearch] = {-1, -1, -1, -1}; <span class="comment">// TRD chambers to be searched for tracklets</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">if</span> (mNCandidates &gt; 1) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        trkWork = &amp;mCandidates[2 * iCandidate + currIdx];</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        prop-&gt;setTrack(trkWork);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">if</span> (trkWork-&gt;GetIsStopped()) {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        Hypothesis hypo(trkWork-&gt;GetNlayers(), iCandidate, -1, trkWork-&gt;GetChi2());</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        InsertHypothesis(hypo, nCurrHypothesis, hypothesisIdxOffset);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        isOK = <span class="keyword">true</span>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">// propagate track to average radius of TRD layer iLayer (sector 0, stack 2 is chosen as a reference)</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keywordflow">if</span> (!prop-&gt;propagateToX(mR[2 * kNLayers + iLayer], .8f, 2.f)) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">//if (ENABLE_INFO) {</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Track propagation failed for track %i candidate %i in layer %i (pt=%f, x=%f, mR[layer]=%f)&quot;</span>, iTrack, iCandidate, iLayer, trkWork-&gt;getPt(), trkWork-&gt;getX(), mR[2 * kNLayers + iLayer]);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">//}</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Propagation failed&quot;</span>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="comment">// rotate track in new sector in case of sector crossing</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="keywordflow">if</span> (!AdjustSector(prop, trkWork, iLayer)) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">ENABLE_INFO</a>) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;FollowProlongation: Adjusting sector failed for track %i candidate %i in layer %i&quot;</span>, iTrack, iCandidate, iLayer);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Adjust sector failed&quot;</span>);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="comment">// check if track is findable</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">if</span> (IsGeoFindable(trkWork, iLayer, prop-&gt;getAlpha())) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        trkWork-&gt;SetIsFindable(iLayer);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="comment">// define search window</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      roadY = 7.f * CAMath::Sqrt(trkWork-&gt;getSigmaY2() + 0.1f * 0.1f) + mExtraRoadY; <span class="comment">// add constant to the road to account for uncertainty due to radial deviations (few mm)</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="comment">// roadZ = 7.f * CAMath::Sqrt(trkWork-&gt;getSigmaZ2() + 9.f * 9.f / 12.f); // take longest pad length</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      roadZ = mRoadZ; <span class="comment">// simply twice the longest pad length -&gt; efficiency 99.996%</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trkWork-&gt;getZ()) - roadZ &gt;= zMaxTRD) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">ENABLE_INFO</a>) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;FollowProlongation: Track out of TRD acceptance with z=%f in layer %i (eta=%f)&quot;</span>, trkWork-&gt;getZ(), iLayer, trkWork-&gt;getEta());</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Out of z acceptance&quot;</span>);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">// determine chamber(s) to be searched for tracklets</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      FindChambersInRoad(trkWork, roadY, roadZ, iLayer, det, zMaxTRD, prop-&gt;getAlpha());</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="comment">// track debug information to be stored in case no matching tracklet can be found</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      mDebug-&gt;SetTrackParameter(*trkWork, iLayer);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="comment">// look for tracklets in chamber(s)</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; nMaxChambersToSearch; iDet++) {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordtype">int</span> currDet = det[iDet];</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">if</span> (currDet == -1) {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordtype">int</span> currSec = mGeo-&gt;GetSector(currDet);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">if</span> (currSec != GetSector(prop-&gt;getAlpha())) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;          <span class="keywordtype">float</span> currAlpha = GetAlphaOfSector(currSec);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="keywordflow">if</span> (!prop-&gt;rotate(currAlpha)) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a>) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;              Warning(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;Track could not be rotated in tracklet coordinate system&quot;</span>);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">if</span> (currSec != GetSector(prop-&gt;getAlpha())) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          Error(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;Track is in sector %i and sector %i is searched for tracklets&quot;</span>, GetSector(prop-&gt;getAlpha()), currSec);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="comment">// propagate track to radius of chamber</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span> (!prop-&gt;propagateToX(mR[currDet], .8f, .2f)) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a>) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            Warning(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;Track parameter for track %i, x=%f at chamber %i x=%f in layer %i cannot be retrieved&quot;</span>, iTrack, trkWork-&gt;getX(), currDet, mR[currDet], iLayer);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="comment">// first propagate track to x of tracklet</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrklt = 0; iTrklt &lt; mNTrackletsInChamber[currDet]; ++iTrklt) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          <span class="keywordtype">int</span> trkltIdx = mTrackletIndexArray[currDet] + iTrklt;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trkWork-&gt;getY() - mSpacePoints[trkltIdx].mX[0]) &gt; roadY &amp;&amp; <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trkWork-&gt;getZ() - mSpacePoints[trkltIdx].mX[1]) &gt; roadZ) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="comment">// skip tracklets which are too far away</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="comment">// although the radii of space points and tracks may differ by ~ few mm the roads are large enough to allow no efficiency loss by this cut</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;          }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> projY, projZ;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          prop-&gt;getPropagatedYZ(mSpacePoints[trkltIdx].mR, projY, projZ);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          <span class="comment">// correction for tilted pads (only applied if deltaZ &lt; l_pad &amp;&amp; track z err &lt;&lt; l_pad)</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;          <span class="keywordtype">float</span> tiltCorr = tilt * (mSpacePoints[trkltIdx].mX[1] - projZ);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          <span class="keywordtype">float</span> l_pad = pad-&gt;GetRowSize(mTracklets[trkltIdx].GetZbin());</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          <span class="keywordflow">if</span> (!((<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(mSpacePoints[trkltIdx].mX[1] - projZ) &lt; l_pad) &amp;&amp; (trkWork-&gt;getSigmaZ2() &lt; (l_pad * l_pad / 12.f)))) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            tiltCorr = 0.f;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          <span class="comment">// correction for mean z position of tracklet (is not the center of the pad if track eta != 0)</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          <span class="keywordtype">float</span> zPosCorr = mSpacePoints[trkltIdx].mX[1] + mZCorrCoefNRC * trkWork-&gt;getTgl();</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          <span class="keywordtype">float</span> yPosCorr = mSpacePoints[trkltIdx].mX[0] - tiltCorr;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          <span class="keywordtype">float</span> deltaY = yPosCorr - projY;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          <span class="keywordtype">float</span> deltaZ = zPosCorr - projZ;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> trkltPosTmpYZ[2] = {yPosCorr, zPosCorr};</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> trkltCovTmp[3] = {0.f};</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          <span class="keywordflow">if</span> ((<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(deltaY) &lt; roadY) &amp;&amp; (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(deltaZ) &lt; roadZ)) { <span class="comment">// TODO: check if this is still necessary after the cut before propagation of track</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="comment">// tracklet is in windwow: get predicted chi2 for update and store tracklet index if best guess</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            RecalcTrkltCov(tilt, trkWork-&gt;getSnp(), pad-&gt;GetRowSize(mTracklets[trkltIdx].GetZbin()), trkltCovTmp);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="keywordtype">float</span> chi2 = prop-&gt;getPredictedChi2(trkltPosTmpYZ, trkltCovTmp);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="comment">// GPUInfo(&quot;layer %i: chi2 = %f&quot;, iLayer, chi2);</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span> (chi2 &lt; mMaxChi2 &amp;&amp; <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(GetAngularPull(mSpacePoints[trkltIdx].mDy, trkWork-&gt;getSnp())) &lt; 4) {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;              Hypothesis hypo(trkWork-&gt;GetNlayers(), iCandidate, trkltIdx, trkWork-&gt;GetChi2() + chi2, GetPredictedChi2(trkltPosTmpYZ, trkltCovTmp, trkWork-&gt;getPar(), trkWork-&gt;getCov()));</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;              InsertHypothesis(hypo, nCurrHypothesis, hypothesisIdxOffset);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            } <span class="comment">// end tracklet chi2 &lt; mMaxChi2</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          }   <span class="comment">// end tracklet in window</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }     <span class="comment">// tracklet loop</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }       <span class="comment">// chamber loop</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="comment">// add no update to hypothesis list</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      Hypothesis hypoNoUpdate(trkWork-&gt;GetNlayers(), iCandidate, -1, trkWork-&gt;GetChi2() + mChi2Penalty);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      InsertHypothesis(hypoNoUpdate, nCurrHypothesis, hypothesisIdxOffset);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      isOK = <span class="keyword">true</span>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    } <span class="comment">// end candidate loop</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUMC</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// in case matching tracklet exists in this layer -&gt; store position information for debugging</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">if</span> (matchAvailableAll[iLayer].<a class="code" href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a>() &gt; 0 &amp;&amp; mDebugOutput) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      mDebug-&gt;SetNmatchAvail(matchAvailableAll[iLayer].<a class="code" href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a>(), iLayer);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordtype">int</span> realTrkltId = matchAvailableAll[iLayer].at(0);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="keywordtype">int</span> realTrkltDet = mTracklets[realTrkltId].GetDetector();</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      prop-&gt;rotate(GetAlphaOfSector(mGeo-&gt;GetSector(realTrkltDet)));</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordflow">if</span> (!prop-&gt;propagateToX(mSpacePoints[realTrkltId].mR, .8f, 2.f) || GetSector(prop-&gt;getAlpha()) != mGeo-&gt;GetSector(realTrkltDet)) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a>) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          Warning(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;Track parameter at x=%f for track %i at real tracklet x=%f in layer %i cannot be retrieved (pt=%f)&quot;</span>, trkWork-&gt;getX(), iTrack, mSpacePoints[realTrkltId].mR, iLayer, trkWork-&gt;getPt());</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment">// track could be propagated, rotated and is in the same sector as the MC matching tracklet</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        mDebug-&gt;SetTrackParameterReal(*trkWork, iLayer);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordtype">float</span> zPosCorrReal = mSpacePoints[realTrkltId].mX[1] + mZCorrCoefNRC * trkWork-&gt;getTgl();</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordtype">float</span> deltaZReal = zPosCorrReal - trkWork-&gt;getZ();</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordtype">float</span> tiltCorrReal = tilt * (mSpacePoints[realTrkltId].mX[1] - trkWork-&gt;getZ());</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordtype">float</span> l_padReal = pad-&gt;GetRowSize(mTracklets[realTrkltId].GetZbin());</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">if</span> ((trkWork-&gt;getSigmaZ2() &gt;= (l_padReal * l_padReal / 12.f)) || (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(mSpacePoints[realTrkltId].mX[1] - trkWork-&gt;getZ()) &gt;= l_padReal)) {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          tiltCorrReal = 0;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> yzPosReal[2] = {mSpacePoints[realTrkltId].mX[0] - tiltCorrReal, zPosCorrReal};</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> covReal[3] = {0.};</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        RecalcTrkltCov(tilt, trkWork-&gt;getSnp(), pad-&gt;GetRowSize(mTracklets[realTrkltId].GetZbin()), covReal);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        mDebug-&gt;SetChi2Real(prop-&gt;getPredictedChi2(yzPosReal, covReal), iLayer);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        mDebug-&gt;SetChi2YZPhiReal(GetPredictedChi2(yzPosReal, covReal, trkWork-&gt;getPar(), trkWork-&gt;getCov()), iLayer);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        mDebug-&gt;SetRawTrackletPositionReal(mSpacePoints[realTrkltId].mR, mSpacePoints[realTrkltId].mX, iLayer);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        mDebug-&gt;SetCorrectedTrackletPositionReal(yzPosReal, iLayer);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        mDebug-&gt;SetTrackletPropertiesReal(mTracklets[realTrkltId].GetDetector(), iLayer);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    mDebug-&gt;SetChi2Update(mHypothesis[0 + hypothesisIdxOffset].mChi2 - t-&gt;GetChi2(), iLayer); <span class="comment">// only meaningful for ONE candidate!!!</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    mDebug-&gt;SetChi2YZPhiUpdate(mHypothesis[0 + hypothesisIdxOffset].mChi2YZPhi, iLayer);      <span class="comment">// only meaningful for ONE candidate!!!</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    mDebug-&gt;SetRoad(roadY, roadZ, iLayer);                                                    <span class="comment">// only meaningful for ONE candidate</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">bool</span> wasTrackStored = <span class="keyword">false</span>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">// --------------------------------------------------------------------------------</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// loop over the best N_candidates hypothesis</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// --------------------------------------------------------------------------------</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">// GPUInfo(&quot;nCurrHypothesis=%i, nCandidates=%i&quot;, nCurrHypothesis, nCandidates);</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">// for (int idx=0; idx&lt;10; ++idx) { GPUInfo(&quot;mHypothesis[%i]: candidateId=%i, nLayers=%i, trackletId=%i, chi2=%f&quot;, idx, mHypothesis[idx].mCandidateId,  mHypothesis[idx].mLayers, mHypothesis[idx].mTrackletId, mHypothesis[idx].mChi2); }</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iUpdate = 0; iUpdate &lt; nCurrHypothesis &amp;&amp; iUpdate &lt; mNCandidates; iUpdate++) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">if</span> (mHypothesis[iUpdate + hypothesisIdxOffset].mCandidateId == -1) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="comment">// no more candidates</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">if</span> (iUpdate == 0) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a>) {</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            Warning(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;No valid candidates for track %i in layer %i&quot;</span>, iTrack, iLayer);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;          nCandidates = 0;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      }</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      nCandidates = iUpdate + 1;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">if</span> (mNCandidates &gt; 1) {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        mCandidates[2 * iUpdate + nextIdx] = mCandidates[2 * mHypothesis[iUpdate + hypothesisIdxOffset].mCandidateId + currIdx];</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        trkWork = &amp;mCandidates[2 * iUpdate + nextIdx];</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">if</span> (mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId == -1) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="comment">// no matching tracklet found</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">if</span> (trkWork-&gt;GetIsFindable(iLayer)) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          <span class="keywordflow">if</span> (trkWork-&gt;GetNmissingConsecLayers(iLayer) &gt; mMaxMissingLy) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            trkWork-&gt;SetIsStopped();</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;          }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          trkWork-&gt;SetChi2(trkWork-&gt;GetChi2() + mChi2Penalty);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">if</span> (iUpdate == 0 &amp;&amp; mNCandidates &gt; 1) { <span class="comment">// TODO: is thie really necessary????? CHECK!</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          *t = mCandidates[2 * iUpdate + nextIdx];</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="comment">// matching tracklet found</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">if</span> (mNCandidates &gt; 1) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        prop-&gt;setTrack(trkWork);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordtype">int</span> trkltSec = mGeo-&gt;GetSector(mTracklets[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].GetDetector());</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">if</span> (trkltSec != GetSector(prop-&gt;getAlpha())) {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="comment">// if after a matching tracklet was found another sector was searched for tracklets the track needs to be rotated back</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        prop-&gt;rotate(GetAlphaOfSector(trkltSec));</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">if</span> (!prop-&gt;propagateToX(mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mR, .8f, 2.f)) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a>) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          Warning(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;Final track propagation for track %i update %i in layer %i failed&quot;</span>, iTrack, iUpdate, iLayer);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        trkWork-&gt;SetChi2(trkWork-&gt;GetChi2() + mChi2Penalty);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">if</span> (trkWork-&gt;GetIsFindable(iLayer)) {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          <span class="keywordflow">if</span> (trkWork-&gt;GetNmissingConsecLayers(iLayer) &gt;= mMaxMissingLy) {</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            trkWork-&gt;SetIsStopped();</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          }</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        }</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">if</span> (iUpdate == 0 &amp;&amp; mNCandidates &gt; 1) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;          *t = mCandidates[2 * iUpdate + nextIdx];</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      }</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordtype">float</span> tiltCorrUp = tilt * (mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mX[1] - trkWork-&gt;getZ());</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="keywordtype">float</span> zPosCorrUp = mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mX[1] + mZCorrCoefNRC * trkWork-&gt;getTgl();</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="keywordtype">float</span> l_padTrklt = pad-&gt;GetRowSize(mTracklets[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].GetZbin());</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">if</span> (!((trkWork-&gt;getSigmaZ2() &lt; (l_padTrklt * l_padTrklt / 12.f)) &amp;&amp; (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mX[1] - trkWork-&gt;getZ()) &lt; l_padTrklt))) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        tiltCorrUp = 0.f;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> trkltPosUp[2] = {mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mX[0] - tiltCorrUp, zPosCorrUp};</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> trkltCovUp[3] = {0.f};</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      RecalcTrkltCov(tilt, trkWork-&gt;getSnp(), pad-&gt;GetRowSize(mTracklets[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].GetZbin()), trkltCovUp);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUTRDDEBUG</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      prop-&gt;setTrack(&amp;trackNoUp);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      prop-&gt;rotate(GetAlphaOfSector(trkltSec));</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="comment">//prop-&gt;propagateToX(mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mR, .8f, 2.f);</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      prop-&gt;propagateToX(mR[mTracklets[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].GetDetector()], .8<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>, 2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      prop-&gt;setTrack(trkWork);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordflow">if</span> (!wasTrackStored) {</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUTRDDEBUG</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        mDebug-&gt;SetTrackParameterNoUp(trackNoUp, iLayer);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        mDebug-&gt;SetTrackParameter(*trkWork, iLayer);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        mDebug-&gt;SetRawTrackletPosition(mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mR, mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mX, iLayer);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        mDebug-&gt;SetCorrectedTrackletPosition(trkltPosUp, iLayer);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        mDebug-&gt;SetTrackletCovariance(mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mCov, iLayer);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        mDebug-&gt;SetTrackletProperties(mSpacePoints[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].mDy, mTracklets[mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId].GetDetector(), iLayer);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        wasTrackStored = <span class="keyword">true</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">if</span> (!prop-&gt;update(trkltPosUp, trkltCovUp)) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a>) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          Warning(<span class="stringliteral">&quot;FollowProlongation&quot;</span>, <span class="stringliteral">&quot;Failed to update track %i with space point in layer %i&quot;</span>, iTrack, iLayer);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        }</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        trkWork-&gt;SetChi2(trkWork-&gt;GetChi2() + mChi2Penalty);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="keywordflow">if</span> (trkWork-&gt;GetIsFindable(iLayer)) {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          <span class="keywordflow">if</span> (trkWork-&gt;GetNmissingConsecLayers(iLayer) &gt;= mMaxMissingLy) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            trkWork-&gt;SetIsStopped();</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;          }</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">if</span> (iUpdate == 0 &amp;&amp; mNCandidates &gt; 1) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;          *t = mCandidates[2 * iUpdate + nextIdx];</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="keywordflow">if</span> (!trkWork-&gt;CheckNumericalQuality()) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">ENABLE_INFO</a>) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;          <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;FollowProlongation: Track %i has invalid covariance matrix. Aborting track following\n&quot;</span>, iTrack);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      trkWork-&gt;AddTracklet(iLayer, mHypothesis[iUpdate + hypothesisIdxOffset].mTrackletId);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      trkWork-&gt;SetChi2(mHypothesis[iUpdate + hypothesisIdxOffset].mChi2);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      trkWork-&gt;SetIsFindable(iLayer);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">if</span> (iUpdate == 0 &amp;&amp; mNCandidates &gt; 1) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        *t = mCandidates[2 * iUpdate + nextIdx];</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    } <span class="comment">// end update loop</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">if</span> (!isOK) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">ENABLE_INFO</a>) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;FollowProlongation: Track %i cannot be followed. Stopped in layer %i&quot;</span>, iTrack, iLayer);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  } <span class="comment">// end layer loop</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// --------------------------------------------------------------------------------</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// add some debug information (compare labels of attached tracklets to track label)</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// and store full track information</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">// --------------------------------------------------------------------------------</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordflow">if</span> (mDebugOutput) {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordtype">int</span> update[6] = {0};</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span> (!mMCEvent) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLy = 0; iLy &lt; kNLayers; iLy++) {</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">if</span> (t-&gt;GetTracklet(iLy) != -1) {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          update[iLy] = 1;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <span class="comment">// for MC: check attached tracklets (match, related, fake)</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      <span class="keywordtype">int</span> nRelated = 0;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keywordtype">int</span> nMatching = 0;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordtype">int</span> nFake = 0;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLy = 0; iLy &lt; kNLayers; iLy++) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="keywordflow">if</span> (t-&gt;GetTracklet(iLy) != -1) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          <span class="keywordtype">int</span> lbTracklet;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> il = 0; il &lt; 3; il++) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="keywordflow">if</span> ((lbTracklet = mSpacePoints[t-&gt;GetTracklet(iLy)].mLabel[il]) &lt; 0) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;              <span class="comment">// no more valid labels</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">if</span> (lbTracklet == <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trackID)) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;              update[iLy] = 1 + il;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;              nMatching++;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUMC</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          <span class="keywordflow">if</span> (update[iLy] &lt; 1 &amp;&amp; mMCEvent) {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="comment">// no exact match, check in related labels</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="keywordtype">bool</span> isRelated = <span class="keyword">false</span>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> il = 0; il &lt; 3; il++) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;              <span class="keywordflow">if</span> (isRelated) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;              }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;              <span class="keywordflow">if</span> ((lbTracklet = mSpacePoints[t-&gt;GetTracklet(iLy)].mLabel[il]) &lt; 0) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                <span class="comment">// no more valid labels</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;              }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;              AliMCParticle* mcPart = (AliMCParticle*)mMCEvent-&gt;GetTrack(lbTracklet);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;              <span class="keywordflow">while</span> (mcPart) {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                <span class="keywordtype">int</span> motherPart = mcPart-&gt;GetMother();</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                <span class="keywordflow">if</span> (motherPart == <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(trackID)) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                  update[iLy] = 4 + il;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                  nRelated++;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                  isRelated = <span class="keyword">true</span>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                mcPart = motherPart &gt;= 0 ? (AliMCParticle*)mMCEvent-&gt;GetTrack(motherPart) : 0;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;              }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;          }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          <span class="keywordflow">if</span> (update[iLy] &lt; 1) {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            update[iLy] = 9;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            nFake++;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;          }</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      mDebug-&gt;SetTrackProperties(nMatching, nFake, nRelated);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="preprocessor">#ifdef ENABLE_GPUMC</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      AliMCParticle* mcPartDbg = (AliMCParticle*)mMCEvent-&gt;GetTrack(trackID);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordflow">if</span> (mcPartDbg) {</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        mDebug-&gt;SetMCinfo(mcPartDbg-&gt;Xv(), mcPartDbg-&gt;Yv(), mcPartDbg-&gt;Zv(), mcPartDbg-&gt;PdgCode());</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    mDebug-&gt;SetTrack(*t);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    mDebug-&gt;SetUpdates(update);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    mDebug-&gt;Output();</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Ended track following for track %i at x=%f with pt=%f&quot;</span>, t-&gt;GetTPCtrackId(), t-&gt;getX(), t-&gt;getPt());</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <a class="code" href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a>(<span class="stringliteral">&quot;Attached %i tracklets&quot;</span>, t-&gt;GetNtracklets());</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;}</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">float</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::GetPredictedChi2</a>(<span class="keyword">const</span> <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a>* pTRD, <span class="keyword">const</span> <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a>* covTRD, <span class="keyword">const</span> <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a>* pTrk, <span class="keyword">const</span> <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a>* covTrk)<span class="keyword"> const</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">// FIXME: This function cannot yet be used in production (maybe it is not necessary at all?)</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="comment">// conversion from tracklet deflection to sin(phi) needs to be parametrized</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="comment">// predict chi2 for update of track with pTrk and covTrk with TRD space point with pTRD and covTRD</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">// taking into account y, z and azimuthal angle of the track and tracklet</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">float</span> deltaY = pTrk[0] - pTRD[0];</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">float</span> deltaZ = pTrk[1] - pTRD[1];</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordtype">float</span> deltaS = pTrk[2] - pTRD[2]; <span class="comment">// FIXME: pTRD[2] is not defined, needs conversion dy -&gt; sin(phi)</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="comment">// add errors for track and space point, assume no correlation in y-sin(phi) and z-sin(phi) for space point</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordtype">float</span> sigmaZ2 = covTrk[2] + covTRD[2];</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordtype">float</span> sigmaS2 = covTrk[5] + GetAngularResolution(pTrk[2]); <span class="comment">// FIXME: convert angular resolution from dy to sin(phi) for the TRD space point</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordtype">float</span> sigmaY2 = covTrk[0] + covTRD[0];</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordtype">float</span> sigmaZS = covTrk[4];</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordtype">float</span> sigmaYS = covTrk[3];</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordtype">float</span> sigmaYZ = covTrk[1] + covTRD[1];</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="comment">// inverse of the covariance matrix</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordtype">float</span> c11 = sigmaZ2 * sigmaS2 - sigmaZS * sigmaZS;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keywordtype">float</span> c21 = sigmaZS * sigmaYS - sigmaYZ * sigmaS2;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordtype">float</span> c22 = sigmaY2 * sigmaS2 - sigmaYS * sigmaYS;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordtype">float</span> c31 = sigmaYZ * sigmaZS - sigmaZ2 * sigmaYS;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordtype">float</span> c32 = sigmaYZ * sigmaYS - sigmaY2 * sigmaZS;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordtype">float</span> c33 = sigmaY2 * sigmaZ2 - sigmaYZ * sigmaYZ;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">// determinant</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordtype">float</span> det = sigmaY2 * sigmaZ2 * sigmaS2 + 2 * sigmaYZ * sigmaZS * sigmaYS - sigmaYS * sigmaYS * sigmaZ2 - sigmaZS * sigmaZS * sigmaY2 - sigmaS2 * sigmaYZ * sigmaYZ;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(det) &lt; 1.<a class="code" href="../../d8/de9/qconfigoptions_8h.html#acc2760558000045ec0803d60d4d01c98">e</a>-10<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    printf(<span class="stringliteral">&quot;Determinant too small: %f\n&quot;</span>, det);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    det = 1.e-10<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  det = 1.f / det;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordflow">return</span> (c11 * deltaY * deltaY + 2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * c21 * deltaY * deltaZ + 2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * c31 * deltaY * deltaS + c22 * deltaZ * deltaZ + 2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * c32 * deltaZ * deltaS + c33 * deltaS * deltaS) * det;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;}</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::InsertHypothesis</a>(Hypothesis hypo, <span class="keywordtype">int</span>&amp; nCurrHypothesis, <span class="keywordtype">int</span> idxOffset)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;{</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// Insert hypothesis into the array. If the array is full and the reduced chi2 is worse</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="comment">// than the worst hypothesis in the array it is dropped.</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="comment">// The hypothesis array is always sorted.</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keywordflow">if</span> (nCurrHypothesis == 0) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="comment">// this is the first hypothesis in the array</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    mHypothesis[idxOffset] = hypo;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    ++nCurrHypothesis;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCurrHypothesis &gt; 0 &amp;&amp; nCurrHypothesis &lt; mNCandidates) {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="comment">// insert the hypothesis into the right position and shift all worse hypothesis to the right</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = idxOffset; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nCurrHypothesis + idxOffset; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <span class="keywordflow">if</span> (hypo.GetReducedChi2() &lt; mHypothesis[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].GetReducedChi2()) {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = nCurrHypothesis + idxOffset; k &gt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; --k) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          mHypothesis[k] = mHypothesis[k - 1];</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        }</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        mHypothesis[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = hypo;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        ++nCurrHypothesis;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    }</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    mHypothesis[nCurrHypothesis + idxOffset] = hypo;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    ++nCurrHypothesis;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">// array is already full, check if new hypothesis should be inserted</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = nCurrHypothesis + idxOffset - 1;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordflow">for</span> (; i &gt;= idxOffset; --<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordflow">if</span> (mHypothesis[i].GetReducedChi2() &lt; hypo.GetReducedChi2()) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    }</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">if</span> (i &lt; (nCurrHypothesis + idxOffset - 1)) {</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="comment">// new hypothesis should be inserted into the array</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = nCurrHypothesis + idxOffset - 1; k &gt; i + 1; --k) {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        mHypothesis[k] = mHypothesis[k - 1];</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      }</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      mHypothesis[i + 1] = hypo;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;}</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">int</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::GetDetectorNumber</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> zPos, <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a090ebe65994a3ee4bb60ae3472abffc5">alpha</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">// if track position is within chamber return the chamber number</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">// otherwise return -1</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordtype">int</span> stack = mGeo-&gt;GetStack(zPos, layer);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">if</span> (stack &lt; 0) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordtype">int</span> sector = GetSector(alpha);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordflow">return</span> mGeo-&gt;GetDetector(layer, stack, sector);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">bool</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::AdjustSector</a>(PROP* prop, TRDTRK* t, <span class="keyword">const</span> <span class="keywordtype">int</span> layer)<span class="keyword"> const</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="comment">// rotate track in new sector if necessary and</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">// propagate to correct x of layer</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="comment">// cancel if track crosses two sector boundaries</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="keywordtype">float</span> alpha = mGeo-&gt;GetAlpha();</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordtype">float</span> xTmp = t-&gt;getX();</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a> = t-&gt;getY();</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#ab2679729f01eb24a5c710712dab7c48a">yMax</a> = t-&gt;getX() * CAMath::Tan(0.5<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * alpha);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordtype">float</span> alphaCurr = t-&gt;getAlpha();</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(y) &gt; 2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * yMax) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">ENABLE_INFO</a>) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      Info(<span class="stringliteral">&quot;AdjustSector&quot;</span>, <span class="stringliteral">&quot;Track %i with pT = %f crossing two sector boundaries at x = %f&quot;</span>, t-&gt;GetTPCtrackId(), t-&gt;getPt(), t-&gt;getX());</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordtype">int</span> nTries = 0;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(y) &gt; <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#ab2679729f01eb24a5c710712dab7c48a">yMax</a>) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">if</span> (nTries &gt;= 2) {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordtype">int</span> sign = (y &gt; 0) ? 1 : -1;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">if</span> (!prop-&gt;rotate(alphaCurr + alpha * sign)) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">if</span> (!prop-&gt;propagateToX(xTmp, .8f, 2.f)) {</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    }</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    y = t-&gt;getY();</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    ++nTries;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  }</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;}</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">int</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::GetSector</a>(<span class="keywordtype">float</span> alpha)<span class="keyword"> const</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="comment">// TRD sector number for reference system alpha</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordflow">if</span> (alpha &lt; 0) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    alpha += 2.f * M_PI;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (alpha &gt;= 2.<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * M_PI) {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    alpha -= 2.f * M_PI;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(alpha * kNSectors / (2.f * M_PI));</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">float</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::GetAlphaOfSector</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sec)<span class="keyword"> const</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="comment">// rotation angle for TRD sector sec</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordflow">return</span> (2.0<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a> * M_PI / (<span class="keywordtype">float</span>)kNSectors * ((<span class="keywordtype">float</span>)sec + 0.5<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>));</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;}</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::RecalcTrkltCov</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> tilt, <span class="keyword">const</span> <span class="keywordtype">float</span> snp, <span class="keyword">const</span> <span class="keywordtype">float</span> rowSize, <a class="code" href="../../d4/dc3/classfloat.html">My_Float</a> (&amp;cov)[3])</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;{</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">// recalculate tracklet covariance taking track phi angle into account</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">// store the new values in cov</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="keywordtype">float</span> t2 = tilt * tilt;      <span class="comment">// tan^2 (tilt)</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="keywordtype">float</span> c2 = 1.f / (1.f + t2); <span class="comment">// cos^2 (tilt)</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordtype">float</span> sy2 = GetRPhiRes(snp);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordtype">float</span> sz2 = rowSize * rowSize / 12.f;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  cov[0] = c2 * (sy2 + t2 * sz2);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  cov[1] = c2 * tilt * (sz2 - sy2);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  cov[2] = c2 * (t2 * sy2 + sz2);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">float</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::GetAngularPull</a>(<span class="keywordtype">float</span> dYtracklet, <span class="keywordtype">float</span> snp)<span class="keyword"> const</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="keywordtype">float</span> dYtrack = ConvertAngleToDy(snp);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keywordtype">float</span> dYresolution = GetAngularResolution(snp);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="keywordflow">if</span> (dYresolution &lt; 1<a class="code" href="../../d8/de9/qconfigoptions_8h.html#acc2760558000045ec0803d60d4d01c98">e</a>-6<a class="code" href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a>) {</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">return</span> 999.f;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keywordflow">return</span> (dYtracklet - dYtrack) / CAMath::Sqrt(dYresolution);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;}</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">void</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::FindChambersInRoad</a>(<span class="keyword">const</span> TRDTRK* t, <span class="keyword">const</span> <span class="keywordtype">float</span> roadY, <span class="keyword">const</span> <span class="keywordtype">float</span> roadZ, <span class="keyword">const</span> <span class="keywordtype">int</span> iLayer, <span class="keywordtype">int</span>* det, <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> alpha)<span class="keyword"> const</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="comment">// determine initial chamber where the track ends up</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="comment">// add more chambers of the same sector or (and) neighbouring</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="comment">// stack if track is close the edge(s) of the chamber</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#ab2679729f01eb24a5c710712dab7c48a">yMax</a> = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(mGeo-&gt;GetCol0(iLayer));</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordtype">int</span> currStack = mGeo-&gt;GetStack(t-&gt;getZ(), iLayer);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordtype">int</span> currSec = GetSector(alpha);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordtype">int</span> currDet;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordtype">int</span> nDets = 0;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="keywordflow">if</span> (currStack &gt; -1) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="comment">// chamber unambiguous</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    currDet = mGeo-&gt;GetDetector(iLayer, currStack, currSec);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    det[nDets++] = currDet;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d1/d29/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDpadPlane.html">GPUTRDpadPlane</a>* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a46f57654c7668c41e9478821a1c567cd">pp</a> = mGeo-&gt;GetPadPlane(iLayer, currStack);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordtype">int</span> lastPadRow = mGeo-&gt;GetRowMax(iLayer, currStack, 0);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keywordtype">float</span> zCenter = pp-&gt;GetRowPos(lastPadRow / 2);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> ((t-&gt;getZ() + roadZ) &gt; pp-&gt;GetRowPos(0) || (t-&gt;getZ() - roadZ) &lt; pp-&gt;GetRowPos(lastPadRow)) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="keywordtype">int</span> addStack = t-&gt;getZ() &gt; zCenter ? currStack - 1 : currStack + 1;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="keywordflow">if</span> (addStack &lt; kNStacks &amp;&amp; addStack &gt; -1) {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        det[nDets++] = mGeo-&gt;GetDetector(iLayer, addStack, currSec);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(t-&gt;getZ()) &gt; zMax) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="comment">// shift track in z so it is in the TRD acceptance</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordflow">if</span> (t-&gt;getZ() &gt; 0) {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        currDet = mGeo-&gt;GetDetector(iLayer, 0, currSec);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        currDet = mGeo-&gt;GetDetector(iLayer, kNStacks - 1, currSec);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      }</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      det[nDets++] = currDet;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      currStack = mGeo-&gt;GetStack(currDet);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="comment">// track in between two stacks, add both surrounding chambers</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="comment">// gap between two stacks is 4 cm wide</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      currDet = GetDetectorNumber(t-&gt;getZ() + 4.0f, <a class="code" href="../../dc/da3/glcorearb_8h.html#a090ebe65994a3ee4bb60ae3472abffc5">alpha</a>, iLayer);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <span class="keywordflow">if</span> (currDet != -1) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        det[nDets++] = currDet;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      currDet = GetDetectorNumber(t-&gt;getZ() - 4.0f, <a class="code" href="../../dc/da3/glcorearb_8h.html#a090ebe65994a3ee4bb60ae3472abffc5">alpha</a>, iLayer);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordflow">if</span> (currDet != -1) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        det[nDets++] = currDet;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="comment">// add chamber(s) from neighbouring sector in case the track is close to the boundary</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(t-&gt;getY()) + roadY) &gt; <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#ab2679729f01eb24a5c710712dab7c48a">yMax</a>) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nStacksToSearch = nDets;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordtype">int</span> newSec;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">if</span> (t-&gt;getY() &gt; 0) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      newSec = (currSec + 1) % kNSectors;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      newSec = (currSec &gt; 0) ? currSec - 1 : kNSectors - 1;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    }</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; nStacksToSearch; ++idx) {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      currStack = mGeo-&gt;GetStack(det[idx]);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      det[nDets++] = mGeo-&gt;GetDetector(iLayer, currStack, newSec);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    }</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  }</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="comment">// skip PHOS hole and non-existing chamber 17_4_4</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iDet = 0; iDet &lt; nDets; iDet++) {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span> (!mGeo-&gt;ChamberInGeometry(det[iDet])) {</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      det[iDet] = -1;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    }</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;}</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> TRDTRK, <span class="keyword">class</span> PROP&gt;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<a class="code" href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a>() <span class="keywordtype">bool</span> <a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;TRDTRK, PROP&gt;::IsGeoFindable</a>(<span class="keyword">const</span> TRDTRK* t, <span class="keyword">const</span> <span class="keywordtype">int</span> layer, <span class="keyword">const</span> <span class="keywordtype">float</span> alpha)<span class="keyword"> const</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="comment">// returns true if track position inside active area of the TRD</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="comment">// and not too close to the boundaries</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="keywordtype">int</span> det = GetDetectorNumber(t-&gt;getZ(), <a class="code" href="../../dc/da3/glcorearb_8h.html#a090ebe65994a3ee4bb60ae3472abffc5">alpha</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a>);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="comment">// reject tracks between stacks</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">if</span> (det &lt; 0) {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  }</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">// reject tracks in PHOS hole and for non existent chamber 17_4_4</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="keywordflow">if</span> (!mGeo-&gt;ChamberInGeometry(det)) {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d1/d29/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDpadPlane.html">GPUTRDpadPlane</a>* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a46f57654c7668c41e9478821a1c567cd">pp</a> = mGeo-&gt;GetPadPlane(det);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#ab2679729f01eb24a5c710712dab7c48a">yMax</a> = pp-&gt;GetColEnd();</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordtype">float</span> zMax = pp-&gt;GetRow0();</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a> = pp-&gt;GetRowEnd();</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">float</span> epsY = 5.f;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordtype">float</span> epsZ = 5.f;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">// reject tracks closer than epsY cm to pad plane boundary</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keywordflow">if</span> (yMax - <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">CAMath::Abs</a>(t-&gt;getY()) &lt; epsY) {</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="comment">// reject tracks closer than epsZ cm to stack boundary</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">if</span> (!((t-&gt;getZ() &gt; zMin + epsZ) &amp;&amp; (t-&gt;getZ() &lt; zMax - epsZ))) {</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;}</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="preprocessor">#ifndef GPUCA_GPUCODE</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../db/df1/namespaceGPUCA__NAMESPACE.html">GPUCA_NAMESPACE</a></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;{</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="keyword">namespace </span>gpu</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;{</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">// instatiate the tracker for both for GPU data types and for AliRoot/O2 data types</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="preprocessor">#if !defined(GPUCA_STANDALONE) &amp;&amp; !defined(GPUCA_GPUCODE)</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;GPUTRDTrack, GPUTRDPropagator&gt;</a>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor">#ifndef GPUCA_ALIROOT_LIB</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUTRDTracker_t&lt;GPUTRDTrackGPU, GPUTRDPropagatorGPU&gt;</a>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;} <span class="comment">// namespace gpu</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;} <span class="comment">// namespace GPUCA_NAMESPACE</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="GPUDataTypes_8h_html_ae7b2b17b359872d7ec2cc61e99afba5f"><div class="ttname"><a href="../../d4/dc5/GPUDataTypes_8h.html#ae7b2b17b359872d7ec2cc61e99afba5f">TRDTracking</a></div><div class="ttdeci">TRDTracking</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/GPUDataTypes_8h_source.html#l00112">GPUDataTypes.h:112</a></div></div>
<div class="ttc" id="namespaceo2_1_1trd_html_a8b425351cbe27ef04f7a127da61479b3"><div class="ttname"><a href="../../d2/d76/namespaceo2_1_1trd.html#a8b425351cbe27ef04f7a127da61479b3">o2::trd::kNstack</a></div><div class="ttdeci">constexpr int kNstack</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/TRDCommonParam_8h_source.html#l00022">TRDCommonParam.h:22</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource_html_a284954b319bc158539f4c5f868d47d36a40246dd6ade2e6e83b4c45c2523e703b"><div class="ttname"><a href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a284954b319bc158539f4c5f868d47d36a40246dd6ade2e6e83b4c45c2523e703b">GPUCA_NAMESPACE::gpu::GPUMemoryResource::ALLOCATION_GLOBAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da6/GPUMemoryResource_8h_source.html#l00077">GPUMemoryResource.h:77</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a4e97b838ac96d726227da91ec35a9650"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value [n] sets TFlen for [n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char nullptr</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00044">qconfigoptions.h:44</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ab2fb5ac19001403d8210b239a4cc0a8b"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a></div><div class="ttdeci">GLenum GLuint GLint GLint layer</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01310">glcorearb.h:1310</a></div></div>
<div class="ttc" id="GPUCommonMath_8h_html"><div class="ttname"><a href="../../d6/da2/GPUCommonMath_8h.html">GPUCommonMath.h</a></div></div>
<div class="ttc" id="GPUTPCSliceData_8cxx_html_ab2679729f01eb24a5c710712dab7c48a"><div class="ttname"><a href="../../d5/d85/GPUTPCSliceData_8cxx.html#ab2679729f01eb24a5c710712dab7c48a">yMax</a></div><div class="ttdeci">float &amp; yMax</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/GPUTPCSliceData_8cxx_source.html#l00141">GPUTPCSliceData.cxx:141</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/df8/GPUConstantMem_8h_source.html#l00035">GPUConstantMem.h:35</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a2cdbb9508b46bd8f3a6039b702ebd16d"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a2cdbb9508b46bd8f3a6039b702ebd16d">t</a></div><div class="ttdeci">Visualize clusters only t</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00020">qconfigoptions.h:20</a></div></div>
<div class="ttc" id="GPULogging_8h_html_a2700ed3728abe6f865af253f6ec5830f"><div class="ttname"><a href="../../df/ddc/GPULogging_8h.html#a2700ed3728abe6f865af253f6ec5830f">GPUError</a></div><div class="ttdeci">#define GPUError(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/ddc/GPULogging_8h_source.html#l00024">GPULogging.h:24</a></div></div>
<div class="ttc" id="GPULogging_8h_html_a620d7111f66f9cb7aeaf21b8ff3e2343"><div class="ttname"><a href="../../df/ddc/GPULogging_8h.html#a620d7111f66f9cb7aeaf21b8ff3e2343">GPUInfo</a></div><div class="ttdeci">#define GPUInfo(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/ddc/GPULogging_8h_source.html#l00021">GPULogging.h:21</a></div></div>
<div class="ttc" id="GPUTPCSliceData_8cxx_html_a6114fa7e064b858b899953d905390bb1"><div class="ttname"><a href="../../d5/d85/GPUTPCSliceData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a></div><div class="ttdeci">float float &amp; zMin</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/GPUTPCSliceData_8cxx_source.html#l00141">GPUTPCSliceData.cxx:141</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource_html_a961d9118e92d6b718a40c7aee87cde7fad1a8b6c0306b39047269d18adf83b7be"><div class="ttname"><a href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fad1a8b6c0306b39047269d18adf83b7be">GPUCA_NAMESPACE::gpu::GPUMemoryResource::MEMORY_INPUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da6/GPUMemoryResource_8h_source.html#l00063">GPUMemoryResource.h:63</a></div></div>
<div class="ttc" id="GPUTRDTrackletWord_8h_html"><div class="ttname"><a href="../../df/d3c/GPUTRDTrackletWord_8h.html">GPUTRDTrackletWord.h</a></div><div class="ttdoc">TRD Tracklet word for GPU tracker - 32bit tracklet info + half chamber ID + index. </div></div>
<div class="ttc" id="glcorearb_8h_html_a3d1e3edfcf61ca2d831883e1afbad89e"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a></div><div class="ttdeci">GLsizeiptr size</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00659">glcorearb.h:659</a></div></div>
<div class="ttc" id="GPUTRDGeometry_8h_html"><div class="ttname"><a href="../../d6/d05/GPUTRDGeometry_8h.html">GPUTRDGeometry.h</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a1fe2b9d716f80da76adb19505d583dc1"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a1fe2b9d716f80da76adb19505d583dc1">f</a></div><div class="ttdeci">GLdouble f</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00310">glcorearb.h:310</a></div></div>
<div class="ttc" id="structGPUCA__NAMESPACE_1_1gpu_1_1GPUTrackingInOutPointers_html"><div class="ttname"><a href="../../d2/d7f/structGPUCA__NAMESPACE_1_1gpu_1_1GPUTrackingInOutPointers.html">GPUCA_NAMESPACE::gpu::GPUTrackingInOutPointers</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/GPUDataTypes_8h_source.html#l00225">GPUDataTypes.h:225</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a0788d3762d0c3c76e4c094d8078b4c27"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0788d3762d0c3c76e4c094d8078b4c27">n</a></div><div class="ttdeci">GLdouble n</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01982">glcorearb.h:1982</a></div></div>
<div class="ttc" id="GPUMemoryResource_8h_html"><div class="ttname"><a href="../../d5/da6/GPUMemoryResource_8h.html">GPUMemoryResource.h</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUChainTracking_html_a6b88ff84879e043607c2014cf4680df0"><div class="ttname"><a href="../../d5/d5f/classGPUCA__NAMESPACE_1_1gpu_1_1GPUChainTracking.html#a6b88ff84879e043607c2014cf4680df0">GPUCA_NAMESPACE::gpu::GPUChainTracking::DoTRDGPUTracking</a></div><div class="ttdeci">int DoTRDGPUTracking()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d58/GPUChainTracking_8cxx_source.html#l02012">GPUChainTracking.cxx:2012</a></div></div>
<div class="ttc" id="GPUReconstruction_8h_html"><div class="ttname"><a href="../../d2/de8/GPUReconstruction_8h.html">GPUReconstruction.h</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTrackerDebug_html"><div class="ttname"><a href="../../dd/d07/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTrackerDebug.html">GPUCA_NAMESPACE::gpu::GPUTRDTrackerDebug</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da6/GPUTRDTrackerDebug_8h_source.html#l00485">GPUTRDTrackerDebug.h:485</a></div></div>
<div class="ttc" id="classfloat_html"><div class="ttname"><a href="../../d4/dc3/classfloat.html">float</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_af0aa78990c130b4b2faf379a885d25f4"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#af0aa78990c130b4b2faf379a885d25f4">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::SetPointersTracklets</a></div><div class="ttdeci">void * SetPointersTracklets(void *base)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00100">GPUTRDTracker.cxx:100</a></div></div>
<div class="ttc" id="GPUTRDTracker_8cxx_html_a6a5c3884c91581d004a17abff2ec3b03"><div class="ttname"><a href="../../d9/d33/GPUTRDTracker_8cxx.html#a6a5c3884c91581d004a17abff2ec3b03">ENABLE_INFO</a></div><div class="ttdeci">#define ENABLE_INFO</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00016">GPUTRDTracker.cxx:16</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_a9f9bc08f2fa24b92d3889eaa0415e022"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a9f9bc08f2fa24b92d3889eaa0415e022">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::InitializeProcessor</a></div><div class="ttdeci">void InitializeProcessor()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00079">GPUTRDTracker.cxx:79</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDpadPlane_html"><div class="ttname"><a href="../../d1/d29/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDpadPlane.html">GPUCA_NAMESPACE::gpu::GPUTRDpadPlane</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d05/GPUTRDGeometry_8h_source.html#l00124">GPUTRDGeometry.h:124</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a090ebe65994a3ee4bb60ae3472abffc5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a090ebe65994a3ee4bb60ae3472abffc5">alpha</a></div><div class="ttdeci">GLfloat GLfloat GLfloat alpha</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00279">glcorearb.h:279</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource_html_a961d9118e92d6b718a40c7aee87cde7fa958db82784a89e22daaf3504ef1e93bc"><div class="ttname"><a href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fa958db82784a89e22daaf3504ef1e93bc">GPUCA_NAMESPACE::gpu::GPUMemoryResource::MEMORY_PERMANENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da6/GPUMemoryResource_8h_source.html#l00070">GPUMemoryResource.h:70</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTPCGMPolynomialField_html"><div class="ttname"><a href="../../d0/d97/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTPCGMPolynomialField.html">GPUCA_NAMESPACE::gpu::GPUTPCGMPolynomialField</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9c/GPUTPCGMPolynomialField_8h_source.html#l00028">GPUTPCGMPolynomialField.h:28</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="../../d6/d30/classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_a1d08e652e6d0a35a32235432717073d7"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a1d08e652e6d0a35a32235432717073d7">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::SetPointersTracks</a></div><div class="ttdeci">void * SetPointersTracks(void *base)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00113">GPUTRDTracker.cxx:113</a></div></div>
<div class="ttc" id="classParam_html"><div class="ttname"><a href="../../d7/d16/classParam.html">Param</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource_html_a284954b319bc158539f4c5f868d47d36a968ab40da0397c963a7d46f34a6bb096"><div class="ttname"><a href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a284954b319bc158539f4c5f868d47d36a968ab40da0397c963a7d46f34a6bb096">GPUCA_NAMESPACE::gpu::GPUMemoryResource::ALLOCATION_INDIVIDUAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da6/GPUMemoryResource_8h_source.html#l00076">GPUMemoryResource.h:76</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a321ff419cd5252e54cf95e64dc6687ee"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a321ff419cd5252e54cf95e64dc6687ee">result</a></div><div class="ttdeci">GLuint64EXT * result</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05662">glcorearb.h:5662</a></div></div>
<div class="ttc" id="GPUTRDTracker_8cxx_html_a78d57a9fc3823ef2a4a3daff4c4032ec"><div class="ttname"><a href="../../d9/d33/GPUTRDTracker_8cxx.html#a78d57a9fc3823ef2a4a3daff4c4032ec">ENABLE_WARNING</a></div><div class="ttdeci">#define ENABLE_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00015">GPUTRDTracker.cxx:15</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a98ac434677655cc8438bb72de2719f39"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a98ac434677655cc8438bb72de2719f39">x0</a></div><div class="ttdeci">GLuint GLfloat x0</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="GPUTRDTracker_8h_html_ab7291fe8893dd107e2154782242e60d5"><div class="ttname"><a href="../../dd/d44/GPUTRDTracker_8h.html#ab7291fe8893dd107e2154782242e60d5">TRD_GEOMETRY_CONST</a></div><div class="ttdeci">#define TRD_GEOMETRY_CONST</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d44/GPUTRDTracker_8h_source.html#l00044">GPUTRDTracker.h:44</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_a1eadedc3bf1e6948d5c2ab6638c35453"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a1eadedc3bf1e6948d5c2ab6638c35453">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::RegisterMemoryAllocation</a></div><div class="ttdeci">void RegisterMemoryAllocation()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00066">GPUTRDTracker.cxx:66</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_acc2760558000045ec0803d60d4d01c98"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#acc2760558000045ec0803d60d4d01c98">e</a></div><div class="ttdeci">Run track merging Number of iterations to Number of iterations to Number of initial iterations excluded from const char e</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00140">qconfigoptions.h:140</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_a393ffefe4b89f34b10c293d8d4089f6c"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a393ffefe4b89f34b10c293d8d4089f6c">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::mR</a></div><div class="ttdeci">float * mR</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d44/GPUTRDTracker_8h_source.html#l00210">GPUTRDTracker.h:210</a></div></div>
<div class="ttc" id="namespaceo2_1_1framework_html_ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">o2::framework::Abs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc2/BasicOps_8h_source.html#l00031">BasicOps.h:31</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDGeometry_html"><div class="ttname"><a href="../../d8/d19/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDGeometry.html">GPUCA_NAMESPACE::gpu::GPUTRDGeometry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d05/GPUTRDGeometry_8h_source.html#l00138">GPUTRDGeometry.h:138</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a49825216c96caaeb09237b36651181c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a></div><div class="ttdeci">GLuint GLfloat GLfloat GLfloat x1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="namespaceGPUCA__NAMESPACE_1_1gpu_html"><div class="ttname"><a href="../../d8/dde/namespaceGPUCA__NAMESPACE_1_1gpu.html">GPUCA_NAMESPACE::gpu</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00029">GPUCommonAlgorithm.h:29</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a74d80fd479c0f6d0153c709949a089ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00270">glcorearb.h:270</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_a23d802b53f9b1fd6c9b5f451c8ba9569"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a23d802b53f9b1fd6c9b5f451c8ba9569">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::GPUTRDTracker_t</a></div><div class="ttdeci">GPUTRDTracker_t()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00123">GPUTRDTracker.cxx:123</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a7d05960f4f1c1b11f3177dc963a45d86"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a></div><div class="ttdeci">GLint GLint GLsizei GLint GLenum GLenum type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00275">glcorearb.h:275</a></div></div>
<div class="ttc" id="GPUTRDTrackerDebug_8h_html"><div class="ttname"><a href="../../d4/da6/GPUTRDTrackerDebug_8h.html">GPUTRDTrackerDebug.h</a></div><div class="ttdoc">For performance analysis + error parametrization of the TRD tracker. </div></div>
<div class="ttc" id="GPUChainTracking_8h_html"><div class="ttname"><a href="../../db/ded/GPUChainTracking_8h.html">GPUChainTracking.h</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="standalone_8cxx_html_ae3795b92d878ebf585413ec4dce002d0"><div class="ttname"><a href="../../dc/df9/standalone_8cxx.html#ae3795b92d878ebf585413ec4dce002d0">chainTracking</a></div><div class="ttdeci">GPUChainTracking * chainTracking</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df9/standalone_8cxx_source.html#l00076">standalone.cxx:76</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a9fb99aa34f76f957d3f57fed6946e901"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a9fb99aa34f76f957d3f57fed6946e901">false</a></div><div class="ttdeci">false</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00016">qconfigoptions.h:16</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTrackletWord_html"><div class="ttname"><a href="../../d6/d2b/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTrackletWord.html">GPUCA_NAMESPACE::gpu::GPUTRDTrackletWord</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d3c/GPUTRDTrackletWord_8h_source.html#l00029">GPUTRDTrackletWord.h:29</a></div></div>
<div class="ttc" id="GPUTPCSliceData_8cxx_html_a30f18d18adf7b4869abe5f41bd87f8f3"><div class="ttname"><a href="../../d5/d85/GPUTPCSliceData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a></div><div class="ttdeci">float float float &amp; zMax</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/GPUTPCSliceData_8cxx_source.html#l00141">GPUTPCSliceData.cxx:141</a></div></div>
<div class="ttc" id="namespaceGPUCA__NAMESPACE_html"><div class="ttname"><a href="../../db/df1/namespaceGPUCA__NAMESPACE.html">GPUCA_NAMESPACE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00027">GPUCommonAlgorithm.h:27</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html">GPUCommonAlgorithm.h</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUChainTracking_html"><div class="ttname"><a href="../../d5/d5f/classGPUCA__NAMESPACE_1_1gpu_1_1GPUChainTracking.html">GPUCA_NAMESPACE::gpu::GPUChainTracking</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/ded/GPUChainTracking_8h_source.html#l00063">GPUChainTracking.h:63</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a46f57654c7668c41e9478821a1c567cd"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a46f57654c7668c41e9478821a1c567cd">pp</a></div><div class="ttdeci">Run track merging Number of iterations to Number of iterations to Number of initial iterations excluded from const char pp</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00140">qconfigoptions.h:140</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t_html_a2b307609e2a5d5363613f70b0cb6f902"><div class="ttname"><a href="../../db/db5/classGPUCA__NAMESPACE_1_1gpu_1_1GPUTRDTracker__t.html#a2b307609e2a5d5363613f70b0cb6f902">GPUCA_NAMESPACE::gpu::GPUTRDTracker_t::SetPointersBase</a></div><div class="ttdeci">void * SetPointersBase(void *base)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/GPUTRDTracker_8cxx_source.html#l00085">GPUTRDTracker.cxx:85</a></div></div>
<div class="ttc" id="GPUTRDTracker_8cxx_html_a7b8cdcf63322563549ead4a0f66a647a"><div class="ttname"><a href="../../d9/d33/GPUTRDTracker_8cxx.html#a7b8cdcf63322563549ead4a0f66a647a">GPUd</a></div><div class="ttdeci">GPUd() void GPUTRDTracker_t&lt; TRDTRK</div><div class="ttdoc">GPUCA_GPUCODE. </div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource_html_a961d9118e92d6b718a40c7aee87cde7fa60034a057fbcfa8c7146adaf61ac83b6"><div class="ttname"><a href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fa60034a057fbcfa8c7146adaf61ac83b6">GPUCA_NAMESPACE::gpu::GPUMemoryResource::MEMORY_CUSTOM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da6/GPUMemoryResource_8h_source.html#l00071">GPUMemoryResource.h:71</a></div></div>
<div class="ttc" id="classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource_html_a961d9118e92d6b718a40c7aee87cde7fa8ed7d1b38779edeb39ec963ac0f4f894"><div class="ttname"><a href="../../d8/d05/classGPUCA__NAMESPACE_1_1gpu_1_1GPUMemoryResource.html#a961d9118e92d6b718a40c7aee87cde7fa8ed7d1b38779edeb39ec963ac0f4f894">GPUCA_NAMESPACE::gpu::GPUMemoryResource::MEMORY_INOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da6/GPUMemoryResource_8h_source.html#l00066">GPUMemoryResource.h:66</a></div></div>
<div class="ttc" id="GPUTRDTracker_8h_html"><div class="ttname"><a href="../../dd/d44/GPUTRDTracker_8h.html">GPUTRDTracker.h</a></div><div class="ttdoc">Online TRD tracker based on extrapolated TPC tracks. </div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_f511f1e9c03c071966ae594f00bbc5e0.html">GPU</a></li><li class="navelem"><a class="el" href="../../dir_77030b149987c946eb2e85728f65acc0.html">GPUTracking</a></li><li class="navelem"><a class="el" href="../../dir_c5c2054ad45a3325316df490e5ea9aa8.html">TRDTracking</a></li><li class="navelem"><a class="el" href="../../d9/d33/GPUTRDTracker_8cxx.html">GPUTRDTracker.cxx</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:35 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
