<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Mapping</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d9/d09/refDetectorsMUONMCHMapping.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Mapping </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../d8/d99/refDetectorsMUONMCHMappingImpl3.html">Impl3</a></li>
<li><a class="el" href="../../d6/d23/refDetectorsMUONMCHMappingImpl4.html">Impl4</a></li>
<li><a class="el" href="../../da/d65/refDetectorsMUONMCHMappingtest.html">Tests</a></li>
<li><a class="el" href="../../d6/d23/refDetectorsMUONMCHMappingSegContour.html">Segmentation contours</a></li>
</ul>
<h1>MCH Mapping Interface</h1>
<p>Two APIs are offered to the MCH Mapping : a <a href="../../Interface/include/MCHMappingInterface/SegmentationCInterface.h">C interface</a> (the core one) and a <a href="../../Interface/include/MCHMappingInterface/Segmentation.h">C++ interface</a>.</p>
<p>The pattern of this dual interface follows the <a href="https://github.com/CppCon/CppCon2014/tree/master/Presentations/Hourglass%20Interfaces%20for%20C%2B%2B%20APIs">Hourglass idea</a>. In a nutshell, the core interface is written in C so it can be accessed easily from different languages and offers a stable ABI.</p>
<p>But most users are only exposed to a header-only <a href="../../Interface/include/MCHMappingInterface/Segmentation.h">C++ interface</a> which sits on top of this core C interface.</p>
<p>Details are to be found in the interface file or in the doxygen documentation, but the basics of the interface is :</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> detElemId{100};</div><div class="line"></div><div class="line"><a class="code" href="../../d9/dac/classo2_1_1mch_1_1mapping_1_1Segmentation.html">o2::mch::mapping::Segmentation</a> <a class="code" href="../../d8/df7/BenchCathodeSegmentation_8cxx.html#a7d4015782f4b4c82095ed284fe630183">seg</a>{detElemId};</div><div class="line"></div><div class="line"><span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>{1.5};</div><div class="line"><span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>{18.6};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>, nb;</div><div class="line">book found = <a class="code" href="../../d8/df7/BenchCathodeSegmentation_8cxx.html#a7d4015782f4b4c82095ed284fe630183">seg</a>.findPadPairByPosition(<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>, b, nb);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/BenchCathodeSegmentation_8cxx.html#a7d4015782f4b4c82095ed284fe630183">seg</a>.<a class="code" href="../../d7/dd6/classo2_1_1mch_1_1mapping_1_1CathodeSegmentation.html#aea8ccf1d775324c13c67261ccddbfb5a">isValid</a>(b)) {</div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;There is a bending pad at position &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">&lt;&lt; <span class="stringliteral">&quot; which belongs to dualSampa &quot;</span> &lt;&lt; <a class="code" href="../../d8/df7/BenchCathodeSegmentation_8cxx.html#a7d4015782f4b4c82095ed284fe630183">seg</a>.<a class="code" href="../../d7/dd6/classo2_1_1mch_1_1mapping_1_1CathodeSegmentation.html#aace8122507000d1efb341b204c98958a">padDualSampaId</a>(b)</div><div class="line">&lt;&lt; <span class="stringliteral">&quot; and has a x-size of &quot;</span> &lt;&lt; <a class="code" href="../../d8/df7/BenchCathodeSegmentation_8cxx.html#a7d4015782f4b4c82095ed284fe630183">seg</a>.<a class="code" href="../../d7/dd6/classo2_1_1mch_1_1mapping_1_1CathodeSegmentation.html#a32a28d79cf0b029f863656e2123a8304">padSizeX</a>(b) &lt;&lt; <span class="stringliteral">&quot; cm\n&quot;</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="../../d7/d94/GPUReconstructionIncludes_8h.html#a287eedb5aeb3e2204ded2924050fb641">assert</a>(b == <a class="code" href="../../d8/df7/BenchCathodeSegmentation_8cxx.html#a7d4015782f4b4c82095ed284fe630183">seg</a>.<a class="code" href="../../d7/dd6/classo2_1_1mch_1_1mapping_1_1CathodeSegmentation.html#ada39d0dd0bcf4a6ba88eaebdc2deed22">findPadByFEE</a>(76, 9));</div></div><!-- fragment --><p>Note that cathode-specific segmentations can be retrieved from <code>Segmentation</code> objects (using bending() and nonBending() methods) or created from scratch using the <code>CathodeSegmentation(int detElemId, bool isBendingPlane)</code> constructor.</p>
<h2>The <a class="el" href="../../df/d04/namespaceo2_1_1mch_1_1mapping.html#a14050c3506d942103309b5b9fe44327a">segmentation()</a> utility function</h2>
<p>To create segmentations and avoid duplicating objects, you can use the <code>segmentation</code> function (mind the lower case first letter s).</p>
<p>For instance :</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="../../dd/d50/classo2_1_1itsmft_1_1SegmentationAlpide.html">Segmentation</a>&amp; seg1 = <a class="code" href="../../df/d04/namespaceo2_1_1mch_1_1mapping.html#a14050c3506d942103309b5b9fe44327a">segmentation</a>(501);</div><div class="line">...</div><div class="line">(some code here)</div><div class="line">...</div><div class="line"><span class="keyword">auto</span>&amp; seg2 = <a class="code" href="../../df/d04/namespaceo2_1_1mch_1_1mapping.html#a14050c3506d942103309b5b9fe44327a">segmentation</a>(501);</div></div><!-- fragment --><p>will result in only one object for segmentation 501 to be created.</p>
<p>On the contrary, if you use :</p>
<div class="fragment"><div class="line"><a class="code" href="../../dd/d50/classo2_1_1itsmft_1_1SegmentationAlpide.html">Segmentation</a> seg1{501};</div><div class="line">...</div><div class="line">...</div><div class="line"><a class="code" href="../../dd/d50/classo2_1_1itsmft_1_1SegmentationAlpide.html">Segmentation</a> seg2{501};</div></div><!-- fragment --><p>two separate objects will be created (and you will be hit twice by the object creation time).</p>
<blockquote class="doxtable">
<p>Note that depending on your use case, <em>both</em> approaches might be valid ones ! While the factory one ensures you only get one object for each detection element, it creates all detection elements at once. So, if you only need the segmentation of one detection element, you'd better off <em>not</em> using the factory. </p>
</blockquote>
<h2>Implementations</h2>
<p>Currently two implementations (<a class="el" href="../../dc/de2/Detectors_2MUON_2MCH_2Mapping_2Impl3_2README_8md.html">Impl3</a> and <a class="el" href="../../d0/d79/Detectors_2MUON_2MCH_2Mapping_2Impl4_2README_8md.html">Impl4</a>, with Impl4 being the default one) are provided. Both are faster than the legacy AliRoot one (but not by an order of magnitude...). Extensive checks have been made to insure that Impl3 yields the same results as AliRoot (see the <code>vsaliroot</code> directory in the <a href="https://github.com/mrrtf/alo">alo repository</a> ). The only difference between the two implementations are the channel numbering. Impl3 uses Manu channel number, aka Run1-2 numbering, while the Impl4 uses DualSampa channel numbering, aka Run3 numbering. Impl3 is to be considered legacy and is used to deal with Run2 data only. It will be deprecated and removed at some point.</p>
<p>Note that there is some (high) level of duplication between the two libraries, but that's by design as the two libraries are meant to be completely independent : by construction they can <em>not</em> be used at the same time, and at some point in the future we'll remove Impl3 for instance. The only commonality they have is that they implement the same interface, but they should not share implementation details.</p>
<h2>Contours</h2>
<p>Besides to core API (finding pads by position and by electronic ids), we offer <a class="el" href="../../d7/d77/Detectors_2MUON_2MCH_2Mapping_2SegContour_2README_8md.html">convenience functions</a> to compute the bounding box and <a href="../../SegContour/include/MCHMappingSegContour/SegmentationContours.h">envelop of the segmentations</a>.</p>
<p><a class="el" href="../../d2/d88/classA.html">A</a> simple executable, <code>o2-mch-mapping-svg-segmentation3</code> can be used to produce <a href="https://developer.mozilla.org/en-US/docs/Web/SVG">SVG</a> plots of the segmentations.</p>
<h2>Tests</h2>
<p><a class="el" href="../../d2/d88/classA.html">A</a> collection of <a class="el" href="../../d7/dbf/Detectors_2Base_2test_2README_8md.html">tests</a> (with or without input) are available.</p>
<h2>Command line interface (CLI)</h2>
<p><a class="el" href="../../d2/d88/classA.html">A</a> very basic CLI is provided for each implementation : <code>o2-mch-mapping-cli3</code> or <code>o2-mch-mapping-cli4</code>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dff/refDetectorsMUON.html">MUON</a></li><li class="navelem"><a class="el" href="../../d0/daf/refDetectorsMUONMCH.html">MCH</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:40 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
