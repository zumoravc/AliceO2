<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/MUON/MCH/Tracking/src/TrackFinderOriginal.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/d6d/TrackFinderOriginal_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TrackFinderOriginal.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d6d/TrackFinderOriginal_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d7f/TrackFinderOriginal_8h.html">TrackFinderOriginal.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;TGeoGlobalMagField.h&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;TMatrixD.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;TMath.h&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/MagneticField_8h.html">Field/MagneticField.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h.html">TrackExtrap.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">namespace </span>mch</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;constexpr <span class="keywordtype">float</span> TrackFinderOriginal::SDefaultChamberZ[10];</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;constexpr <span class="keywordtype">double</span> TrackFinderOriginal::SChamberThicknessInX0[10];</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;constexpr <span class="keywordtype">bool</span> TrackFinderOriginal::SRequestStation[5];</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#ac72415d34e9e5b505d6a435f0628a1f0">   40</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#ac72415d34e9e5b505d6a435f0628a1f0">TrackFinderOriginal::init</a>(<span class="keywordtype">float</span> l3Current, <span class="keywordtype">float</span> dipoleCurrent)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">// Create the magnetic field map if not already done</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  mTrackFitter.initField(l3Current, dipoleCurrent);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">// Enable the track smoother</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  mTrackFitter.smoothTracks(<span class="keyword">true</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// Set the maximum MCS angle in chamber from the minimum acceptable momentum</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>{};</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordtype">double</span> inverseBendingP = (SMinBendingMomentum &gt; 0.) ? 1. / SMinBendingMomentum : 1.;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">setInverseBendingMomentum</a>(inverseBendingP);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt; 10; ++iCh) {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    mMaxMCSAngle2[iCh] = <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">TrackExtrap::getMCSAngle2</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>, SChamberThicknessInX0[iCh], 1.);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#a142cdf59fb39bc472f9bad816761a1fe">   60</a></span>&#160;<span class="keyword">const</span> std::list&lt;Track&gt;&amp; <a class="code" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#a142cdf59fb39bc472f9bad816761a1fe">TrackFinderOriginal::findTracks</a>(<span class="keyword">const</span> std::array&lt;std::list&lt;Cluster&gt;, 10&gt;* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;\n------------------ Start the original track finder ------------------&quot;</span>);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  mClusters = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  mTracks.clear();</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// Look for candidates from clusters in stations(1..) 4 and 5</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;\n--&gt; Step 1: find track candidates\n&quot;</span>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keyword">auto</span> tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  findTrackCandidates();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keyword">auto</span> tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  mTimeFindCandidates += tEnd - tStart;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span> (mMoreCandidates) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    findMoreTrackCandidates();</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    mTimeFindMoreCandidates += tEnd - tStart;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  mNCandidates += mTracks.size();</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// Stop tracking if no candidate found</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span> (mTracks.empty()) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">return</span> mTracks;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// Follow tracks in stations(1..) 3, 2 then 1</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;\n--&gt; Step 2: Follow track candidates\n&quot;</span>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  followTracks(mTracks.begin(), mTracks.end(), 2);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  mTimeFollowTracks += tEnd - tStart;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// Complete the reconstructed tracks</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">if</span> (completeTracks()) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    printTracks();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    removeDuplicateTracks();</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  mTimeCompleteTracks += tEnd - tStart;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  printTracks();</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// Improve the reconstructed tracks</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  improveTracks();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  mTimeImproveTracks += tEnd - tStart;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  printTracks();</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// Remove connected tracks in stations(1..) 3, 4 and 5</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  removeConnectedTracks(3, 4);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  removeConnectedTracks(2, 2);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  mTimeCleanTracks += tEnd - tStart;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Set the final track parameters and covariances</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  finalize();</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  printTracks();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">  // Refit the reconstructed tracks with a different resolution for mono-cathod clusters</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">  discardMonoCathodClusters();</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> mTracks;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::findTrackCandidates()</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iSt = 4; iSt &gt;= 3; --iSt) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// Find track candidates in the station</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keyword">auto</span> itTrack = findTrackCandidates(2 * iSt, 2 * iSt + 1);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">for</span> (; itTrack != mTracks.end();) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">// Look for compatible clusters in the other station</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keyword">auto</span> itNewTrack = followTrackInStation(itTrack, 7 - iSt);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;new candidates starting at position #&quot;</span>, getTrackIndex(itNewTrack));</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="comment">// Keep the current candidate only if no compatible cluster is found and the station is not requested</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">if</span> (!SRequestStation[7 - iSt] &amp;&amp; itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        ++itTrack;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing original candidate now at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// Make sure each candidate is unique</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  printTracks();</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  removeDuplicateTracks();</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  printTracks();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Refitting tracks&quot;</span>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">auto</span> itTrack(mTracks.begin());</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">while</span> (itTrack != mTracks.end()) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="comment">// Refit tracks using the Kalman filter</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      mTrackFitter.fit(*itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="comment">// Make sure they pass the selections</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (!isAcceptable(itTrack-&gt;first())) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        ++itTrack;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  printTracks();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::findMoreTrackCandidates()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">// create an iterator to the last track of the list before adding new ones</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keyword">auto</span> itCurrentTrack = mTracks.empty() ? mTracks.end() : std::prev(mTracks.end());</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh1 = 6; iCh1 &lt;= 7; ++iCh1) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh2 = 8; iCh2 &lt;= 9; ++iCh2) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="comment">// Find track candidates between these 2 chambers</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keyword">auto</span> itTrack = findTrackCandidates(iCh1, iCh2, <span class="keyword">true</span>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">for</span> (; itTrack != mTracks.end();) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">// Look for compatible clusters in the second chamber of station (1..) 5</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keyword">auto</span> itNewTrack = followLinearTrackInChamber(itTrack, 17 - iCh2);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;new candidates starting at position #&quot;</span>, getTrackIndex(itNewTrack));</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// Keep the current candidate only if no compatible cluster is found</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">if</span> (itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          itNewTrack = itTrack;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          ++itTrack;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing original candidate now at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;          itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">for</span> (; itNewTrack != itTrack;) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;          <span class="comment">// Look for compatible clusters in the second chamber of station (1..) 4</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          <span class="keyword">auto</span> itNewNewTrack = followLinearTrackInChamber(itNewTrack, 13 - iCh1);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;new candidates starting at position #&quot;</span>, getTrackIndex(itNewNewTrack));</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          <span class="comment">// Keep the current candidate only if no compatible cluster is found</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          <span class="keywordflow">if</span> (itNewNewTrack == mTracks.end()) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            ++itNewTrack;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing original candidate now at position #&quot;</span>, getTrackIndex(itNewTrack));</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            itNewTrack = mTracks.erase(itNewTrack);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;          }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Refitting tracks&quot;</span>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  itCurrentTrack = (itCurrentTrack == mTracks.end()) ? mTracks.begin() : ++itCurrentTrack;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">while</span> (itCurrentTrack != mTracks.end()) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">// Refit tracks using the Kalman filter</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      mTrackFitter.fit(*itCurrentTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">// Make sure they pass the selections</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordflow">if</span> (!isAcceptable(itCurrentTrack-&gt;first())) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itCurrentTrack));</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        itCurrentTrack = mTracks.erase(itCurrentTrack);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        ++itCurrentTrack;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itCurrentTrack));</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      itCurrentTrack = mTracks.erase(itCurrentTrack);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  printTracks();</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;std::list&lt;Track&gt;::iterator TrackFinderOriginal::findTrackCandidates(<span class="keywordtype">int</span> ch1, <span class="keywordtype">int</span> ch2, <span class="keywordtype">bool</span> skipUsedPairs)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Looking for candidates between chamber &quot;</span>, ch1, <span class="stringliteral">&quot; and &quot;</span>, ch2);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">double</span> bendingVertexDispersion2 = SBendingVertexDispersion * SBendingVertexDispersion;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// maximum impact parameter dispersion**2 due to MCS in chambers</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordtype">double</span> impactMCS2(0.);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt;= ch1; ++iCh) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    impactMCS2 += SDefaultChamberZ[iCh] * SDefaultChamberZ[iCh] * mMaxMCSAngle2[iCh];</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// create an iterator to the last track of the list before adding new ones</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keyword">auto</span> itTrack = mTracks.empty() ? mTracks.end() : std::prev(mTracks.end());</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster1 : mClusters-&gt;at(ch1)) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">z1</a> = cluster1.getZ();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster2 : mClusters-&gt;at(ch2)) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="comment">// skip combinations of clusters already part of a track if requested</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">if</span> (skipUsedPairs &amp;&amp; areUsed(cluster1, cluster2)) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a1e60213b0a0658ac2a9ee86f18ef0f95">z2</a> = cluster2.getZ();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordtype">double</span> dZ = z1 - <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a1e60213b0a0658ac2a9ee86f18ef0f95">z2</a>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">// check if non bending impact parameter is within tolerances</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordtype">double</span> nonBendingSlope = (cluster1.getX() - cluster2.getX()) / dZ;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordtype">double</span> nonBendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(cluster1.getX() - cluster1.getZ() * nonBendingSlope);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordtype">double</span> nonBendingImpactParamErr = TMath::Sqrt((z1 * z1 * cluster2.getEx2() + z2 * z2 * cluster1.getEx2()) / dZ / dZ + impactMCS2);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">if</span> ((nonBendingImpactParam - SSigmaCutForTracking * nonBendingImpactParamErr) &gt; (3. * SNonBendingVertexDispersion)) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordtype">double</span> bendingSlope = (cluster1.getY() - cluster2.getY()) / dZ;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>()) { <span class="comment">// depending whether the field is ON or OFF</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// check if bending momentum is within tolerances</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordtype">double</span> bendingImpactParam = cluster1.getY() - cluster1.getZ() * bendingSlope;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordtype">double</span> bendingImpactParamErr2 = (z1 * z1 * cluster2.getEy2() + z2 * z2 * cluster1.getEy2()) / dZ / dZ + impactMCS2;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordtype">double</span> bendingMomentum = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">TrackExtrap::getBendingMomentumFromImpactParam</a>(bendingImpactParam));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordtype">double</span> bendingMomentumErr = TMath::Sqrt((bendingVertexDispersion2 + bendingImpactParamErr2) / bendingImpactParam / bendingImpactParam + 0.01) * bendingMomentum;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">if</span> ((bendingMomentum + 3. * bendingMomentumErr) &lt; SMinBendingMomentum) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">// or check if bending impact parameter is within tolerances</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordtype">double</span> bendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(cluster1.getY() - cluster1.getZ() * bendingSlope);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordtype">double</span> bendingImpactParamErr = TMath::Sqrt((z1 * z1 * cluster2.getEy2() + z2 * z2 * cluster1.getEy2()) / dZ / dZ + impactMCS2);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span> ((bendingImpactParam - SSigmaCutForTracking * bendingImpactParamErr) &gt; (3. * SBendingVertexDispersion)) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="comment">// create a new track candidate</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      createTrack(cluster1, cluster2);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">return</span> (itTrack == mTracks.end()) ? mTracks.begin() : ++itTrack;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordtype">bool</span> TrackFinderOriginal::areUsed(<span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl1, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl2)</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; track : mTracks) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordtype">bool</span> cl1Used(<span class="keyword">false</span>), cl2Used(<span class="keyword">false</span>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = track.rbegin(); itParam != track.rend(); ++itParam) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">if</span> (itParam-&gt;getClusterPtr() == &amp;cl1) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        cl1Used = <span class="keyword">true</span>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itParam-&gt;getClusterPtr() == &amp;cl2) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        cl2Used = <span class="keyword">true</span>;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keywordflow">if</span> (cl1Used &amp;&amp; cl2Used) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::createTrack(<span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl1, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl2)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;{</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Creating a new candidate&quot;</span>);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">// create the track and the trackParam at each cluster</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  mTracks.emplace_back();</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param2 = mTracks.back().createParamAtCluster(cl2);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param1 = mTracks.back().createParamAtCluster(cl1);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// Compute track parameters</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">double</span> dZ = cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() - cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>();</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordtype">double</span> nonBendingSlope = (cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>() - cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>()) / dZ;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">double</span> bendingSlope = (cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>() - cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>()) / dZ;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">double</span> bendingImpact = cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>() - cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * bendingSlope;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">double</span> inverseBendingMomentum = 1. / <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">TrackExtrap::getBendingMomentumFromImpactParam</a>(bendingImpact);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// Set track parameters at first cluster</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  param1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>());</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  param1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a31171def877b3bf1a6c62fabe8606a32">setNonBendingSlope</a>(nonBendingSlope);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  param1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>());</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  param1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a15fb665a79024f2e0653a4cb3b94d068">setBendingSlope</a>(bendingSlope);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  param1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">setInverseBendingMomentum</a>(inverseBendingMomentum);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// Set track parameters at last cluster</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  param2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>());</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  param2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a31171def877b3bf1a6c62fabe8606a32">setNonBendingSlope</a>(nonBendingSlope);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  param2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>());</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  param2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a15fb665a79024f2e0653a4cb3b94d068">setBendingSlope</a>(bendingSlope);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  param2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">setInverseBendingMomentum</a>(inverseBendingMomentum);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">// Compute and set track parameters covariances at first cluster</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  TMatrixD paramCov(5, 5);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  paramCov.Zero();</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// Non bending plane</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordtype">double</span> cl1Ex2 = cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">getEx2</a>();</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordtype">double</span> cl2Ex2 = cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">getEx2</a>();</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  paramCov(0, 0) = cl1Ex2;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  paramCov(0, 1) = cl1Ex2 / dZ;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  paramCov(1, 0) = paramCov(0, 1);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  paramCov(1, 1) = (cl1Ex2 + cl2Ex2) / dZ / dZ;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">// Bending plane</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordtype">double</span> cl1Ey2 = cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">getEy2</a>();</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">double</span> cl2Ey2 = cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">getEy2</a>();</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  paramCov(2, 2) = cl1Ey2;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  paramCov(2, 3) = cl1Ey2 / dZ;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  paramCov(3, 2) = paramCov(2, 3);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  paramCov(3, 3) = (cl1Ey2 + cl2Ey2) / dZ / dZ;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">// Inverse bending momentum (vertex resolution + bending slope resolution + 10% error on dipole parameters+field)</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>()) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    paramCov(4, 4) = ((SBendingVertexDispersion * SBendingVertexDispersion +</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                       (cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl2Ey2 + cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl1Ey2) / dZ / dZ) /</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        bendingImpact / bendingImpact +</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                      0.1 * 0.1) *</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                     inverseBendingMomentum * inverseBendingMomentum;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    paramCov(2, 4) = -cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl1Ey2 * inverseBendingMomentum / bendingImpact / dZ;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    paramCov(4, 2) = paramCov(2, 4);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    paramCov(3, 4) = -(cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl2Ey2 + cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl1Ey2) * inverseBendingMomentum / bendingImpact / dZ / dZ;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    paramCov(4, 3) = paramCov(3, 4);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    paramCov(4, 4) = inverseBendingMomentum * inverseBendingMomentum;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  param1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(paramCov);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// Compute and set track parameters covariances at last cluster</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">// Non bending plane</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  paramCov(0, 0) = cl2Ex2;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  paramCov(0, 1) = -cl2Ex2 / dZ;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  paramCov(1, 0) = paramCov(0, 1);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">// Bending plane</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  paramCov(2, 2) = cl2Ey2;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  paramCov(2, 3) = -cl2Ey2 / dZ;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  paramCov(3, 2) = paramCov(2, 3);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="comment">// Inverse bending momentum (vertex resolution + bending slope resolution + 10% error on dipole parameters+field)</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>()) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    paramCov(2, 4) = cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() * cl2Ey2 * inverseBendingMomentum / bendingImpact / dZ;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    paramCov(4, 2) = paramCov(2, 4);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  param2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(paramCov);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  printTrackParam(param1);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordtype">bool</span> TrackFinderOriginal::isAcceptable(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; paramCov = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordtype">int</span> chamber = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>();</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">getZ</a>();</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// impact parameter dispersion**2 due to MCS in chambers</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">double</span> impactMCS2(0.);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>() &amp;&amp; chamber &lt; 6) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// track momentum is known</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt;= chamber; ++iCh) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      impactMCS2 += SDefaultChamberZ[iCh] * SDefaultChamberZ[iCh] * <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">TrackExtrap::getMCSAngle2</a>(param, SChamberThicknessInX0[iCh], 1.);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// track momentum is unknown</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">for</span> (Int_t iCh = 0; iCh &lt;= chamber; ++iCh) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      impactMCS2 += SDefaultChamberZ[iCh] * SDefaultChamberZ[iCh] * mMaxMCSAngle2[iCh];</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">// check if non bending impact parameter is within tolerances</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordtype">double</span> nonBendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>() - z * param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7996f6bdfe1ebde73d35a5afb0cfddf8">getNonBendingSlope</a>());</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordtype">double</span> nonBendingImpactParamErr = TMath::Sqrt(paramCov(0, 0) + z * z * paramCov(1, 1) - 2. * z * paramCov(0, 1) + impactMCS2);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span> ((nonBendingImpactParam - SSigmaCutForTracking * nonBendingImpactParamErr) &gt; (3. * SNonBendingVertexDispersion)) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>()) { <span class="comment">// depending whether the field is ON or OFF</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">// check if bending momentum is within tolerances</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordtype">double</span> bendingMomentum = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(1. / param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0311a27a83ed443fe3ebcfac7563fb6e">getInverseBendingMomentum</a>());</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">double</span> bendingMomentumErr = TMath::Sqrt(paramCov(4, 4)) * bendingMomentum * bendingMomentum;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">if</span> (chamber &lt; 6 &amp;&amp; (bendingMomentum + SSigmaCutForTracking * bendingMomentumErr) &lt; SMinBendingMomentum) {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((bendingMomentum + 3. * bendingMomentumErr) &lt; SMinBendingMomentum) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// or check if bending impact parameter is within tolerances</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordtype">double</span> bendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>() - z * param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad8aec7a026adb273c2a04ec99bfa9241">getBendingSlope</a>());</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">double</span> bendingImpactParamErr = TMath::Sqrt(paramCov(2, 2) + z * z * paramCov(3, 3) - 2. * z * paramCov(2, 3) + impactMCS2);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> ((bendingImpactParam - SSigmaCutForTracking * bendingImpactParamErr) &gt; (3. * SBendingVertexDispersion)) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;}</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::removeDuplicateTracks()</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;{</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Remove duplicated tracks&quot;</span>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack1 = mTracks.begin(); itTrack1 != mTracks.end();) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">int</span> nClusters1 = itTrack1-&gt;getNClusters();</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">bool</span> track1Removed(<span class="keyword">false</span>);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack2 = std::next(itTrack1); itTrack2 != mTracks.end();) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordtype">int</span> nClusters2 = itTrack2-&gt;getNClusters();</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordtype">int</span> nClustersInCommon = itTrack2-&gt;getNClustersInCommon(*itTrack1);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (nClustersInCommon == nClusters2) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack2));</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        itTrack2 = mTracks.erase(itTrack2);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nClustersInCommon == nClusters1) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack1));</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        itTrack1 = mTracks.erase(itTrack1);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        track1Removed = <span class="keyword">true</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        ++itTrack2;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (!track1Removed) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      ++itTrack1;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::removeConnectedTracks(<span class="keywordtype">int</span> stMin, <span class="keywordtype">int</span> stMax)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;{</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Remove connected tracks in stations [&quot;</span>, stMin, <span class="stringliteral">&quot;, &quot;</span>, stMax, <span class="stringliteral">&quot;]&quot;</span>);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">// first loop to tag the tracks to remove...</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack1 = mTracks.begin(); itTrack1 != mTracks.end(); ++itTrack1) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack2 = std::next(itTrack1); itTrack2 != mTracks.end(); ++itTrack2) {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">if</span> (itTrack2-&gt;getNClustersInCommon(*itTrack1, stMin, stMax) &gt; 0) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">if</span> (itTrack2-&gt;isBetter(*itTrack1)) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          itTrack1-&gt;connected();</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          itTrack2-&gt;connected();</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// ...then remove them. That way all combinations are tested.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;isConnected()) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      ++itTrack;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;}</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::followTracks(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itTrackBegin,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                       <span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itTrackEnd, <span class="keywordtype">int</span> nextStation)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;{</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Follow track candidates #&quot;</span>, getTrackIndex(itTrackBegin), <span class="stringliteral">&quot; to #&quot;</span>, getTrackIndex(std::prev(itTrackEnd)), <span class="stringliteral">&quot; in station &quot;</span>, nextStation);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = itTrackBegin; itTrack != itTrackEnd;) {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">// Look for compatible clusters in the next station</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keyword">auto</span> itNewTrack = followTrackInStation(itTrack, nextStation);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// Try to recover the track if no compatible cluster is found</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="comment">// Keep the case where no cluster is found as a possible candidate if the next station is not requested</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">if</span> (!SRequestStation[nextStation]) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Duplicate original candidate&quot;</span>);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        itTrack = mTracks.emplace(itTrack, *itTrack);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="comment">// Try to recover</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      itNewTrack = recoverTrack(itTrack, nextStation);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">// Remove the initial candidate or its copy</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing original candidate or its copy at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">// If the next station is not requested, we can at minimum continue with the initial candidate</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">if</span> (!SRequestStation[nextStation]) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          itNewTrack = itTrack;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        ++itTrack;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">// Or remove the initial candidate if new candidates have been produced</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing original candidate now at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Currently &quot;</span>, mTracks.size(), <span class="stringliteral">&quot; candidates&quot;</span>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    printTracks();</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">// follow the new candidates, if any, down to the first station</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (itNewTrack != mTracks.end() &amp;&amp; nextStation != 0) {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      followTracks(itNewTrack, itTrack, nextStation - 1);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;std::list&lt;Track&gt;::iterator TrackFinderOriginal::followTrackInStation(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keywordtype">int</span> nextStation)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;{</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Follow track candidate #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; in station &quot;</span>, nextStation);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keyword">auto</span> itNewTrack(itTrack);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> extrapTrackParamAtCluster1{};</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> extrapTrackParamAtCluster2{};</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> extrapTrackParam{};</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// Order the chambers according to the propagation direction (tracking starts with ch2):</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// - nextStation == station(1...) 5 =&gt; forward propagation</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">// - nextStation &lt; station(1...) 5 =&gt; backward propagation</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordtype">int</span> ch1(0), ch2(0);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">if</span> (nextStation == 4) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    ch1 = 2 * nextStation + 1;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    ch2 = 2 * nextStation;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    ch1 = 2 * nextStation;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    ch2 = 2 * nextStation + 1;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">// Maximum chi2 to accept a cluster candidate (the factor 2 is for the 2 degrees of freedom: x and y)</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordtype">double</span> maxChi2OfCluster = 2. * SSigmaCutForTracking * SSigmaCutForTracking;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">// Get the current track parameters according to the propagation direction</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> extrapTrackParamAtCh = (nextStation == 4) ? itTrack-&gt;last() : itTrack-&gt;first();</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="comment">// Add MCS effects in the current chamber</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordtype">int</span> currentChamber(extrapTrackParamAtCh.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>());</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;extrapTrackParamAtCh, SChamberThicknessInX0[currentChamber], -1.);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">// Reset the propagator for the smoother</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">if</span> (mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    extrapTrackParamAtCh.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ae233ce574fef4f6f53569dd50c805a05">resetPropagator</a>();</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">// Add MCS effects in the missing chamber(s) if any</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordflow">while</span> (ch1 &lt; ch2 &amp;&amp; currentChamber &gt; ch2 + 1) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    --currentChamber;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;extrapTrackParamAtCh, SDefaultChamberZ[currentChamber],</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                   mTrackFitter.isSmootherEnabled())) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;extrapTrackParamAtCh, SChamberThicknessInX0[currentChamber], -1.);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="comment">//Extrapolate the track candidate to chamber 2</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;extrapTrackParamAtCh, SDefaultChamberZ[ch2], mTrackFitter.isSmootherEnabled())) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="comment">// Prepare to remember the clusters used in ch1 in combination with a cluster in ch2</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  std::vector&lt;bool&gt; clusterCh1Used(mClusters-&gt;at(ch1).size(), <span class="keyword">false</span>);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// Look for cluster candidates in chamber 2</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; clusterCh2 : mClusters-&gt;at(ch2)) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">// Fast try to add the current cluster</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span> (!tryOneClusterFast(extrapTrackParamAtCh, clusterCh2)) {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Try to add the current cluster accurately</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (tryOneCluster(extrapTrackParamAtCh, clusterCh2, extrapTrackParamAtCluster2,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                      mTrackFitter.isSmootherEnabled()) &gt;= maxChi2OfCluster) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// Save the extrapolated parameters and covariances for the smoother</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">if</span> (mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      extrapTrackParamAtCluster2.setExtrapParameters(extrapTrackParamAtCluster2.getParameters());</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      extrapTrackParamAtCluster2.setExtrapCovariances(extrapTrackParamAtCluster2.getCovariances());</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">// Compute the new track parameters including clusterCh2 using the Kalman filter</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      mTrackFitter.runKalmanFilter(extrapTrackParamAtCluster2);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// skip tracks out of limits</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">if</span> (!isAcceptable(extrapTrackParamAtCluster2)) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// copy the new track parameters for the next step and add MCS effects in chamber 2</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    extrapTrackParam = extrapTrackParamAtCluster2;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;extrapTrackParam, SChamberThicknessInX0[ch2], -1.);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// Reset the propagator for the smoother</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">if</span> (mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      extrapTrackParam.resetPropagator();</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">//Extrapolate the track candidate to chamber 1</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordtype">bool</span> foundSecondCluster(<span class="keyword">false</span>);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;extrapTrackParam, SDefaultChamberZ[ch1], mTrackFitter.isSmootherEnabled())) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="comment">// look for second cluster candidates in chamber 1</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordtype">int</span> iCluster1(-1);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; clusterCh1 : mClusters-&gt;at(ch1)) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        ++iCluster1;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="comment">// Fast try to add the current cluster</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">if</span> (!tryOneClusterFast(extrapTrackParam, clusterCh1)) {</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="comment">// Try to add the current cluster accurately</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keywordflow">if</span> (tryOneCluster(extrapTrackParam, clusterCh1, extrapTrackParamAtCluster1,</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                          mTrackFitter.isSmootherEnabled()) &gt;= maxChi2OfCluster) {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="comment">// Save the extrapolated parameters and covariances for the smoother</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">if</span> (mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;          extrapTrackParamAtCluster1.setExtrapParameters(extrapTrackParamAtCluster1.getParameters());</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          extrapTrackParamAtCluster1.setExtrapCovariances(extrapTrackParamAtCluster1.getCovariances());</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="comment">// Compute the new track parameters including clusterCh1 using the Kalman filter</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          mTrackFitter.runKalmanFilter(extrapTrackParamAtCluster1);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="comment">// Skip tracks out of limits</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">if</span> (!isAcceptable(extrapTrackParamAtCluster1)) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="comment">// Copy the initial candidate into a new track with these 2 clusters added</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Duplicate the candidate&quot;</span>);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        itNewTrack = mTracks.emplace(itNewTrack, *itTrack);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        updateTrack(*itNewTrack, extrapTrackParamAtCluster1, extrapTrackParamAtCluster2);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="comment">// Tag clusterCh1 as used</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        clusterCh1Used[iCluster1] = <span class="keyword">true</span>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        foundSecondCluster = <span class="keyword">true</span>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">// If no clusterCh1 found then copy the initial candidate into a new track with only clusterCh2 added</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">if</span> (!foundSecondCluster) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Duplicate the candidate&quot;</span>);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      itNewTrack = mTracks.emplace(itNewTrack, *itTrack);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      updateTrack(*itNewTrack, extrapTrackParamAtCluster2);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">// Add MCS effects in chamber 2</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;extrapTrackParamAtCh, SChamberThicknessInX0[ch2], -1.);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">//Extrapolate the track candidate to chamber 1</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;extrapTrackParamAtCh, SDefaultChamberZ[ch1], mTrackFitter.isSmootherEnabled())) {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span> (itNewTrack == itTrack) ? mTracks.end() : itNewTrack;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="comment">// look for cluster candidates not already used in chamber 1</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordtype">int</span> iCluster1(-1);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; clusterCh1 : mClusters-&gt;at(ch1)) {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    ++iCluster1;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">if</span> (clusterCh1Used[iCluster1]) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Fast try to add the current cluster</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">if</span> (!tryOneClusterFast(extrapTrackParamAtCh, clusterCh1)) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">// Try to add the current cluster accurately</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (tryOneCluster(extrapTrackParamAtCh, clusterCh1, extrapTrackParamAtCluster1,</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                      mTrackFitter.isSmootherEnabled()) &gt;= maxChi2OfCluster) {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">// Save the extrapolated parameters and covariances for the smoother</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">if</span> (mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      extrapTrackParamAtCluster1.setExtrapParameters(extrapTrackParamAtCluster1.getParameters());</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      extrapTrackParamAtCluster1.setExtrapCovariances(extrapTrackParamAtCluster1.getCovariances());</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">// Compute the new track parameters including clusterCh1 using the Kalman filter</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      mTrackFitter.runKalmanFilter(extrapTrackParamAtCluster1);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">// Skip tracks out of limits</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">if</span> (!isAcceptable(extrapTrackParamAtCluster1)) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">// Copy the initial candidate into a new track with clusterCh1 added</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Duplicate the candidate&quot;</span>);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    itNewTrack = mTracks.emplace(itNewTrack, *itTrack);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    updateTrack(*itNewTrack, extrapTrackParamAtCluster1);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">return</span> (itNewTrack == itTrack) ? mTracks.end() : itNewTrack;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;}</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;std::list&lt;Track&gt;::iterator TrackFinderOriginal::followLinearTrackInChamber(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keywordtype">int</span> nextChamber)</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;{</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Follow track candidate #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; in chamber &quot;</span>, nextChamber);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  printTrackParam(itTrack-&gt;first());</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keyword">auto</span> itNewTrack(itTrack);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> extrapTrackParamAtCluster{};</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// Maximum chi2 to accept a cluster candidate (the factor 2 is for the 2 degrees of freedom: x and y)</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">double</span> maxChi2OfCluster = 2. * SSigmaCutForTracking * SSigmaCutForTracking;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">// Get the current track parameters according to the propagation direction</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> trackParam = (nextChamber &gt; 7) ? itTrack-&gt;last() : itTrack-&gt;first();</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="comment">// Add MCS effects in the current chamber</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;trackParam, SChamberThicknessInX0[trackParam.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>()], -1.);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">// Look for cluster candidates in the next chamber</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster : mClusters-&gt;at(nextChamber)) {</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="comment">// Fast try to add the current cluster</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">if</span> (!tryOneClusterFast(trackParam, cluster)) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// propagate linearly the track to the z position of the current cluster</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    extrapTrackParamAtCluster = trackParam;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6a38a16a9b79f77e515a8c3b76eebdd7">TrackExtrap::linearExtrapToZCov</a>(&amp;extrapTrackParamAtCluster, cluster.getZ());</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">// Try to add the current cluster accurately</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span> (tryOneCluster(extrapTrackParamAtCluster, cluster, extrapTrackParamAtCluster, <span class="keyword">false</span>) &gt;= maxChi2OfCluster) {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    }</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="comment">// Copy the initial candidate into a new track with cluster added</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Duplicate the candidate&quot;</span>);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    itNewTrack = mTracks.emplace(itNewTrack, *itTrack);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    updateTrack(*itNewTrack, extrapTrackParamAtCluster);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordflow">return</span> (itNewTrack == itTrack) ? mTracks.end() : itNewTrack;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;}</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="keywordtype">bool</span> TrackFinderOriginal::tryOneClusterFast(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cluster)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;{</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  ++mNCallTryOneClusterFast;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordtype">double</span> dZ = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() - param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">getZ</a>();</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordtype">double</span> dX = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>() - (param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>() + param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7996f6bdfe1ebde73d35a5afb0cfddf8">getNonBendingSlope</a>() * dZ);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordtype">double</span> dY = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>() - (param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>() + param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad8aec7a026adb273c2a04ec99bfa9241">getBendingSlope</a>() * dZ);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; paramCov = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>();</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordtype">double</span> errX2 = paramCov(0, 0) + dZ * dZ * paramCov(1, 1) + 2. * dZ * paramCov(0, 1) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">getEx2</a>();</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="keywordtype">double</span> errY2 = paramCov(2, 2) + dZ * dZ * paramCov(3, 3) + 2. * dZ * paramCov(2, 3) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">getEy2</a>();</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordtype">double</span> dXmax = SSigmaCutForTracking * TMath::Sqrt(2. * errX2) + SMaxNonBendingDistanceToTrack;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordtype">double</span> dYmax = SSigmaCutForTracking * TMath::Sqrt(2. * errY2) + SMaxBendingDistanceToTrack;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(dX) &gt; dXmax || <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(dY) &gt; dYmax) {</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="keywordtype">double</span> TrackFinderOriginal::tryOneCluster(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cluster, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; paramAtCluster,</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                          <span class="keywordtype">bool</span> updatePropagator)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;{</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  ++mNCallTryOneCluster;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="comment">// Extrapolate the track parameters and covariances at the z position of the cluster</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  paramAtCluster = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#abf4e8f66fa2c6511ee9da38bd5f5e3f1">setClusterPtr</a>(&amp;cluster);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;paramAtCluster, cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>(), updatePropagator)) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">return</span> mTrackFitter.getMaxChi2();</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">// Compute the cluster-track residuals in bending and non bending directions</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordtype">double</span> dX = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>() - paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>();</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordtype">double</span> dY = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>() - paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>();</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">// Combine the cluster and track resolutions and covariances</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; paramCov = paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>();</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordtype">double</span> sigmaX2 = paramCov(0, 0) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">getEx2</a>();</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordtype">double</span> sigmaY2 = paramCov(2, 2) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">getEy2</a>();</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordtype">double</span> covXY = paramCov(0, 2);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordtype">double</span> det = sigmaX2 * sigmaY2 - covXY * covXY;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// Compute and return the matching chi2</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordflow">if</span> (det == 0.) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">return</span> mTrackFitter.getMaxChi2();</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">return</span> (dX * dX * sigmaY2 + dY * dY * sigmaX2 - 2. * dX * dY * covXY) / det;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;}</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::updateTrack(<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html">Track</a>&amp; track, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; trackParamAtCluster)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;{</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="comment">// Flag the cluster as being (not) removable</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">if</span> (SRequestStation[trackParamAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>() / 2]) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    trackParamAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0eed106d352224e0913dcbde4deaa3cb">setRemovable</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    trackParamAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0eed106d352224e0913dcbde4deaa3cb">setRemovable</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  }</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="comment">// No need to compute the chi2 in this case, just set it to minimum possible value</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  trackParamAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa344f7f06cafc6075c5bcac6be043980">setLocalChi2</a>(0.);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// Add the parameters at the new cluster</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#ae898dcb7b49608672e0b5a53f3476194">addParamAtCluster</a>(trackParamAtCluster);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;}</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::updateTrack(<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html">Track</a>&amp; track, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; trackParamAtCluster1, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; trackParamAtCluster2)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;{</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="comment">// Flag the clusters as being removable</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  trackParamAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0eed106d352224e0913dcbde4deaa3cb">setRemovable</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  trackParamAtCluster2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0eed106d352224e0913dcbde4deaa3cb">setRemovable</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="comment">// Compute the local chi2 at cluster1</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>* cluster1(trackParamAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>());</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">double</span> deltaX = trackParamAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>() - cluster1-&gt;getX();</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">double</span> deltaY = trackParamAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>() - cluster1-&gt;getY();</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordtype">double</span> localChi2 = deltaX * deltaX / cluster1-&gt;getEx2() + deltaY * deltaY / cluster1-&gt;getEy2();</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  trackParamAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa344f7f06cafc6075c5bcac6be043980">setLocalChi2</a>(localChi2);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="comment">// Compute the local chi2 at cluster2</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>* cluster2(trackParamAtCluster2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>());</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> extrapTrackParamAtCluster2(trackParamAtCluster1);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">TrackExtrap::extrapToZ</a>(&amp;extrapTrackParamAtCluster2, trackParamAtCluster2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">getZ</a>());</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  deltaX = extrapTrackParamAtCluster2.getNonBendingCoor() - cluster2-&gt;getX();</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  deltaY = extrapTrackParamAtCluster2.getBendingCoor() - cluster2-&gt;getY();</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  localChi2 = deltaX * deltaX / cluster2-&gt;getEx2() + deltaY * deltaY / cluster2-&gt;getEy2();</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  trackParamAtCluster2.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa344f7f06cafc6075c5bcac6be043980">setLocalChi2</a>(localChi2);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="comment">// Add the parameters at the new clusters</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#ae898dcb7b49608672e0b5a53f3476194">addParamAtCluster</a>(trackParamAtCluster2);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#ae898dcb7b49608672e0b5a53f3476194">addParamAtCluster</a>(trackParamAtCluster1);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;}</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;std::list&lt;Track&gt;::iterator TrackFinderOriginal::recoverTrack(std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keywordtype">int</span> nextStation)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;{</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="comment">// Do not try to recover track until we have attached cluster(s) on station(1..) 3</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordflow">if</span> (nextStation &gt; 1) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Try to recover the track candidate #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; in station &quot;</span>, nextStation);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="comment">// Look for the cluster to remove</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keyword">auto</span> itWorstParam = itTrack-&gt;end();</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">double</span> worstLocalChi2(-1.);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack-&gt;begin(); itParam != itTrack-&gt;end(); ++itParam) {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="comment">// Check if the current cluster is in the previous station</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">if</span> (itParam-&gt;getClusterPtr()-&gt;getChamberId() / 2 != nextStation + 1) {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">// Check if the current cluster is removable</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">if</span> (!itParam-&gt;isRemovable()) {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="comment">// Reset the current cluster as being not removable if it is on a requested station</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">if</span> (SRequestStation[nextStation + 1]) {</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      itParam-&gt;setRemovable(<span class="keyword">false</span>);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="comment">// Pick up the cluster with the worst chi2</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span> (itParam-&gt;getLocalChi2() &gt; worstLocalChi2) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      worstLocalChi2 = itParam-&gt;getLocalChi2();</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      itWorstParam = itParam;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  }</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="comment">// Check if the cluster to remove has been found</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordflow">if</span> (itWorstParam == itTrack-&gt;end()) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="comment">// Remove the worst cluster</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  itTrack-&gt;removeParamAtCluster(itWorstParam);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">// Recompute the track parameters at the first cluster from the second, as currently done in AliRoot</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keyword">auto</span> itParam = std::next(itTrack-&gt;begin());</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keyword">auto</span> ritParam = std::make_reverse_iterator(++itParam);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    mTrackFitter.fit(*itTrack, <span class="keyword">false</span>, <span class="keyword">false</span>, &amp;ritParam);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="comment">// Skip tracks out of limits</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordflow">if</span> (!isAcceptable(itTrack-&gt;first())) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="comment">// Look for new cluster(s) in the next station</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordflow">return</span> followTrackInStation(itTrack, nextStation);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordtype">bool</span> TrackFinderOriginal::completeTracks()</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;{</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Complete tracks&quot;</span>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordtype">bool</span> completionOccurred(<span class="keyword">false</span>);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> paramAtCluster{};</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> bestParamAtCluster{};</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">// Maximum chi2 to accept a cluster candidate (the factor 2 is for the 2 degrees of freedom: x and y)</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordtype">double</span> maxChi2OfCluster = 2. * SSigmaCutForTracking * SSigmaCutForTracking;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordtype">bool</span> trackCompleted(<span class="keyword">false</span>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack-&gt;begin(), itPrevParam = itTrack-&gt;begin(); itParam != itTrack-&gt;end();) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="comment">// Prepare access to the next trackParam before adding new cluster as it can be added in-between</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="keyword">auto</span> itNextParam = std::next(itParam);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="comment">// Never test new clusters starting from parameters at last cluster because the covariance matrix is meaningless</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* param = (itNextParam == itTrack-&gt;end()) ? &amp;*itPrevParam : &amp;*itParam;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="comment">// Look for a second cluster candidate in the same chamber</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="keywordtype">int</span> deId = itParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a506efa42d60bb4ea23d0efded52cad1a">getDEId</a>();</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="keywordtype">double</span> bestChi2AtCluster = mTrackFitter.getMaxChi2();</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster : mClusters-&gt;at(itParam-&gt;getClusterPtr()-&gt;getChamberId())) {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="comment">// In another detection element</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">if</span> (cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a506efa42d60bb4ea23d0efded52cad1a">getDEId</a>() == deId) {</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        }</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="comment">// Fast try to add the current cluster</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="keywordflow">if</span> (!tryOneClusterFast(*itParam, cluster)) {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        }</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="comment">// Try to add the current cluster accurately</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="keywordflow">if</span> (tryOneCluster(*param, cluster, paramAtCluster, <span class="keyword">false</span>) &gt;= maxChi2OfCluster) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="comment">// Compute the new track parameters including the cluster using the Kalman filter</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;          mTrackFitter.runKalmanFilter(paramAtCluster);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        }</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        <span class="comment">// Keep the best cluster</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">if</span> (paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3ce61e6d918e966d3b7d0587526d45da">getTrackChi2</a>() &lt; bestChi2AtCluster) {</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;          bestChi2AtCluster = paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3ce61e6d918e966d3b7d0587526d45da">getTrackChi2</a>();</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;          bestParamAtCluster = paramAtCluster;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="comment">// Add the new cluster if any (should be added either just before or just after itParam)</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="keywordflow">if</span> (bestChi2AtCluster &lt; mTrackFitter.getMaxChi2()) {</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        itParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0eed106d352224e0913dcbde4deaa3cb">setRemovable</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        bestParamAtCluster.setRemovable(<span class="keyword">true</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        itTrack-&gt;addParamAtCluster(bestParamAtCluster);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        trackCompleted = kTRUE;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        completionOccurred = kTRUE;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      }</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      itPrevParam = itParam;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      itParam = itNextParam;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    }</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="comment">// If the track has been completed, refit it using the Kalman filter and remove it in case of failure</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordflow">if</span> (trackCompleted) {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="keywordflow">try</span> {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        mTrackFitter.fit(*itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Candidate at position #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; completed&quot;</span>);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        ++itTrack;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      ++itTrack;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">return</span> completionOccurred;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;}</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::improveTracks()</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;{</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Improve tracks&quot;</span>);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="comment">// The smoother must be enabled to compute the local chi2 at each cluster</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordflow">if</span> (!mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Smoother disabled --&gt; tracks cannot be improved&quot;</span>;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  }</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="comment">// Maximum chi2 to keep a cluster (the factor 2 is for the 2 degrees of freedom: x and y)</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordtype">double</span> maxChi2OfCluster = 2. * SSigmaCutForImprovement * SSigmaCutForImprovement;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="keywordtype">bool</span> removeTrack(<span class="keyword">false</span>);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">// At the first step, only run the smoother</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keyword">auto</span> itStartingParam = std::prev(itTrack-&gt;rend());</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="comment">// Refit the part of the track affected by the cluster removal, run the smoother, but do not finalize</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">try</span> {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        mTrackFitter.fit(*itTrack, <span class="keyword">true</span>, <span class="keyword">false</span>, (itStartingParam == itTrack-&gt;rbegin()) ? <span class="keyword">nullptr</span> : &amp;itStartingParam);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        removeTrack = <span class="keyword">true</span>;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="comment">// Identify removable clusters</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      itTrack-&gt;tagRemovableClusters(requestedStationMask());</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="comment">// Look for the cluster with the worst local chi2</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keywordtype">double</span> worstLocalChi2(-1.);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="keyword">auto</span> itWorstParam(itTrack-&gt;end());</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack-&gt;begin(); itParam != itTrack-&gt;end(); ++itParam) {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <span class="keywordflow">if</span> (itParam-&gt;getLocalChi2() &gt; worstLocalChi2) {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          worstLocalChi2 = itParam-&gt;getLocalChi2();</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;          itWorstParam = itParam;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      }</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">// If the worst chi2 is under requirement then the track is improved</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">if</span> (worstLocalChi2 &lt; maxChi2OfCluster) {</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="comment">// If the worst cluster is not removable then the track cannot be improved</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="keywordflow">if</span> (!itWorstParam-&gt;isRemovable()) {</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        removeTrack = <span class="keyword">true</span>;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="comment">// Remove the worst cluster</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keyword">auto</span> itNextParam = itTrack-&gt;removeParamAtCluster(itWorstParam);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="comment">// Decide from where to refit the track: from the cluster next the one suppressed or</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="comment">// from scratch if the removed cluster was used to compute the tracking seed</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      itStartingParam = itTrack-&gt;rbegin();</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="keyword">auto</span> itNextToNextParam = (itNextParam == itTrack-&gt;end()) ? itNextParam : std::next(itNextParam);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <span class="keywordflow">while</span> (itNextToNextParam != itTrack-&gt;end()) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="keywordflow">if</span> (itNextToNextParam-&gt;getClusterPtr()-&gt;getChamberId() != itNextParam-&gt;getClusterPtr()-&gt;getChamberId()) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          itStartingParam = std::make_reverse_iterator(++itNextParam);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        }</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        ++itNextToNextParam;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="comment">// Remove the track if it couldn&#39;t be improved</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">if</span> (removeTrack) {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Candidate at position #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; is improved&quot;</span>);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      ++itTrack;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    }</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;}</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::finalize()</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;{</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;Finalize tracks&quot;</span>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="comment">// The smoother must be enabled to compute the final parameters at each cluster</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span> (!mTrackFitter.isSmootherEnabled()) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Smoother disabled --&gt; tracks cannot be finalized&quot;</span>;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; track : mTracks) {</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; param : track) {</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aba28923af349ff2ec356d00c8b46dcb4">setParameters</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#adbaa2b794300321b1b7cdde8fe49349f">getSmoothParameters</a>());</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0199cb638413b2f94773c37b5b114292">getSmoothCovariances</a>());</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    }</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  }</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;}</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;uint8_t TrackFinderOriginal::requestedStationMask()<span class="keyword"> const</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  uint8_t <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>(0);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">if</span> (SRequestStation[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      mask |= (1 &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    }</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  }</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;}</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="keywordtype">int</span> TrackFinderOriginal::getTrackIndex(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itCurrentTrack)<span class="keyword"> const</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &lt; 1) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">return</span> -3;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  }</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordflow">if</span> (itCurrentTrack == mTracks.end()) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  }</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>(0);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != itCurrentTrack; ++itTrack) {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">if</span> (itTrack == mTracks.end()) {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordflow">return</span> -2;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    }</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    ++<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;}</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::printTracks()<span class="keyword"> const</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 1) {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; track : mTracks) {</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#a807516709eba43dcb1ae2271d839fd6d">print</a>();</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    }</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  }</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;}</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::printTrackParam(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; trackParam)<span class="keyword"> const</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 1) {</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    trackParam.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a25859a79a80fa7e3af1593276b6613ec">print</a>();</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  }</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;}</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span>... Args&gt;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="keywordtype">void</span> TrackFinderOriginal::print(Args... args)<span class="keyword"> const</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 0) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    (cout &lt;&lt; ... &lt;&lt; args) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;}</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01359"></a><span class="lineno"><a class="line" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#a8141bfd7a126f2389fb7570b43a0111f"> 1359</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#a8141bfd7a126f2389fb7570b43a0111f">TrackFinderOriginal::printStats</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of candidates tracked = &quot;</span> &lt;&lt; mNCandidates;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">TrackExtrap::printNCalls</a>();</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of times tryOneClusterFast() is called = &quot;</span> &lt;&lt; mNCallTryOneClusterFast;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of times tryOneCluster() is called = &quot;</span> &lt;&lt; mNCallTryOneCluster;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;}</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01369"></a><span class="lineno"><a class="line" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#af176b21f94db3b42fc93b9685f2507ba"> 1369</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#af176b21f94db3b42fc93b9685f2507ba">TrackFinderOriginal::printTimers</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;findTrackCandidates duration = &quot;</span> &lt;&lt; mTimeFindCandidates.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;findMoreTrackCandidates duration = &quot;</span> &lt;&lt; mTimeFindMoreCandidates.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;followTracks duration = &quot;</span> &lt;&lt; mTimeFollowTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;completeTracks duration = &quot;</span> &lt;&lt; mTimeCompleteTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;improveTracks duration = &quot;</span> &lt;&lt; mTimeImproveTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;removeConnectedTracks duration = &quot;</span> &lt;&lt; mTimeCleanTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;}</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;} <span class="comment">// namespace mch</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;} <span class="comment">// namespace o2</span></div><div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ac0ac144cc47efb6f5aa57fff3842dfdb"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">o2::mch::TrackParam::getClusterPtr</a></div><div class="ttdeci">const Cluster * getClusterPtr() const</div><div class="ttdoc">get pointer to associated cluster </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00113">TrackParam.h:113</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_ae93da2c687d7a3c5ce7b947256671fca"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">o2::mch::Cluster::getEy2</a></div><div class="ttdeci">double getEy2() const</div><div class="ttdoc">Return the cluster resolution square along y. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00057">Cluster.h:57</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac7c896d55e93a6cf7ff8524005b4e7b4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a></div><div class="ttdeci">GLenum GLfloat param</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00271">glcorearb.h:271</a></div></div>
<div class="ttc" id="namespaceo2_html"><div class="ttname"><a href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="ttdoc">information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d24/BitstreamReader_8h_source.html#l00022">BitstreamReader.h:22</a></div></div>
<div class="ttc" id="glcorearb_8h_html_aee38b51639b577753f6a92029fb92000"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a></div><div class="ttdeci">GLdouble GLdouble GLdouble z</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00843">glcorearb.h:843</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a6a38a16a9b79f77e515a8c3b76eebdd7"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6a38a16a9b79f77e515a8c3b76eebdd7">o2::mch::TrackExtrap::linearExtrapToZCov</a></div><div class="ttdeci">static void linearExtrapToZCov(TrackParam *trackParam, double zEnd, bool updatePropagator=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00103">TrackExtrap.cxx:103</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a936b218ebcf61fd9a1d0c4db296e71a8"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">o2::mch::TrackParam::getCovariances</a></div><div class="ttdeci">const TMatrixD &amp; getCovariances() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00191">TrackParam.cxx:191</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a0199cb638413b2f94773c37b5b114292"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0199cb638413b2f94773c37b5b114292">o2::mch::TrackParam::getSmoothCovariances</a></div><div class="ttdeci">const TMatrixD &amp; getSmoothCovariances() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00332">TrackParam.cxx:332</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_afcf7aeb373f274c8c3c1e53ce5ab242a"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">o2::mch::TrackParam::setNonBendingCoor</a></div><div class="ttdeci">void setNonBendingCoor(Double_t nonBendingCoor)</div><div class="ttdoc">set non bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00049">TrackParam.h:49</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00028">GPUCommonLogger.h:28</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_ad8e7d8f437e9eb1bf58132f4f0ff921e"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">o2::mch::Cluster::getX</a></div><div class="ttdeci">double getX() const</div><div class="ttdoc">Return the cluster position along x. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00045">Cluster.h:45</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinderOriginal_html_ac72415d34e9e5b505d6a435f0628a1f0"><div class="ttname"><a href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#ac72415d34e9e5b505d6a435f0628a1f0">o2::mch::TrackFinderOriginal::init</a></div><div class="ttdeci">void init(float l3Current, float dipoleCurrent)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6d/TrackFinderOriginal_8cxx_source.html#l00040">TrackFinderOriginal.cxx:40</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a42a3d28a9a3c94d7058387da1d0fd980"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">o2::mch::Cluster::getEx2</a></div><div class="ttdeci">double getEx2() const</div><div class="ttdoc">Return the cluster resolution square along x. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00055">Cluster.h:55</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinderOriginal_html_af176b21f94db3b42fc93b9685f2507ba"><div class="ttname"><a href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#af176b21f94db3b42fc93b9685f2507ba">o2::mch::TrackFinderOriginal::printTimers</a></div><div class="ttdeci">void printTimers() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6d/TrackFinderOriginal_8cxx_source.html#l01369">TrackFinderOriginal.cxx:1369</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_adbaa2b794300321b1b7cdde8fe49349f"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#adbaa2b794300321b1b7cdde8fe49349f">o2::mch::TrackParam::getSmoothParameters</a></div><div class="ttdeci">const TMatrixD &amp; getSmoothParameters() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00311">TrackParam.cxx:311</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_af3a03bdc4c1fce56d5e8b10a69e6a233"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">o2::mch::TrackExtrap::addMCSEffect</a></div><div class="ttdeci">static void addMCSEffect(TrackParam *trackParam, double dZ, double x0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00486">TrackExtrap.cxx:486</a></div></div>
<div class="ttc" id="namespaceo2_1_1its_1_1math__utils_html_a1e60213b0a0658ac2a9ee86f18ef0f95"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a1e60213b0a0658ac2a9ee86f18ef0f95">o2::its::math_utils::z2</a></div><div class="ttdeci">float float float float float z2</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00043">MathUtils.h:43</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a4fd54f6fd209ed9abe259d6f4bd9c555"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">o2::mch::TrackExtrap::getMCSAngle2</a></div><div class="ttdeci">static double getMCSAngle2(const TrackParam &amp;param, double dZ, double x0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00466">TrackExtrap.cxx:466</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a0eed106d352224e0913dcbde4deaa3cb"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0eed106d352224e0913dcbde4deaa3cb">o2::mch::TrackParam::setRemovable</a></div><div class="ttdeci">void setRemovable(Bool_t removable)</div><div class="ttdoc">set the flag telling whether the associated cluster can be removed from the track it belongs to or no...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00120">TrackParam.h:120</a></div></div>
<div class="ttc" id="testBareElinkEncoder_8cxx_html_a61d454dcf3f57efb6c741c369b92cbf8"><div class="ttname"><a href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a></div><div class="ttdeci">void print(const char *msg, const ElinkEncoder&lt; FORMAT, CHARGESUM &gt; &amp;enc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d33/testBareElinkEncoder_8cxx_source.html#l00119">testBareElinkEncoder.cxx:119</a></div></div>
<div class="ttc" id="namespaceo2_1_1data__flow_html_a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873"><div class="ttname"><a href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">o2::data_flow::ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db0/TimeframeParser_8cxx_source.html#l00049">TimeframeParser.cxx:49</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d76/Cartesian3D_8h_source.html#l00229">Cartesian3D.h:229</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">o2::mch::Cluster</a></div><div class="ttdoc">cluster for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00030">Cluster.h:30</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_aac63a415ff843e903851611bb8e2df79"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">o2::mch::TrackExtrap::extrapToZCov</a></div><div class="ttdeci">static bool extrapToZCov(TrackParam *trackParam, double zEnd, bool updatePropagator=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00159">TrackExtrap.cxx:159</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a9f04bd9911b4abbc19de20edbcd89d64"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">o2::mch::TrackParam::setBendingCoor</a></div><div class="ttdeci">void setBendingCoor(Double_t bendingCoor)</div><div class="ttdoc">set bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00057">TrackParam.h:57</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aba28923af349ff2ec356d00c8b46dcb4"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aba28923af349ff2ec356d00c8b46dcb4">o2::mch::TrackParam::setParameters</a></div><div class="ttdeci">void setParameters(const TMatrixD &amp;parameters)</div><div class="ttdoc">set track parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00078">TrackParam.h:78</a></div></div>
<div class="ttc" id="MUON_2MCH_2Tracking_2src_2TrackExtrap_8h_html"><div class="ttname"><a href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h.html">TrackExtrap.h</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ae1838b9db98fcca9cd79d66954101c9f"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a></div><div class="ttdeci">GLint GLuint mask</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00291">glcorearb.h:291</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a15fb665a79024f2e0653a4cb3b94d068"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a15fb665a79024f2e0653a4cb3b94d068">o2::mch::TrackParam::setBendingSlope</a></div><div class="ttdeci">void setBendingSlope(Double_t bendingSlope)</div><div class="ttdoc">set bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00061">TrackParam.h:61</a></div></div>
<div class="ttc" id="MagneticField_8h_html"><div class="ttname"><a href="../../db/d4b/MagneticField_8h.html">MagneticField.h</a></div><div class="ttdoc">Definition of the MagF class. </div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_ad705e1fd1795b9429ed58b6cff35ea50"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">o2::mch::TrackExtrap::printNCalls</a></div><div class="ttdeci">static void printNCalls()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l01232">TrackExtrap.cxx:1232</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinderOriginal_html_a142cdf59fb39bc472f9bad816761a1fe"><div class="ttname"><a href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#a142cdf59fb39bc472f9bad816761a1fe">o2::mch::TrackFinderOriginal::findTracks</a></div><div class="ttdeci">const std::list&lt; Track &gt; &amp; findTracks(const std::array&lt; std::list&lt; Cluster &gt;, 10 &gt; *clusters)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6d/TrackFinderOriginal_8cxx_source.html#l00060">TrackFinderOriginal.cxx:60</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a8fad63ea683004a4d6de4348ba26df7d"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">o2::mch::TrackParam::setCovariances</a></div><div class="ttdeci">void setCovariances(const TMatrixD &amp;covariances)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00202">TrackParam.cxx:202</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_abf4e8f66fa2c6511ee9da38bd5f5e3f1"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#abf4e8f66fa2c6511ee9da38bd5f5e3f1">o2::mch::TrackParam::setClusterPtr</a></div><div class="ttdeci">void setClusterPtr(const Cluster *cluster)</div><div class="ttdoc">set pointer to associated cluster </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00115">TrackParam.h:115</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a7996f6bdfe1ebde73d35a5afb0cfddf8"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7996f6bdfe1ebde73d35a5afb0cfddf8">o2::mch::TrackParam::getNonBendingSlope</a></div><div class="ttdeci">Double_t getNonBendingSlope() const</div><div class="ttdoc">return non bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00051">TrackParam.h:51</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a364c45fd57208b3171ae0fa782bc26de"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">o2::mch::TrackExtrap::isFieldON</a></div><div class="ttdeci">static bool isFieldON()</div><div class="ttdoc">Return true if the field is switched ON. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h_source.html#l00046">TrackExtrap.h:46</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aa344f7f06cafc6075c5bcac6be043980"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa344f7f06cafc6075c5bcac6be043980">o2::mch::TrackParam::setLocalChi2</a></div><div class="ttdeci">void setLocalChi2(Double_t chi2)</div><div class="ttdoc">set the local chi2 of the associated cluster with respect to the track </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00129">TrackParam.h:129</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a00dc28d5db1371df938f63ad9eb450df"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value [n] sets TFlen for [n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char Store histograms in output root Do not run but just create PDFs from input root files Set cut for Q Compute the efficiency including impure tracks with fake contamination Maxmimum Create resolution histograms in the native fit Filter for Filter for Particle Store mc labels to file for later matching Minimum Pt of a matched track to be displayed Compare QA QAonly Event generator settings h Reconstruction settings Enable TRD processing Enable TPC Compression Mask to disable certain attachment steps during Enable rejection of TPC clusters for Pt threshold to reject clusters of TPC tracks Sort order of TPC Force early TPC transformation also for continuous Forward TPC digits as clusters(if they pass the ZS threshold)&quot;) AddOption(dropLoopers</div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_a807516709eba43dcb1ae2271d839fd6d"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#a807516709eba43dcb1ae2271d839fd6d">o2::mch::Track::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da9/Detectors_2MUON_2MCH_2Tracking_2src_2Track_8cxx_source.html#l00220">Track.cxx:220</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a3270667ed541999064ec1ea8d578df04"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">o2::mch::TrackParam::getNonBendingCoor</a></div><div class="ttdeci">Double_t getNonBendingCoor() const</div><div class="ttdoc">return non bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00047">TrackParam.h:47</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a31171def877b3bf1a6c62fabe8606a32"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a31171def877b3bf1a6c62fabe8606a32">o2::mch::TrackParam::setNonBendingSlope</a></div><div class="ttdeci">void setNonBendingSlope(Double_t nonBendingSlope)</div><div class="ttdoc">set non bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00053">TrackParam.h:53</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a8f1273bfdd614c2336509e4ec4395d62"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">o2::mch::TrackExtrap::extrapToZ</a></div><div class="ttdeci">static bool extrapToZ(TrackParam *trackParam, double zEnd)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00144">TrackExtrap.cxx:144</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a7845c105d3d46f0c4c31ec6dfea154b2"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">o2::mch::TrackParam::setInverseBendingMomentum</a></div><div class="ttdeci">void setInverseBendingMomentum(Double_t inverseBendingMomentum)</div><div class="ttdoc">set inverse bending momentum (GeV/c ** -1) times the charge (assumed forward motion) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00065">TrackParam.h:65</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a65db4eb2d3fc758a825b41944b9c8359"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">o2::mch::TrackParam::getZ</a></div><div class="ttdeci">Double_t getZ() const</div><div class="ttdoc">return Z coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00043">TrackParam.h:43</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a25859a79a80fa7e3af1593276b6613ec"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a25859a79a80fa7e3af1593276b6613ec">o2::mch::TrackParam::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00426">TrackParam.cxx:426</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a0dc0247307c07874ee991618e8e8d486"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">o2::mch::Cluster::getChamberId</a></div><div class="ttdeci">int getChamberId() const</div><div class="ttdoc">Return the chamber ID (0..), part of the unique ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00062">Cluster.h:62</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aa712d841f1781437b0ecc35bbf320e80"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">o2::mch::TrackParam::getBendingCoor</a></div><div class="ttdeci">Double_t getBendingCoor() const</div><div class="ttdoc">return bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00055">TrackParam.h:55</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a0311a27a83ed443fe3ebcfac7563fb6e"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0311a27a83ed443fe3ebcfac7563fb6e">o2::mch::TrackParam::getInverseBendingMomentum</a></div><div class="ttdeci">Double_t getInverseBendingMomentum() const</div><div class="ttdoc">return inverse bending momentum (GeV/c ** -1) times the charge (assumed forward motion) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00063">TrackParam.h:63</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a6e00e7ed1cba587512308463c62edd52"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">o2::mch::TrackExtrap::getBendingMomentumFromImpactParam</a></div><div class="ttdeci">static double getBendingMomentumFromImpactParam(double impactParam)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00068">TrackExtrap.cxx:68</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a57f14e05b1900f16a2da82ade47d0c6d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a></div><div class="ttdeci">GLuint index</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="namespaceo2_1_1framework_html_ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">o2::framework::Abs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc2/BasicOps_8h_source.html#l00031">BasicOps.h:31</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_af6ce9829522ed857e0a661df8d611a55"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">o2::mch::Cluster::getZ</a></div><div class="ttdeci">double getZ() const</div><div class="ttdoc">Return the cluster position along z. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00049">Cluster.h:49</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html">o2::mch::Track</a></div><div class="ttdoc">track for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7a/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Track_8h_source.html#l00031">Track.h:31</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a62805738e05bae416a55ea7b1e9295a2"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">o2::mch::Cluster::getY</a></div><div class="ttdeci">double getY() const</div><div class="ttdoc">Return the cluster position along y. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00047">Cluster.h:47</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinderOriginal_html_a8141bfd7a126f2389fb7570b43a0111f"><div class="ttname"><a href="../../d4/df0/classo2_1_1mch_1_1TrackFinderOriginal.html#a8141bfd7a126f2389fb7570b43a0111f">o2::mch::TrackFinderOriginal::printStats</a></div><div class="ttdeci">void printStats() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6d/TrackFinderOriginal_8cxx_source.html#l01359">TrackFinderOriginal.cxx:1359</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ad8aec7a026adb273c2a04ec99bfa9241"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad8aec7a026adb273c2a04ec99bfa9241">o2::mch::TrackParam::getBendingSlope</a></div><div class="ttdeci">Double_t getBendingSlope() const</div><div class="ttdoc">return bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00059">TrackParam.h:59</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ae233ce574fef4f6f53569dd50c805a05"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ae233ce574fef4f6f53569dd50c805a05">o2::mch::TrackParam::resetPropagator</a></div><div class="ttdeci">void resetPropagator()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00251">TrackParam.cxx:251</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a506efa42d60bb4ea23d0efded52cad1a"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a506efa42d60bb4ea23d0efded52cad1a">o2::mch::Cluster::getDEId</a></div><div class="ttdeci">int getDEId() const</div><div class="ttdoc">Return the detection element ID, part of the unique ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00064">Cluster.h:64</a></div></div>
<div class="ttc" id="TrackFinderOriginal_8h_html"><div class="ttname"><a href="../../d7/d7f/TrackFinderOriginal_8h.html">TrackFinderOriginal.h</a></div><div class="ttdoc">Definition of a class to reconstruct tracks with the original algorithm. </div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_ae898dcb7b49608672e0b5a53f3476194"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#ae898dcb7b49608672e0b5a53f3476194">o2::mch::Track::addParamAtCluster</a></div><div class="ttdeci">void addParamAtCluster(const TrackParam &amp;param)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da9/Detectors_2MUON_2MCH_2Tracking_2src_2Track_8cxx_source.html#l00067">Track.cxx:67</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a3ce61e6d918e966d3b7d0587526d45da"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3ce61e6d918e966d3b7d0587526d45da">o2::mch::TrackParam::getTrackChi2</a></div><div class="ttdeci">Double_t getTrackChi2() const</div><div class="ttdoc">return the chi2 of the track when the associated cluster was attached </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00123">TrackParam.h:123</a></div></div>
<div class="ttc" id="namespaceo2_1_1its_1_1math__utils_html_ac713be41b5cad67abc4e4d0581961905"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">o2::its::math_utils::z1</a></div><div class="ttdeci">float float float float z1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00043">MathUtils.h:43</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">o2::mch::TrackParam</a></div><div class="ttdoc">track parameters for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00031">TrackParam.h:31</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_1cc233fd3b1202b9dad36810b41b97af.html">MUON</a></li><li class="navelem"><a class="el" href="../../dir_061f7088060f41729027f6c2fce0273e.html">MCH</a></li><li class="navelem"><a class="el" href="../../dir_09445408fa345a18838fb91740d089d0.html">Tracking</a></li><li class="navelem"><a class="el" href="../../dir_f33357dc4b90b7dfe5d72abda619e77f.html">src</a></li><li class="navelem"><a class="el" href="../../d6/d6d/TrackFinderOriginal_8cxx.html">TrackFinderOriginal.cxx</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:30 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
