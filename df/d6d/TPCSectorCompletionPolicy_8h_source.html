<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/TPC/workflow/include/TPCWorkflow/TPCSectorCompletionPolicy.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('df/d6d/TPCSectorCompletionPolicy_8h_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TPCSectorCompletionPolicy.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/d6d/TPCSectorCompletionPolicy_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#ifndef O2_TPC_TPCSECTORCOMPLETIONPOLICY_H</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#define O2_TPC_TPCSECTORCOMPLETIONPOLICY_H</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/dd6/CompletionPolicy_8h.html">Framework/CompletionPolicy.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d3f/InputSpec_8h.html">Framework/InputSpec.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/de8/DeviceSpec_8h.html">Framework/DeviceSpec.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d09/TPCSectorHeader_8h.html">DataFormatsTPC/TPCSectorHeader.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd6/Sector_8h.html">TPCBase/Sector.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;regex&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using namespace </span>framework;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">namespace </span>tpc</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html">   64</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html">TPCSectorCompletionPolicy</a></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#adfbd44201b53681a6377f4ed8f8c5061">   67</a></span>&#160;  <span class="keyword">enum struct</span> <a class="code" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#adfbd44201b53681a6377f4ed8f8c5061">Config</a> {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// require data on all other inputs in addition to the ones checked for the sector completion</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    RequireAll,</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  };</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html">TPCSectorCompletionPolicy</a>() = <span class="keyword">delete</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#a57b51affa79a0dfc087beb59728bbb53">   73</a></span>&#160;  <a class="code" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#a57b51affa79a0dfc087beb59728bbb53">TPCSectorCompletionPolicy</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* processorName, Args&amp;&amp;... args)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    : mProcessorName(processorName), mInputMatchers()</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    init(std::forward&lt;Args&gt;(args)...);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#af9ce19720dbe10de8a6ba01b49013402">   79</a></span>&#160;  <a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html">o2::framework::CompletionPolicy</a> <a class="code" href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#af9ce19720dbe10de8a6ba01b49013402">operator()</a>()</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    constexpr <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">NSectors</a> = <a class="code" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html#ac8b33b4c676a81bba75f8c3c5d4dc11e">o2::tpc::Sector::MAXSECTOR</a>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">auto</span> matcher = [expression = mProcessorName](<a class="code" href="../../df/dce/structo2_1_1framework_1_1DeviceSpec.html">DeviceSpec</a> <span class="keyword">const</span>&amp; device) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <span class="keywordflow">return</span> std::regex_match(device.name.begin(), device.name.end(), std::regex(expression.c_str()));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    };</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">auto</span> callback = [inputMatchers = mInputMatchers, bRequireAll = this-&gt;mRequireAll](<a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a216ffde1280c9cdf8313fcd11c08d7fd">CompletionPolicy::InputSet</a> inputs) -&gt; <a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293a">CompletionPolicy::CompletionOp</a> {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keyword">auto</span> op = <a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293aa0f68101772bd5397ef8eb1b632798652">CompletionPolicy::CompletionOp::Wait</a>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      std::bitset&lt;NSectors&gt; validSectors = 0;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordtype">bool</span> haveMatchedInput = <span class="keyword">false</span>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="../../d6/d30/classuint64__t.html">uint64_t</a> activeSectors = 0;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordtype">size_t</span> nActiveInputRoutes = 0;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordtype">size_t</span> nMaxPartsPerRoute = 0;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordtype">int</span> inputType = -1;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = inputs.begin(), <a class="code" href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">end</a> = inputs.end(); it != <a class="code" href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">end</a>; ++it) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        nMaxPartsPerRoute = it.size() &gt; nMaxPartsPerRoute ? it.size() : nMaxPartsPerRoute;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordtype">bool</span> haveActivePart = <span class="keyword">false</span>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#ad32bdec748ba376f6c0d2df39ab9a95b">ref</a> : it) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d45/structo2_1_1framework_1_1DataRefUtils.html#aeed5f0809cdf6d6755a9baa024fed345">DataRefUtils::isValid</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#ad32bdec748ba376f6c0d2df39ab9a95b">ref</a>)) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;          haveActivePart = <span class="keyword">true</span>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>* dh = DataRefUtils::getHeader&lt;o2::header::DataHeader*&gt;(<a class="code" href="../../dc/da3/glcorearb_8h.html#ad32bdec748ba376f6c0d2df39ab9a95b">ref</a>);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          <span class="comment">// check if the O2 message matches on of the input specs to be matched and</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          <span class="comment">// if it matches, check for the sector header, retrieve the active sector information</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;          <span class="comment">// and mark the sector as valid</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> idx = 0, <a class="code" href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">end</a> = inputMatchers.size(); idx &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">end</a>; idx++) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; spec = inputMatchers[idx];</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/d45/structo2_1_1framework_1_1DataRefUtils.html#a2144c868a45854081d9c59c449bf70f2">DataRefUtils::match</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#ad32bdec748ba376f6c0d2df39ab9a95b">ref</a>, spec)) {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;              haveMatchedInput = <span class="keyword">true</span>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;              <span class="keywordflow">if</span> (inputType == -1) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="comment">// we bind to the index of the first match and require all other inputs to match the same spec</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                inputType = idx;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inputType != idx) {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                std::stringstream error;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                error &lt;&lt; <span class="stringliteral">&quot;routing error, input messages must all be of the same type previously bound to &quot;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                      &lt;&lt; inputMatchers[inputType]</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                      &lt;&lt; dh-&gt;dataOrigin.as&lt;std::string&gt;() + <span class="stringliteral">&quot;/&quot;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                      &lt;&lt; dh-&gt;dataDescription.as&lt;std::string&gt;() + <span class="stringliteral">&quot;/&quot;</span> + dh-&gt;subSpecification;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="keywordflow">throw</span> std::runtime_error(error.str());</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;              }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;              <span class="keyword">auto</span> <span class="keyword">const</span>* sectorHeader = DataRefUtils::getHeader&lt;o2::tpc::TPCSectorHeader*&gt;(<a class="code" href="../../dc/da3/glcorearb_8h.html#ad32bdec748ba376f6c0d2df39ab9a95b">ref</a>);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;              <span class="keywordflow">if</span> (sectorHeader == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="comment">// FIXME: think about error policy</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;TPC sector header missing on header stack&quot;</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;              }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;              activeSectors |= sectorHeader-&gt;activeSectors;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;              std::bitset&lt;NSectors&gt; sectorMask(sectorHeader-&gt;sectorBits);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;              validSectors |= sectorMask;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span> (haveActivePart) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          ++nActiveInputRoutes;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="comment">// If the flag Config::RequireAll is set in the constructor arguments we require</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">// data from all inputs in addition to the sector matching condition</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="comment">// To be fully correct we would need to require data from all inputs not going</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="comment">// into the TPC policy, but that is not possible for the moment. That&#39;s why there is a possibly</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">// unhandled case if multiple TPC input routes are defined but a complete data set is coming over</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="comment">// one of them. Not likely to be a use case, though.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">if</span> (haveMatchedInput &amp;&amp; activeSectors == validSectors.to_ulong() &amp;&amp;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          (!bRequireAll || nActiveInputRoutes == inputs.size())) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">// we can process if there is input for all sectors, the required sectors are</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">// transported as part of the sector header</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        op = <a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293aad2e0379c3a30439bfc1b6869af4408cc">CompletionPolicy::CompletionOp::Consume</a>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (activeSectors == 0 &amp;&amp; nActiveInputRoutes == inputs.size()) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">// no sector header is transmitted, this is the case for e.g. the ZS raw data</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// we simply require input on all routes, this is also the default of DPL DataRelayer</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// Because DPL can not do more without knowing how many parts are required for a complete</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">// data set, the workflow should be such that exactly one O2 message arrives per input route.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// Currently, the workflow has multiple O2 messages per input route, but they all come in</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// a single multipart message. So it works fine, and we disable the warning below, but there</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// is a potential problem. Need to fix this on the level of the workflow.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">//if (nMaxPartsPerRoute &gt; 1) {</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">//  LOG(WARNING) &lt;&lt; &quot;No sector information is provided with the data, data set is complete with data on all input routes. But there are multiple parts on at least one route and this policy might not be complete, no check possible if other parts on some routes are still missing. It is adviced to add a custom policy.&quot;;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">//}</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        op = <a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293aad2e0379c3a30439bfc1b6869af4408cc">CompletionPolicy::CompletionOp::Consume</a>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">return</span> op;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    };</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html">CompletionPolicy</a>{<span class="stringliteral">&quot;TPCSectorCompletionPolicy&quot;</span>, matcher, callback};</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Arg, <span class="keyword">typename</span>... Args&gt;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">void</span> init(Arg&amp;&amp; arg, Args&amp;&amp;... args)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">using</span> <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a7cb47c18c663b616974d65febeaa1790">Type</a> = std::decay_t&lt;Arg&gt;;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> constexpr (<a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">std::is_same&lt;Type, InputSpec&gt;::value</a>) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      mInputMatchers.emplace_back(std::move(arg));</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> constexpr (<a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">std::is_same&lt;Type, TPCSectorCompletionPolicy::Config&gt;::value</a>) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">switch</span> (arg) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">case</span> Config::RequireAll:</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          mRequireAll = <span class="keyword">true</span>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      static_assert(always_static_assert_v&lt;Type&gt;);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> constexpr (<span class="keyword">sizeof</span>...(args) &gt; 0) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      init(std::forward&lt;Args&gt;(args)...);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  std::string mProcessorName;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  std::vector&lt;InputSpec&gt; mInputMatchers;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">bool</span> mRequireAll = <span class="keyword">false</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;};</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;} <span class="comment">// namespace tpc</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;} <span class="comment">// namespace o2</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#endif // O2_TPC_TPCSECTORCOMPLETIONPOLICY_H</span></div><div class="ttc" id="structo2_1_1framework_1_1CompletionPolicy_html_a69410f24719d46f78fd1f931bb87293a"><div class="ttname"><a href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293a">o2::framework::CompletionPolicy::CompletionOp</a></div><div class="ttdeci">CompletionOp</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd6/CompletionPolicy_8h_source.html#l00034">CompletionPolicy.h:34</a></div></div>
<div class="ttc" id="namespaceo2_html"><div class="ttname"><a href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="ttdoc">information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d24/BitstreamReader_8h_source.html#l00022">BitstreamReader.h:22</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1CompletionPolicy_html_a216ffde1280c9cdf8313fcd11c08d7fd"><div class="ttname"><a href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a216ffde1280c9cdf8313fcd11c08d7fd">o2::framework::CompletionPolicy::InputSet</a></div><div class="ttdeci">InputSpan const  &amp; InputSet</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd6/CompletionPolicy_8h_source.html#l00053">CompletionPolicy.h:53</a></div></div>
<div class="ttc" id="InputSpec_8h_html"><div class="ttname"><a href="../../d5/d3f/InputSpec_8h.html">InputSpec.h</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1DataRefUtils_html_aeed5f0809cdf6d6755a9baa024fed345"><div class="ttname"><a href="../../dc/d45/structo2_1_1framework_1_1DataRefUtils.html#aeed5f0809cdf6d6755a9baa024fed345">o2::framework::DataRefUtils::isValid</a></div><div class="ttdeci">static bool isValid(DataRef const &amp;ref)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db8/DataRefUtils_8h_source.html#l00189">DataRefUtils.h:189</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a7cb47c18c663b616974d65febeaa1790"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a7cb47c18c663b616974d65febeaa1790">Type</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value [n] sets TFlen for [n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char Store histograms in output root Do not run but just create PDFs from input root files Set cut for Q Compute the efficiency including impure tracks with fake contamination Maxmimum Create resolution histograms in the native fit Filter for Filter for Particle Type(0 Electron, 1 Muon, 2 Pion, 3 Kaon, 4 Proton)&quot;) AddOption(writeMCLabels</div></div>
<div class="ttc" id="namespaceo2_1_1constants_1_1math_html_a0c4e106cb192dc65c6fd29e258f49e66"><div class="ttname"><a href="../../d2/d3a/namespaceo2_1_1constants_1_1math.html#a0c4e106cb192dc65c6fd29e258f49e66">o2::constants::math::NSectors</a></div><div class="ttdeci">constexpr int NSectors</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d84/MathConstants_8h_source.html#l00034">MathConstants.h:34</a></div></div>
<div class="ttc" id="classo2_1_1tpc_1_1TPCSectorCompletionPolicy_html_af9ce19720dbe10de8a6ba01b49013402"><div class="ttname"><a href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#af9ce19720dbe10de8a6ba01b49013402">o2::tpc::TPCSectorCompletionPolicy::operator()</a></div><div class="ttdeci">o2::framework::CompletionPolicy operator()()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6d/TPCSectorCompletionPolicy_8h_source.html#l00079">TPCSectorCompletionPolicy.h:79</a></div></div>
<div class="ttc" id="classo2_1_1tpc_1_1TPCSectorCompletionPolicy_html_adfbd44201b53681a6377f4ed8f8c5061"><div class="ttname"><a href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#adfbd44201b53681a6377f4ed8f8c5061">o2::tpc::TPCSectorCompletionPolicy::Config</a></div><div class="ttdeci">Config</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6d/TPCSectorCompletionPolicy_8h_source.html#l00067">TPCSectorCompletionPolicy.h:67</a></div></div>
<div class="ttc" id="classo2_1_1tpc_1_1TPCSectorCompletionPolicy_html"><div class="ttname"><a href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html">o2::tpc::TPCSectorCompletionPolicy</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6d/TPCSectorCompletionPolicy_8h_source.html#l00064">TPCSectorCompletionPolicy.h:64</a></div></div>
<div class="ttc" id="CompletionPolicy_8h_html"><div class="ttname"><a href="../../df/dd6/CompletionPolicy_8h.html">CompletionPolicy.h</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1CompletionPolicy_html_a69410f24719d46f78fd1f931bb87293aa0f68101772bd5397ef8eb1b632798652"><div class="ttname"><a href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293aa0f68101772bd5397ef8eb1b632798652">o2::framework::CompletionPolicy::CompletionOp::Wait</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a432111147038972f06e049e18a837002"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">end</a></div><div class="ttdeci">GLuint GLuint end</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00469">glcorearb.h:469</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ad32bdec748ba376f6c0d2df39ab9a95b"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ad32bdec748ba376f6c0d2df39ab9a95b">ref</a></div><div class="ttdeci">GLint ref</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00291">glcorearb.h:291</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1DataRefUtils_html_a2144c868a45854081d9c59c449bf70f2"><div class="ttname"><a href="../../dc/d45/structo2_1_1framework_1_1DataRefUtils.html#a2144c868a45854081d9c59c449bf70f2">o2::framework::DataRefUtils::match</a></div><div class="ttdeci">static bool match(DataRef const &amp;ref, const char *binding)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db8/DataRefUtils_8h_source.html#l00197">DataRefUtils.h:197</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="../../d6/d30/classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="DeviceSpec_8h_html"><div class="ttname"><a href="../../df/de8/DeviceSpec_8h.html">DeviceSpec.h</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1CompletionPolicy_html"><div class="ttname"><a href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html">o2::framework::CompletionPolicy</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd6/CompletionPolicy_8h_source.html#l00031">CompletionPolicy.h:31</a></div></div>
<div class="ttc" id="Sector_8h_html"><div class="ttname"><a href="../../d3/dd6/Sector_8h.html">Sector.h</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1DeviceSpec_html"><div class="ttname"><a href="../../df/dce/structo2_1_1framework_1_1DeviceSpec.html">o2::framework::DeviceSpec</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/de8/DeviceSpec_8h_source.html#l00039">DeviceSpec.h:39</a></div></div>
<div class="ttc" id="glcorearb_8h_html_af5ef68ee1b33850ea6254115a25d0a85"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a></div><div class="ttdeci">GLsizei const GLfloat * value</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00819">glcorearb.h:819</a></div></div>
<div class="ttc" id="classo2_1_1tpc_1_1Sector_html_ac8b33b4c676a81bba75f8c3c5d4dc11e"><div class="ttname"><a href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html#ac8b33b4c676a81bba75f8c3c5d4dc11e">o2::tpc::Sector::MAXSECTOR</a></div><div class="ttdeci">static constexpr int MAXSECTOR</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd6/Sector_8h_source.html#l00043">Sector.h:43</a></div></div>
<div class="ttc" id="TPCSectorHeader_8h_html"><div class="ttname"><a href="../../d3/d09/TPCSectorHeader_8h.html">TPCSectorHeader.h</a></div></div>
<div class="ttc" id="classo2_1_1tpc_1_1TPCSectorCompletionPolicy_html_a57b51affa79a0dfc087beb59728bbb53"><div class="ttname"><a href="../../dd/d78/classo2_1_1tpc_1_1TPCSectorCompletionPolicy.html#a57b51affa79a0dfc087beb59728bbb53">o2::tpc::TPCSectorCompletionPolicy::TPCSectorCompletionPolicy</a></div><div class="ttdeci">TPCSectorCompletionPolicy(const char *processorName, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6d/TPCSectorCompletionPolicy_8h_source.html#l00073">TPCSectorCompletionPolicy.h:73</a></div></div>
<div class="ttc" id="structo2_1_1framework_1_1CompletionPolicy_html_a69410f24719d46f78fd1f931bb87293aad2e0379c3a30439bfc1b6869af4408cc"><div class="ttname"><a href="../../d6/d43/structo2_1_1framework_1_1CompletionPolicy.html#a69410f24719d46f78fd1f931bb87293aad2e0379c3a30439bfc1b6869af4408cc">o2::framework::CompletionPolicy::CompletionOp::Consume</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_a597e8e061b11201a1dff411feb10d0b.html">TPC</a></li><li class="navelem"><a class="el" href="../../dir_9cc61f72f781098a662027b321784562.html">workflow</a></li><li class="navelem"><a class="el" href="../../dir_1ccc0e6feb2a9e42d8edde27429c6d63.html">include</a></li><li class="navelem"><a class="el" href="../../dir_24b8bac55cb140e3af9e30ab593ab26a.html">TPCWorkflow</a></li><li class="navelem"><a class="el" href="../../df/d6d/TPCSectorCompletionPolicy_8h.html">TPCSectorCompletionPolicy.h</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:31 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
