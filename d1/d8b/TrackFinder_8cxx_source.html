<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/MUON/MCH/Tracking/src/TrackFinder.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d8b/TrackFinder_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TrackFinder.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/d8b/TrackFinder_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d91/TrackFinder_8h.html">TrackFinder.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;TGeoGlobalMagField.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;TMatrixD.h&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;TMath.h&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/MagneticField_8h.html">Field/MagneticField.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h.html">TrackExtrap.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">namespace </span>mch</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;{</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;constexpr <span class="keywordtype">float</span> TrackFinder::SDefaultChamberZ[10];</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;constexpr <span class="keywordtype">double</span> TrackFinder::SChamberThicknessInX0[10];</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;constexpr <span class="keywordtype">bool</span> TrackFinder::SRequestStation[5];</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;constexpr <span class="keywordtype">int</span> TrackFinder::SNDE[10];</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#a4052165d5a3142ddd64bdc4766cdec95">   42</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#a4052165d5a3142ddd64bdc4766cdec95">TrackFinder::init</a>(<span class="keywordtype">float</span> l3Current, <span class="keywordtype">float</span> dipoleCurrent)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">// create the magnetic field map if not already done</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  mTrackFitter.initField(l3Current, dipoleCurrent);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// enable the track smoother</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  mTrackFitter.smoothTracks(<span class="keyword">true</span>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// use the Runge-Kutta extrapolation v2</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ac931d315a8ff2528f8bc1ab875598990">TrackExtrap::useExtrapV2</a>();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// set the maximum MCS angle in chamber from the minimum acceptable momentum</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>{};</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">double</span> inverseBendingP = (SMinBendingMomentum &gt; 0.) ? 1. / SMinBendingMomentum : 1.;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">setInverseBendingMomentum</a>(inverseBendingP);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt; 10; ++iCh) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    mMaxMCSAngle2[iCh] = <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">TrackExtrap::getMCSAngle2</a>(<a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>, SChamberThicknessInX0[iCh], 1.);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// prepare the internal array of list of vector</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">// grouping DEs in z-planes (2 for chambers 1-4 and 4 for chambers 5-10)</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt; 4; ++iCh) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    mClusters[2 * iCh].reserve(2);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    mClusters[2 * iCh].emplace_back(100 * (iCh + 1) + 1, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    mClusters[2 * iCh].emplace_back(100 * (iCh + 1) + 3, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    mClusters[2 * iCh + 1].reserve(2);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    mClusters[2 * iCh + 1].emplace_back(100 * (iCh + 1), <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    mClusters[2 * iCh + 1].emplace_back(100 * (iCh + 1) + 2, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 4; iCh &lt; 6; ++iCh) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    mClusters[8 + 4 * (iCh - 4)].reserve(5);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1), <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 2, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 4, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 14, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 16, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].reserve(4);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 1, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 3, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 15, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 17, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].reserve(4);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 6, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 8, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 10, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 12, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].reserve(5);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 5, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 7, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 9, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 11, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 13, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 6; iCh &lt; 10; ++iCh) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    mClusters[8 + 4 * (iCh - 4)].reserve(7);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1), <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 2, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 4, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 6, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 20, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 22, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    mClusters[8 + 4 * (iCh - 4)].emplace_back(100 * (iCh + 1) + 24, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].reserve(6);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 1, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 3, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 5, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 21, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 23, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 1].emplace_back(100 * (iCh + 1) + 25, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].reserve(6);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 8, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 10, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 12, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 14, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 16, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 2].emplace_back(100 * (iCh + 1) + 18, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].reserve(7);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 7, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 9, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 11, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 13, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 15, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 17, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    mClusters[8 + 4 * (iCh - 4) + 3].emplace_back(100 * (iCh + 1) + 19, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#a9de2ac373731d05c5a8a650743d775f1">  132</a></span>&#160;<span class="keyword">const</span> std::list&lt;Track&gt;&amp; <a class="code" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#a9de2ac373731d05c5a8a650743d775f1">TrackFinder::findTracks</a>(<span class="keyword">const</span> std::unordered_map&lt;<span class="keywordtype">int</span>, std::list&lt;Cluster&gt;&gt;&amp; <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  mTracks.clear();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// fill the internal array of pointers to the list of clusters per DE</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; plane : mClusters) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de : plane) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keyword">auto</span> itDE = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>.find(de.first);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">if</span> (itDE == <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>.end()) {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        de.second = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        de.second = &amp;(itDE-&gt;second);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">// find track candidates on stations 4 and 5</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keyword">auto</span> tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  findTrackCandidates();</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keyword">auto</span> tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  mTimeFindCandidates += tEnd - tStart;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span> (mMoreCandidates) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    findMoreTrackCandidates();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    mTimeFindMoreCandidates += tEnd - tStart;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  mNCandidates += mTracks.size();</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;------ list of track candidates ------&quot;</span>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  printTracks();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// track each candidate down to chamber 1 and remove it</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    std::unordered_map&lt;int, std::unordered_set&lt;uint32_t&gt;&gt; excludedClusters{};</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    followTrackInChamber(itTrack, 5, 0, <span class="keyword">false</span>, excludedClusters);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTracks: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  mTimeFollowTracks += tEnd - tStart;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;------ list of tracks before improvement and cleaning ------&quot;</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  printTracks();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">// improve the reconstructed tracks</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  improveTracks();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  mTimeImproveTracks += tEnd - tStart;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// Remove connected tracks in stations(1..) 3, 4 and 5</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  tStart = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  removeConnectedTracks(2, 4);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  tEnd = std::chrono::high_resolution_clock::now();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  mTimeCleanTracks += tEnd - tStart;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// Set the final track parameters and covariances</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  finalize();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">return</span> mTracks;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keywordtype">void</span> TrackFinder::findTrackCandidates()</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;{</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">// start by looking for candidates on station 5</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  findTrackCandidatesInSt5();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// prepare backward tracking if not already done</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (!itTrack-&gt;hasCurrentParam()) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// look for compatible clusters on station 4</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    std::unordered_map&lt;int, std::unordered_set&lt;uint32_t&gt;&gt; excludedClusters{};</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">auto</span> itNewTrack = followTrackInChamber(itTrack, 7, 6, <span class="keyword">false</span>, excludedClusters);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// keep the current candidate only if no compatible cluster is found and the station is not requested</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">if</span> (!SRequestStation[3] &amp;&amp; excludedClusters.empty() &amp;&amp; itTrack-&gt;areCurrentParamValid()) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      ++itTrack;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="comment">// prepare backward tracking for the new tracks</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">for</span> (; itNewTrack != mTracks.end() &amp;&amp; itNewTrack != itTrack; ++itNewTrack) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        prepareBackwardTracking(itNewTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keyword">auto</span> itLastCandidateFromSt5 = mTracks.empty() ? mTracks.end() : std::prev(mTracks.end());</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// then look for candidates on station 4</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  findTrackCandidatesInSt4();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">auto</span> itFirstCandidateOnSt4 = (itLastCandidateFromSt5 == mTracks.end()) ? mTracks.begin() : std::next(itLastCandidateFromSt5);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = itFirstCandidateOnSt4; itTrack != mTracks.end();) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// prepare forward tracking if not already done</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (!itTrack-&gt;hasCurrentParam()) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">try</span> {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        prepareForwardTracking(itTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// look for compatible clusters on each chamber of station 5 separately,</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// exluding those already attached to an identical candidate on station 4</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// (cases where both chambers of station 5 are fired should have been found in the first step)</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    std::unordered_map&lt;int, std::unordered_set&lt;uint32_t&gt;&gt; excludedClusters{};</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (itLastCandidateFromSt5 != mTracks.end()) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      excludeClustersFromIdenticalTracks(itTrack, excludedClusters, std::next(itLastCandidateFromSt5));</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keyword">auto</span> itFirstNewTrack = followTrackInChamber(itTrack, 8, 8, <span class="keyword">false</span>, excludedClusters);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keyword">auto</span> itNewTrack = followTrackInChamber(itTrack, 9, 9, <span class="keyword">false</span>, excludedClusters);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// keep the current candidate only if no compatible cluster is found and the station is not requested</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (!SRequestStation[4] &amp;&amp; excludedClusters.empty()) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      itFirstNewTrack = itTrack;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      ++itTrack;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// refit the track(s) and prepare to continue the tracking in the backward direction</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">while</span> (itFirstNewTrack != mTracks.end() &amp;&amp; itFirstNewTrack != itTrack) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">try</span> {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        prepareBackwardTracking(itFirstNewTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        ++itFirstNewTrack;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itFirstNewTrack));</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        itFirstNewTrack = mTracks.erase(itFirstNewTrack);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keywordtype">void</span> TrackFinder::findTrackCandidatesInSt5()</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;--- find candidates in station 5 ---&quot;</span>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlaneCh9 = 27; iPlaneCh9 &gt; 23; --iPlaneCh9) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlaneCh10 = 28; iPlaneCh10 &lt; 32; ++iPlaneCh10) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="comment">// skip candidates that have already been found starting from a previous combination</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordtype">bool</span> skipUsedPairs = (iPlaneCh9 == 24 || iPlaneCh9 == 26 || iPlaneCh10 == 29 || iPlaneCh10 == 31);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="comment">// find all valid candidates between these 2 planes</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keyword">auto</span> itTrack = findTrackCandidates(iPlaneCh9, iPlaneCh10, skipUsedPairs, mTracks.begin());</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">// stop here if overlaps have already been checked on both chambers</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">if</span> ((iPlaneCh9 == 24 || iPlaneCh9 == 26) &amp;&amp; (iPlaneCh10 == 29 || iPlaneCh10 == 31)) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">while</span> (itTrack != mTracks.end()) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keyword">auto</span> itNextTrack = std::next(itTrack);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span> (iPlaneCh10 == 28 || iPlaneCh10 == 30) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="comment">// if not already done, look for compatible clusters in the overlapping regions of chamber 10</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <span class="keywordflow">try</span> {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            prepareForwardTracking(itTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt5: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          <span class="keyword">auto</span> itNewTrack = followTrackInOverlapDE(itTrack, itTrack-&gt;last().getClusterPtr()-&gt;getDEId(), iPlaneCh10 + 1);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="keywordflow">if</span> (itNewTrack != mTracks.end()) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// remove the initial candidate if compatible cluster(s) are found</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt5: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="comment">// refit the track(s) with new attached cluster(s) and prepare to continue the tracking in the backward direction</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordtype">bool</span> stop(<span class="keyword">false</span>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">while</span> (!stop) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;              itTrack = std::prev(itTrack);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;              <span class="keywordflow">if</span> (itTrack == itNewTrack) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                stop = <span class="keyword">true</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;              }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;              <span class="keywordflow">try</span> {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                prepareBackwardTracking(itTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;              } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt5: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;              }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="comment">// prepare to continue the tracking in the backward direction with the initial candidate</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">if</span> (iPlaneCh9 == 25 || iPlaneCh9 == 27) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;          <span class="keywordflow">while</span> (itTrack != itNextTrack) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="comment">// if not already done, look for compatible clusters in the overlapping regions of chamber 9</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">if</span> (!itTrack-&gt;hasCurrentParam()) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;              prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keyword">auto</span> itNewTrack = followTrackInOverlapDE(itTrack, itTrack-&gt;first().getClusterPtr()-&gt;getDEId(), iPlaneCh9 - 1);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="comment">// keep the initial candidate only if no compatible cluster is found</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">if</span> (itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;              ++itTrack;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;              <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt5: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;              itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        itTrack = itNextTrack;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// remove tracks out of limits now that overlaps have been checked</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;isRemovable()) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      ++itTrack;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordtype">void</span> TrackFinder::findTrackCandidatesInSt4()</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;{</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;--- find candidates in station 4 ---&quot;</span>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keyword">auto</span> itLastCandidateFromSt5 = mTracks.empty() ? mTracks.end() : std::prev(mTracks.end());</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlaneCh8 = 20; iPlaneCh8 &lt; 24; ++iPlaneCh8) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlaneCh7 = 19; iPlaneCh7 &gt; 15; --iPlaneCh7) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="comment">// skip candidates that have already been found starting from a previous combination</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordtype">bool</span> skipUsedPairs = (iPlaneCh7 == 18 || iPlaneCh7 == 16 || iPlaneCh8 == 21 || iPlaneCh8 == 23);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="comment">// find all valid candidates between these 2 planes</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keyword">auto</span> itFirstCandidateOnSt4 = (itLastCandidateFromSt5 == mTracks.end()) ? mTracks.begin() : std::next(itLastCandidateFromSt5);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keyword">auto</span> itTrack = findTrackCandidates(iPlaneCh7, iPlaneCh8, skipUsedPairs, itFirstCandidateOnSt4);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="comment">// stop here if overlaps have already been checked on both chambers</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">if</span> ((iPlaneCh7 == 18 || iPlaneCh7 == 16) &amp;&amp; (iPlaneCh8 == 21 || iPlaneCh8 == 23)) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">while</span> (itTrack != mTracks.end()) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keyword">auto</span> itNextTrack = std::next(itTrack);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">if</span> (iPlaneCh7 == 19 || iPlaneCh7 == 17) {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          <span class="comment">// if not already done, look for compatible clusters in the overlapping regions of chamber 7</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          <span class="keyword">auto</span> itNewTrack = followTrackInOverlapDE(itTrack, itTrack-&gt;first().getClusterPtr()-&gt;getDEId(), iPlaneCh7 - 1);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;          <span class="comment">// keep the initial candidate only if no compatible cluster is found</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="keywordflow">if</span> (itNewTrack != mTracks.end()) {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt4: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            mTracks.erase(itTrack);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            itTrack = itNewTrack;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;          }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">while</span> (itTrack != itNextTrack) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          <span class="comment">// for every tracks, prepare to continue the tracking in the forward direction</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          <span class="keywordflow">try</span> {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            prepareForwardTracking(itTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;          } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt4: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          <span class="keywordflow">if</span> (iPlaneCh8 == 20 || iPlaneCh8 == 22) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="comment">// if not already done, look for compatible clusters in the overlapping regions of chamber 8</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="keyword">auto</span> itNewTrack = followTrackInOverlapDE(itTrack, itTrack-&gt;last().getClusterPtr()-&gt;getDEId(), iPlaneCh8 + 1);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="comment">// keep the initial candidate only if no compatible cluster is found</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="keywordflow">if</span> (itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;              ++itTrack;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;              <span class="comment">// prepare to continue the tracking of the new tracks from the last attached cluster</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;              <span class="keywordflow">for</span> (; itNewTrack != itTrack; ++itNewTrack) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                prepareForwardTracking(itNewTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;              }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;              <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findTrackCandidatesInSt4: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;              itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            ++itTrack;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// remove tracks out of limits now that overlaps have been checked</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keyword">auto</span> itTrack = (itLastCandidateFromSt5 == mTracks.end()) ? mTracks.begin() : ++itLastCandidateFromSt5;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">while</span> (itTrack != mTracks.end()) {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;isRemovable()) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      ++itTrack;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordtype">void</span> TrackFinder::findMoreTrackCandidates()</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;{</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;--- find more candidates ---&quot;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keyword">auto</span> itLastCandidate = mTracks.empty() ? mTracks.end() : std::prev(mTracks.end());</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlaneSt4 = 23; iPlaneSt4 &gt; 15; --iPlaneSt4) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlaneSt5 = 24; iPlaneSt5 &lt; 32; ++iPlaneSt5) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">// find all valid candidates between these 2 planes</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keyword">auto</span> itTrack = findTrackCandidates(iPlaneSt4, iPlaneSt5, <span class="keyword">true</span>, mTracks.begin());</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">// stop here if overlaps have already been checked on both chambers</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">if</span> ((iPlaneSt4 % 2 == 0) &amp;&amp; (iPlaneSt5 % 2 == 1)) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">while</span> (itTrack != mTracks.end()) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keyword">auto</span> itNextTrack = std::next(itTrack);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">if</span> (iPlaneSt5 % 2 == 0) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          <span class="comment">// if not already done, look for compatible clusters in the overlapping regions of that chamber in station 5</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;          <span class="keywordflow">try</span> {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            prepareForwardTracking(itTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findMoreTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <span class="keyword">auto</span> itNewTrack = followTrackInOverlapDE(itTrack, itTrack-&gt;last().getClusterPtr()-&gt;getDEId(), iPlaneSt5 + 1);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          <span class="keywordflow">if</span> (itNewTrack != mTracks.end()) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="comment">// remove the initial candidate if compatible cluster(s) are found</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findMoreTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="comment">// refit the track(s) with new cluster(s) and prepare to continue the tracking in the backward direction</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="keywordtype">bool</span> stop(<span class="keyword">false</span>);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">while</span> (!stop) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;              itTrack = std::prev(itTrack);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;              <span class="keywordflow">if</span> (itTrack == itNewTrack) {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                stop = <span class="keyword">true</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;              }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;              <span class="keywordflow">try</span> {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                prepareBackwardTracking(itTrack, <span class="keyword">true</span>);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;              } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findMoreTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;              }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="comment">// prepare to continue the tracking in the backward direction with the initial candidate</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">if</span> (iPlaneSt4 % 2 == 1) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          <span class="keywordflow">while</span> (itTrack != itNextTrack) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="comment">// if not already done, look for compatible clusters in the overlapping regions of that chamber in station 4</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="keywordflow">if</span> (!itTrack-&gt;hasCurrentParam()) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;              prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keyword">auto</span> itNewTrack = followTrackInOverlapDE(itTrack, itTrack-&gt;first().getClusterPtr()-&gt;getDEId(), iPlaneSt4 - 1);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="comment">// keep the initial candidate only if no compatible cluster is found</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="keywordflow">if</span> (itNewTrack == mTracks.end()) {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;              ++itTrack;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;              <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;findMoreTrackCandidates: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;              itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        itTrack = itNextTrack;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// remove tracks out of limits now that overlaps have been checked</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// and make sure every new tracks are prepared to continue the tracking in the backward direction</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keyword">auto</span> itTrack = (itLastCandidate == mTracks.end()) ? mTracks.begin() : ++itLastCandidate;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">while</span> (itTrack != mTracks.end()) {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;isRemovable()) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">if</span> (!itTrack-&gt;hasCurrentParam()) {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        prepareBackwardTracking(itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      ++itTrack;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;std::list&lt;Track&gt;::iterator TrackFinder::findTrackCandidates(<span class="keywordtype">int</span> plane1, <span class="keywordtype">int</span> plane2, <span class="keywordtype">bool</span> skipUsedPairs, <span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itFirstTrack)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;{</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> bendingVertexDispersion2 = SBendingVertexDispersion * SBendingVertexDispersion;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">// maximum impact parameter dispersion**2 due to MCS in chambers</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordtype">double</span> impactMCS2(0.);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordtype">int</span> chamber1 = getChamberId(plane1);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt;= chamber1; ++iCh) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    impactMCS2 += SDefaultChamberZ[iCh] * SDefaultChamberZ[iCh] * mMaxMCSAngle2[iCh];</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="comment">// create an iterator to the last track of the list before adding new ones</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keyword">auto</span> itTrack = mTracks.empty() ? mTracks.end() : std::prev(mTracks.end());</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de1 : mClusters[plane1]) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// skip DE without cluster</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">if</span> (de1.second == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster1 : *de1.second) {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">z1</a> = cluster1.getZ();</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de2 : mClusters[plane2]) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="comment">// skip DE without cluster</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span> (de2.second == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster2 : *de2.second) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          <span class="comment">// skip combinations of clusters already part of a track if requested</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;          <span class="keywordflow">if</span> (skipUsedPairs &amp;&amp; itTrack != mTracks.end() &amp;&amp; areUsed(cluster1, cluster2, itFirstTrack, std::next(itTrack))) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a1e60213b0a0658ac2a9ee86f18ef0f95">z2</a> = cluster2.getZ();</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          <span class="keywordtype">double</span> dZ = z1 - <a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a1e60213b0a0658ac2a9ee86f18ef0f95">z2</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          <span class="comment">// check if non bending impact parameter is within tolerances</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <span class="keywordtype">double</span> nonBendingSlope = (cluster1.getX() - cluster2.getX()) / dZ;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          <span class="keywordtype">double</span> nonBendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(cluster1.getX() - cluster1.getZ() * nonBendingSlope);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordtype">double</span> nonBendingImpactParamErr = TMath::Sqrt((z1 * z1 * cluster2.getEx2() + z2 * z2 * cluster1.getEx2()) / dZ / dZ + impactMCS2);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          <span class="keywordflow">if</span> ((nonBendingImpactParam - SSigmaCutForTracking * nonBendingImpactParamErr) &gt; (3. * SNonBendingVertexDispersion)) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          <span class="keywordtype">double</span> bendingSlope = (cluster1.getY() - cluster2.getY()) / dZ;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>()) { <span class="comment">// depending whether the field is ON or OFF</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="comment">// check if bending momentum is within tolerances</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordtype">double</span> bendingImpactParam = cluster1.getY() - cluster1.getZ() * bendingSlope;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <span class="keywordtype">double</span> bendingImpactParamErr2 = (z1 * z1 * cluster2.getEy2() + z2 * z2 * cluster1.getEy2()) / dZ / dZ + impactMCS2;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordtype">double</span> bendingMomentum = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">TrackExtrap::getBendingMomentumFromImpactParam</a>(bendingImpactParam));</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordtype">double</span> bendingMomentumErr = TMath::Sqrt((bendingVertexDispersion2 + bendingImpactParamErr2) / bendingImpactParam / bendingImpactParam + 0.01) * bendingMomentum;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <span class="keywordflow">if</span> ((bendingMomentum + 3. * bendingMomentumErr) &lt; SMinBendingMomentum) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="comment">// or check if bending impact parameter is within tolerances</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="keywordtype">double</span> bendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(cluster1.getY() - cluster1.getZ() * bendingSlope);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="keywordtype">double</span> bendingImpactParamErr = TMath::Sqrt((z1 * z1 * cluster2.getEy2() + z2 * z2 * cluster1.getEy2()) / dZ / dZ + impactMCS2);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="keywordflow">if</span> ((bendingImpactParam - SSigmaCutForTracking * bendingImpactParamErr) &gt; (3. * SBendingVertexDispersion)) {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="comment">// create a new track candidate</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          createTrack(cluster1, cluster2);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">return</span> (itTrack == mTracks.end()) ? mTracks.begin() : ++itTrack;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;}</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;std::list&lt;Track&gt;::iterator TrackFinder::followTrackInOverlapDE(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keywordtype">int</span> currentDE, <span class="keywordtype">int</span> plane)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;{</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;followTrackInOverlapDE: follow track #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; currently at DE &quot;</span>, currentDE, <span class="stringliteral">&quot; to plane &quot;</span>, plane);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  printTrack(*itTrack);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">// the current track parameters must be set</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <a class="code" href="../../d7/d94/GPUReconstructionIncludes_8h.html#a287eedb5aeb3e2204ded2924050fb641">assert</a>(itTrack-&gt;hasCurrentParam());</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keyword">auto</span> itNewTrack(itTrack);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; currentParam = itTrack-&gt;getCurrentParam();</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordtype">int</span> currentChamber = itTrack-&gt;getCurrentChamber();</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">// loop over all DEs of plane</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> paramAtCluster{};</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de : mClusters[plane]) {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// skip DE without cluster</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span> (de.second == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">// skip DE that do not overlap with the current DE</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordflow">if</span> (de.first % 100 != (currentDE % 100 + 1) % SNDE[currentChamber] &amp;&amp; de.first % 100 != (currentDE % 100 - 1 + SNDE[currentChamber]) % SNDE[currentChamber]) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">// look for cluster candidate in this DE</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster : *de.second) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="comment">// try to add the current cluster</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">if</span> (!isCompatible(currentParam, cluster, paramAtCluster)) {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="comment">// duplicate the track and add the new cluster</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      itNewTrack = mTracks.emplace(itNewTrack, *itTrack);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;followTrackInOverlapDE: duplicating candidate at position #&quot;</span>, getTrackIndex(itNewTrack), <span class="stringliteral">&quot; to add cluster &quot;</span>, cluster.getIdAsString());</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      itNewTrack-&gt;addParamAtCluster(paramAtCluster);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">// tag the track as removable (if it is not already the case) if it is out of limits</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="keywordflow">if</span> (!itNewTrack-&gt;isRemovable() &amp;&amp; !isAcceptable(paramAtCluster)) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        itNewTrack-&gt;removable();</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">return</span> (itNewTrack == itTrack) ? mTracks.end() : itNewTrack;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;std::list&lt;Track&gt;::iterator TrackFinder::followTrackInChamber(std::list&lt;Track&gt;::iterator&amp; itTrack,</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                                             <span class="keywordtype">int</span> chamber, <span class="keywordtype">int</span> lastChamber, <span class="keywordtype">bool</span> canSkip,</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                                             std::unordered_map&lt;<span class="keywordtype">int</span>, std::unordered_set&lt;uint32_t&gt;&gt;&amp; excludedClusters)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;{</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="comment">// list of (half-)planes, 2 or 4 per chamber, ordered according to the direction of propagation,</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">// which is forward when going to station 5 and backward otherwise with the present algorithm</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keyword">static</span> constexpr <span class="keywordtype">int</span> plane[10][4] = {{1, 0, -1, -1}, {3, 2, -1, -1}, {5, 4, -1, -1}, {7, 6, -1, -1}, {11, 10, 9, 8}, {15, 14, 13, 12}, {19, 18, 17, 16}, {23, 22, 21, 20}, {24, 25, 26, 27}, {28, 29, 30, 31}};</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;followTrackInChamber: follow track #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; to chamber &quot;</span>, chamber + 1, <span class="stringliteral">&quot; up to chamber &quot;</span>, lastChamber + 1);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="comment">// the current track parameters must be set at a different chamber and valid</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">if</span> (!itTrack-&gt;areCurrentParamValid() || chamber == itTrack-&gt;getCurrentChamber()) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="comment">// determine whether the chamber is the first one reached on the station</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordtype">int</span> currentChamber = itTrack-&gt;getCurrentChamber();</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordtype">bool</span> isFirstOnStation = ((chamber &lt; currentChamber &amp;&amp; chamber % 2 == 1) || (chamber &gt; currentChamber &amp;&amp; chamber % 2 == 0));</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="comment">// follow the track in the 2 planes or 4 half-planes of the chamber</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keyword">auto</span> itFirstNewTrack = followTrackInChamber(itTrack, plane[chamber][0], plane[chamber][1], lastChamber, excludedClusters);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span> (chamber &gt; 3) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keyword">auto</span> itNewTrack = followTrackInChamber(itTrack, plane[chamber][2], plane[chamber][3], lastChamber, excludedClusters);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">// add MCS effects in that chamber before going further with this track or stop here if the track could not reach that chamber</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keywordflow">if</span> (itTrack-&gt;areCurrentParamValid()) {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;(itTrack-&gt;getCurrentParam()), SChamberThicknessInX0[chamber], -1.);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">return</span> itFirstNewTrack;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordflow">if</span> (chamber != lastChamber) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">// save the current track parameters before going to the next chamber</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> currentParam = itTrack-&gt;getCurrentParam();</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// consider the possibility to skip the chamber if it is the first one of the station or if we know we can skip it,</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">// i.e. if a compatible cluster has been found on the first chamber and none has been found on the second</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span> (isFirstOnStation || (canSkip &amp;&amp; excludedClusters.empty())) {</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordtype">int</span> nextChamber = (chamber &gt; lastChamber) ? chamber - 1 : chamber + 1;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keyword">auto</span> itNewTrack = followTrackInChamber(itTrack, nextChamber, lastChamber, <span class="keyword">false</span>, excludedClusters);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    }</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// consider the possibility to skip the entire station if not requested and not the last one</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> (isFirstOnStation &amp;&amp; !SRequestStation[chamber / 2] &amp;&amp; chamber / 2 != lastChamber / 2) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordtype">int</span> nextChamber = (chamber &gt; lastChamber) ? chamber - 2 : chamber + 2;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keyword">auto</span> itNewTrack = followTrackInChamber(itTrack, nextChamber, lastChamber, <span class="keyword">false</span>, excludedClusters);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">// reset the current track parameters to the ones at that chamber if needed</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// (not sure it is needed at all but that way it is clear what the current track parameters are at the end of this function)</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;getCurrentChamber() != chamber) {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      setCurrentParam(*itTrack, currentParam, chamber);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="comment">// add a new track if a cluster has been found on the first chamber of the station but not on the second and last one</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">// or if one reaches station 1 and it is not requested, whether a cluster has been found on it or not</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">if</span> ((!isFirstOnStation &amp;&amp; canSkip &amp;&amp; excludedClusters.empty()) ||</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        (chamber / 2 == 0 &amp;&amp; !SRequestStation[0] &amp;&amp; (isFirstOnStation || !canSkip))) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      itFirstNewTrack = mTracks.emplace(itTrack, *itTrack);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;followTrackInChamber: duplicating candidate at position #&quot;</span>, getTrackIndex(itFirstNewTrack));</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  }</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">return</span> itFirstNewTrack;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;}</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;std::list&lt;Track&gt;::iterator TrackFinder::followTrackInChamber(std::list&lt;Track&gt;::iterator&amp; itTrack,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                                             <span class="keywordtype">int</span> plane1, <span class="keywordtype">int</span> plane2, <span class="keywordtype">int</span> lastChamber,</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                                                             std::unordered_map&lt;<span class="keywordtype">int</span>, std::unordered_set&lt;uint32_t&gt;&gt;&amp; excludedClusters)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;{</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;followTrackInChamber: follow track #&quot;</span>, getTrackIndex(itTrack), <span class="stringliteral">&quot; to planes &quot;</span>, plane1, <span class="stringliteral">&quot; and &quot;</span>, plane2, <span class="stringliteral">&quot; up to chamber &quot;</span>, lastChamber + 1);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  printTrack(*itTrack);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="comment">// the current track parameters must be set and valid</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">if</span> (!itTrack-&gt;areCurrentParamValid()) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  }</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keyword">auto</span> itFirstNewTrack(mTracks.end());</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// add MCS effects in the missing chambers if any. Update the current parameters in the process</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordtype">int</span> chamber = getChamberId(plane1);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">if</span> ((chamber &lt; itTrack-&gt;getCurrentChamber() - 1 || chamber &gt; itTrack-&gt;getCurrentChamber() + 1) &amp;&amp;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      !propagateCurrentParam(*itTrack, (chamber &lt; itTrack-&gt;getCurrentChamber()) ? chamber + 1 : chamber - 1)) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="comment">// extrapolate the candidate to the chamber if not already there</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> paramAtChamber = itTrack-&gt;getCurrentParam();</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordflow">if</span> (itTrack-&gt;getCurrentChamber() != chamber &amp;&amp; !<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;paramAtChamber, SDefaultChamberZ[chamber], <span class="keyword">true</span>)) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    itTrack-&gt;invalidateCurrentParam();</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">return</span> mTracks.end();</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  }</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">// determine the next chamber to go to, if lastChamber is not yet reached</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">int</span> nextChamber(-1);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">if</span> (chamber &gt; lastChamber) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    nextChamber = chamber - 1;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chamber &lt; lastChamber) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    nextChamber = chamber + 1;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="comment">// loop over all DEs of plane1</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> paramAtCluster1{};</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> currentParamAtCluster1{};</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> paramAtCluster2{};</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  std::unordered_map&lt;int, std::unordered_set&lt;uint32_t&gt;&gt; newExcludedClusters{};</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de1 : mClusters[plane1]) {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// skip DE without cluster</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> (de1.second == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">// get the list of excluded clusters for the DE</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keyword">auto</span> itExcludedClusters = excludedClusters.find(de1.first);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordtype">bool</span> hasExcludedClusters = (itExcludedClusters != excludedClusters.end());</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// look for cluster candidate in this DE</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster1 : *de1.second) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="comment">// skip excluded clusters</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">if</span> (hasExcludedClusters &amp;&amp; itExcludedClusters-&gt;second.count(cluster1.getUniqueId()) &gt; 0) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="comment">// try to add the current cluster</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">if</span> (!isCompatible(paramAtChamber, cluster1, paramAtCluster1)) {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="comment">// add it to the list of excluded clusters for this candidate</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      excludedClusters[de1.first].emplace(cluster1.getUniqueId());</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="comment">// skip tracks out of limits, but after checking for overlaps</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordtype">bool</span> isAcceptableAtCluster1 = isAcceptable(paramAtCluster1);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="comment">// save the current parameters at cluster1, reset the propagator and add MCS effects before going to plane2</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      currentParamAtCluster1 = paramAtCluster1;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      currentParamAtCluster1.resetPropagator();</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;currentParamAtCluster1, SChamberThicknessInX0[chamber], -1.);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="comment">// loop over all DEs of plane2</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordtype">bool</span> cluster2Found(<span class="keyword">false</span>);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de2 : mClusters[plane2]) {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">// skip DE without cluster</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">if</span> (de2.second == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="comment">// skip DE that do not overlap with the DE of plane1</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">if</span> (de2.first % 100 != (de1.first % 100 + 1) % SNDE[chamber] &amp;&amp; de2.first % 100 != (de1.first % 100 - 1 + SNDE[chamber]) % SNDE[chamber]) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="comment">// look for cluster candidate in this DE</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster2 : *de2.second) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;          <span class="comment">// try to add the current cluster</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;          <span class="keywordflow">if</span> (!isCompatible(currentParamAtCluster1, cluster2, paramAtCluster2)) {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;          }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          cluster2Found = <span class="keyword">true</span>;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;          <span class="comment">// add it to the list of excluded clusters for this candidate</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          excludedClusters[de2.first].emplace(cluster2.getUniqueId());</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;          <span class="comment">// skip tracks out of limits</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          <span class="keywordflow">if</span> (!isAcceptableAtCluster1 || !isAcceptable(paramAtCluster2)) {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;          }</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;          <span class="comment">// continue the tracking to the next chambers and attach the 2 clusters to the new tracks if any</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;          <span class="keyword">auto</span> itNewTrack = addClustersAndFollowTrack(itTrack, paramAtCluster1, &amp;paramAtCluster2, nextChamber, lastChamber, newExcludedClusters);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;          <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;          }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          <span class="comment">// transfert the list of new excluded clusters to the full list for the initial candidate</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;          moveClusters(newExcludedClusters, excludedClusters);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordflow">if</span> (!cluster2Found &amp;&amp; isAcceptableAtCluster1) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="comment">// continue the tracking with only cluster1 if no compatible cluster is found on plane2 and the track stays within limits</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keyword">auto</span> itNewTrack = addClustersAndFollowTrack(itTrack, paramAtCluster1, <span class="keyword">nullptr</span>, nextChamber, lastChamber, newExcludedClusters);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment">// transfert the list of new excluded clusters to the full list for the initial candidate</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        moveClusters(newExcludedClusters, excludedClusters);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      }</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">// loop over all DEs of plane2</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; de2 : mClusters[plane2]) {</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">// skip DE without cluster</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">if</span> (de2.second == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// get the list of excluded clusters for the DE</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keyword">auto</span> itExcludedClusters = excludedClusters.find(de2.first);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordtype">bool</span> hasExcludedClusters = (itExcludedClusters != excludedClusters.end());</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">// look for cluster candidate in this DE</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cluster2 : *de2.second) {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="comment">// skip excluded clusters (in particular the ones already attached together with a cluster on plane1)</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">if</span> (hasExcludedClusters &amp;&amp; itExcludedClusters-&gt;second.count(cluster2.getUniqueId()) &gt; 0) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="comment">// try to add the current cluster</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">if</span> (!isCompatible(paramAtChamber, cluster2, paramAtCluster2)) {</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      }</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="comment">// add it to the list of excluded clusters for this candidate</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      excludedClusters[de2.first].emplace(cluster2.getUniqueId());</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="comment">// skip tracks out of limits</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span> (!isAcceptable(paramAtCluster2)) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="comment">// continue the tracking to the next chambers and attach the cluster to the new tracks if any</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keyword">auto</span> itNewTrack = addClustersAndFollowTrack(itTrack, paramAtCluster2, <span class="keyword">nullptr</span>, nextChamber, lastChamber, newExcludedClusters);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">if</span> (itFirstNewTrack == mTracks.end()) {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="comment">// transfert the list of new excluded clusters to the full list for the initial candidate</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      moveClusters(newExcludedClusters, excludedClusters);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">// reset the current parameters to the ones at that chamber if needed, not adding MCS effects yet</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keywordflow">if</span> (itTrack-&gt;getCurrentChamber() != chamber) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    setCurrentParam(*itTrack, paramAtChamber, chamber);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordflow">return</span> itFirstNewTrack;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;}</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;std::list&lt;Track&gt;::iterator TrackFinder::addClustersAndFollowTrack(std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; paramAtCluster1,</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                                                  <span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* paramAtCluster2, <span class="keywordtype">int</span> nextChamber, <span class="keywordtype">int</span> lastChamber,</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                                                  std::unordered_map&lt;<span class="keywordtype">int</span>, std::unordered_set&lt;uint32_t&gt;&gt;&amp; excludedClusters)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;{</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">// the list of excluded clusters must be empty here as new cluster(s) are being attached to the candidate</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <a class="code" href="../../d7/d94/GPUReconstructionIncludes_8h.html#a287eedb5aeb3e2204ded2924050fb641">assert</a>(excludedClusters.empty());</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keyword">auto</span> itFirstNewTrack(mTracks.end());</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">if</span> (nextChamber &gt;= 0) {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">// the tracking continues from paramAtCluster2, if any, or from paramAtCluster1</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">if</span> (paramAtCluster2) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;addClustersAndFollowTrack: 2 clusters found (&quot;</span>, paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot; and &quot;</span>,</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            paramAtCluster2-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot;). Continuing the tracking of candidate #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      setCurrentParam(*itTrack, *paramAtCluster2, paramAtCluster2-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>());</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;addClustersAndFollowTrack: 1 cluster found (&quot;</span>, paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(),</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <span class="stringliteral">&quot;). Continuing the tracking of candidate #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      setCurrentParam(*itTrack, paramAtCluster1, paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>());</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// follow the track to the next chamber, which can be skipped if it is on the same station</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordtype">bool</span> canSkip = (nextChamber / 2 == paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>() / 2);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keyword">auto</span> itNewTrack = followTrackInChamber(itTrack, nextChamber, lastChamber, canSkip, excludedClusters);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    itFirstNewTrack = itNewTrack;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="comment">// attach the current cluster(s) to every new tracks found</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">if</span> (itNewTrack != mTracks.end()) {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordflow">while</span> (itNewTrack != itTrack) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        itNewTrack-&gt;addParamAtCluster(paramAtCluster1);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">if</span> (paramAtCluster2) {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;          itNewTrack-&gt;addParamAtCluster(*paramAtCluster2);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;          <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;addClustersAndFollowTrack: add to the candidate at position #&quot;</span>, getTrackIndex(itNewTrack),</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                <span class="stringliteral">&quot; clusters &quot;</span>, paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot; and &quot;</span>, paramAtCluster2-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>());</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;          <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;addClustersAndFollowTrack: add to the candidate at position #&quot;</span>, getTrackIndex(itNewTrack),</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                <span class="stringliteral">&quot; cluster &quot;</span>, paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>());</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        ++itNewTrack;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      }</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="comment">// or duplicate the track and add the new cluster(s)</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    itFirstNewTrack = mTracks.emplace(itTrack, *itTrack);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    itFirstNewTrack-&gt;addParamAtCluster(paramAtCluster1);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span> (paramAtCluster2) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      itFirstNewTrack-&gt;addParamAtCluster(*paramAtCluster2);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;addClustersAndFollowTrack: duplicating candidate at position #&quot;</span>, getTrackIndex(itFirstNewTrack), <span class="stringliteral">&quot; to add 2 clusters (&quot;</span>,</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot; and &quot;</span>, paramAtCluster2-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;addClustersAndFollowTrack: duplicating candidate at position #&quot;</span>, getTrackIndex(itFirstNewTrack),</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="stringliteral">&quot; to add 1 cluster (&quot;</span>, paramAtCluster1.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">return</span> itFirstNewTrack;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;}</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keywordtype">void</span> TrackFinder::improveTracks()</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;{</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="comment">// Maximum chi2 to keep a cluster (the factor 2 is for the 2 degrees of freedom: x and y)</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> maxChi2OfCluster = 2. * SSigmaCutForImprovement * SSigmaCutForImprovement;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordtype">bool</span> removeTrack(<span class="keyword">false</span>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// At the first step, only run the smoother</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keyword">auto</span> itStartingParam = std::prev(itTrack-&gt;rend());</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="comment">// Refit the part of the track affected by the cluster removal, run the smoother, but do not finalize</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keywordflow">try</span> {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        mTrackFitter.fit(*itTrack, <span class="keyword">true</span>, <span class="keyword">false</span>, (itStartingParam == itTrack-&gt;rbegin()) ? <span class="keyword">nullptr</span> : &amp;itStartingParam);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        removeTrack = <span class="keyword">true</span>;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="comment">// Identify removable clusters</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      itTrack-&gt;tagRemovableClusters(requestedStationMask());</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="comment">// Look for the cluster with the worst local chi2</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordtype">double</span> worstLocalChi2(-1.);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keyword">auto</span> itWorstParam(itTrack-&gt;end());</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack-&gt;begin(); itParam != itTrack-&gt;end(); ++itParam) {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">if</span> (itParam-&gt;getLocalChi2() &gt; worstLocalChi2) {</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          worstLocalChi2 = itParam-&gt;getLocalChi2();</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;          itWorstParam = itParam;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      <span class="comment">// If the worst chi2 is under requirement then the track is improved</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keywordflow">if</span> (worstLocalChi2 &lt; maxChi2OfCluster) {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      }</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">// If the worst cluster is not removable then the track cannot be improved</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">if</span> (!itWorstParam-&gt;isRemovable()) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        removeTrack = <span class="keyword">true</span>;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="comment">// Remove the worst cluster</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keyword">auto</span> itNextParam = itTrack-&gt;removeParamAtCluster(itWorstParam);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="comment">// Decide from where to refit the track: from the cluster next the one suppressed or</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="comment">// from scratch if the removed cluster was used to compute the tracking seed</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      itStartingParam = itTrack-&gt;rbegin();</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keyword">auto</span> itNextToNextParam = (itNextParam == itTrack-&gt;end()) ? itNextParam : std::next(itNextParam);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">while</span> (itNextToNextParam != itTrack-&gt;end()) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordflow">if</span> (itNextToNextParam-&gt;getClusterPtr()-&gt;getChamberId() != itNextParam-&gt;getClusterPtr()-&gt;getChamberId()) {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;          itStartingParam = std::make_reverse_iterator(++itNextParam);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        ++itNextToNextParam;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      }</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// Remove the track if it couldn&#39;t be improved</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span> (removeTrack) {</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;improveTracks: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      ++itTrack;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    }</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;}</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="keywordtype">void</span> TrackFinder::removeConnectedTracks(<span class="keywordtype">int</span> stMin, <span class="keywordtype">int</span> stMax)</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;{</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">if</span> (mTracks.size() &lt; 2) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordtype">int</span> chMin = 2 * stMin;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keywordtype">int</span> chMax = 2 * stMax + 1;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordtype">int</span> nPlane = 2 * (chMax - chMin + 1);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// first loop to fill the array of cluster Ids</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  std::vector&lt;uint32_t&gt; ClIds{};</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  ClIds.resize(nPlane * mTracks.size());</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordtype">int</span> iTrack(0);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end(); ++itTrack, ++iTrack) {</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack-&gt;rbegin(); itParam != itTrack-&gt;rend(); ++itParam) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="keywordtype">int</span> ch = itParam-&gt;getClusterPtr()-&gt;getChamberId();</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordflow">if</span> (ch &gt; chMax) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch &lt; chMin) {</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      }</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      ClIds[nPlane * iTrack + 2 * (ch - chMin) + itParam-&gt;getClusterPtr()-&gt;getDEId() % 2] = itParam-&gt;getClusterPtr()-&gt;getUniqueId();</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="comment">// second loop to tag the tracks to remove</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordtype">int</span> iindex = ClIds.size() - 1;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack1 = mTracks.rbegin(); itTrack1 != mTracks.rend(); ++itTrack1, iindex -= nPlane) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordtype">int</span> jindex = iindex - nPlane;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack2 = std::next(itTrack1); itTrack2 != mTracks.rend(); ++itTrack2) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPlane = nPlane; iPlane &gt; 0; --iPlane) {</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">if</span> (ClIds[iindex] &gt; 0 &amp;&amp; ClIds[iindex] == ClIds[jindex]) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;          <span class="keywordflow">if</span> (itTrack2-&gt;isBetter(*itTrack1)) {</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            itTrack1-&gt;connected();</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            itTrack2-&gt;connected();</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;          }</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;          iindex -= iPlane;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          jindex -= iPlane;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        --iindex;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        --jindex;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      }</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      iindex += nPlane;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  }</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="comment">// third loop to remove them. That way all combinations are tested.</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != mTracks.end();) {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;isConnected()) {</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;removeConnectedTracks: removing candidate at position #&quot;</span>, getTrackIndex(itTrack));</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      itTrack = mTracks.erase(itTrack);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      ++itTrack;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;}</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="keywordtype">void</span> TrackFinder::finalize()</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;{</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; track : mTracks) {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a> : track) {</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>.setParameters(<a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>.getSmoothParameters());</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>.setCovariances(<a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>.getSmoothCovariances());</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;}</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="keywordtype">void</span> TrackFinder::createTrack(<span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl1, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl2)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;{</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// create the track and the trackParam at each cluster</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html">Track</a>&amp; track = mTracks.emplace_back();</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#a2ec5f44327528b76b9992d4d72c1194b">createParamAtCluster</a>(cl2);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#a2ec5f44327528b76b9992d4d72c1194b">createParamAtCluster</a>(cl1);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;createTrack: creating candidate at position #&quot;</span>, getTrackIndex(std::prev(mTracks.end())),</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <span class="stringliteral">&quot; with clusters &quot;</span>, cl1.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>(), <span class="stringliteral">&quot; and &quot;</span>, cl2.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">getIdAsString</a>());</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="comment">// fit the track using the Kalman filter</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    mTrackFitter.fit(track, <span class="keyword">false</span>);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a>(<span class="stringliteral">&quot;... fit failed --&gt; removing it&quot;</span>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    mTracks.erase(std::prev(mTracks.end()));</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;}</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="keywordtype">bool</span> TrackFinder::isAcceptable(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="comment">// impact parameter dispersion**2 due to MCS in chambers</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordtype">int</span> chamber = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>();</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="keywordtype">double</span> impactMCS2(0.);</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>() &amp;&amp; chamber &lt; 6) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="comment">// track momentum is known</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iCh = 0; iCh &lt;= chamber; ++iCh) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      impactMCS2 += SDefaultChamberZ[iCh] * SDefaultChamberZ[iCh] * <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">TrackExtrap::getMCSAngle2</a>(param, SChamberThicknessInX0[iCh], 1.);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="comment">// track momentum is unknown</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordflow">for</span> (Int_t iCh = 0; iCh &lt;= chamber; ++iCh) {</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      impactMCS2 += SDefaultChamberZ[iCh] * SDefaultChamberZ[iCh] * mMaxMCSAngle2[iCh];</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    }</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; paramCov = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>();</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">getZ</a>();</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="comment">// check if non bending impact parameter is within tolerances</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordtype">double</span> nonBendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>() - z * param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7996f6bdfe1ebde73d35a5afb0cfddf8">getNonBendingSlope</a>());</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordtype">double</span> nonBendingImpactParamErr = TMath::Sqrt(paramCov(0, 0) + z * z * paramCov(1, 1) - 2. * z * paramCov(0, 1) + impactMCS2);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordflow">if</span> ((nonBendingImpactParam - SSigmaCutForTracking * nonBendingImpactParamErr) &gt; (3. * SNonBendingVertexDispersion)) {</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  }</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">TrackExtrap::isFieldON</a>()) { <span class="comment">// depending whether the field is ON or OFF</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="comment">// check if bending momentum is within tolerances</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordtype">double</span> bendingMomentum = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(1. / param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0311a27a83ed443fe3ebcfac7563fb6e">getInverseBendingMomentum</a>());</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordtype">double</span> bendingMomentumErr = TMath::Sqrt(paramCov(4, 4)) * bendingMomentum * bendingMomentum;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">if</span> (chamber &lt; 6 &amp;&amp; (bendingMomentum + SSigmaCutForTracking * bendingMomentumErr) &lt; SMinBendingMomentum) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((bendingMomentum + 3. * bendingMomentumErr) &lt; SMinBendingMomentum) {</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    }</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="comment">// or check if bending impact parameter is within tolerances</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordtype">double</span> bendingImpactParam = <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>() - z * param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad8aec7a026adb273c2a04ec99bfa9241">getBendingSlope</a>());</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordtype">double</span> bendingImpactParamErr = TMath::Sqrt(paramCov(2, 2) + z * z * paramCov(3, 3) - 2. * z * paramCov(2, 3) + impactMCS2);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keywordflow">if</span> ((bendingImpactParam - SSigmaCutForTracking * bendingImpactParamErr) &gt; (3. * SBendingVertexDispersion)) {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  }</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;}</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="keywordtype">void</span> TrackFinder::prepareForwardTracking(std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keywordtype">bool</span> runSmoother)</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;{</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="keywordflow">if</span> (runSmoother) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keyword">auto</span> itStartingParam = std::prev(itTrack-&gt;rend());</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    mTrackFitter.fit(*itTrack, <span class="keyword">true</span>, <span class="keyword">false</span>, &amp;itStartingParam);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  setCurrentParam(*itTrack, itTrack-&gt;last(), itTrack-&gt;last().getClusterPtr()-&gt;getChamberId(), runSmoother);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;}</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keywordtype">void</span> TrackFinder::prepareBackwardTracking(std::list&lt;Track&gt;::iterator&amp; itTrack, <span class="keywordtype">bool</span> <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af8d5e8746a70a9e5950bf2000846ca1c">refit</a>)</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;{</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordflow">if</span> (refit) {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    mTrackFitter.fit(*itTrack, <span class="keyword">false</span>);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  setCurrentParam(*itTrack, itTrack-&gt;first(), itTrack-&gt;first().getClusterPtr()-&gt;getChamberId());</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;}</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="keywordtype">void</span> TrackFinder::setCurrentParam(<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html">Track</a>&amp; track, <span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param, <span class="keywordtype">int</span> chamber, <span class="keywordtype">bool</span> smoothed)</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;{</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#ad13bf2d542023b5ac9fb78f67fb34e47">setCurrentParam</a>(param, chamber);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="keywordflow">if</span> (smoothed) {</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; currentParam = track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#abf32b3cbc4bc7e5985ea649a646e6807">getCurrentParam</a>();</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    currentParam.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aba28923af349ff2ec356d00c8b46dcb4">setParameters</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#adbaa2b794300321b1b7cdde8fe49349f">getSmoothParameters</a>());</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    currentParam.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0199cb638413b2f94773c37b5b114292">getSmoothCovariances</a>());</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordflow">if</span> (param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">getClusterPtr</a>()) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; currentParam = track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#abf32b3cbc4bc7e5985ea649a646e6807">getCurrentParam</a>();</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    currentParam.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ae233ce574fef4f6f53569dd50c805a05">resetPropagator</a>();</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;currentParam, SChamberThicknessInX0[chamber], -1.);</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  }</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;}</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="keywordtype">bool</span> TrackFinder::propagateCurrentParam(<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html">Track</a>&amp; track, <span class="keywordtype">int</span> chamber)</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;{</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; currentParam = track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#abf32b3cbc4bc7e5985ea649a646e6807">getCurrentParam</a>();</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordtype">int</span>&amp; currentChamber = track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#aa1e85d9d6752001291afc6153fd7a1c0">getCurrentChamber</a>();</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="keywordflow">while</span> (currentChamber != chamber) {</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    currentChamber += (chamber &lt; currentChamber) ? -1 : 1;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;currentParam, SDefaultChamberZ[currentChamber], <span class="keyword">true</span>)) {</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#a0299373dcb8b77f1666ac7316fec59c3">invalidateCurrentParam</a>();</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(&amp;currentParam, SChamberThicknessInX0[currentChamber], -1.);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  }</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;}</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="keywordtype">bool</span> TrackFinder::areUsed(<span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl1, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cl2, <span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itFirstTrack, <span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itLastTrack)</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;{</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keywordflow">if</span> (itFirstTrack == mTracks.end()) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  }</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = itFirstTrack; itTrack != itLastTrack; ++itTrack) {</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordtype">bool</span> cl1Used(<span class="keyword">false</span>), cl2Used(<span class="keyword">false</span>);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack-&gt;rbegin(); itParam != itTrack-&gt;rend(); ++itParam) {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="keywordflow">if</span> (itParam-&gt;getClusterPtr() == &amp;cl1) {</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        cl1Used = <span class="keyword">true</span>;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itParam-&gt;getClusterPtr() == &amp;cl2) {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        cl2Used = <span class="keyword">true</span>;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      }</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <span class="keywordflow">if</span> (cl1Used &amp;&amp; cl2Used) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      }</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    }</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  }</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;}</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="keywordtype">void</span> TrackFinder::excludeClustersFromIdenticalTracks(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itTrack,</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                                                     std::unordered_map&lt;<span class="keywordtype">int</span>, std::unordered_set&lt;uint32_t&gt;&gt;&amp; excludedClusters,</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                                                     <span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itEndTrack)</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;{</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack2 = mTracks.begin(); itTrack2 != itEndTrack; ++itTrack2) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> (itTrack-&gt;getNClustersInCommon(*itTrack2) == itTrack-&gt;getNClusters()) {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> itParam = itTrack2-&gt;rbegin(); itParam != itTrack2-&gt;rend(); ++itParam) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>* cluster = itParam-&gt;getClusterPtr();</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">if</span> (cluster-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">getChamberId</a>() &gt; 7) {</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;          excludedClusters[cluster-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a506efa42d60bb4ea23d0efded52cad1a">getDEId</a>()].emplace(cluster-&gt;<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a031c66897cf9d3634fa7a514abb34fd8">getUniqueId</a>());</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      }</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    }</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  }</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;}</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="keywordtype">void</span> TrackFinder::moveClusters(std::unordered_map&lt;<span class="keywordtype">int</span>, std::unordered_set&lt;uint32_t&gt;&gt;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a6ffd2192cbc75d017665e95207ee36a7">source</a>, std::unordered_map&lt;<span class="keywordtype">int</span>, std::unordered_set&lt;uint32_t&gt;&gt;&amp; destination)</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;{</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; sourceDE : <a class="code" href="../../dc/da3/glcorearb_8h.html#a6ffd2192cbc75d017665e95207ee36a7">source</a>) {</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    destination[sourceDE.first].insert(sourceDE.second.begin(), sourceDE.second.end());</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  source.clear();</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;}</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="keywordtype">bool</span> TrackFinder::isCompatible(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cluster, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; paramAtCluster)</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;{</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="comment">// maximum chi2 to accept a cluster candidate (the factor 2 is for the 2 degrees of freedom: x and y)</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> maxChi2OfCluster = 2. * SSigmaCutForTracking * SSigmaCutForTracking;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="comment">// fast try to add the current cluster</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="keywordflow">if</span> (!tryOneClusterFast(param, cluster)) {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="comment">// try to add the current cluster accurately</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="keywordflow">if</span> (tryOneCluster(param, cluster, paramAtCluster) &gt;= maxChi2OfCluster) {</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  }</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="comment">// save the extrapolated parameters and covariances for the smoother</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#af507f14ee2ac8fb7494eb6c131cfe58a">setExtrapParameters</a>(paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ae581607973425b7873b2fd4e2f8f7f3a">getParameters</a>());</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a54b440482f0c4e680e71a43724d0638f">setExtrapCovariances</a>(paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>());</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="comment">// compute the new track parameters including the cluster using the Kalman filter</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    mTrackFitter.runKalmanFilter(paramAtCluster);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  } <span class="keywordflow">catch</span> (exception <span class="keyword">const</span>&amp;) {</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  }</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;}</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="keywordtype">bool</span> TrackFinder::tryOneClusterFast(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cluster)</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;{</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  ++mNCallTryOneClusterFast;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  <span class="keywordtype">double</span> dZ = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>() - param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">getZ</a>();</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <span class="keywordtype">double</span> dX = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>() - (param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>() + param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7996f6bdfe1ebde73d35a5afb0cfddf8">getNonBendingSlope</a>() * dZ);</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="keywordtype">double</span> dY = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>() - (param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>() + param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad8aec7a026adb273c2a04ec99bfa9241">getBendingSlope</a>() * dZ);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; paramCov = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>();</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="keywordtype">double</span> errX2 = paramCov(0, 0) + dZ * dZ * paramCov(1, 1) + 2. * dZ * paramCov(0, 1) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">getEx2</a>();</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keywordtype">double</span> errY2 = paramCov(2, 2) + dZ * dZ * paramCov(3, 3) + 2. * dZ * paramCov(2, 3) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">getEy2</a>();</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="keywordtype">double</span> dXmax = SSigmaCutForTracking * TMath::Sqrt(2. * errX2) + SMaxNonBendingDistanceToTrack;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keywordtype">double</span> dYmax = SSigmaCutForTracking * TMath::Sqrt(2. * errY2) + SMaxBendingDistanceToTrack;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(dX) &gt; dXmax || <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(dY) &gt; dYmax) {</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  }</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;}</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="keywordtype">double</span> TrackFinder::tryOneCluster(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; param, <span class="keyword">const</span> <a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">Cluster</a>&amp; cluster, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; paramAtCluster)</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;{</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  ++mNCallTryOneCluster;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// Extrapolate the track parameters and covariances at the z position of the cluster</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  paramAtCluster = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#abf4e8f66fa2c6511ee9da38bd5f5e3f1">setClusterPtr</a>(&amp;cluster);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(&amp;paramAtCluster, cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">getZ</a>(), <span class="keyword">true</span>)) {</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="keywordflow">return</span> mTrackFitter.getMaxChi2();</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="comment">// Compute the cluster-track residuals in bending and non bending directions</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="keywordtype">double</span> dX = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">getX</a>() - paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">getNonBendingCoor</a>();</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keywordtype">double</span> dY = cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">getY</a>() - paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">getBendingCoor</a>();</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="comment">// Combine the cluster and track resolutions and covariances</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; paramCov = paramAtCluster.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">getCovariances</a>();</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="keywordtype">double</span> sigmaX2 = paramCov(0, 0) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">getEx2</a>();</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="keywordtype">double</span> sigmaY2 = paramCov(2, 2) + cluster.<a class="code" href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">getEy2</a>();</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="keywordtype">double</span> covXY = paramCov(0, 2);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordtype">double</span> det = sigmaX2 * sigmaY2 - covXY * covXY;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="comment">// Compute and return the matching chi2</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordflow">if</span> (det == 0.) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">return</span> mTrackFitter.getMaxChi2();</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keywordflow">return</span> (dX * dX * sigmaY2 + dY * dY * sigmaX2 - 2. * dX * dY * covXY) / det;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;}</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;uint8_t TrackFinder::requestedStationMask()<span class="keyword"> const</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  uint8_t <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>(0);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">if</span> (SRequestStation[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      mask |= (1 &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  }</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;}</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="keywordtype">int</span> TrackFinder::getTrackIndex(<span class="keyword">const</span> std::list&lt;Track&gt;::iterator&amp; itCurrentTrack)<span class="keyword"> const</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &lt; 1) {</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">return</span> -3;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  }</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordflow">if</span> (itCurrentTrack == mTracks.end()) {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  }</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>(0);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itTrack = mTracks.begin(); itTrack != itCurrentTrack; ++itTrack) {</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keywordflow">if</span> (itTrack == mTracks.end()) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <span class="keywordflow">return</span> -2;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    }</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    ++<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;}</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="keywordtype">void</span> TrackFinder::printTracks()<span class="keyword"> const</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 1) {</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; track : mTracks) {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#a807516709eba43dcb1ae2271d839fd6d">print</a>();</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    }</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  }</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;}</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="keywordtype">void</span> TrackFinder::printTrack(<span class="keyword">const</span> <a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html">Track</a>&amp; track)<span class="keyword"> const</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 1) {</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    track.<a class="code" href="../../d7/d24/classo2_1_1mch_1_1Track.html#a807516709eba43dcb1ae2271d839fd6d">print</a>();</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  }</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;}</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="keywordtype">void</span> TrackFinder::printTrackParam(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; trackParam)<span class="keyword"> const</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 1) {</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    trackParam.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a25859a79a80fa7e3af1593276b6613ec">print</a>();</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  }</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;}</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span>... Args&gt;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="keywordtype">void</span> TrackFinder::print(Args... args)<span class="keyword"> const</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="keywordflow">if</span> (mDebugLevel &gt; 0) {</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    (cout &lt;&lt; ... &lt;&lt; args) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  }</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;}</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01620"></a><span class="lineno"><a class="line" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#ad79b6013e73aaa242f920e447480ca53"> 1620</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#ad79b6013e73aaa242f920e447480ca53">TrackFinder::printStats</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of candidates tracked = &quot;</span> &lt;&lt; mNCandidates;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">TrackExtrap::printNCalls</a>();</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of times tryOneClusterFast() is called = &quot;</span> &lt;&lt; mNCallTryOneClusterFast;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of times tryOneCluster() is called = &quot;</span> &lt;&lt; mNCallTryOneCluster;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;}</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">//_________________________________________________________________________________________________</span></div><div class="line"><a name="l01630"></a><span class="lineno"><a class="line" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#adf0ffe9b505420477e63df8aee2a1424"> 1630</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#adf0ffe9b505420477e63df8aee2a1424">TrackFinder::printTimers</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;findTrackCandidates duration = &quot;</span> &lt;&lt; mTimeFindCandidates.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;findMoreTrackCandidates duration = &quot;</span> &lt;&lt; mTimeFindMoreCandidates.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;followTracks duration = &quot;</span> &lt;&lt; mTimeFollowTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;improveTracks duration = &quot;</span> &lt;&lt; mTimeImproveTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;removeConnectedTracks duration = &quot;</span> &lt;&lt; mTimeCleanTracks.count() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;}</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;} <span class="comment">// namespace mch</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;} <span class="comment">// namespace o2</span></div><div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ac0ac144cc47efb6f5aa57fff3842dfdb"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ac0ac144cc47efb6f5aa57fff3842dfdb">o2::mch::TrackParam::getClusterPtr</a></div><div class="ttdeci">const Cluster * getClusterPtr() const</div><div class="ttdoc">get pointer to associated cluster </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00113">TrackParam.h:113</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_ae93da2c687d7a3c5ce7b947256671fca"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ae93da2c687d7a3c5ce7b947256671fca">o2::mch::Cluster::getEy2</a></div><div class="ttdeci">double getEy2() const</div><div class="ttdoc">Return the cluster resolution square along y. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00057">Cluster.h:57</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac7c896d55e93a6cf7ff8524005b4e7b4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a></div><div class="ttdeci">GLenum GLfloat param</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00271">glcorearb.h:271</a></div></div>
<div class="ttc" id="namespaceo2_html"><div class="ttname"><a href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="ttdoc">information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d24/BitstreamReader_8h_source.html#l00022">BitstreamReader.h:22</a></div></div>
<div class="ttc" id="glcorearb_8h_html_aee38b51639b577753f6a92029fb92000"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a></div><div class="ttdeci">GLdouble GLdouble GLdouble z</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00843">glcorearb.h:843</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a936b218ebcf61fd9a1d0c4db296e71a8"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a936b218ebcf61fd9a1d0c4db296e71a8">o2::mch::TrackParam::getCovariances</a></div><div class="ttdeci">const TMatrixD &amp; getCovariances() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00191">TrackParam.cxx:191</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a0199cb638413b2f94773c37b5b114292"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0199cb638413b2f94773c37b5b114292">o2::mch::TrackParam::getSmoothCovariances</a></div><div class="ttdeci">const TMatrixD &amp; getSmoothCovariances() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00332">TrackParam.cxx:332</a></div></div>
<div class="ttc" id="GPUReconstructionIncludes_8h_html_a287eedb5aeb3e2204ded2924050fb641"><div class="ttname"><a href="../../d7/d94/GPUReconstructionIncludes_8h.html#a287eedb5aeb3e2204ded2924050fb641">assert</a></div><div class="ttdeci">#define assert(param)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/GPUReconstructionIncludes_8h_source.html#l00021">GPUReconstructionIncludes.h:21</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_ac931d315a8ff2528f8bc1ab875598990"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ac931d315a8ff2528f8bc1ab875598990">o2::mch::TrackExtrap::useExtrapV2</a></div><div class="ttdeci">static void useExtrapV2()</div><div class="ttdoc">Switch to Runge-Kutta extrapolation v2. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h_source.html#l00049">TrackExtrap.h:49</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_abf32b3cbc4bc7e5985ea649a646e6807"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#abf32b3cbc4bc7e5985ea649a646e6807">o2::mch::Track::getCurrentParam</a></div><div class="ttdeci">TrackParam &amp; getCurrentParam()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da9/Detectors_2MUON_2MCH_2Tracking_2src_2Track_8cxx_source.html#l00210">Track.cxx:210</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00028">GPUCommonLogger.h:28</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_ad8e7d8f437e9eb1bf58132f4f0ff921e"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#ad8e7d8f437e9eb1bf58132f4f0ff921e">o2::mch::Cluster::getX</a></div><div class="ttdeci">double getX() const</div><div class="ttdoc">Return the cluster position along x. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00045">Cluster.h:45</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a42a3d28a9a3c94d7058387da1d0fd980"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a42a3d28a9a3c94d7058387da1d0fd980">o2::mch::Cluster::getEx2</a></div><div class="ttdeci">double getEx2() const</div><div class="ttdoc">Return the cluster resolution square along x. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00055">Cluster.h:55</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinder_html_ad79b6013e73aaa242f920e447480ca53"><div class="ttname"><a href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#ad79b6013e73aaa242f920e447480ca53">o2::mch::TrackFinder::printStats</a></div><div class="ttdeci">void printStats() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8b/TrackFinder_8cxx_source.html#l01620">TrackFinder.cxx:1620</a></div></div>
<div class="ttc" id="TrackFinder_8h_html"><div class="ttname"><a href="../../d5/d91/TrackFinder_8h.html">TrackFinder.h</a></div><div class="ttdoc">Definition of a class to reconstruct tracks. </div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_adbaa2b794300321b1b7cdde8fe49349f"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#adbaa2b794300321b1b7cdde8fe49349f">o2::mch::TrackParam::getSmoothParameters</a></div><div class="ttdeci">const TMatrixD &amp; getSmoothParameters() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00311">TrackParam.cxx:311</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_af3a03bdc4c1fce56d5e8b10a69e6a233"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">o2::mch::TrackExtrap::addMCSEffect</a></div><div class="ttdeci">static void addMCSEffect(TrackParam *trackParam, double dZ, double x0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00486">TrackExtrap.cxx:486</a></div></div>
<div class="ttc" id="namespaceo2_1_1its_1_1math__utils_html_a1e60213b0a0658ac2a9ee86f18ef0f95"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a1e60213b0a0658ac2a9ee86f18ef0f95">o2::its::math_utils::z2</a></div><div class="ttdeci">float float float float float z2</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00043">MathUtils.h:43</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a4fd54f6fd209ed9abe259d6f4bd9c555"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">o2::mch::TrackExtrap::getMCSAngle2</a></div><div class="ttdeci">static double getMCSAngle2(const TrackParam &amp;param, double dZ, double x0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00466">TrackExtrap.cxx:466</a></div></div>
<div class="ttc" id="testBareElinkEncoder_8cxx_html_a61d454dcf3f57efb6c741c369b92cbf8"><div class="ttname"><a href="../../d7/d33/testBareElinkEncoder_8cxx.html#a61d454dcf3f57efb6c741c369b92cbf8">print</a></div><div class="ttdeci">void print(const char *msg, const ElinkEncoder&lt; FORMAT, CHARGESUM &gt; &amp;enc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d33/testBareElinkEncoder_8cxx_source.html#l00119">testBareElinkEncoder.cxx:119</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d76/Cartesian3D_8h_source.html#l00229">Cartesian3D.h:229</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinder_html_adf0ffe9b505420477e63df8aee2a1424"><div class="ttname"><a href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#adf0ffe9b505420477e63df8aee2a1424">o2::mch::TrackFinder::printTimers</a></div><div class="ttdeci">void printTimers() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8b/TrackFinder_8cxx_source.html#l01630">TrackFinder.cxx:1630</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html">o2::mch::Cluster</a></div><div class="ttdoc">cluster for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00030">Cluster.h:30</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_aac63a415ff843e903851611bb8e2df79"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">o2::mch::TrackExtrap::extrapToZCov</a></div><div class="ttdeci">static bool extrapToZCov(TrackParam *trackParam, double zEnd, bool updatePropagator=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00159">TrackExtrap.cxx:159</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aba28923af349ff2ec356d00c8b46dcb4"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aba28923af349ff2ec356d00c8b46dcb4">o2::mch::TrackParam::setParameters</a></div><div class="ttdeci">void setParameters(const TMatrixD &amp;parameters)</div><div class="ttdoc">set track parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00078">TrackParam.h:78</a></div></div>
<div class="ttc" id="MUON_2MCH_2Tracking_2src_2TrackExtrap_8h_html"><div class="ttname"><a href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h.html">TrackExtrap.h</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_a0299373dcb8b77f1666ac7316fec59c3"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#a0299373dcb8b77f1666ac7316fec59c3">o2::mch::Track::invalidateCurrentParam</a></div><div class="ttdeci">void invalidateCurrentParam()</div><div class="ttdoc">invalidate the current parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7a/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Track_8h_source.html#l00086">Track.h:86</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ae1838b9db98fcca9cd79d66954101c9f"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a></div><div class="ttdeci">GLint GLuint mask</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00291">glcorearb.h:291</a></div></div>
<div class="ttc" id="MagneticField_8h_html"><div class="ttname"><a href="../../db/d4b/MagneticField_8h.html">MagneticField.h</a></div><div class="ttdoc">Definition of the MagF class. </div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_ad705e1fd1795b9429ed58b6cff35ea50"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">o2::mch::TrackExtrap::printNCalls</a></div><div class="ttdeci">static void printNCalls()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l01232">TrackExtrap.cxx:1232</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinder_html_a4052165d5a3142ddd64bdc4766cdec95"><div class="ttname"><a href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#a4052165d5a3142ddd64bdc4766cdec95">o2::mch::TrackFinder::init</a></div><div class="ttdeci">void init(float l3Current, float dipoleCurrent)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8b/TrackFinder_8cxx_source.html#l00042">TrackFinder.cxx:42</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a8fad63ea683004a4d6de4348ba26df7d"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">o2::mch::TrackParam::setCovariances</a></div><div class="ttdeci">void setCovariances(const TMatrixD &amp;covariances)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00202">TrackParam.cxx:202</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_abf4e8f66fa2c6511ee9da38bd5f5e3f1"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#abf4e8f66fa2c6511ee9da38bd5f5e3f1">o2::mch::TrackParam::setClusterPtr</a></div><div class="ttdeci">void setClusterPtr(const Cluster *cluster)</div><div class="ttdoc">set pointer to associated cluster </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00115">TrackParam.h:115</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a7996f6bdfe1ebde73d35a5afb0cfddf8"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7996f6bdfe1ebde73d35a5afb0cfddf8">o2::mch::TrackParam::getNonBendingSlope</a></div><div class="ttdeci">Double_t getNonBendingSlope() const</div><div class="ttdoc">return non bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00051">TrackParam.h:51</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a364c45fd57208b3171ae0fa782bc26de"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a364c45fd57208b3171ae0fa782bc26de">o2::mch::TrackExtrap::isFieldON</a></div><div class="ttdeci">static bool isFieldON()</div><div class="ttdoc">Return true if the field is switched ON. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df1/MUON_2MCH_2Tracking_2src_2TrackExtrap_8h_source.html#l00046">TrackExtrap.h:46</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a6ffd2192cbc75d017665e95207ee36a7"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6ffd2192cbc75d017665e95207ee36a7">source</a></div><div class="ttdeci">GLsizei GLsizei GLchar * source</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00798">glcorearb.h:798</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a00dc28d5db1371df938f63ad9eb450df"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value [n] sets TFlen for [n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char Store histograms in output root Do not run but just create PDFs from input root files Set cut for Q Compute the efficiency including impure tracks with fake contamination Maxmimum Create resolution histograms in the native fit Filter for Filter for Particle Store mc labels to file for later matching Minimum Pt of a matched track to be displayed Compare QA QAonly Event generator settings h Reconstruction settings Enable TRD processing Enable TPC Compression Mask to disable certain attachment steps during Enable rejection of TPC clusters for Pt threshold to reject clusters of TPC tracks Sort order of TPC Force early TPC transformation also for continuous Forward TPC digits as clusters(if they pass the ZS threshold)&quot;) AddOption(dropLoopers</div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_a807516709eba43dcb1ae2271d839fd6d"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#a807516709eba43dcb1ae2271d839fd6d">o2::mch::Track::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da9/Detectors_2MUON_2MCH_2Tracking_2src_2Track_8cxx_source.html#l00220">Track.cxx:220</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackFinder_html_a9de2ac373731d05c5a8a650743d775f1"><div class="ttname"><a href="../../da/daf/classo2_1_1mch_1_1TrackFinder.html#a9de2ac373731d05c5a8a650743d775f1">o2::mch::TrackFinder::findTracks</a></div><div class="ttdeci">const std::list&lt; Track &gt; &amp; findTracks(const std::unordered_map&lt; int, std::list&lt; Cluster &gt;&gt; &amp;clusters)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8b/TrackFinder_8cxx_source.html#l00132">TrackFinder.cxx:132</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a3270667ed541999064ec1ea8d578df04"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3270667ed541999064ec1ea8d578df04">o2::mch::TrackParam::getNonBendingCoor</a></div><div class="ttdeci">Double_t getNonBendingCoor() const</div><div class="ttdoc">return non bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00047">TrackParam.h:47</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_aa1e85d9d6752001291afc6153fd7a1c0"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#aa1e85d9d6752001291afc6153fd7a1c0">o2::mch::Track::getCurrentChamber</a></div><div class="ttdeci">int &amp; getCurrentChamber()</div><div class="ttdoc">get a reference to the current chamber on which the current parameters are given </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7a/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Track_8h_source.html#l00080">Track.h:80</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a7845c105d3d46f0c4c31ec6dfea154b2"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">o2::mch::TrackParam::setInverseBendingMomentum</a></div><div class="ttdeci">void setInverseBendingMomentum(Double_t inverseBendingMomentum)</div><div class="ttdoc">set inverse bending momentum (GeV/c ** -1) times the charge (assumed forward motion) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00065">TrackParam.h:65</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_af8d5e8746a70a9e5950bf2000846ca1c"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#af8d5e8746a70a9e5950bf2000846ca1c">refit</a></div><div class="ttdeci">Run track merging refit</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00136">qconfigoptions.h:136</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a65db4eb2d3fc758a825b41944b9c8359"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a65db4eb2d3fc758a825b41944b9c8359">o2::mch::TrackParam::getZ</a></div><div class="ttdeci">Double_t getZ() const</div><div class="ttdoc">return Z coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00043">TrackParam.h:43</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a25859a79a80fa7e3af1593276b6613ec"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a25859a79a80fa7e3af1593276b6613ec">o2::mch::TrackParam::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00426">TrackParam.cxx:426</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a0dc0247307c07874ee991618e8e8d486"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a0dc0247307c07874ee991618e8e8d486">o2::mch::Cluster::getChamberId</a></div><div class="ttdeci">int getChamberId() const</div><div class="ttdoc">Return the chamber ID (0..), part of the unique ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00062">Cluster.h:62</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a103c4cb34263ae74bed43946c30f23d4"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a103c4cb34263ae74bed43946c30f23d4">o2::mch::Cluster::getIdAsString</a></div><div class="ttdeci">std::string getIdAsString() const</div><div class="ttdoc">Return the unique ID of this cluster in human readable form. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00068">Cluster.h:68</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aa712d841f1781437b0ecc35bbf320e80"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aa712d841f1781437b0ecc35bbf320e80">o2::mch::TrackParam::getBendingCoor</a></div><div class="ttdeci">Double_t getBendingCoor() const</div><div class="ttdoc">return bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00055">TrackParam.h:55</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_a2ec5f44327528b76b9992d4d72c1194b"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#a2ec5f44327528b76b9992d4d72c1194b">o2::mch::Track::createParamAtCluster</a></div><div class="ttdeci">TrackParam &amp; createParamAtCluster(const Cluster &amp;cluster)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da9/Detectors_2MUON_2MCH_2Tracking_2src_2Track_8cxx_source.html#l00042">Track.cxx:42</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a0311a27a83ed443fe3ebcfac7563fb6e"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a0311a27a83ed443fe3ebcfac7563fb6e">o2::mch::TrackParam::getInverseBendingMomentum</a></div><div class="ttdeci">Double_t getInverseBendingMomentum() const</div><div class="ttdoc">return inverse bending momentum (GeV/c ** -1) times the charge (assumed forward motion) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00063">TrackParam.h:63</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a54b440482f0c4e680e71a43724d0638f"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a54b440482f0c4e680e71a43724d0638f">o2::mch::TrackParam::setExtrapCovariances</a></div><div class="ttdeci">void setExtrapCovariances(const TMatrixD &amp;covariances)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00301">TrackParam.cxx:301</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a6e00e7ed1cba587512308463c62edd52"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">o2::mch::TrackExtrap::getBendingMomentumFromImpactParam</a></div><div class="ttdeci">static double getBendingMomentumFromImpactParam(double impactParam)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d30/MUON_2MCH_2Tracking_2src_2TrackExtrap_8cxx_source.html#l00068">TrackExtrap.cxx:68</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html_ad13bf2d542023b5ac9fb78f67fb34e47"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html#ad13bf2d542023b5ac9fb78f67fb34e47">o2::mch::Track::setCurrentParam</a></div><div class="ttdeci">void setCurrentParam(const TrackParam &amp;param, int chamber)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da9/Detectors_2MUON_2MCH_2Tracking_2src_2Track_8cxx_source.html#l00197">Track.cxx:197</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a57f14e05b1900f16a2da82ade47d0c6d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a></div><div class="ttdeci">GLuint index</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="namespaceo2_1_1framework_html_ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">o2::framework::Abs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc2/BasicOps_8h_source.html#l00031">BasicOps.h:31</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ae581607973425b7873b2fd4e2f8f7f3a"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ae581607973425b7873b2fd4e2f8f7f3a">o2::mch::TrackParam::getParameters</a></div><div class="ttdeci">const TMatrixD &amp; getParameters() const</div><div class="ttdoc">return track parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00076">TrackParam.h:76</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_af6ce9829522ed857e0a661df8d611a55"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#af6ce9829522ed857e0a661df8d611a55">o2::mch::Cluster::getZ</a></div><div class="ttdeci">double getZ() const</div><div class="ttdoc">Return the cluster position along z. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00049">Cluster.h:49</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Track_html"><div class="ttname"><a href="../../d7/d24/classo2_1_1mch_1_1Track.html">o2::mch::Track</a></div><div class="ttdoc">track for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7a/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Track_8h_source.html#l00031">Track.h:31</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a62805738e05bae416a55ea7b1e9295a2"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a62805738e05bae416a55ea7b1e9295a2">o2::mch::Cluster::getY</a></div><div class="ttdeci">double getY() const</div><div class="ttdoc">Return the cluster position along y. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00047">Cluster.h:47</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ad8aec7a026adb273c2a04ec99bfa9241"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad8aec7a026adb273c2a04ec99bfa9241">o2::mch::TrackParam::getBendingSlope</a></div><div class="ttdeci">Double_t getBendingSlope() const</div><div class="ttdoc">return bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00059">TrackParam.h:59</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ae233ce574fef4f6f53569dd50c805a05"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ae233ce574fef4f6f53569dd50c805a05">o2::mch::TrackParam::resetPropagator</a></div><div class="ttdeci">void resetPropagator()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00251">TrackParam.cxx:251</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a506efa42d60bb4ea23d0efded52cad1a"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a506efa42d60bb4ea23d0efded52cad1a">o2::mch::Cluster::getDEId</a></div><div class="ttdeci">int getDEId() const</div><div class="ttdoc">Return the detection element ID, part of the unique ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00064">Cluster.h:64</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="namespaceo2_1_1its_1_1math__utils_html_ac713be41b5cad67abc4e4d0581961905"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#ac713be41b5cad67abc4e4d0581961905">o2::its::math_utils::z1</a></div><div class="ttdeci">float float float float z1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00043">MathUtils.h:43</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_af507f14ee2ac8fb7494eb6c131cfe58a"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#af507f14ee2ac8fb7494eb6c131cfe58a">o2::mch::TrackParam::setExtrapParameters</a></div><div class="ttdeci">void setExtrapParameters(const TMatrixD &amp;parameters)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00280">TrackParam.cxx:280</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1Cluster_html_a031c66897cf9d3634fa7a514abb34fd8"><div class="ttname"><a href="../../d6/d65/classo2_1_1mch_1_1Cluster.html#a031c66897cf9d3634fa7a514abb34fd8">o2::mch::Cluster::getUniqueId</a></div><div class="ttdeci">uint32_t getUniqueId() const</div><div class="ttdoc">Return the unique ID of this cluster. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5c/Detectors_2MUON_2MCH_2Tracking_2include_2MCHTracking_2Cluster_8h_source.html#l00060">Cluster.h:60</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">o2::mch::TrackParam</a></div><div class="ttdoc">track parameters for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00031">TrackParam.h:31</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_1cc233fd3b1202b9dad36810b41b97af.html">MUON</a></li><li class="navelem"><a class="el" href="../../dir_061f7088060f41729027f6c2fce0273e.html">MCH</a></li><li class="navelem"><a class="el" href="../../dir_09445408fa345a18838fb91740d089d0.html">Tracking</a></li><li class="navelem"><a class="el" href="../../dir_f33357dc4b90b7dfe5d72abda619e77f.html">src</a></li><li class="navelem"><a class="el" href="../../d1/d8b/TrackFinder_8cxx.html">TrackFinder.cxx</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:30 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
