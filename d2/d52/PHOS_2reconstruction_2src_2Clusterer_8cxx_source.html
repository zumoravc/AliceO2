<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/PHOS/reconstruction/src/Clusterer.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Clusterer.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h.html">PHOSReconstruction/Clusterer.h</a>&quot;</span> <span class="comment">// for LOG</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d7f/PHOS_2base_2include_2PHOSBase_2Geometry_8h.html">PHOSBase/Geometry.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d62/PHOSSimParams_8h.html">PHOSBase/PHOSSimParams.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d50/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h.html">DataFormatsPHOS/Cluster.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d32/PHOS_2reconstruction_2include_2PHOSReconstruction_2FullCluster_8h.html">PHOSReconstruction/FullCluster.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h.html">DataFormatsPHOS/Digit.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d3e/CcdbApi_8h.html">CCDB/CcdbApi.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;FairLogger.h&quot;</span> <span class="comment">// for LOG</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../dd/d57/namespaceo2_1_1phos.html">o2::phos</a>;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<a class="code" href="../../d2/dd9/CPV_2reconstruction_2src_2Clusterer_8cxx.html#a09ffd78f500e40dde5621939c693e157">ClassImp</a>(<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html">Clusterer</a>);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab42a1e5b4f260522f5498086d1f8eea2">   30</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab42a1e5b4f260522f5498086d1f8eea2">Clusterer::initialize</a>()</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a90e3d50526d2bd8e6caf2e479e80b0de">mPHOSGeom</a>) {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a90e3d50526d2bd8e6caf2e479e80b0de">mPHOSGeom</a> = <a class="code" href="../../d4/d6c/classo2_1_1phos_1_1Geometry.html#a5beceefc4ad5b551a86e46e3efe6d243">Geometry::GetInstance</a>();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a> = 0;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a> = -1;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a767750330781fc5d9eea2b8bec39d0f5">   39</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a767750330781fc5d9eea2b8bec39d0f5">Clusterer::process</a>(gsl::span&lt;const Digit&gt; digits, gsl::span&lt;const TriggerRecord&gt; dtr,</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                        <span class="keyword">const</span> <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>* dmc,</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                        std::vector&lt;Cluster&gt;* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>, std::vector&lt;TriggerRecord&gt;* trigRec,</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                        <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>* cluMC)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  clusters-&gt;clear(); <span class="comment">//final out list of clusters</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  trigRec-&gt;clear();</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  cluMC-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#afe8bc587090f857ee2d825751fa4af8f">clear</a>();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; tr : dtr) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a> = tr.getFirstEntry();</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a> = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a> + tr.getNumberOfObjects();</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">int</span> indexStart = clusters-&gt;size();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.clear(); <span class="comment">// internal list of FullClusters</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Starting clusteriztion digits from &quot;</span> &lt;&lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a>) {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mCCDBPath.compare(<span class="stringliteral">&quot;localtest&quot;</span>) == 0) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a> = <span class="keyword">new</span> <a class="code" href="../../dd/db4/classo2_1_1phos_1_1BadChannelMap.html">BadChannelMap</a>(1);    <span class="comment">// test default map</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ac96d5581237220624b0bf18f05b51aec">mCalibParams</a> = <span class="keyword">new</span> <a class="code" href="../../d9/d6b/classo2_1_1phos_1_1CalibParams.html">CalibParams</a>(1); <span class="comment">//test calibration map</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;No reading BadMap/Calibration from ccdb requested, set default&quot;</span>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Getting BadMap object from ccdb&quot;</span>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html">o2::ccdb::CcdbApi</a> ccdb;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        std::map&lt;std::string, std::string&gt; metadata; <span class="comment">// do we want to store any meta data?</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        ccdb.<a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0121aadd2206dae1f108db333bd257d2">init</a>(<span class="stringliteral">&quot;http://ccdb-test.cern.ch:8080&quot;</span>);  <span class="comment">// or http://localhost:8080 for a local installation</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordtype">long</span> bcTime = 1;                             <span class="comment">//TODO!!! Convert BC time to time o2::InteractionRecord bcTime = digitsTR.front().getBCData() ;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a> = ccdb.<a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#ae843c7520a304d6297986d7692932bd9">retrieveFromTFileAny</a>&lt;<a class="code" href="../../dd/db4/classo2_1_1phos_1_1BadChannelMap.html">o2::phos::BadChannelMap</a>&gt;(<span class="stringliteral">&quot;PHOS/BadMap&quot;</span>, metadata, bcTime);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ac96d5581237220624b0bf18f05b51aec">mCalibParams</a> = ccdb.<a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#ae843c7520a304d6297986d7692932bd9">retrieveFromTFileAny</a>&lt;<a class="code" href="../../d9/d6b/classo2_1_1phos_1_1CalibParams.html">o2::phos::CalibParams</a>&gt;(<span class="stringliteral">&quot;PHOS/Calib&quot;</span>, metadata, bcTime);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a>) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;[PHOSCellConverter - run] can not get Bad Map&quot;</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">if</span> (!mCalibParams) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;[PHOSCellConverter - run] can not get CalibParams&quot;</span>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// Collect digits to clusters</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a82a80a35e3132b535bd280f5932c92b7">makeClusters</a>(digits);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// Unfold overlapped clusters</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// Split clusters with several local maxima if necessary</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mUnfoldClusters) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a55344c27631c40c4948becb389c3634b">makeUnfoldings</a>(digits);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// Calculate properties of collected clusters (Local position, energy, disp etc.)</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0725f21d72df9f5315adc739b4597964">evalCluProperties</a>(digits, clusters, dmc, cluMC);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Found clusters from &quot;</span> &lt;&lt; indexStart &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; clusters-&gt;size();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    trigRec-&gt;emplace_back(tr.getBCData(), indexStart, clusters-&gt;size());</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a93711cbabfe6841771b90ec5aa33998c">   96</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a93711cbabfe6841771b90ec5aa33998c">Clusterer::processCells</a>(gsl::span&lt;const Cell&gt; cells, gsl::span&lt;const TriggerRecord&gt; ctr,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                             <span class="keyword">const</span> <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>* dmc, gsl::span&lt;const unsigned int&gt; mcmap,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                             std::vector&lt;Cluster&gt;* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>, std::vector&lt;TriggerRecord&gt;* trigRec,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                             <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>* cluMC)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// Transform input Cells to digits and run standard recontruction</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  clusters-&gt;clear(); <span class="comment">//final out list of clusters</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  trigRec-&gt;clear();</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  cluMC-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#afe8bc587090f857ee2d825751fa4af8f">clear</a>();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; tr : ctr) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordtype">int</span> firstCellInEvent = tr.getFirstEntry();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">int</span> lastCellInEvent = firstCellInEvent + tr.getNumberOfObjects();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">int</span> indexStart = clusters-&gt;size();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.clear(); <span class="comment">// internal list of FullClusters</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Starting clusteriztion cells from &quot;</span> &lt;&lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a>) {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mCCDBPath.compare(<span class="stringliteral">&quot;localtest&quot;</span>) == 0) {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a> = <span class="keyword">new</span> <a class="code" href="../../dd/db4/classo2_1_1phos_1_1BadChannelMap.html">BadChannelMap</a>(1);    <span class="comment">// test default map</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ac96d5581237220624b0bf18f05b51aec">mCalibParams</a> = <span class="keyword">new</span> <a class="code" href="../../d9/d6b/classo2_1_1phos_1_1CalibParams.html">CalibParams</a>(1); <span class="comment">//test calibration map</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;No reading BadMap/Calibration from ccdb requested, set default&quot;</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Getting BadMap object from ccdb&quot;</span>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html">o2::ccdb::CcdbApi</a> ccdb;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        std::map&lt;std::string, std::string&gt; metadata; <span class="comment">// do we want to store any meta data?</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        ccdb.<a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0121aadd2206dae1f108db333bd257d2">init</a>(<span class="stringliteral">&quot;http://ccdb-test.cern.ch:8080&quot;</span>);  <span class="comment">// or http://localhost:8080 for a local installation</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordtype">long</span> bcTime = 1;                             <span class="comment">//TODO!!! Convert BC time to time o2::InteractionRecord bcTime = digitsTR.front().getBCData() ;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a> = ccdb.<a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#ae843c7520a304d6297986d7692932bd9">retrieveFromTFileAny</a>&lt;<a class="code" href="../../dd/db4/classo2_1_1phos_1_1BadChannelMap.html">o2::phos::BadChannelMap</a>&gt;(<span class="stringliteral">&quot;PHOS/BadMap&quot;</span>, metadata, bcTime);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ac96d5581237220624b0bf18f05b51aec">mCalibParams</a> = ccdb.<a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#ae843c7520a304d6297986d7692932bd9">retrieveFromTFileAny</a>&lt;<a class="code" href="../../d9/d6b/classo2_1_1phos_1_1CalibParams.html">o2::phos::CalibParams</a>&gt;(<span class="stringliteral">&quot;PHOS/Calib&quot;</span>, metadata, bcTime);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">mBadMap</a>) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;[PHOSCellConverter - run] can not get Bad Map&quot;</span>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (!mCalibParams) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(FATAL) &lt;&lt; <span class="stringliteral">&quot;[PHOSCellConverter - run] can not get CalibParams&quot;</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ace9c856d2fb37cc0d87d37a5c858d57d">convertCellsToDigits</a>(cells, firstCellInEvent, lastCellInEvent, mcmap);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// Collect digits to clusters</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a82a80a35e3132b535bd280f5932c92b7">makeClusters</a>(<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// Unfold overlapped clusters</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// Split clusters with several local maxima if necessary</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mUnfoldClusters) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a55344c27631c40c4948becb389c3634b">makeUnfoldings</a>(<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// Calculate properties of collected clusters (Local position, energy, disp etc.)</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0725f21d72df9f5315adc739b4597964">evalCluProperties</a>(<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>, clusters, dmc, cluMC);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Found clusters from &quot;</span> &lt;&lt; indexStart &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; clusters-&gt;size();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    trigRec-&gt;emplace_back(tr.getBCData(), indexStart, clusters-&gt;size());</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ace9c856d2fb37cc0d87d37a5c858d57d">  156</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ace9c856d2fb37cc0d87d37a5c858d57d">Clusterer::convertCellsToDigits</a>(gsl::span&lt;const Cell&gt; cells, <span class="keywordtype">int</span> firstCellInEvent, <span class="keywordtype">int</span> lastCellInEvent, gsl::span&lt;const unsigned int&gt; mcmap)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>.clear();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>.capacity() &lt; lastCellInEvent - firstCellInEvent) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>.reserve(lastCellInEvent - firstCellInEvent);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">int</span> iLab = 0, nLab = mcmap.size();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">while</span> (iLab &lt; nLab) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span> (mcmap[iLab] &gt;= firstCellInEvent) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    ++iLab;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = firstCellInEvent; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; lastCellInEvent; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../dd/d9e/classo2_1_1phos_1_1Cell.html">Cell</a> c = cells[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">//short cell, float amplitude, float time, int label</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a> = -1;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (mcmap[iLab] == <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      label = iLab;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      ++iLab;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">if</span> (iLab &gt;= nLab)</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        --iLab;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>.emplace_back(c.<a class="code" href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#a9aac1ef0436d1dc9303d802c2fb6f608">getAbsId</a>(), c.<a class="code" href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#aaf1d4994ee2dcc49b4895a75201557ca">getEnergy</a>(), c.<a class="code" href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#a9f95e42d44ff27598ad7261b3f09a9ac">getTime</a>(), <a class="code" href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a>);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>.back().setHighGain(c.<a class="code" href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#a9b41c86e64242a9c933fea497ff8cebc">getHighGain</a>());</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a> = 0;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a> = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">mDigits</a>.size();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a82a80a35e3132b535bd280f5932c92b7">  188</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a82a80a35e3132b535bd280f5932c92b7">Clusterer::makeClusters</a>(gsl::span&lt;const Digit&gt; digits)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;{</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// A cluster is defined as a list of neighbour digits</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="comment">// Mark all digits as unused yet</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> maxNDigits = 12546; <span class="comment">// There is no digits more than in PHOS modules ;)</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordtype">bool</span> digitsUsed[maxNDigits];</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  memset(digitsUsed, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>) * maxNDigits);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordtype">int</span> iFirst = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a>; <span class="comment">// first index of digit which potentially can be a part of cluster</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = iFirst; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a>; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">if</span> (digitsUsed[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> - <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a>])</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html">Digit</a>&amp; digitSeed = digits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordtype">float</span> digitSeedEnergy = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#aa528bb6e7d804a875687aff894567db2">calibrate</a>(digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a49bdaf6956f61a394031795b8d13d08e">getAmplitude</a>(), digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>());</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0f9881b4fa8d297457b3665106f53842">isBadChannel</a>(digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>())) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      digitSeedEnergy = 0.;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (digitSeedEnergy &lt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().<a class="code" href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a78e61019dd71792e6f58f5854fd3ea09">mDigitMinEnergy</a>) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// is this digit so energetic that start cluster?</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html">FullCluster</a>* clu = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">int</span> iDigitInCluster = 0;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">if</span> (digitSeedEnergy &gt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().<a class="code" href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a9783f6ddc64c30e6e3c0a9ad55e9d691">mClusteringThreshold</a>) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="comment">// start new cluster</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.emplace_back(digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>(), digitSeedEnergy,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                             <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a6f2184225b0d79f18bb1e1c7be072991">calibrateT</a>(digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#aa8773b49e42ff866bea9a70ebcd66f0f">getTime</a>(), digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>(), digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a698ca9586038bccb90af761a4012ccfb">isHighGain</a>()),</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                             digitSeed.<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a739e9b0a1e5f2ee1c5d2ee1f0c30815b">getLabel</a>(), 1.);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      clu = &amp;(<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.back());</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      digitsUsed[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> - <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      iDigitInCluster = 1;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// Now scan remaining digits in list to find neigbours of our seed</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a> = 0;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">while</span> (index &lt; iDigitInCluster) { <span class="comment">// scan over digits already in cluster</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordtype">short</span> digitSeedAbsId = clu-&gt;<a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#af51e989bd73449578f438c2ee9785fde">getDigitAbsId</a>(index);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      index++;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">for</span> (Int_t j = iFirst; j &lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">mLastDigitInEvent</a>; j++) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span> (digitsUsed[j - <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a>])</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;          <span class="keywordflow">continue</span>; <span class="comment">// look through remaining digits</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html">Digit</a>* digitN = &amp;(digits[j]);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordtype">float</span> digitNEnergy = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#aa528bb6e7d804a875687aff894567db2">calibrate</a>(digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a49bdaf6956f61a394031795b8d13d08e">getAmplitude</a>(), digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>());</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0f9881b4fa8d297457b3665106f53842">isBadChannel</a>(digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>())) { <span class="comment">//remove digit</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          digitNEnergy = 0.;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">if</span> (digitNEnergy &lt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().<a class="code" href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a78e61019dd71792e6f58f5854fd3ea09">mDigitMinEnergy</a>) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">// call (digit,digitN) in THAT oder !!!!!</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        Int_t ineb = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a90e3d50526d2bd8e6caf2e479e80b0de">mPHOSGeom</a>-&gt;<a class="code" href="../../d4/d6c/classo2_1_1phos_1_1Geometry.html#aa5272e2f0bce58f2a1ead0108832223a">areNeighbours</a>(digitSeedAbsId, digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>());</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">switch</span> (ineb) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keywordflow">case</span> -1: <span class="comment">// too early (e.g. previous module), do not look before j at subsequent passes</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            iFirst = j;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          <span class="keywordflow">case</span> 0: <span class="comment">// not a neighbour</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          <span class="keywordflow">case</span> 1: <span class="comment">// are neighbours</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            clu-&gt;<a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a9acc167899424997098bfe7e17c89301">addDigit</a>(digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>(), digitNEnergy, <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a6f2184225b0d79f18bb1e1c7be072991">calibrateT</a>(digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#aa8773b49e42ff866bea9a70ebcd66f0f">getTime</a>(), digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">getAbsId</a>(), digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a698ca9586038bccb90af761a4012ccfb">isHighGain</a>()), digitN-&gt;<a class="code" href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a739e9b0a1e5f2ee1c5d2ee1f0c30815b">getLabel</a>(), 1.);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            iDigitInCluster++;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            digitsUsed[j - <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">mFirstDigitInEvent</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;          <span class="keywordflow">case</span> 2: <span class="comment">// too far from each other</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          <span class="keywordflow">default</span>:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        } <span class="comment">// switch</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    } <span class="comment">// loop over cluster</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }   <span class="comment">// energy theshold</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a55344c27631c40c4948becb389c3634b">  266</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a55344c27631c40c4948becb389c3634b">Clusterer::makeUnfoldings</a>(gsl::span&lt;const Digit&gt; digits)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;{</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">//Split cluster if several local maxima are found</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  std::vector&lt;int&gt; maxAt(<a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mNLMMax); <span class="comment">// NLMMax:Maximal number of local maxima</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">int</span> numberOfNotUnfolded = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.size();</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; numberOfNotUnfolded; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <span class="comment">//can not use iterator here as list can expand</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html">FullCluster</a>&amp; clu = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (clu.<a class="code" href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a81e82c1876490f8db66d1178b39dd410">getNExMax</a>() &gt; -1) { <span class="comment">//already unfolded</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">char</span> nMultipl = clu.<a class="code" href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a47cea1a6525730aed2913b4f10a09670">getMultiplicity</a>();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordtype">char</span> nMax = clu.<a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a37510fdb5997bab190e3e09173251c87">getNumberOfLocalMax</a>(maxAt);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (nMax &gt; 1) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a172f36ca9d07d3bcca8cd620591b273e">unfoldOneCluster</a>(clu, nMax, maxAt, digits);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      clu.<a class="code" href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#aa109b534c10cc82bfe47bca49f2bc2c0">setEnergy</a>(0); <span class="comment">// will be skipped later</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      clu.<a class="code" href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a4d942afe12ed57dcd1919b906be56e88">setNExMax</a>(nMax); <span class="comment">// Only one local maximum</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a172f36ca9d07d3bcca8cd620591b273e">  290</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a172f36ca9d07d3bcca8cd620591b273e">Clusterer::unfoldOneCluster</a>(<a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html">FullCluster</a>&amp; iniClu, <span class="keywordtype">char</span> nMax, gsl::span&lt;int&gt; digitId, gsl::span&lt;const Digit&gt; digits)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Performs the unfolding of a cluster with nMax overlapping showers</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// Parameters: iniClu cluster to be unfolded</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">//             nMax number of local maxima found (this is the number of new clusters)</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">//             digitId: index of digits, corresponding to local maxima</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">//             maxAtEnergy: energies of digits, corresponding to local maxima</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">// Take initial cluster and calculate local coordinates of digits</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">// To avoid multiple re-calculation of same parameters</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">char</span> mult = iniClu.<a class="code" href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a47cea1a6525730aed2913b4f10a09670">getMultiplicity</a>();</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  std::vector&lt;std::vector&lt;float&gt;&gt; eInClusters(mult, std::vector&lt;float&gt;(nMax));</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  std::vector&lt;std::vector&lt;float&gt;&gt; fij(mult, std::vector&lt;float&gt;(nMax));</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keyword">const</span> std::vector&lt;FullCluster::CluElement&gt;* cluElist = iniClu.<a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a6f8b3d9aed0076e11bb1e0a1b53a6ec8">getElementList</a>();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">// Coordinates of centers of clusters</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  std::vector&lt;float&gt; xMax(nMax);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  std::vector&lt;float&gt; <a class="code" href="../../d5/d85/GPUTPCSliceData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>(nMax);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  std::vector&lt;float&gt; eMax(nMax);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  std::vector&lt;float&gt; deNew(nMax);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">//transient variables</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  std::vector&lt;float&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>(nMax);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  std::vector&lt;float&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>(nMax);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  std::vector&lt;float&gt; c(nMax);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    xMax[iclu] = (*cluElist)[digitId[iclu]].localX;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    zMax[iclu] = (*cluElist)[digitId[iclu]].localZ;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    eMax[iclu] = 2. * (*cluElist)[digitId[iclu]].energy;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  std::vector&lt;float&gt; prop(nMax); <span class="comment">// proportion of clusters in the current digit</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// Try to decompose cluster to contributions</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">int</span> nIterations = 0;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordtype">bool</span> insuficientAccuracy = <span class="keyword">true</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">while</span> (insuficientAccuracy &amp;&amp; nIterations &lt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mNMaxIterations) {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    insuficientAccuracy = <span class="keyword">false</span>; <span class="comment">// will be true if at least one parameter changed too much</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    a.clear();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    b.clear();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    c.clear();</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">//First calculate shower shapes</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idig = 0; idig &lt; mult; idig++) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keyword">auto</span> it = (*cluElist)[idig];</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        fij[idig][iclu] = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a5f2d1d378eb161acbea5d04ca5ed125c">showerShape</a>(it.localX - xMax[iclu], it.localZ - zMax[iclu]);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">//Fit energies</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idig = 0; idig &lt; mult; idig++) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keyword">auto</span> it = (*cluElist)[idig];</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        a[iclu] += fij[idig][iclu] * fij[idig][iclu];</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        b[iclu] += it.energy * fij[idig][iclu];</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> kclu = 0; kclu &lt; nMax; kclu++) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          <span class="keywordflow">if</span> (iclu == kclu)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          c[iclu] += eMax[kclu] * fij[idig][iclu] * fij[idig][kclu];</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">//Evaluate new maximal energies</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">if</span> (a[iclu] != 0.) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordtype">float</span> eNew = (b[iclu] - c[iclu]) / a[iclu];</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        insuficientAccuracy += (std::abs(eMax[iclu] - eNew) &gt; eNew * <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().<a class="code" href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#ab65bac5fd8a834e7d78bc4603735fc49">mUnfogingEAccuracy</a>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        eMax[iclu] = eNew;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    } <span class="comment">// otherwise keep old value</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// Loop over all digits of parent cluster and split their energies between daughter clusters</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// according to shower shape</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// then re-evaluate local position of clusters</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idig = 0; idig &lt; mult; idig++) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordtype">float</span> eEstimated = 0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        prop[iclu] = eMax[iclu] * fij[idig][iclu];</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        eEstimated += prop[iclu];</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">if</span> (eEstimated == 0.) { <span class="comment">// numerical accuracy</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">// Split energy of digit according to contributions</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        eInClusters[idig][iclu] = (*cluElist)[idig].energy * prop[iclu] / eEstimated;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// Recalculate parameters of clusters and check relative variation of energy and absolute of position</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keywordtype">float</span> oldX = xMax[iclu];</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordtype">float</span> oldZ = zMax[iclu];</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">// full energy, need for weight</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordtype">float</span> eTotNew = 0;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idig = 0; idig &lt; mult; idig++) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        eTotNew += eInClusters[idig][iclu];</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      xMax[iclu] = 0;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      zMax[iclu] = 0.;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordtype">float</span> wtot = 0.;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idig = 0; idig &lt; mult; idig++) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">if</span> (eInClusters[idig][iclu] &gt; 0) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          <span class="comment">// In unfolding it is better to use linear weight to reduce contribution of unfolded tails</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a> = eInClusters[idig][iclu] / eTotNew;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="comment">// float w = std::max(std::log(eInClusters[idig][iclu] / eTotNew) + o2::phos::PHOSSimParams::Instance().mLogWeight, float(0.));</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          xMax[iclu] += (*cluElist)[idig].localX * <a class="code" href="../../dc/da3/glcorearb_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          zMax[iclu] += (*cluElist)[idig].localZ * <a class="code" href="../../dc/da3/glcorearb_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;          wtot += <a class="code" href="../../dc/da3/glcorearb_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">if</span> (wtot &gt; 0.) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        wtot = 1. / wtot;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        xMax[iclu] *= wtot;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        zMax[iclu] *= wtot;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="comment">// Compare variation of parameters</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      insuficientAccuracy += (std::abs(xMax[iclu] - oldX) &gt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().<a class="code" href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a9b82330c68188cfc9491072e47658ccb">mUnfogingXZAccuracy</a>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      insuficientAccuracy += (std::abs(zMax[iclu] - oldZ) &gt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().<a class="code" href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a9b82330c68188cfc9491072e47658ccb">mUnfogingXZAccuracy</a>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    nIterations++;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">// Iterations finished, add new clusters</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iclu = 0; iclu &lt; nMax; iclu++) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.emplace_back();</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html">FullCluster</a>&amp; clu = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.back();</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    clu.<a class="code" href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a4d942afe12ed57dcd1919b906be56e88">setNExMax</a>(nMax);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordtype">int</span> idig = 0;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idig = 0; idig &lt; mult; idig++) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordtype">float</span> eDigit = eInClusters[idig][iclu];</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      idig++;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">if</span> (eDigit &lt; <a class="code" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::phos::PHOSSimParams::Instance</a>().mDigitMinEnergy) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      clu.<a class="code" href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a9acc167899424997098bfe7e17c89301">addDigit</a>((*cluElist)[idig].absId, eDigit, (*cluElist)[idig].time, (*cluElist)[idig].<a class="code" href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a>, eDigit / (*cluElist)[idig].<a class="code" href="../../dd/ddf/SecondaryVertex_8h.html#a7effbf82c50caa2e6b11dd6c61317195">energy</a>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0725f21d72df9f5315adc739b4597964">  432</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0725f21d72df9f5315adc739b4597964">Clusterer::evalCluProperties</a>(gsl::span&lt;const Digit&gt; digits, std::vector&lt;Cluster&gt;* <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a>,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>* dmc,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                                  <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>* cluMC)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;{</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span> (clusters-&gt;capacity() - clusters-&gt;size() &lt; <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.size()) { <span class="comment">//avoid expanding vector per element</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    clusters-&gt;reserve(clusters-&gt;size() + <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.size());</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordtype">int</span> labelIndex = 0;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">if</span> (cluMC) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    labelIndex = cluMC-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a9c5fbbeee8e2c01c916ef0bc2a7d0087">getIndexedSize</a>();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">auto</span> clu = <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.begin();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">while</span> (clu != <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">mClusters</a>.end()) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (clu-&gt;getEnergy() &lt; 1.e-4) { <span class="comment">//Marked earlier for removal</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      ++clu;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// may be soft digits remain after unfolding</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    clu-&gt;purify();</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">//  LOG(DEBUG) &lt;&lt; &quot;Purify done&quot;;</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    clu-&gt;evalAll();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> (clu-&gt;getEnergy() &gt; 1.e-4) { <span class="comment">//Non-empty cluster</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      clusters-&gt;emplace_back(*clu);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">if</span> (cluMC) { <span class="comment">//Handle labels</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">//Calculate list of primaries</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="comment">//loop over entries in digit MCTruthContainer</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keyword">const</span> std::vector&lt;FullCluster::CluElement&gt;* vl = clu-&gt;getElementList();</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keyword">auto</span> ll = vl-&gt;begin();</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">while</span> (ll != vl-&gt;end()) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = (*ll).label; <span class="comment">//index</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          <span class="keywordtype">float</span> sc = (*ll).scale;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          <span class="keywordflow">if</span> (i &lt; 0) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            ++ll;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;          }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;          gsl::span&lt;const MCLabel&gt; spDigList = dmc-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">getLabels</a>(i);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          gsl::span&lt;MCLabel&gt; spCluList = cluMC-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">getLabels</a>(labelIndex); <span class="comment">//get updated list</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;          <span class="keyword">auto</span> digL = spDigList.begin();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;          <span class="keywordflow">while</span> (digL != spDigList.end()) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordtype">bool</span> merged = <span class="keyword">false</span>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="keyword">auto</span> cluL = spCluList.begin();</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="keywordflow">while</span> (cluL != spCluList.end()) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;              <span class="keywordflow">if</span> (*digL == *cluL) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                (*cluL).add(*digL, sc);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                merged = <span class="keyword">true</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;              }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;              ++cluL;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            }</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="keywordflow">if</span> (!merged) { <span class="comment">//just add label</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;              <span class="keywordflow">if</span> (sc == 1.) {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                cluMC-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a48909c36a47bc704d7d58672cb0e27fb">addElement</a>(labelIndex, (*digL));</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;              } <span class="keywordflow">else</span> { <span class="comment">//rare case of unfolded clusters</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <a class="code" href="../../d9/d1e/classo2_1_1phos_1_1MCLabel.html">MCLabel</a> tmpL = (*digL);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                tmpL.<a class="code" href="../../d9/d1e/classo2_1_1phos_1_1MCLabel.html#addef3b995c34b207239a060e1c930dc0">scale</a>(sc);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                cluMC-&gt;<a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a48909c36a47bc704d7d58672cb0e27fb">addElement</a>(labelIndex, tmpL);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;              }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            ++digL;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          ++ll;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        clusters-&gt;back().setLabel(labelIndex);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        labelIndex++;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      } <span class="comment">// Work with MC</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    ++clu;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">//____________________________________________________________________________</span></div><div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a5f2d1d378eb161acbea5d04ca5ed125c">  511</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a5f2d1d378eb161acbea5d04ca5ed125c">Clusterer::showerShape</a>(<span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// Shape of the shower (see PHOS TDR)</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="comment">// we neglect dependence on the incident angle.</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a6879d830f164725df67adeeabca3ea47">width</a> = 1. / (2. * 2.32 * 2.32 * 2.32 * 2.32 * 2.32 * 2.32);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordtype">float</span> r2 = x * x + z * <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739a1c1a8879ff29bcbab7e1c6e23d9d4c11">TMath::Exp</a>(-r2 * r2 * r2 * width);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">/*  float r2 = x * x + z * z;</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">  float r4 = r2 * r2;</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">  float r295 = TMath::Power(r2, 2.95 / 2.);</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">  float shape = TMath::Exp(-r4 * (1. / (2.32 + 0.26 * r4) + 0.0316 / (1 + 0.0652 * r295)));</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">  return shape;</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">*/</span>}</div><div class="ttc" id="PHOS_2reconstruction_2include_2PHOSReconstruction_2FullCluster_8h_html"><div class="ttname"><a href="../../d3/d32/PHOS_2reconstruction_2include_2PHOSReconstruction_2FullCluster_8h.html">FullCluster.h</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html_afe8bc587090f857ee2d825751fa4af8f"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#afe8bc587090f857ee2d825751fa4af8f">o2::dataformats::MCTruthContainer::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d14/MCTruthContainer_8h_source.html#l00162">MCTruthContainer.h:162</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_ace9c856d2fb37cc0d87d37a5c858d57d"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ace9c856d2fb37cc0d87d37a5c858d57d">o2::phos::Clusterer::convertCellsToDigits</a></div><div class="ttdeci">void convertCellsToDigits(gsl::span&lt; const Cell &gt; cells, int firstCellInEvent, int lastCellInEvent, gsl::span&lt; const unsigned int &gt; mcmap)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00156">Clusterer.cxx:156</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_ab42a1e5b4f260522f5498086d1f8eea2"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab42a1e5b4f260522f5498086d1f8eea2">o2::phos::Clusterer::initialize</a></div><div class="ttdeci">void initialize()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00030">Clusterer.cxx:30</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html">o2::phos::Clusterer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00031">Clusterer.h:31</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cluster_html_a4d942afe12ed57dcd1919b906be56e88"><div class="ttname"><a href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a4d942afe12ed57dcd1919b906be56e88">o2::phos::Cluster::setNExMax</a></div><div class="ttdeci">void setNExMax(char nmax=1)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d50/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h_source.html#l00060">Cluster.h:60</a></div></div>
<div class="ttc" id="structo2_1_1phos_1_1PHOSSimParams_html_a78e61019dd71792e6f58f5854fd3ea09"><div class="ttname"><a href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a78e61019dd71792e6f58f5854fd3ea09">o2::phos::PHOSSimParams::mDigitMinEnergy</a></div><div class="ttdeci">float mDigitMinEnergy</div><div class="ttdoc">Minimal energy of digits to be used in cluster (GeV) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d62/PHOSSimParams_8h_source.html#l00055">PHOSSimParams.h:55</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cell_html_a9aac1ef0436d1dc9303d802c2fb6f608"><div class="ttname"><a href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#a9aac1ef0436d1dc9303d802c2fb6f608">o2::phos::Cell::getAbsId</a></div><div class="ttdeci">short getAbsId() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/de8/PHOS_2src_2Cell_8cxx_source.html#l00057">Cell.cxx:57</a></div></div>
<div class="ttc" id="classo2_1_1ccdb_1_1CcdbApi_html"><div class="ttname"><a href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html">o2::ccdb::CcdbApi</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/CcdbApi_8h_source.html#l00044">CcdbApi.h:44</a></div></div>
<div class="ttc" id="glcorearb_8h_html_aee38b51639b577753f6a92029fb92000"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a></div><div class="ttdeci">GLdouble GLdouble GLdouble z</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00843">glcorearb.h:843</a></div></div>
<div class="ttc" id="namespaceo2_1_1framework_html_ac2569e9658701f4fc5b687da9dacb739a1c1a8879ff29bcbab7e1c6e23d9d4c11"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739a1c1a8879ff29bcbab7e1c6e23d9d4c11">o2::framework::Exp</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc2/BasicOps_8h_source.html#l00028">BasicOps.h:28</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a55344c27631c40c4948becb389c3634b"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a55344c27631c40c4948becb389c3634b">o2::phos::Clusterer::makeUnfoldings</a></div><div class="ttdeci">void makeUnfoldings(gsl::span&lt; const Digit &gt; digits)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00266">Clusterer.cxx:266</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00028">GPUCommonLogger.h:28</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a90e3d50526d2bd8e6caf2e479e80b0de"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a90e3d50526d2bd8e6caf2e479e80b0de">o2::phos::Clusterer::mPHOSGeom</a></div><div class="ttdeci">Geometry * mPHOSGeom</div><div class="ttdoc">PHOS geometry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00076">Clusterer.h:76</a></div></div>
<div class="ttc" id="CcdbApi_8h_html"><div class="ttname"><a href="../../dd/d3e/CcdbApi_8h.html">CcdbApi.h</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cell_html_aaf1d4994ee2dcc49b4895a75201557ca"><div class="ttname"><a href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#aaf1d4994ee2dcc49b4895a75201557ca">o2::phos::Cell::getEnergy</a></div><div class="ttdeci">float getEnergy() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/de8/PHOS_2src_2Cell_8cxx_source.html#l00117">Cell.cxx:117</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac8729153468b5dcf13f971b21d84d4e5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a></div><div class="ttdeci">GLboolean GLboolean GLboolean GLboolean a</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Digit_html_a49bdaf6956f61a394031795b8d13d08e"><div class="ttname"><a href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a49bdaf6956f61a394031795b8d13d08e">o2::phos::Digit::getAmplitude</a></div><div class="ttdeci">float getAmplitude() const</div><div class="ttdoc">Energy deposited in a cell. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_source.html#l00098">Digit.h:98</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cell_html"><div class="ttname"><a href="../../dd/d9e/classo2_1_1phos_1_1Cell.html">o2::phos::Cell</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dba/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cell_8h_source.html#l00039">Cell.h:39</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1BadChannelMap_html"><div class="ttname"><a href="../../dd/db4/classo2_1_1phos_1_1BadChannelMap.html">o2::phos::BadChannelMap</a></div><div class="ttdoc">CCDB container for bad (masked) channels in PHOS. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d65/PHOS_2calib_2include_2PHOSCalib_2BadChannelMap_8h_source.html#l00055">BadChannelMap.h:55</a></div></div>
<div class="ttc" id="structo2_1_1phos_1_1PHOSSimParams_html_a9b82330c68188cfc9491072e47658ccb"><div class="ttname"><a href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a9b82330c68188cfc9491072e47658ccb">o2::phos::PHOSSimParams::mUnfogingXZAccuracy</a></div><div class="ttdeci">float mUnfogingXZAccuracy</div><div class="ttdoc">Accuracy of position calculation in unfolding procedure (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d62/PHOSSimParams_8h_source.html#l00060">PHOSSimParams.h:60</a></div></div>
<div class="ttc" id="PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_html"><div class="ttname"><a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h.html">Clusterer.h</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cell_html_a9b41c86e64242a9c933fea497ff8cebc"><div class="ttname"><a href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#a9b41c86e64242a9c933fea497ff8cebc">o2::phos::Cell::getHighGain</a></div><div class="ttdeci">bool getHighGain() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/de8/PHOS_2src_2Cell_8cxx_source.html#l00167">Cell.cxx:167</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html_a9c5fbbeee8e2c01c916ef0bc2a7d0087"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a9c5fbbeee8e2c01c916ef0bc2a7d0087">o2::dataformats::MCTruthContainer::getIndexedSize</a></div><div class="ttdeci">size_t getIndexedSize() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d14/MCTruthContainer_8h_source.html#l00138">MCTruthContainer.h:138</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a93711cbabfe6841771b90ec5aa33998c"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a93711cbabfe6841771b90ec5aa33998c">o2::phos::Clusterer::processCells</a></div><div class="ttdeci">void processCells(gsl::span&lt; const Cell &gt; digits, gsl::span&lt; const TriggerRecord &gt; dtr, const o2::dataformats::MCTruthContainer&lt; MCLabel &gt; *dmc, gsl::span&lt; const unsigned int &gt; mcmap, std::vector&lt; Cluster &gt; *clusters, std::vector&lt; TriggerRecord &gt; *rigRec, o2::dataformats::MCTruthContainer&lt; MCLabel &gt; *cluMC)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00096">Clusterer.cxx:96</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1FullCluster_html_a9acc167899424997098bfe7e17c89301"><div class="ttname"><a href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a9acc167899424997098bfe7e17c89301">o2::phos::FullCluster::addDigit</a></div><div class="ttdeci">void addDigit(short digitAbsId, float energy, float time, int label, float scale)</div><div class="ttdoc">Method to add digit to a cluster. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d64/PHOS_2reconstruction_2src_2FullCluster_8cxx_source.html#l00028">FullCluster.cxx:28</a></div></div>
<div class="ttc" id="structo2_1_1phos_1_1PHOSSimParams_html_a9783f6ddc64c30e6e3c0a9ad55e9d691"><div class="ttname"><a href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#a9783f6ddc64c30e6e3c0a9ad55e9d691">o2::phos::PHOSSimParams::mClusteringThreshold</a></div><div class="ttdeci">float mClusteringThreshold</div><div class="ttdoc">Minimal energy of digit to start clustering (GeV) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d62/PHOSSimParams_8h_source.html#l00056">PHOSSimParams.h:56</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1FullCluster_html_a37510fdb5997bab190e3e09173251c87"><div class="ttname"><a href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a37510fdb5997bab190e3e09173251c87">o2::phos::FullCluster::getNumberOfLocalMax</a></div><div class="ttdeci">char getNumberOfLocalMax(gsl::span&lt; int &gt; maxAt) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d64/PHOS_2reconstruction_2src_2FullCluster_8cxx_source.html#l00277">FullCluster.cxx:277</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Digit_html_a698ca9586038bccb90af761a4012ccfb"><div class="ttname"><a href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a698ca9586038bccb90af761a4012ccfb">o2::phos::Digit::isHighGain</a></div><div class="ttdeci">bool isHighGain() const</div><div class="ttdoc">Checks if this digit is produced in High Gain or Low Gain channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_source.html#l00106">Digit.h:106</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_aa528bb6e7d804a875687aff894567db2"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#aa528bb6e7d804a875687aff894567db2">o2::phos::Clusterer::calibrate</a></div><div class="ttdeci">float calibrate(float amp, short absId)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00061">Clusterer.h:61</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a82a80a35e3132b535bd280f5932c92b7"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a82a80a35e3132b535bd280f5932c92b7">o2::phos::Clusterer::makeClusters</a></div><div class="ttdeci">void makeClusters(gsl::span&lt; const Digit &gt; digits)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00188">Clusterer.cxx:188</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Geometry_html_a5beceefc4ad5b551a86e46e3efe6d243"><div class="ttname"><a href="../../d4/d6c/classo2_1_1phos_1_1Geometry.html#a5beceefc4ad5b551a86e46e3efe6d243">o2::phos::Geometry::GetInstance</a></div><div class="ttdeci">static Geometry * GetInstance()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7f/PHOS_2base_2include_2PHOSBase_2Geometry_8h_source.html#l00057">Geometry.h:57</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1FullCluster_html"><div class="ttname"><a href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html">o2::phos::FullCluster</a></div><div class="ttdoc">PHOS cluster implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d32/PHOS_2reconstruction_2include_2PHOSReconstruction_2FullCluster_8h_source.html#l00027">FullCluster.h:27</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a0725f21d72df9f5315adc739b4597964"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0725f21d72df9f5315adc739b4597964">o2::phos::Clusterer::evalCluProperties</a></div><div class="ttdeci">void evalCluProperties(gsl::span&lt; const Digit &gt; digits, std::vector&lt; Cluster &gt; *clusters, const o2::dataformats::MCTruthContainer&lt; MCLabel &gt; *dmc, o2::dataformats::MCTruthContainer&lt; MCLabel &gt; *cluMC)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00432">Clusterer.cxx:432</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1MCLabel_html_addef3b995c34b207239a060e1c930dc0"><div class="ttname"><a href="../../d9/d1e/classo2_1_1phos_1_1MCLabel.html#addef3b995c34b207239a060e1c930dc0">o2::phos::MCLabel::scale</a></div><div class="ttdeci">void scale(float s)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d0d/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2MCLabel_8h_source.html#l00042">MCLabel.h:42</a></div></div>
<div class="ttc" id="CPV_2reconstruction_2src_2Clusterer_8cxx_html_a09ffd78f500e40dde5621939c693e157"><div class="ttname"><a href="../../d2/dd9/CPV_2reconstruction_2src_2Clusterer_8cxx.html#a09ffd78f500e40dde5621939c693e157">ClassImp</a></div><div class="ttdeci">ClassImp(Clusterer)</div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_ae0c6a1876bc57107795467c1596d7b13"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ae0c6a1876bc57107795467c1596d7b13">o2::phos::Clusterer::mClusters</a></div><div class="ttdeci">std::vector&lt; FullCluster &gt; mClusters</div><div class="ttdoc">Calibration coefficients. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00080">Clusterer.h:80</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Digit_html_a739e9b0a1e5f2ee1c5d2ee1f0c30815b"><div class="ttname"><a href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a739e9b0a1e5f2ee1c5d2ee1f0c30815b">o2::phos::Digit::getLabel</a></div><div class="ttdeci">int getLabel() const</div><div class="ttdoc">index of entry in MCLabels array </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_source.html#l00111">Digit.h:111</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1CalibParams_html"><div class="ttname"><a href="../../d9/d6b/classo2_1_1phos_1_1CalibParams.html">o2::phos::CalibParams</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d37/PHOS_2calib_2include_2PHOSCalib_2CalibParams_8h_source.html#l00032">CalibParams.h:32</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a00dc28d5db1371df938f63ad9eb450df"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a00dc28d5db1371df938f63ad9eb450df">clusters</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value [n] sets TFlen for [n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char Store histograms in output root Do not run but just create PDFs from input root files Set cut for Q Compute the efficiency including impure tracks with fake contamination Maxmimum Create resolution histograms in the native fit Filter for Filter for Particle Store mc labels to file for later matching Minimum Pt of a matched track to be displayed Compare QA QAonly Event generator settings h Reconstruction settings Enable TRD processing Enable TPC Compression Mask to disable certain attachment steps during Enable rejection of TPC clusters for Pt threshold to reject clusters of TPC tracks Sort order of TPC Force early TPC transformation also for continuous Forward TPC digits as clusters(if they pass the ZS threshold)&quot;) AddOption(dropLoopers</div></div>
<div class="ttc" id="glcorearb_8h_html_a9371a1f53f8067997cd15aaf657c62d0"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a></div><div class="ttdeci">GLuint GLsizei const GLchar * label</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l02519">glcorearb.h:2519</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a4322f7aba5ad3c6cb0dc28fba2f7c657"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a4322f7aba5ad3c6cb0dc28fba2f7c657">o2::phos::Clusterer::mDigits</a></div><div class="ttdeci">std::vector&lt; Digit &gt; mDigits</div><div class="ttdoc">vector of trancient digits for cell processing </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00083">Clusterer.h:83</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1FullCluster_html_af51e989bd73449578f438c2ee9785fde"><div class="ttname"><a href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#af51e989bd73449578f438c2ee9785fde">o2::phos::FullCluster::getDigitAbsId</a></div><div class="ttdeci">short getDigitAbsId(Int_t i) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d32/PHOS_2reconstruction_2include_2PHOSReconstruction_2FullCluster_8h_source.html#l00056">FullCluster.h:56</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_ac96d5581237220624b0bf18f05b51aec"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ac96d5581237220624b0bf18f05b51aec">o2::phos::Clusterer::mCalibParams</a></div><div class="ttdeci">const CalibParams * mCalibParams</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00077">Clusterer.h:77</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cell_html_a9f95e42d44ff27598ad7261b3f09a9ac"><div class="ttname"><a href="../../dd/d9e/classo2_1_1phos_1_1Cell.html#a9f95e42d44ff27598ad7261b3f09a9ac">o2::phos::Cell::getTime</a></div><div class="ttdeci">float getTime() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/de8/PHOS_2src_2Cell_8cxx_source.html#l00096">Cell.cxx:96</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a5f2d1d378eb161acbea5d04ca5ed125c"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a5f2d1d378eb161acbea5d04ca5ed125c">o2::phos::Clusterer::showerShape</a></div><div class="ttdeci">float showerShape(float dx, float dz)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00511">Clusterer.cxx:511</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a6eba317e3cf44d6d26c04a5a8f197dcb"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a></div><div class="ttdeci">GLboolean GLboolean GLboolean b</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a9ac4309fe731e800485180c8f99ee606"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a9ac4309fe731e800485180c8f99ee606">o2::phos::Clusterer::mFirstDigitInEvent</a></div><div class="ttdeci">int mFirstDigitInEvent</div><div class="ttdoc">Range of digits from one event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00081">Clusterer.h:81</a></div></div>
<div class="ttc" id="namespaceo2_1_1phos_html"><div class="ttname"><a href="../../dd/d57/namespaceo2_1_1phos.html">o2::phos</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbc/SimTraits_8h_source.html#l00120">SimTraits.h:120</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1FullCluster_html_a6f8b3d9aed0076e11bb1e0a1b53a6ec8"><div class="ttname"><a href="../../dd/db5/classo2_1_1phos_1_1FullCluster.html#a6f8b3d9aed0076e11bb1e0a1b53a6ec8">o2::phos::FullCluster::getElementList</a></div><div class="ttdeci">const std::vector&lt; CluElement &gt; * getElementList() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d32/PHOS_2reconstruction_2include_2PHOSReconstruction_2FullCluster_8h_source.html#l00058">FullCluster.h:58</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cluster_html_a47cea1a6525730aed2913b4f10a09670"><div class="ttname"><a href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a47cea1a6525730aed2913b4f10a09670">o2::phos::Cluster::getMultiplicity</a></div><div class="ttdeci">int getMultiplicity() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d50/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h_source.html#l00057">Cluster.h:57</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cluster_html_a81e82c1876490f8db66d1178b39dd410"><div class="ttname"><a href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#a81e82c1876490f8db66d1178b39dd410">o2::phos::Cluster::getNExMax</a></div><div class="ttdeci">char getNExMax() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d50/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h_source.html#l00061">Cluster.h:61</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer</a></div><div class="ttdoc">A container to hold and manage MC truth information/labels. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/ClusterNative_8h_source.html#l00029">ClusterNative.h:29</a></div></div>
<div class="ttc" id="DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_html"><div class="ttname"><a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h.html">Digit.h</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a6f2184225b0d79f18bb1e1c7be072991"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a6f2184225b0d79f18bb1e1c7be072991">o2::phos::Clusterer::calibrateT</a></div><div class="ttdeci">float calibrateT(float time, short absId, bool isHighGain)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00063">Clusterer.h:63</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Geometry_html_aa5272e2f0bce58f2a1ead0108832223a"><div class="ttname"><a href="../../d4/d6c/classo2_1_1phos_1_1Geometry.html#aa5272e2f0bce58f2a1ead0108832223a">o2::phos::Geometry::areNeighbours</a></div><div class="ttdeci">static int areNeighbours(short absId1, short absId2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dab/PHOS_2base_2src_2Geometry_8cxx_source.html#l00078">Geometry.cxx:78</a></div></div>
<div class="ttc" id="classo2_1_1ccdb_1_1CcdbApi_html_a0121aadd2206dae1f108db333bd257d2"><div class="ttname"><a href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0121aadd2206dae1f108db333bd257d2">o2::ccdb::CcdbApi::init</a></div><div class="ttdeci">void init(std::string const &amp;host)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5f/CcdbApi_8cxx_source.html#l00059">CcdbApi.cxx:59</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html_a48909c36a47bc704d7d58672cb0e27fb"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a48909c36a47bc704d7d58672cb0e27fb">o2::dataformats::MCTruthContainer::addElement</a></div><div class="ttdeci">void addElement(uint32_t dataindex, TruthElement const &amp;element)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d14/MCTruthContainer_8h_source.html#l00170">MCTruthContainer.h:170</a></div></div>
<div class="ttc" id="PHOSSimParams_8h_html"><div class="ttname"><a href="../../df/d62/PHOSSimParams_8h.html">PHOSSimParams.h</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Digit_html"><div class="ttname"><a href="../../df/dbc/classo2_1_1phos_1_1Digit.html">o2::phos::Digit</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_source.html#l00027">Digit.h:27</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Cluster_html_aa109b534c10cc82bfe47bca49f2bc2c0"><div class="ttname"><a href="../../dd/d6c/classo2_1_1phos_1_1Cluster.html#aa109b534c10cc82bfe47bca49f2bc2c0">o2::phos::Cluster::setEnergy</a></div><div class="ttdeci">void setEnergy(float e)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d50/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h_source.html#l00042">Cluster.h:42</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a57f14e05b1900f16a2da82ade47d0c6d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a></div><div class="ttdeci">GLuint index</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="classo2_1_1ccdb_1_1CcdbApi_html_ae843c7520a304d6297986d7692932bd9"><div class="ttname"><a href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#ae843c7520a304d6297986d7692932bd9">o2::ccdb::CcdbApi::retrieveFromTFileAny</a></div><div class="ttdeci">T * retrieveFromTFileAny(std::string const &amp;path, std::map&lt; std::string, std::string &gt; const &amp;metadata, long timestamp=-1, std::map&lt; std::string, std::string &gt; *headers=nullptr, std::string const &amp;etag=&quot;&quot;) const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/CcdbApi_8h_source.html#l00387">CcdbApi.h:387</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00403">glcorearb.h:403</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a172f36ca9d07d3bcca8cd620591b273e"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a172f36ca9d07d3bcca8cd620591b273e">o2::phos::Clusterer::unfoldOneCluster</a></div><div class="ttdeci">void unfoldOneCluster(FullCluster &amp;iniClu, char nMax, gsl::span&lt; int &gt; digitId, gsl::span&lt; const Digit &gt; digits)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00290">Clusterer.cxx:290</a></div></div>
<div class="ttc" id="structo2_1_1phos_1_1PHOSSimParams_html_ab65bac5fd8a834e7d78bc4603735fc49"><div class="ttname"><a href="../../d1/d8d/structo2_1_1phos_1_1PHOSSimParams.html#ab65bac5fd8a834e7d78bc4603735fc49">o2::phos::PHOSSimParams::mUnfogingEAccuracy</a></div><div class="ttdeci">float mUnfogingEAccuracy</div><div class="ttdoc">Accuracy of energy calculation in unfoding prosedure (GeV) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d62/PHOSSimParams_8h_source.html#l00059">PHOSSimParams.h:59</a></div></div>
<div class="ttc" id="SecondaryVertex_8h_html_a7effbf82c50caa2e6b11dd6c61317195"><div class="ttname"><a href="../../dd/ddf/SecondaryVertex_8h.html#a7effbf82c50caa2e6b11dd6c61317195">energy</a></div><div class="ttdeci">float energy(float px, float py, float pz, float mass)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddf/SecondaryVertex_8h_source.html#l00079">SecondaryVertex.h:79</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a237f408d12e668ba944a4de0866f377e"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a237f408d12e668ba944a4de0866f377e">o2::phos::Clusterer::mBadMap</a></div><div class="ttdeci">const BadChannelMap * mBadMap</div><div class="ttdoc">Calibration coefficients. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00078">Clusterer.h:78</a></div></div>
<div class="ttc" id="glcorearb_8h_html_adb12a0d439f32ca388b2c806150cc54d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a></div><div class="ttdeci">GLubyte GLubyte GLubyte GLubyte w</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00852">glcorearb.h:852</a></div></div>
<div class="ttc" id="PHOS_2base_2include_2PHOSBase_2Geometry_8h_html"><div class="ttname"><a href="../../d7/d7f/PHOS_2base_2include_2PHOSBase_2Geometry_8h.html">Geometry.h</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Digit_html_aa8773b49e42ff866bea9a70ebcd66f0f"><div class="ttname"><a href="../../df/dbc/classo2_1_1phos_1_1Digit.html#aa8773b49e42ff866bea9a70ebcd66f0f">o2::phos::Digit::getTime</a></div><div class="ttdeci">float getTime() const</div><div class="ttdoc">time measured in digit w.r.t. photon to PHOS arrival </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_source.html#l00102">Digit.h:102</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a0f9881b4fa8d297457b3665106f53842"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a0f9881b4fa8d297457b3665106f53842">o2::phos::Clusterer::isBadChannel</a></div><div class="ttdeci">bool isBadChannel(short absId)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00073">Clusterer.h:73</a></div></div>
<div class="ttc" id="GPUTPCSliceData_8cxx_html_a30f18d18adf7b4869abe5f41bd87f8f3"><div class="ttname"><a href="../../d5/d85/GPUTPCSliceData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a></div><div class="ttdeci">float float float &amp; zMax</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/GPUTPCSliceData_8cxx_source.html#l00141">GPUTPCSliceData.cxx:141</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_ab8efbc1a9cb80f35b09416d11a568a0d"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#ab8efbc1a9cb80f35b09416d11a568a0d">o2::phos::Clusterer::mLastDigitInEvent</a></div><div class="ttdeci">int mLastDigitInEvent</div><div class="ttdoc">Range of digits from one event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d34/PHOS_2reconstruction_2include_2PHOSReconstruction_2Clusterer_8h_source.html#l00082">Clusterer.h:82</a></div></div>
<div class="ttc" id="classo2_1_1conf_1_1ConfigurableParamHelper_html_acd640717f419212c67fecff71d876d39"><div class="ttname"><a href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#acd640717f419212c67fecff71d876d39">o2::conf::ConfigurableParamHelper&lt; PHOSSimParams &gt;::Instance</a></div><div class="ttdeci">static const PHOSSimParams &amp; Instance()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d6b/ConfigurableParamHelper_8h_source.html#l00073">ConfigurableParamHelper.h:73</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a6879d830f164725df67adeeabca3ea47"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6879d830f164725df67adeeabca3ea47">width</a></div><div class="ttdeci">GLint GLsizei width</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00270">glcorearb.h:270</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1MCLabel_html"><div class="ttname"><a href="../../d9/d1e/classo2_1_1phos_1_1MCLabel.html">o2::phos::MCLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d0d/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2MCLabel_8h_source.html#l00022">MCLabel.h:22</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html_a47e20a65d29e6613e3deeedad9d7990f"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html#a47e20a65d29e6613e3deeedad9d7990f">o2::dataformats::MCTruthContainer::getLabels</a></div><div class="ttdeci">gsl::span&lt; TruthElement &gt; getLabels(uint32_t dataindex)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d14/MCTruthContainer_8h_source.html#l00144">MCTruthContainer.h:144</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Clusterer_html_a767750330781fc5d9eea2b8bec39d0f5"><div class="ttname"><a href="../../dd/dce/classo2_1_1phos_1_1Clusterer.html#a767750330781fc5d9eea2b8bec39d0f5">o2::phos::Clusterer::process</a></div><div class="ttdeci">void process(gsl::span&lt; const Digit &gt; digits, gsl::span&lt; const TriggerRecord &gt; dtr, const o2::dataformats::MCTruthContainer&lt; MCLabel &gt; *dmc, std::vector&lt; Cluster &gt; *clusters, std::vector&lt; TriggerRecord &gt; *rigRec, o2::dataformats::MCTruthContainer&lt; MCLabel &gt; *cluMC)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx_source.html#l00039">Clusterer.cxx:39</a></div></div>
<div class="ttc" id="DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h_html"><div class="ttname"><a href="../../d8/d50/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Cluster_8h.html">Cluster.h</a></div></div>
<div class="ttc" id="classo2_1_1phos_1_1Digit_html_a38cdf835c869b8faff7f651de9a1bf01"><div class="ttname"><a href="../../df/dbc/classo2_1_1phos_1_1Digit.html#a38cdf835c869b8faff7f651de9a1bf01">o2::phos::Digit::getAbsId</a></div><div class="ttdeci">short getAbsId() const</div><div class="ttdoc">Absolute sell id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d98/DataFormats_2Detectors_2PHOS_2include_2DataFormatsPHOS_2Digit_8h_source.html#l00094">Digit.h:94</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_cd3c152a7db0580c86a4c50ad0325149.html">PHOS</a></li><li class="navelem"><a class="el" href="../../dir_da16e9ad2b18bb132f2d9a9746692e88.html">reconstruction</a></li><li class="navelem"><a class="el" href="../../dir_44824022925402f34c59ab8ad8fd997a.html">src</a></li><li class="navelem"><a class="el" href="../../d2/d52/PHOS_2reconstruction_2src_2Clusterer_8cxx.html">Clusterer.cxx</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:22 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
