<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Performace testing</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/d3a/refFITbenchmark.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Performace testing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Documentation for Performance testing</h1>
<p>This document will summarize the tools that can be used to get information about the memory and CPU time evolution of simulations in ALICE O2.</p>
<p>In this folder you will find two scripts:</p><ol type="1">
<li><code>monitor.sh</code></li>
<li><code>process.py</code></li>
</ol>
<p>Both of these scripts define the two step procedure (<b>monitoring</b> and <b>processing</b>) of obtainging performance metrics of interest: <em>maximum memory, average memory, maximum CPU time, wall clock time, (CPU)/(wall clock) time ratio</em> and lastly <em>plots of the evolving memory and cpu as a function of wall clock time.</em></p>
<h2>1) Monitoring</h2>
<p>You can monitor whatever you like as:</p>
<p><code>$&gt; ./monitor.sh &lt;your <a class="el" href="../../d4/d7c/namespaceo2.html" title="information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc) ...">o2</a> command&gt;</code></p>
<p>To obtain plots of (FairMQ) devices operating in the simulation you will have to generate a <b>logfile</b> as:</p>
<p><code>$&gt; ./monitor.sh &lt;your <a class="el" href="../../d4/d7c/namespaceo2.html" title="information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc) ...">o2</a> command&gt; | tee o2xxx.log</code></p>
<p>e.g. if you wish to monitor 50 pp (pythia) events with Geant3 as the VMC backend using the FIT detector and utilizing parallel mode with 2 simulation workers AND keep track of FairMQ devices, you can do:</p>
<p><code>$&gt; ./monitor.sh o2-sim -g pythia8 -e TGeant3 -m FV0 FT0 FDD -j 2 -n 50 |Â tee o2sim.log</code> </p><hr/>
<p>Similarly you can monitor the digitization routine as:</p>
<p><code>$&gt; ./monitor.sh o2-sim-digitizer-workflow -b --run | tee o2digi.log</code></p>
<p>NB! notice the <code>--run</code> that is needed (only digitization) in order to overload the PIPE <code>|</code> command in DPL (Data Processing Layer).</p>
<p>The <code>./monitor.sh</code> script will generate 4 .txt files in total: <em>mem_evolution_xxxx.txt, cpu_evolution_xxxx.txt, time_evolution_xxxx.txt, pid_evolution_xxxx.txt</em>. Here <em>xxxx</em> is the PID (process identifcation) number of the main process responsible for the command (driver application). You will have to parse two of these files (mem and cpu) in the next step.</p>
<h2>2) Processing</h2>
<p>The monitored data has to be processed as: <code>$&gt; python3 process.py mem_evolution_xxxx.txt cpu_evolution_xxxx.txt</code></p>
<p>This will generate an output:</p>
<div class="fragment"><div class="line">You have monitored o2 simulation in parallel.</div><div class="line"></div><div class="line">********************************</div><div class="line">max mem: 723.30 MB</div><div class="line">mean mem: 544.63 MB</div><div class="line">max cpu: 120.69s</div><div class="line">Total wall clock time: 82.54 s</div><div class="line">Ratio (cpu time) / (wall clock time) :  1.46</div><div class="line">********************************</div></div><!-- fragment --><p> and generate two plots each:</p>
<div class="image">
<img src="https://github.com/AliceO2Group/AliceO2/tree/dev/Detectors/FIT/benchmark/images/Figure_1.png" alt="alt text"/>
</div>
 <div class="image">
<img src="https://github.com/AliceO2Group/AliceO2/tree/dev/Detectors/FIT/benchmark/images/Figure_2.png" alt="alt text"/>
</div>
<p>if no logfiles where provided the plots would look like:</p>
<div class="image">
<img src="https://github.com/AliceO2Group/AliceO2/tree/dev/Detectors/FIT/benchmark/images/Figure_1_nolog.png" alt="alt text"/>
</div>
 <div class="image">
<img src="https://github.com/AliceO2Group/AliceO2/tree/dev/Detectors/FIT/benchmark/images/Figure_2_nolog.png" alt="alt text"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../da/d84/refDetectorsFIT.html">FIT</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:40 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
