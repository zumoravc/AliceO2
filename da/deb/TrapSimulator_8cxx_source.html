<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/TRD/simulation/src/TrapSimulator.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/deb/TrapSimulator_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TrapSimulator.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/deb/TrapSimulator_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//                                                                           //</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//  TRD MCM (Multi Chip Module) simulator                                    //</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//  which simulates the TRAP processing after the AD-conversion.             //</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//  The relevant parameters (i.e. configuration settings of the TRAP)        //</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//  are taken from TrapConfig.                                         //</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//                                                                           //</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//#include &quot;TTreeStream.h&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/df4/TRDSimParam_8h.html">TRDBase/TRDSimParam.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d32/TRDCommonParam_8h.html">TRDBase/TRDCommonParam.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d07/TRDGeometry_8h.html">TRDBase/TRDGeometry.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d36/FeeParam_8h.html">TRDBase/FeeParam.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/dac/TRD_2base_2include_2TRDBase_2Tracklet_8h.html">TRDBase/Tracklet.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da9/CalOnlineGainTables_8h.html">TRDBase/CalOnlineGainTables.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d00/TrapConfigHandler_8h.html">TRDSimulation/TrapConfigHandler.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/dbb/TrapConfig_8h.html">TRDSimulation/TrapConfig.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d42/TrapSimulator_8h.html">TRDSimulation/TrapSimulator.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;fairlogger/Logger.h&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//to pull in the digitzer incomnig data.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/da5/Detectors_2TRD_2base_2include_2TRDBase_2Digit_8h.html">TRDBase/Digit.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/dae/TRD_2simulation_2include_2TRDSimulation_2Digitizer_8h.html">TRDSimulation/Digitizer.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d7/dcd/MCCompLabel_8h.html">SimulationDataFormat/MCCompLabel.h</a>&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../db/d14/MCTruthContainer_8h.html">SimulationDataFormat/MCTruthContainer.h</a>&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;TH1F.h&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;TH2F.h&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;TGraph.h&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;TLine.h&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;TRandom.h&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;TMath.h&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &lt;TTree.h&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;TFile.h&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &lt;ostream&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d2/d76/namespaceo2_1_1trd.html">o2::trd</a>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../da/deb/TrapSimulator_8cxx.html#a4422d887a69e169efcdfe31bc90c70bb">   56</a></span>&#160;<span class="preprocessor">#define DEBUGTRAP 1</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keywordtype">bool</span> TrapSimulator::mgApplyCut = <span class="keyword">true</span>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">int</span> TrapSimulator::mgAddBaseline = 0;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keywordtype">bool</span> TrapSimulator::mgStoreClusters = <span class="keyword">true</span>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">TrapSimulator::mgkFormatIndex</a> = std::ios_base::xalloc();</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">const</span> std::array&lt;unsigned short, 4&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a920f63bd22ec25a962a0119501126dd5">TrapSimulator::mgkFPshifts</a>{11, 14, 17, 21};</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4a9489306cb5a03e7d87378a80efdf2d">   64</a></span>&#160;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4a9489306cb5a03e7d87378a80efdf2d">TrapSimulator::TrapSimulator</a>()</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  : mInitialized(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a9fb99aa34f76f957d3f57fed6946e901">false</a>), mDetector(-1), mRobPos(-1), mMcmPos(-1), mRow(-1), mNTimeBin(-1), mTrklBranchName(<span class="stringliteral">&quot;mcmtrklbranch&quot;</span>), mFeeParam(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>), mTrapConfig(<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a>)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// TrapSimulator default constructor</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// By default, nothing is initialized.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// It is necessary to issue init before use.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[0] = 0;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[1] = 0;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[2] = 0;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[3] = 0;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a> = 0;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad0ce7d9382bb7a29c7eea6b241e67688">   79</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad0ce7d9382bb7a29c7eea6b241e67688">TrapSimulator::init</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html">TrapConfig</a>* trapconfig, <span class="keywordtype">int</span> det, <span class="keywordtype">int</span> robPos, <span class="keywordtype">int</span> mcmPos)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// Initialize the class with new MCM position information</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// memory is allocated in the first initialization</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug4) &lt;&lt; <span class="stringliteral">&quot; : trap sim is at : 0x&quot;</span> &lt;&lt; hex &lt;&lt; trapconfig;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8e8bef766a373f357d80dbddbeb7bc5">mInitialized</a>) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a366b5827275974d0739979a59d933b0a">mFeeParam</a> = <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#abb8653b0c3c43e7433053b128b4c0933">FeeParam::instance</a>();</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a> = trapconfig;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> = det;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> = robPos;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> = mcmPos;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab5cf186d3d19eaeb26a32a391df91d6e">mRow</a> = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a366b5827275974d0739979a59d933b0a">mFeeParam</a>-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a764c851feacd971f907903b57e5504e3">getPadRowFromMCM</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8e8bef766a373f357d80dbddbeb7bc5">mInitialized</a>) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3707dcb93c3e28e53d19a070c00a5491">TrapConfig::kC13CPUA</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>.resize(<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>());</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// tracklet calculation</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">//now a 25 slot array mFitReg.resize(FeeParam::getNadcMcm()); //TODO for now this is constant size in an array not a vector</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">//  mTrackletArray-.resize(mgkMaxTracklets);</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">//now a 100 slot array as per run2  mHits.resize(50);</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>.resize(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4c4a1f9409e651a51dcf4c185b1cacba">mgkMaxTracklets</a>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>.resize(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> * <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>());</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>.resize(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> * <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>());</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8e8bef766a373f357d80dbddbeb7bc5">mInitialized</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a> = 0;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#adb893e88e76a746845bcd65742b10f7c">reset</a>();</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#adb893e88e76a746845bcd65742b10f7c">  118</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#adb893e88e76a746845bcd65742b10f7c">TrapSimulator::reset</a>()</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Resets the data values and internal filter registers</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// by re-initialising them</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  memset(&amp;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[0]) * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>.size());</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  memset(&amp;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[0]) * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>.size());</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> filterreg : <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    filterreg.ClearReg();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// Default unread, low active bit mask</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  memset(&amp;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[0]) * <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>());</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  memset(&amp;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[0]) * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4c4a1f9409e651a51dcf4c185b1cacba">mgkMaxTracklets</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">//mDict1.clear();</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">//mDict2.clear();</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">//mDict3.clear();</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac421d3becb1e3bf4a04d9ead29f98140">filterPedestalInit</a>();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1418e4ed28a4b349a0e882f44cd0cc77">filterGainInit</a>();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a667c406f12bf04f78c37a2ac2424d81b">filterTailInit</a>();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">//labelsInit();</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">// ----- I/O implementation -----</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7de0cebed187eadb245acff124de2244">  146</a></span>&#160;ostream&amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7de0cebed187eadb245acff124de2244">TrapSimulator::text</a>(ostream&amp; os)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">// manipulator to activate output in text format (default)</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  os.iword(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">mgkFormatIndex</a>) = 0;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">return</span> os;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4f8cb9c7f57384b64d3f2968353f9ecf">  154</a></span>&#160;ostream&amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4f8cb9c7f57384b64d3f2968353f9ecf">TrapSimulator::cfdat</a>(ostream&amp; os)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// manipulator to activate output in CFDAT format</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// to send to the FEE via SCSN</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  os.iword(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">mgkFormatIndex</a>) = 1;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">return</span> os;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2f493935228ccca8731a1773c8f55b48">  163</a></span>&#160;ostream&amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2f493935228ccca8731a1773c8f55b48">TrapSimulator::raw</a>(ostream&amp; os)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;{</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// manipulator to activate output as raw data dump</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  os.iword(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">mgkFormatIndex</a>) = 2;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">return</span> os;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">//std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const TrapSimulator&amp; mcm); // data output using ostream (e.g. cout &lt;&lt; mcm;)</span></div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="../../d2/d76/namespaceo2_1_1trd.html#a5e7f2ac8120b52d13cab6196789480d6">  172</a></span>&#160;std::ostream&amp; <a class="code" href="../../d2/d76/namespaceo2_1_1trd.html#ae3fe869645d0433238249bd6b5a96d03">o2::trd::operator&lt;&lt;</a>(std::ostream&amp; os, <span class="keyword">const</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html">TrapSimulator</a>&amp; mcm)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;{</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// output implementation</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">// no output for non-initialized MCM</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> (!mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">return</span> os;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// ----- human-readable output -----</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">if</span> (os.iword(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">TrapSimulator::mgkFormatIndex</a>) == 0) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;TRAP &quot;</span> &lt;&lt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a67a37ea3fb4a681e383db89e6d3130d5">getMcmPos</a>() &lt;&lt; <span class="stringliteral">&quot; on ROB &quot;</span> &lt;&lt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a66e709054640516f525d051bcc545833">getRobPos</a>() &lt;&lt; <span class="stringliteral">&quot; in detector &quot;</span> &lt;&lt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a40c7c0070b27fbeb80eba351a77985a3">getDetector</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;----- Unfiltered ADC data (10 bit) -----&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;ch    &quot;</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      os &lt;&lt; std::setw(5) &lt;&lt; iChannel;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    os &lt;&lt; std::endl;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>(); iTimeBin++) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;tb &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; iTimeBin &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        os &lt;&lt; std::setw(5) &lt;&lt; (mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8de221d59fddf3720d2afca105fab7b0">getDataRaw</a>(iChannel, iTimeBin) &gt;&gt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      os &lt;&lt; std::endl;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;----- Filtered ADC data (10+2 bit) -----&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;ch    &quot;</span>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      os &lt;&lt; std::setw(4) &lt;&lt; iChannel</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;         &lt;&lt; ((~mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a43396a83bfc442bf6784258b6740ca73">getZeroSupressionMap</a>(iChannel) != 0) ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    os &lt;&lt; std::endl;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>(); iTimeBin++) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;tb &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; iTimeBin &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        os &lt;&lt; std::setw(4) &lt;&lt; (mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(iChannel, iTimeBin))</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;           &lt;&lt; (((mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a43396a83bfc442bf6784258b6740ca73">getZeroSupressionMap</a>(iChannel) &amp; (1 &lt;&lt; iTimeBin)) == 0) ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      os &lt;&lt; std::endl;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// ----- CFDAT output -----</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (os.iword(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">TrapSimulator::mgkFormatIndex</a>) == 1) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordtype">int</span> dest = 127;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordtype">int</span> addrOffset = 0x2000;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordtype">int</span> addrStep = 0x80;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>(); iTimeBin++) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        os &lt;&lt; std::setw(5) &lt;&lt; 10</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;           &lt;&lt; std::setw(5) &lt;&lt; addrOffset + iChannel * addrStep + iTimeBin</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;           &lt;&lt; std::setw(5) &lt;&lt; (mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(iChannel, iTimeBin))</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;           &lt;&lt; std::setw(5) &lt;&lt; dest &lt;&lt; std::endl;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      os &lt;&lt; std::endl;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">// ----- raw data ouptut -----</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (os.iword(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">TrapSimulator::mgkFormatIndex</a>) == 2) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a> = 300;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a> = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[<a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a>];</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">int</span> bufLength = mcm.<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2336f3806e4c9361fc60a99779c3aa7e">produceRawStream</a>(&amp;buf[0], bufSize);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; bufLength; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;0x&quot;</span> &lt;&lt; std::hex &lt;&lt; buf[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; std::dec &lt;&lt; std::endl;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;unknown format set&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">return</span> os;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a308939ec2bc6885d2fea9709cd52c771">  251</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a308939ec2bc6885d2fea9709cd52c771">TrapSimulator::printFitRegXml</a>(ostream&amp; os)<span class="keyword"> const</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">// print fit registres in XML format</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae2a2a37ba599460efa340a552b89b169">tracklet</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cpu = 0; cpu &lt; 4; cpu++) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[cpu] != 31)</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      tracklet = <span class="keyword">true</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> aquote{R<span class="stringliteral">&quot;(&quot;)&quot;};</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">  </span><span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> cmdid{R<span class="stringliteral">&quot;(&quot; cmdid=&quot;0&quot;&gt;)&quot;};</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">  </span><span class="keywordflow">if</span> (tracklet == <span class="keyword">true</span>) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;nginject&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;ack roc=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; cmdid &lt;&lt; std::endl;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;dmem-readout&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;d det=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot; &lt;ro-board rob=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;  &lt;m mcm=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cpu = 0; cpu &lt; 4; cpu++) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;   &lt;c cpu=\&quot;&quot;</span> &lt;&lt; cpu &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[cpu] != 31) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> adcch = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[cpu]; adcch &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[cpu] + 2; adcch++) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          <span class="keywordflow">if</span> (adcch &gt; 24)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot;adcch going awol : &quot;</span> &lt;&lt; adcch &lt;&lt; <span class="stringliteral">&quot; &gt; 25&quot;</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;    &lt;ch chnr=\&quot;&quot;</span> &lt;&lt; adcch &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;hits&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mNhits &lt;&lt; <span class="stringliteral">&quot;&lt;/hits&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;q0&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mQ0 &lt;&lt; <span class="stringliteral">&quot;&lt;/q0&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;q1&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mQ1 &lt;&lt; <span class="stringliteral">&quot;&lt;/q1&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;sumx&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mSumX &lt;&lt; <span class="stringliteral">&quot;&lt;/sumx&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;sumxsq&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mSumX2 &lt;&lt; <span class="stringliteral">&quot;&lt;/sumxsq&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;sumy&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mSumY &lt;&lt; <span class="stringliteral">&quot;&lt;/sumy&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;sumysq&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mSumY2 &lt;&lt; <span class="stringliteral">&quot;&lt;/sumysq&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;     &lt;sumxy&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcch].mSumXY &lt;&lt; <span class="stringliteral">&quot;&lt;/sumxy&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;    &lt;/ch&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;      &lt;/c&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;    &lt;/m&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;  &lt;/ro-board&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;/d&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;/dmem-readout&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;/ack&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;&lt;/nginject&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac082c9fbcfa73ad165aa00b85346b156">  300</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac082c9fbcfa73ad165aa00b85346b156">TrapSimulator::printTrackletsXml</a>(ostream&amp; os)<span class="keyword"> const</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">// print tracklets in XML format</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> cmdid{R<span class="stringliteral">&quot;(&quot; cmdid=&quot;0&quot;&gt;)&quot;};</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="stringliteral">  os &lt;&lt; </span><span class="stringliteral">&quot;&lt;nginject&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;ack roc=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; cmdid &lt;&lt; std::endl;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;dmem-readout&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;d det=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;  &lt;ro-board rob=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;    &lt;m mcm=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordtype">int</span> pid, padrow, slope, <a class="code" href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cpu = 0; cpu &lt; 4; cpu++) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] == 0x10001000) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      pid = -1;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      padrow = -1;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      slope = -1;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      offset = -1;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      pid = (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] &amp; 0xFF000000) &gt;&gt; 24;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      padrow = (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] &amp; 0xF00000) &gt;&gt; 20;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      slope = (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] &amp; 0xFE000) &gt;&gt; 13;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      offset = (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] &amp; 0x1FFF);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;      &lt;trk&gt; &lt;pid&gt;&quot;</span> &lt;&lt; pid &lt;&lt; <span class="stringliteral">&quot;&lt;/pid&gt;&quot;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; &lt;padrow&gt;&quot;</span> &lt;&lt; padrow &lt;&lt; <span class="stringliteral">&quot;&lt;/padrow&gt;&quot;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; &lt;slope&gt;&quot;</span> &lt;&lt; slope &lt;&lt; <span class="stringliteral">&quot;&lt;/slope&gt;&quot;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; &lt;offset&gt;&quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;&lt;/offset&gt;&quot;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;&lt;/trk&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;    &lt;/m&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;  &lt;/ro-board&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/d&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/dmem-readout&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/ack&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/nginject&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a08a63ecf136012952fd00cfb3dcf6d35">TrapSimulator::printAdcDatTxt</a>(ostream&amp; os)<span class="keyword"> const</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">// print ADC data in text format (suitable as Modelsim stimuli)</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;# MCM &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; <span class="stringliteral">&quot; on ROB &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; <span class="stringliteral">&quot; in detector &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); ++iChannel) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      os &lt;&lt; std::setw(5) &lt;&lt; (getDataRaw(iChannel, iTimeBin) &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    os &lt;&lt; std::endl;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#addb70efc22337d885b5c7ded6ed7322a">TrapSimulator::printAdcDatHuman</a>(ostream&amp; os)<span class="keyword"> const</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// print ADC data in human-readable format</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;MCM &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; <span class="stringliteral">&quot; on ROB &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; <span class="stringliteral">&quot; in detector &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;----- Unfiltered ADC data (10 bit) -----&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;ch    &quot;</span>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    os &lt;&lt; std::setw(5) &lt;&lt; iChannel;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  os &lt;&lt; std::endl;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;tb &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; iTimeBin &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      os &lt;&lt; std::setw(5) &lt;&lt; (getDataRaw(iChannel, iTimeBin) &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    os &lt;&lt; std::endl;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;----- Filtered ADC data (10+2 bit) -----&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;ch    &quot;</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    os &lt;&lt; std::setw(4) &lt;&lt; iChannel</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;       &lt;&lt; ((~<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iChannel] != 0) ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  os &lt;&lt; std::endl;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;tb &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; iTimeBin &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      os &lt;&lt; std::setw(4) &lt;&lt; (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(iChannel, iTimeBin))</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         &lt;&lt; (((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iChannel] &amp; (1 &lt;&lt; iTimeBin)) == 0) ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    os &lt;&lt; std::endl;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a19814d027d13a233552ccec6068049b6">TrapSimulator::printAdcDatXml</a>(ostream&amp; os)<span class="keyword"> const</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// print ADC data in XML format</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> cmdid{R<span class="stringliteral">&quot;(&quot; cmdid=&quot;0&quot;&gt;)&quot;};</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="stringliteral">  os &lt;&lt; </span><span class="stringliteral">&quot;&lt;nginject&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;ack roc=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; cmdid &lt;&lt; std::endl;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;dmem-readout&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;d det=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot; &lt;ro-board rob=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;  &lt;m mcm=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;   &lt;ch chnr=\&quot;&quot;</span> &lt;&lt; iChannel &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;&lt;tb&gt;&quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iChannel * mNTimeBin + iTimeBin] / 4 &lt;&lt; <span class="stringliteral">&quot;&lt;/tb&gt;&quot;</span>;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;   &lt;/ch&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;  &lt;/m&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot; &lt;/ro-board&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/d&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/dmem-readout&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/ack&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  os &lt;&lt; <span class="stringliteral">&quot;&lt;/nginject&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0c33960ac489c87a08d3d54f76d9f521">TrapSimulator::printAdcDatDatx</a>(ostream&amp; os, <span class="keywordtype">bool</span> broadcast, <span class="keywordtype">int</span> timeBinOffset)<span class="keyword"> const</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// print ADC data in datx format (to send to FEE)</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a3246f5ecddb2cb86186e13a75a5a15a8">printDatx</a>(os, 2602, 1, 0, 127); <span class="comment">// command to enable the ADC clock - necessary to write ADC values to MCM</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  os &lt;&lt; std::endl;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">int</span> addrOffset = 0x2000;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">int</span> addrStep = 0x80;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordtype">int</span> addrOffsetEBSIA = 0x20;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iChannel = 0; iChannel &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iChannel++) {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">if</span> ((iTimeBin &lt; timeBinOffset) || (iTimeBin &gt;= mNTimeBin + timeBinOffset)) {</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">if</span> (broadcast == <span class="keyword">false</span>)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a3246f5ecddb2cb86186e13a75a5a15a8">printDatx</a>(os, addrOffset + iChannel * addrStep + addrOffsetEBSIA + iTimeBin, 10, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a66e709054640516f525d051bcc545833">getRobPos</a>(), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a67a37ea3fb4a681e383db89e6d3130d5">getMcmPos</a>());</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a3246f5ecddb2cb86186e13a75a5a15a8">printDatx</a>(os, addrOffset + iChannel * addrStep + addrOffsetEBSIA + iTimeBin, 10, 0, 127);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span> (broadcast == <span class="keyword">false</span>)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a3246f5ecddb2cb86186e13a75a5a15a8">printDatx</a>(os, addrOffset + iChannel * addrStep + addrOffsetEBSIA + iTimeBin, (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(iChannel, iTimeBin - timeBinOffset) / 4), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a66e709054640516f525d051bcc545833">getRobPos</a>(), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a67a37ea3fb4a681e383db89e6d3130d5">getMcmPos</a>());</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a3246f5ecddb2cb86186e13a75a5a15a8">printDatx</a>(os, addrOffset + iChannel * addrStep + addrOffsetEBSIA + iTimeBin, (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(iChannel, iTimeBin - timeBinOffset) / 4), 0, 127);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    os &lt;&lt; std::endl;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a56289b031f21dc2129b4c54f7dbccf7a">TrapSimulator::printPidLutHuman</a>()</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;{</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">// print PID LUT in human readable format</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addrEnd = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8553c5fe786aedd2fa28d24e810f1ae">mgkDmemAddrLUTStart</a> + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a927160fb41550e13ed1332388c6bd491">mgkDmemAddrLUTLength</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) / 4; <span class="comment">// /4 because each addr contains 4 values</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nBinsQ0 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1ae055d11c7b762b0849040b7fbda835">mgkDmemAddrLUTnbins</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;nBinsQ0: &quot;</span> &lt;&lt; nBinsQ0 &lt;&lt; std::endl;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;LUT table length: &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a927160fb41550e13ed1332388c6bd491">mgkDmemAddrLUTLength</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &lt;&lt; std::endl;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">if</span> (nBinsQ0 &gt; 0) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8553c5fe786aedd2fa28d24e810f1ae">mgkDmemAddrLUTStart</a>; addr &lt; addrEnd; addr++) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a321ff419cd5252e54cf95e64dc6687ee">result</a>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      result = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(addr, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      std::cout &lt;&lt; addr &lt;&lt; <span class="stringliteral">&quot; # x: &quot;</span> &lt;&lt; ((addr - <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8553c5fe786aedd2fa28d24e810f1ae">mgkDmemAddrLUTStart</a>) % ((nBinsQ0) / 4)) * 4 &lt;&lt; <span class="stringliteral">&quot;, y: &quot;</span> &lt;&lt; (addr - <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8553c5fe786aedd2fa28d24e810f1ae">mgkDmemAddrLUTStart</a>) / (nBinsQ0 / 4)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;  #  &quot;</span> &lt;&lt; ((result &gt;&gt; 0) &amp; 0xFF)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; ((result &gt;&gt; 8) &amp; 0xFF)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; ((result &gt;&gt; 16) &amp; 0xFF)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; ((result &gt;&gt; 24) &amp; 0xFF) &lt;&lt; std::endl;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af419c1e8b835ae86a0cf72529a2797b8">TrapSimulator::setNTimebins</a>(<span class="keywordtype">int</span> ntimebins)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;{</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="comment">// Reallocate memory if a change in the number of timebins</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="comment">// is needed (should not be the case for real data)</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(fatal) &lt;&lt; <span class="stringliteral">&quot;setNTimebins(&quot;</span> &lt;&lt; ntimebins &lt;&lt; <span class="stringliteral">&quot;) not implemented as we can no longer change the size of the ADC array&quot;</span>;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> = ntimebins;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="comment">// for( int iAdc = 0 ; iAdc &lt; FeeParam::getNadcMcm(); iAdc++ ) {</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">//  delete [] mADCR[iAdc];</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">//  delete [] mADCF[iAdc];</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">//  mADCR[iAdc] = new int[mNTimeBin];</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">//  mADCF[iAdc] = new int[mNTimeBin];</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// }</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;}</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5599ddbbdffa2454f147b63fcc1395e5">TrapSimulator::loadMCM</a>(<span class="keywordtype">int</span> det, <span class="keywordtype">int</span> rob, <span class="keywordtype">int</span> mcm)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;{</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// loads the ADC data as obtained from the digitsManager for the specified MCM.</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// This method is meant for rare execution, e.g. in the visualization. When called</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">// frequently use SetData(...) instead.</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(fatal) &lt;&lt; <span class="stringliteral">&quot;no longer implemented, this is left incase script calls it that I have not found yet.&quot;</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;}</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aab1dc98efdf1f426f53df1bb9688cd15">TrapSimulator::noiseTest</a>(<span class="keywordtype">int</span> nsamples, <span class="keywordtype">int</span> mean, <span class="keywordtype">int</span> sigma, <span class="keywordtype">int</span> inputGain, <span class="keywordtype">int</span> inputTail)</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;{</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="comment">// This function can be used to test the filters.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">// It feeds nsamples of ADC values with a gaussian distribution specified by mean and sigma.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">// The filter chain implemented here consists of:</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">// Pedestal -&gt; Gain -&gt; Tail</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="comment">// With inputGain and inputTail the input to the gain and tail filter, respectively,</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">// can be chosen where</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="comment">// 0: noise input</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="comment">// 1: pedestal output</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">// 2: gain output</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="comment">// The input has to be chosen from a stage before.</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">// The filter behaviour is controlled by the TRAP parameters from TrapConfig in the</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// same way as in normal simulation.</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="comment">// The functions produces four histograms with the values at the different stages.</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  std::string nameInputGain;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  std::string nameInputTail;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">switch</span> (inputGain) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      nameInputGain = <span class="stringliteral">&quot;Noise&quot;</span>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      nameInputGain = <span class="stringliteral">&quot;Pedestal&quot;</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot;Undefined input to tail cancellation filter&quot;</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">switch</span> (inputTail) {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      nameInputTail = <span class="stringliteral">&quot;Noise&quot;</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      nameInputTail = <span class="stringliteral">&quot;Pedestal&quot;</span>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      nameInputTail = <span class="stringliteral">&quot;Gain&quot;</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot;Undefined input to tail cancellation filter&quot;</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  TH1F* <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a> = <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;noise&quot;</span>, <span class="stringliteral">&quot;Gaussian Noise;sample;ADC count&quot;</span>,</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                     nsamples, 0, nsamples);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  TH1F* hfp = <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;ped&quot;</span>, <span class="stringliteral">&quot;Noise #rightarrow Pedestal filter;sample;ADC count&quot;</span>, nsamples, 0, nsamples);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  TH1F* hfg = <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;gain&quot;</span>,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                       (nameInputGain + <span class="stringliteral">&quot;#rightarrow Gain;sample;ADC count&quot;</span>).c_str(),</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                       nsamples, 0, nsamples);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  TH1F* hft = <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;tail&quot;</span>,</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                       (nameInputTail + <span class="stringliteral">&quot;#rightarrow Tail;sample;ADC count&quot;</span>).c_str(),</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                       nsamples, 0, nsamples);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  h-&gt;SetStats(<span class="keyword">false</span>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  hfp-&gt;SetStats(<span class="keyword">false</span>);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  hfg-&gt;SetStats(<span class="keyword">false</span>);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  hft-&gt;SetStats(<span class="keyword">false</span>);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nsamples; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a>;                               <span class="comment">// ADC count with noise (10 bit)</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordtype">int</span> valuep;                              <span class="comment">// pedestal filter output (12 bit)</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordtype">int</span> valueg;                              <span class="comment">// gain filter output (12 bit)</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordtype">int</span> valuet;                              <span class="comment">// tail filter value (12 bit)</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    value = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)gRandom-&gt;Gaus(mean, sigma); <span class="comment">// generate noise with gaussian distribution</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    h-&gt;SetBinContent(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, value);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    valuep = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a14d524b4525db37961daec35c0bf814e">filterPedestalNextSample</a>(1, 0, ((<span class="keywordtype">int</span>)value) &lt;&lt; 2);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (inputGain == 0)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      valueg = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aadb87c171f30ff3f869219fa9023283b">filterGainNextSample</a>(1, ((<span class="keywordtype">int</span>)value) &lt;&lt; 2);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      valueg = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aadb87c171f30ff3f869219fa9023283b">filterGainNextSample</a>(1, valuep);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span> (inputTail == 0)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      valuet = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8f3a3fdb5260c675584a5fae1401f3e7">filterTailNextSample</a>(1, ((<span class="keywordtype">int</span>)value) &lt;&lt; 2);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inputTail == 1)</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      valuet = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8f3a3fdb5260c675584a5fae1401f3e7">filterTailNextSample</a>(1, valuep);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      valuet = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8f3a3fdb5260c675584a5fae1401f3e7">filterTailNextSample</a>(1, valueg);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    hfp-&gt;SetBinContent(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, valuep &gt;&gt; 2);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    hfg-&gt;SetBinContent(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, valueg &gt;&gt; 2);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    hft-&gt;SetBinContent(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, valuet &gt;&gt; 2);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  TCanvas* c = <span class="keyword">new</span> TCanvas;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  c-&gt;Divide(2, 2);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  c-&gt;cd(1);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  h-&gt;Draw();</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  c-&gt;cd(2);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  hfp-&gt;Draw();</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  c-&gt;cd(3);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  hfg-&gt;Draw();</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  c-&gt;cd(4);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  hft-&gt;Draw();</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;}</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">TrapSimulator::checkInitialized</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// Check whether object is initialized</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">//  if (!mInitialized)</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">//   LOG(debug4) &lt;&lt; &quot;TrapSimulator is not initialized but function other than Init() is called.&quot;;</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8e8bef766a373f357d80dbddbeb7bc5">mInitialized</a>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;}</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a69867079534b8c6ad96aeb33a906d54c">TrapSimulator::print</a>(<span class="keywordtype">int</span> choice)<span class="keyword"> const</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// Prints the data stored and/or calculated for this TRAP</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">// The output is controlled by option which can be any bitpattern defined in the header</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="comment">// PRINTRAW - prints raw ADC data</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="comment">// PRINTFILTERED - prints filtered data</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">// PRINTHITS - prints detected hits</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// PRINTTRACKLETS - prints found tracklets</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="comment">// The later stages are only meaningful after the corresponding calculations</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// have been performed.</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">// Codacy wont let us use string choices, as it says we must use string::starts_with() instead of string::find()</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;MCM &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; <span class="stringliteral">&quot;  on ROB &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; <span class="stringliteral">&quot; in detector &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="comment">//std::string opt = option;</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordflow">if</span> ((choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435afdba17aac06cb616fbfc9cb904fc44df">PRINTRAW</a>) != 0 || (choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435a35c04d36a70e284f1c4bf9548857bfba">PRINTFILTERED</a>) != 0) {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    std::cout &lt;&lt; *<span class="keyword">this</span>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">if</span> ((choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435ac3b6aed3ed2ba6de27c165559f4c547d">PRINTDETECTED</a>) != 0) {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a> &lt;&lt; <span class="stringliteral">&quot; hits:&quot;</span>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>; iHit++) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Hit &quot;</span> &lt;&lt; std::setw(3) &lt;&lt; iHit &lt;&lt; <span class="stringliteral">&quot; in timebin &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin &lt;&lt; <span class="stringliteral">&quot;, ADC &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mChannel &lt;&lt; <span class="stringliteral">&quot; has charge &quot;</span> &lt;&lt; std::setw(3) &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mQtot &lt;&lt; <span class="stringliteral">&quot; and position &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mYpos;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordflow">if</span> ((choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435aefbf1ef46b9c47fbff3490178306645c">PRINTFOUND</a>) != 0) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Trackletsi:&quot;</span>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrkl = 0; iTrkl &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>.size(); iTrkl++) {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;tracklet &quot;</span> &lt;&lt; iTrkl &lt;&lt; <span class="stringliteral">&quot;: 0x&quot;</span> &lt;&lt; hex &lt;&lt; std::setw(8) &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[iTrkl].getTrackletWord();</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;}</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7dd0c69979dbf8b50d6bcd5969763def">TrapSimulator::draw</a>(<span class="keywordtype">int</span> choice, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>)</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;{</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">// Plots the data stored in a 2-dim. timebin vs. ADC channel plot.</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="comment">// The choice selects what data is plotted and is enumated in the header.</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// PLOTRAW - plot raw data (default)</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="comment">// PLOTFILTERED - plot filtered data (meaningless if R is specified)</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">// In addition to the ADC values:</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="comment">// PLOTHITS - plot hits</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">// PLOTTRACKLETS - plot tracklets</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  TFile* rootfile = <span class="keyword">new</span> TFile(Form(<span class="stringliteral">&quot;Spectra_%i.root&quot;</span>, index), <span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  TH2F* hist = <span class="keyword">new</span> TH2F(Form(<span class="stringliteral">&quot;mcmdata_%i&quot;</span>, index),</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        Form(<span class="stringliteral">&quot;Data of MCM %i on ROB %i in detector %i&quot;</span>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>),</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                        <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(),</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        -0.5,</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                        <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>() - 0.5,</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>(),</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                        -0.5,</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>() - 0.5);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  hist-&gt;GetXaxis()-&gt;SetTitle(<span class="stringliteral">&quot;ADC Channel&quot;</span>);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  hist-&gt;GetYaxis()-&gt;SetTitle(<span class="stringliteral">&quot;Timebin&quot;</span>);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  hist-&gt;SetStats(<span class="keyword">false</span>);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordflow">if</span> ((choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aee16770e6f7230958845149a413fb112a81e9ef527e98d0c9e11bb4f52d8d484a">PLOTRAW</a>) != 0) {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++) {</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        hist-&gt;SetBinContent(iAdc + 1, iTimeBin + 1, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[iAdc * mNTimeBin + iTimeBin] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++) {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        hist-&gt;SetBinContent(iAdc + 1, iTimeBin + 1, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + iTimeBin] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    }</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  hist-&gt;Draw(<span class="stringliteral">&quot;colz&quot;</span>);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span> ((choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aee16770e6f7230958845149a413fb112a6ac5214e376c5367275b8567fbe95233">PLOTHITS</a>) != 0) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    TGraph* grHits = <span class="keyword">new</span> TGraph();</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>; iHit++) {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      grHits-&gt;SetPoint(iHit,</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                       <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mChannel + 1 + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mYpos / 256.,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                       <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    grHits-&gt;Draw(<span class="stringliteral">&quot;*&quot;</span>);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordflow">if</span> ((choice &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aee16770e6f7230958845149a413fb112aab06ad7e83b258677ccdc0eb757987fc">PLOTTRACKLETS</a>) != 0) {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    TLine* trklLines = <span class="keyword">new</span> TLine[4];</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTrkl = 0; iTrkl &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>.size(); iTrkl++) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <a class="code" href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html">Tracklet</a> trkl = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[iTrkl];</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordtype">float</span> padWidth = 0.635 + 0.03 * (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> % 6);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a> = padWidth / 256. * ((((((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &amp; 0x1) &lt;&lt; 2) + (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &amp; 0x3)) * 18) &lt;&lt; 8) - ((18 * 4 * 2 - 18 * 2 - 3) &lt;&lt; 7)); <span class="comment">// revert adding offset in FitTracklet</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                                                                                                                      <span class="comment">//TODO replace the 18, 4 3 and 7 with constants for readability</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordtype">int</span> ndrift = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a87a1572c8fb96b7c90a08122511cd581">mgkDmemAddrNdrift</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &gt;&gt; 5;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordtype">float</span> slope = 0;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="keywordflow">if</span> (ndrift)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        slope = trkl.<a class="code" href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a5bc3cd4186795b7c06dfa11c506b4ab9">getdY</a>() * 140<a class="code" href="../../d8/de9/qconfigoptions_8h.html#acc2760558000045ec0803d60d4d01c98">e</a>-4 / ndrift;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#abf0ea7853561a9028dbbc4caeb2f8ff1">t0</a> = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca495215e5e729091082c9e718f5c5412d">TrapConfig::kTPFS</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a> = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee5d08b4a157f43a48a3c3b8d3627ae6">TrapConfig::kTPFE</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      trklLines[iTrkl].SetX1((offset - (trkl.<a class="code" href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a552396834c4e331e3fd0c3c4971316d7">getY</a>() - slope * <a class="code" href="../../dc/da3/glcorearb_8h.html#abf0ea7853561a9028dbbc4caeb2f8ff1">t0</a>)) / padWidth); <span class="comment">// ??? sign?</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      trklLines[iTrkl].SetY1(t0);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      trklLines[iTrkl].SetX2((offset - (trkl.<a class="code" href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a552396834c4e331e3fd0c3c4971316d7">getY</a>() - slope * <a class="code" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a>)) / padWidth); <span class="comment">// ??? sign?</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      trklLines[iTrkl].SetY2(t1);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      trklLines[iTrkl].SetLineColor(2);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      trklLines[iTrkl].SetLineWidth(2);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Tracklet &quot;</span> &lt;&lt; iTrkl &lt;&lt; <span class="stringliteral">&quot;: y = &quot;</span> &lt;&lt; trkl.<a class="code" href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a552396834c4e331e3fd0c3c4971316d7">getY</a>() &lt;&lt; <span class="stringliteral">&quot;, dy = &quot;</span> &lt;&lt; (trkl.<a class="code" href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a5bc3cd4186795b7c06dfa11c506b4ab9">getdY</a>() * 140<a class="code" href="../../d8/de9/qconfigoptions_8h.html#acc2760558000045ec0803d60d4d01c98">e</a>-4) &lt;&lt; <span class="stringliteral">&quot; offset : &quot;</span> &lt;&lt; offset;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">//TODO put that 140e-4 in some constant somewhere</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      trklLines[iTrkl].Draw();</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  rootfile-&gt;Close();</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a654248d39a677b189958ba1bb69574bf">TrapSimulator::setData</a>(<span class="keywordtype">int</span> adc, <span class="keyword">const</span> <a class="code" href="../../d2/d76/namespaceo2_1_1trd.html#a74b648440ce4e942f21911868a934b75">ArrayADC</a>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>)</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;{</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="comment">// Store ADC data into array of raw data</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keywordflow">if</span> (adc &lt; 0 || adc &gt;= <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>()) {</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot;Error: ADC &quot;</span> &lt;&lt; adc &lt;&lt; <span class="stringliteral">&quot; is out of range (0 .. &quot;</span> &lt;&lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>() - 1 &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> it = 0; it &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; it++) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[adc * mNTimeBin + it] = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)(data[it]) &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * mNTimeBin + it] = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)(data[it]) &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  mDataIsSet = <span class="keyword">true</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a654248d39a677b189958ba1bb69574bf">TrapSimulator::setData</a>(<span class="keywordtype">int</span> adc, <span class="keywordtype">int</span> it, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;{</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="comment">// Store ADC data into array of raw data</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="comment">// This time enter it element by element.</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">if</span> (adc &lt; 0 || adc &gt;= <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>()) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot;Error: ADC &quot;</span> &lt;&lt; adc &lt;&lt; <span class="stringliteral">&quot; is out of range (0 .. &quot;</span> &lt;&lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>() - 1 &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[adc * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> + it] = data &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> + it] = data &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;}</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af7943e58db355976579f0e31fc841606">TrapSimulator::setDataByPad</a>(std::vector&lt;o2::trd::Digit&gt;&amp; padrowdigits, <a class="code" href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer&lt;MCLabel&gt;</a>&amp; labels, <span class="keywordtype">int</span> padrowoffset)</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;{</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">// Set the ADC data from the incoming digits vector which contains an entire row</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">// (by pad, to be used during initial reading in simulation)</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">// digits contains an entire padrow from the simulation, this is done to sort out the shared pads.</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="comment">//Do we need to copy the labels into an internal format or just keep for passing through later.</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> != <a class="code" href="../../d2/d76/namespaceo2_1_1trd.html#ade2e479ac957ba3a33e97e58d78ad654">o2::trd::kTimeBins</a>) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;Changing number of time bins in the simulation from &quot;</span> &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="../../d2/d76/namespaceo2_1_1trd.html#ade2e479ac957ba3a33e97e58d78ad654">o2::trd::kTimeBins</a>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af419c1e8b835ae86a0cf72529a2797b8">setNTimebins</a>(o2::trd::kTimeBins);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(fatal) &lt;&lt; <span class="stringliteral">&quot;Changing number of time bins in the simulation this is fatal as I think this timebin changee is going to mess things up. timebins are fixed with in digit class.&quot;</span>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="comment">//this is the offset with in a padrow, and due to the reverse number of mcm adcs vs the pads, we offset to the end and then loop back through the adcs</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a> = padrowoffset; <span class="comment">//(mMcmPos % 4 + 1) * 18 + (mRobPos % 2) * 72 + 1;</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> adc = 0; adc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); adc++) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <a class="code" href="../../d2/d76/namespaceo2_1_1trd.html#a74b648440ce4e942f21911868a934b75">ArrayADC</a> timebins;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordtype">int</span> pad = offset - adc;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">if</span> (pad &gt; -1 &amp;&amp; pad &lt; 144)</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      timebins = padrowdigits[pad].getADC();</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> timebin = 0; timebin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; timebin++) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a> = timebins[timebin];</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="keywordflow">if</span> (value &lt; 0 || (offset - adc &lt; 1) || (offset - adc &gt; 165)) {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[adc * mNTimeBin + timebin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cacf25bd83a078d5ade10a368c0ba55a76">TrapConfig::kFPNP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) + (mgAddBaseline &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * mNTimeBin + timebin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cad658f0fea9a2d6b2e16f889a1a9b3b91">TrapConfig::kTPFP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) + (mgAddBaseline &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[adc] = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[adc * mNTimeBin + timebin] = (value &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>) + (mgAddBaseline &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * mNTimeBin + timebin] = (value &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>) + (mgAddBaseline &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      }</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0b6619b0b6971ff23ff8f2cb6c87b5f9">TrapSimulator::setDataPedestal</a>(<span class="keywordtype">int</span> adc)</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;{</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="comment">// Store ADC data into array of raw data</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">if</span> (adc &lt; 0 || adc &gt;= <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>()) {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> it = 0; it &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; it++) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[adc * mNTimeBin + it] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cacf25bd83a078d5ade10a368c0ba55a76">TrapConfig::kFPNP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) + (mgAddBaseline &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * mNTimeBin + it] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cad658f0fea9a2d6b2e16f889a1a9b3b91">TrapConfig::kTPFP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) + (mgAddBaseline &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  }</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;}</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af5f285a4defaffaa7ed6a4a9fccf0381">TrapSimulator::getHit</a>(<span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>, <span class="keywordtype">int</span>&amp; channel, <span class="keywordtype">int</span>&amp; timebin, <span class="keywordtype">int</span>&amp; qtot, <span class="keywordtype">int</span>&amp; ypos, <span class="keywordtype">float</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>, <span class="keywordtype">int</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="comment">// retrieve the MC hit information (not available in TRAP hardware)</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index &lt; 0 || index &gt;</a>= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>)</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  channel = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>].mChannel;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  timebin = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>].mTimebin;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  qtot = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>].mQtot;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  ypos = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>].mYpos;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  y = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)((((((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &amp; 0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a>) &lt;&lt; 2) + (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &amp; 0<a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a48d1d55da7e44710eb682e4ac2d7c86d">x3</a>)) * 18) &lt;&lt; 8) - ((18 * 4 * 2 - 18 * 2 - 1) &lt;&lt; 7) -</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;              (channel &lt;&lt; 8) - ypos) *</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      (0.635 + 0.03 * (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> % 6)) / 256.0;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">//label = mHits[index].mLabel[0];</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af0fb5026985126c43e800e4ced0c8621">TrapSimulator::getCol</a>(<span class="keywordtype">int</span> adc)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;{</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="comment">// Return column id of the pad for the given ADC channel</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordtype">int</span> col = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a366b5827275974d0739979a59d933b0a">mFeeParam</a>-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#af1241df8d091fa4ea0d0d7c8cfc45cd4">getPadColFromADC</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>, adc);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordflow">if</span> (col &lt; 0 || col &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a366b5827275974d0739979a59d933b0a">mFeeParam</a>-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a8d916c06dc405aa0ab66b5ecffc7513e">getNcol</a>())</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">return</span> col;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;}</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2336f3806e4c9361fc60a99779c3aa7e">TrapSimulator::produceRawStream</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iEv)<span class="keyword"> const</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// Produce raw data stream from this MCM and put in buf</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">// Returns number of words filled, or negative value</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="comment">// with -1 * number of overflowed words</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mcmHeader = 0;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> adcMask = 0;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="keywordtype">int</span> nw = 0; <span class="comment">// Number of written words</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html">of</a> = 0; <span class="comment">// Number of overflowed words</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordtype">int</span> rawVer = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a366b5827275974d0739979a59d933b0a">mFeeParam</a>-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a27c61087a425cd5d1c3ceae04c9507ce">getRAWversion</a>();</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  std::vector&lt;int&gt; adc;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca7429e9806b8a20f7a206cccbbba16656">TrapConfig::kEBSF</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) != 0) <span class="comment">// store unfiltered data</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    adc = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    adc = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">// Produce ADC mask : nncc cccm mmmm mmmm mmmm mmmm mmmm 1100</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">//        n : unused , c : ADC count, m : selected ADCs</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">if</span> (rawVer &gt;= 3 &amp;&amp;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cac39e3d9f1b5abb49ce46ac175dbd8dd9">TrapConfig::kC15CPUA</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp; (1 &lt;&lt; 13))) { <span class="comment">// check for zs flag in TRAP configuration</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordtype">int</span> nActiveADC = 0;                                                                           <span class="comment">// number of activated ADC bits in a word</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">if</span> (~<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc] != 0) {       <span class="comment">//  0 means not suppressed</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        adcMask |= (1 &lt;&lt; (iAdc + 4)); <span class="comment">// last 4 digit reserved for 1100=0xc</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        nActiveADC++;                 <span class="comment">// number of 1 in mmm....m</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      }</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">if</span> ((nActiveADC == 0) &amp;&amp;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cac39e3d9f1b5abb49ce46ac175dbd8dd9">TrapConfig::kC15CPUA</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp; (1 &lt;&lt; 8))) <span class="comment">// check for DEH flag in TRAP configuration</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="comment">// assemble adc mask word</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    adcMask |= (1 &lt;&lt; 30) | ((0x3FFFFFFC) &amp; (~(nActiveADC) &lt;&lt; 25)) | 0xC; <span class="comment">// nn = 01, ccccc are inverted, 0xc=1100</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// MCM header</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  mcmHeader = (1 &lt;&lt; 31) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &lt;&lt; 28) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &lt;&lt; 24) | ((iEv % 0x100000) &lt;&lt; 4) | 0xC;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (nw &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a>)</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>[nw++] = mcmHeader;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    of++;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">// ADC mask</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">if</span> (adcMask != 0) {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">if</span> (nw &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a>)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>[nw++] = adcMask;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      of++;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">// Produce ADC data. 3 timebins are packed into one 32 bits word</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">// In this version, different ADC channel will NOT share the same word</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> aa = 0, a1 = 0, a2 = 0, a3 = 0;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; 21; iAdc++) {</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">if</span> (rawVer &gt;= 3 &amp;&amp; ~<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc] == 0)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Zero Suppression, 0 means not suppressed</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    aa = !(iAdc &amp; 1) + 2;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iT = 0; iT &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iT += 3) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      a1 = ((iT) &lt; mNTimeBin) ? adc[iAdc * mNTimeBin + iT] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a> : 0;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      a2 = ((iT + 1) &lt; mNTimeBin) ? adc[iAdc * mNTimeBin + iT + 1] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a> : 0;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      a3 = ((iT + 2) &lt; mNTimeBin) ? adc[iAdc * mNTimeBin + iT + 2] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a> : 0;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      x = (a3 &lt;&lt; 22) | (a2 &lt;&lt; 12) | (a1 &lt;&lt; 2) | aa;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">if</span> (nw &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a>) {</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>[nw++] = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        of++;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">if</span> (of != 0)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">return</span> -of;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordflow">return</span> nw;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;}</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aec699535dbbf95308ea0f65723685d8d">TrapSimulator::produceTrackletStream</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a>)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;{</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// Produce tracklet data stream from this MCM and put in buf</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="comment">// Returns number of words filled, or negative value</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="comment">// with -1 * number of overflowed words</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordtype">int</span> nw = 0; <span class="comment">// Number of written words</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html">of</a> = 0; <span class="comment">// Number of overflowed words</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">// Produce tracklet data. A maximum of four 32 Bit words will be written per MCM</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="comment">// mMCMT is filled continuously until no more tracklet words available</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTracklet = 0; iTracklet &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>.size(); iTracklet++) {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (nw &lt; bufSize)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <a class="code" href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a>[nw++] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[iTracklet].getTrackletWord();</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      of++;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordflow">if</span> (of != 0)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">return</span> -of;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">return</span> nw;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;}</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4a6fe5ae668d51cb620ed129ee8b9b">TrapSimulator::filter</a>()</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;{</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="comment">// Filter the raw ADC values. The active filter stages and their</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">// parameters are taken from TrapConfig.</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="comment">// The raw data is stored separate from the filtered data. Thus,</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="comment">// it is possible to run the filters on a set of raw values</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">// sequentially for parameter tuning.</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// Apply filters sequentially. Bypass is handled by filters</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="comment">// since counters and internal registers may be updated even</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="comment">// if the filter is bypassed.</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="comment">// The first filter takes the data from mADCR and</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="comment">// outputs to mADCF.</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">// Non-linearity filter not implemented.</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a346b92ba59949838973d07c9aa042c06">filterPedestal</a>();</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7f7c4095ae9dde2ec6402a2238b2f765">filterGain</a>();</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e6eb448ada40e689e83ff5780f70eb0">filterTail</a>();</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// Crosstalk filter not implemented.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;}</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac421d3becb1e3bf4a04d9ead29f98140">TrapSimulator::filterPedestalInit</a>(<span class="keywordtype">int</span> baseline)</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;{</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="comment">// Initializes the pedestal filter assuming that the input has</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">// been constant for a long time (compared to the time constant).</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fptc = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca982ce69965a304892d53c5088c067751">TrapConfig::kFPTC</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// 0..3, 0 - fastest, 3 - slowest</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> adc = 0; adc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); adc++)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mPedAcc = (baseline &lt;&lt; 2) * (1 &lt;&lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a920f63bd22ec25a962a0119501126dd5">mgkFPshifts</a>[fptc]);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;}</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a14d524b4525db37961daec35c0bf814e">TrapSimulator::filterPedestalNextSample</a>(<span class="keywordtype">int</span> adc, <span class="keywordtype">int</span> timebin, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a>)</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;{</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">// Returns the output of the pedestal filter given the input value.</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="comment">// The output depends on the internal registers and, thus, the</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">// history of the filter.</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fpnp = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cacf25bd83a078d5ade10a368c0ba55a76">TrapConfig::kFPNP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// 0..511 -&gt; 0..127.75, pedestal at the output</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fptc = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca982ce69965a304892d53c5088c067751">TrapConfig::kFPTC</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// 0..3, 0 - fastest, 3 - slowest</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fpby = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caf235cf7cec62783f3671d81d7869ab3e">TrapConfig::kFPBY</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// 0..1 bypass, active low</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> accumulatorShifted;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> inpAdd;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  inpAdd = value + fpnp;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  accumulatorShifted = (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mPedAcc &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a920f63bd22ec25a962a0119501126dd5">mgkFPshifts</a>[fptc]) &amp; 0x3FF; <span class="comment">// 10 bits</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">if</span> (timebin == 0)                                                                          <span class="comment">// the accumulator is disabled in the drift time</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="keywordtype">int</span> correction = (value &amp; 0x3FF) - accumulatorShifted;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mPedAcc = (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mPedAcc + correction) &amp; 0x7FFFFFFF; <span class="comment">// 31 bits</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">if</span> (fpby == 0)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">if</span> (inpAdd &lt;= accumulatorShifted)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    inpAdd = inpAdd - accumulatorShifted;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span> (inpAdd &gt; 0xFFF)</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordflow">return</span> 0xFFF;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keywordflow">return</span> inpAdd;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  }</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a346b92ba59949838973d07c9aa042c06">TrapSimulator::filterPedestal</a>()</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;{</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="comment">// Apply pedestal filter</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="comment">// As the first filter in the chain it reads data from mADCR</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="comment">// and outputs to mADCF.</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">// It has only an effect if previous samples have been fed to</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">// find the pedestal. Currently, the simulation assumes that</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="comment">// the input has been stable for a sufficiently long time.</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + iTimeBin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a14d524b4525db37961daec35c0bf814e">filterPedestalNextSample</a>(iAdc, iTimeBin, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">mADCR</a>[iAdc * mNTimeBin + iTimeBin]);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;}</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1418e4ed28a4b349a0e882f44cd0cc77">TrapSimulator::filterGainInit</a>()</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;{</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="comment">// Initializes the gain filter. In this case, only threshold</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="comment">// counters are reset.</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> adc = 0; adc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); adc++) {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="comment">// these are counters which in hardware continue</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// until maximum or reset</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mGainCounterA = 0;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mGainCounterB = 0;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  }</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;}</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aadb87c171f30ff3f869219fa9023283b">TrapSimulator::filterGainNextSample</a>(<span class="keywordtype">int</span> adc, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a>)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;{</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="comment">// Apply the gain filter to the given value.</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">// BEGIN_LATEX O_{i}(t) = #gamma_{i} * I_{i}(t) + a_{i} END_LATEX</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="comment">// The output depends on the internal registers and, thus, the</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="comment">// history of the filter.</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mgby = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca4fb238065019006598da2057da7146a7">TrapConfig::kFGBY</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);                             <span class="comment">// bypass, active low</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mgf = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701c">TrapConfig::TrapReg_t</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cae0519f54d493015c6b2174c514e98cea">TrapConfig::kFGF0</a> + adc), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// 0x700 + (0 &amp; 0x1ff);</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mga = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701c">TrapConfig::TrapReg_t</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3d5ce4e5e5690c78fe97cbdcae17418d">TrapConfig::kFGA0</a> + adc), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// 40;</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mgta = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cae59830e75d7da507eeab9de7d76a5ca0">TrapConfig::kFGTA</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);                             <span class="comment">// 20;</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mgtb = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca0cffdccb0c2a141e255123facb8ea982">TrapConfig::kFGTB</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);                             <span class="comment">// 2060;</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mgfExtended = 0x700 + mgf; <span class="comment">// The corr factor which is finally applied has to be extended by 0x700 (hex) or 0.875 (dec)</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                                          <span class="comment">// because fgf=0 correspons to 0.875 and fgf=511 correspons to 1.125 - 2^(-11)</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                                          <span class="comment">// (see TRAP User Manual for details)</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> corr; <span class="comment">// corrected value</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  value &amp;= 0xFFF;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  corr = (value * mgfExtended) &gt;&gt; 11;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  corr = corr &gt; 0xfff ? 0xfff : corr;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  corr = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">addUintClipping</a>(corr, mga, 12);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// Update threshold counters</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="comment">// not really useful as they are cleared with every new event</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="keywordflow">if</span> (!((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mGainCounterA == 0x3FFFFFF) || (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mGainCounterB == 0x3FFFFFF)))</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">// stop when full</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span> (corr &gt;= mgtb)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mGainCounterB++;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (corr &gt;= mgta)</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mGainCounterA++;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="keywordflow">if</span> (mgby == 1)</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">return</span> corr;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a>;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;}</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7f7c4095ae9dde2ec6402a2238b2f765">TrapSimulator::filterGain</a>()</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;{</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="comment">// Read data from mADCF and apply gain filter.</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> adc = 0; adc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); adc++) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * mNTimeBin + iTimeBin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aadb87c171f30ff3f869219fa9023283b">filterGainNextSample</a>(adc, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adc * mNTimeBin + iTimeBin]);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    }</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  }</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;}</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a667c406f12bf04f78c37a2ac2424d81b">TrapSimulator::filterTailInit</a>(<span class="keywordtype">int</span> baseline)</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;{</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="comment">// Initializes the tail filter assuming that the input has</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="comment">// been at the baseline value (configured by FTFP) for a</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="comment">// sufficiently long time.</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="comment">// exponents and weight calculated from configuration</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> alphaLong = 0x3ff &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca1b5e518651b7c80595565500bbb840ab">TrapConfig::kFTAL</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);                            <span class="comment">// the weight of the long component</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lambdaLong = (1 &lt;&lt; 10) | (1 &lt;&lt; 9) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca9447f8cd1926f2cb5c2d48a66e24f7ef">TrapConfig::kFTLL</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp; 0x1FF);  <span class="comment">// the multiplier</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lambdaShort = (0 &lt;&lt; 10) | (1 &lt;&lt; 9) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caeaae9cf6d3f38913266f574fb6a29a1a">TrapConfig::kFTLS</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp; 0x1FF); <span class="comment">// the multiplier</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">float</span> lambdaL = lambdaLong * 1.0 / (1 &lt;&lt; 11);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordtype">float</span> lambdaS = lambdaShort * 1.0 / (1 &lt;&lt; 11);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordtype">float</span> alphaL = alphaLong * 1.0 / (1 &lt;&lt; 11);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordtype">float</span> qup, qdn;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  qup = (1 - lambdaL) * (1 - lambdaS);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  qdn = 1 - lambdaS * alphaL - lambdaL * (1 - alphaL);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keywordtype">float</span> kdc = qup / qdn;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordtype">float</span> ql, qs;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordflow">if</span> (baseline &lt; 0)</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    baseline = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cacf25bd83a078d5ade10a368c0ba55a76">TrapConfig::kFPNP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  ql = lambdaL * (1 - lambdaS) * alphaL;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  qs = lambdaS * (1 - lambdaL) * (1 - alphaL);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> adc = 0; adc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); adc++) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a> = baseline &amp; 0xFFF;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordtype">int</span> corr = (value * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701c">TrapConfig::TrapReg_t</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cae0519f54d493015c6b2174c514e98cea">TrapConfig::kFGF0</a> + adc), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)) &gt;&gt; 11;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    corr = corr &gt; 0xfff ? 0xfff : corr;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    corr = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">addUintClipping</a>(corr, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701c">TrapConfig::TrapReg_t</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3d5ce4e5e5690c78fe97cbdcae17418d">TrapConfig::kFGA0</a> + adc), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>), 12);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordtype">float</span> kt = kdc * baseline;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> aout = baseline - (<span class="keywordtype">unsigned</span> <a class="code" href="../../dc/d10/classshort.html">short</a>)kt;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplLong = (<span class="keywordtype">unsigned</span> <a class="code" href="../../dc/d10/classshort.html">short</a>)(aout * ql / (ql + qs));</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplShort = (<span class="keywordtype">unsigned</span> <a class="code" href="../../dc/d10/classshort.html">short</a>)(aout * qs / (ql + qs));</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  }</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;}</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8f3a3fdb5260c675584a5fae1401f3e7">TrapSimulator::filterTailNextSample</a>(<span class="keywordtype">int</span> adc, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a>)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;{</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">// Returns the output of the tail filter for the given input value.</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="comment">// The output depends on the internal registers and, thus, the</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="comment">// history of the filter.</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">// exponents and weight calculated from configuration</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> alphaLong = 0x3ff &amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca1b5e518651b7c80595565500bbb840ab">TrapConfig::kFTAL</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);                            <span class="comment">// the weight of the long component</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lambdaLong = (1 &lt;&lt; 10) | (1 &lt;&lt; 9) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca9447f8cd1926f2cb5c2d48a66e24f7ef">TrapConfig::kFTLL</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp; 0x1FF);  <span class="comment">// the multiplier of the long component</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lambdaShort = (0 &lt;&lt; 10) | (1 &lt;&lt; 9) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caeaae9cf6d3f38913266f574fb6a29a1a">TrapConfig::kFTLS</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp; 0x1FF); <span class="comment">// the multiplier of the short component</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="comment">// intermediate signals</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> aDiff;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> alInpv;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> aQ;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> inpVolt = value &amp; 0xFFF; <span class="comment">// 12 bits</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="comment">// add the present generator outputs</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  aQ = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">addUintClipping</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplLong, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplShort, 12);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">// calculate the difference between the input and the generated signal</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordflow">if</span> (inpVolt &gt; aQ)</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    aDiff = inpVolt - aQ;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    aDiff = 0;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="comment">// the inputs to the two generators, weighted</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  alInpv = (aDiff * alphaLong) &gt;&gt; 11;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="comment">// the new values of the registers, used next time</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="comment">// long component</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  tmp = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">addUintClipping</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplLong, alInpv, 12);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  tmp = (tmp * lambdaLong) &gt;&gt; 11;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplLong = tmp &amp; 0xFFF;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="comment">// short component</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  tmp = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">addUintClipping</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplShort, aDiff - alInpv, 12);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  tmp = (tmp * lambdaShort) &gt;&gt; 11;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">mInternalFilterRegisters</a>[adc].mTailAmplShort = tmp &amp; 0xFFF;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="comment">// the output of the filter</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca012d413eed496a374564b79f45c3758c">TrapConfig::kFTBY</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) == 0) <span class="comment">// bypass mode, active low</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">return</span> value;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">return</span> aDiff;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;}</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e6eb448ada40e689e83ff5780f70eb0">TrapSimulator::filterTail</a>()</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;{</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="comment">// Apply tail cancellation filter to all data.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimeBin = 0; iTimeBin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; iTimeBin++) {</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++) {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + iTimeBin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8f3a3fdb5260c675584a5fae1401f3e7">filterTailNextSample</a>(iAdc, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + iTimeBin]);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;}</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b97ce24f11538c45b895385fb3eebc7">TrapSimulator::zeroSupressionMapping</a>()</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;{</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// Zero Suppression Mapping implemented in TRAP chip</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">// only implemented for up to 30 timebins</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">// See detail TRAP manual &quot;Data Indication&quot; section:</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">// http://www.kip.uni-heidelberg.de/ti/TRD/doc/trap/TRAP-UserManual.pdf</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">checkInitialized</a>())</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="keywordtype">int</span> eBIS = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca356ea49ce887ba20538e93d27c502220">TrapConfig::kEBIS</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordtype">int</span> eBIT = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca7deacfee172519d6db9ea5de268ce963">TrapConfig::kEBIT</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordtype">int</span> eBIL = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca54e4f503b6cbdcb8f69fcf18a4b57ae8">TrapConfig::kEBIL</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordtype">int</span> eBIN = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca45811b3142d540e70f4aed144773b44f">TrapConfig::kEBIN</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc] = -1;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> it = 0; it &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>; it++) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordtype">int</span> iAdc; <span class="comment">// current ADC channel</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordtype">int</span> ap;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordtype">int</span> ac;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordtype">int</span> an;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">int</span> supp; <span class="comment">// suppression of the current channel (low active)</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="comment">// ----- first channel -----</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    iAdc = 0;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    ap = 0 &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;                                  <span class="comment">// previous</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    ac = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + it] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;       <span class="comment">// current</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    an = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[(iAdc + 1) * mNTimeBin + it] &gt;&gt; mgkAddDigits; <span class="comment">// next</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    mask = (ac &gt;= ap &amp;&amp; ac &gt;= an) ? 0 : 0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a>; <span class="comment">// peak center detection</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    mask += (ap + ac + an &gt; eBIT) ? 0 : 0<a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a0430deee85a5676223120d355c147f0e">x2</a>; <span class="comment">// cluster</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    mask += (ac &gt; eBIS) ? 0 : 0x4;           <span class="comment">// absolute large peak</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    supp = (eBIL &gt;&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>) &amp; 1;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordflow">if</span> (eBIN == 0) { <span class="comment">// neighbour sensitivity</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc + 1] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    }</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">// ----- last channel -----</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    iAdc = <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>() - 1;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    ap = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[(iAdc - 1) * mNTimeBin + it] &gt;&gt; mgkAddDigits; <span class="comment">// previous</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    ac = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + it] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;       <span class="comment">// current</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    an = 0 &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;                                  <span class="comment">// next</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    mask = (ac &gt;= ap &amp;&amp; ac &gt;= an) ? 0 : 0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a>; <span class="comment">// peak center detection</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    mask += (ap + ac + an &gt; eBIT) ? 0 : 0<a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a0430deee85a5676223120d355c147f0e">x2</a>; <span class="comment">// cluster</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    mask += (ac &gt; eBIS) ? 0 : 0x4;           <span class="comment">// absolute large peak</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    supp = (eBIL &gt;&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>) &amp; 1;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">if</span> (eBIN == 0) { <span class="comment">// neighbour sensitivity</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc - 1] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    }</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="comment">// ----- middle channels -----</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keywordflow">for</span> (iAdc = 1; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>() - 1; iAdc++) {</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      ap = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[(iAdc - 1) * mNTimeBin + it] &gt;&gt; mgkAddDigits; <span class="comment">// previous</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      ac = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[iAdc * mNTimeBin + it] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>;       <span class="comment">// current</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      an = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[(iAdc + 1) * mNTimeBin + it] &gt;&gt; mgkAddDigits; <span class="comment">// next</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      mask = (ac &gt;= ap &amp;&amp; ac &gt;= an) ? 0 : 0<a class="code" href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a>; <span class="comment">// peak center detection</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      mask += (ap + ac + an &gt; eBIT) ? 0 : 0<a class="code" href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a0430deee85a5676223120d355c147f0e">x2</a>; <span class="comment">// cluster</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      mask += (ac &gt; eBIS) ? 0 : 0x4;           <span class="comment">// absolute large peak</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      supp = (eBIL &gt;&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a>) &amp; 1;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <span class="keywordflow">if</span> (eBIN == 0) { <span class="comment">// neighbour sensitivity</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc - 1] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">mZSMap</a>[iAdc + 1] &amp;= ~((1 - supp) &lt;&lt; it);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      }</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    }</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;}</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af0ff6fee86376f75515470a9c5b07a63">TrapSimulator::addHitToFitreg</a>(<span class="keywordtype">int</span> adc, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> timebin, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> qtot, <span class="keywordtype">short</span> ypos)</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;{</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <span class="comment">// Add the given hit to the fit register which will be used for</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="comment">// the tracklet calculation.</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="comment">// In addition to the fit sums in the fit register</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordflow">if</span> (adc &gt; 24)</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot; adc channel into addHitToFitReg is out of bounds for mFitReg : &quot;</span> &lt;&lt; adc;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="comment">//  LOG(debug2) &lt;&lt; &quot;ENTER: &quot; &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __func__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot; with mNHits = &quot; &lt;&lt; mNHits;</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordflow">if</span> ((timebin &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3f04bd3c6bdf030633f83a46333c7e05">TrapConfig::kTPQS0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)) &amp;&amp;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      (timebin &lt; mTrapConfig-&gt;getTrapReg(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca86bcf58808f5d5dd9615e5dfe112182f">TrapConfig::kTPQE0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)))</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mQ0 += qtot;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="keywordflow">if</span> ((timebin &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca72add304532b133e6232b7f5c8cd0cca">TrapConfig::kTPQS1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)) &amp;&amp;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      (timebin &lt; mTrapConfig-&gt;getTrapReg(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee489b298564fdb8b6752993076cd665">TrapConfig::kTPQE1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)))</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mQ1 += qtot;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="keywordflow">if</span> ((timebin &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca495215e5e729091082c9e718f5c5412d">TrapConfig::kTPFS</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)) &amp;&amp;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      (timebin &lt; mTrapConfig-&gt;getTrapReg(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee5d08b4a157f43a48a3c3b8d3627ae6">TrapConfig::kTPFE</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>))) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mSumX += timebin;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mSumX2 += timebin * timebin;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mNhits++;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mSumY += ypos;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mSumY2 += ypos * ypos;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adc].mSumXY += timebin * ypos;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="comment">//    LOG(debug) &lt;&lt; &quot;fitreg[&quot; &lt;&lt; adc &lt;&lt; &quot;] in timebin &quot; &lt;&lt; timebin &lt;&lt; &quot;: X=&quot; &lt;&lt; mFitReg[adc].mSumX</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="comment">//             &lt;&lt; &quot;, X2=&quot; &lt;&lt; mFitReg[adc].mSumX2 &lt;&lt; &quot;, N=&quot; &lt;&lt; mFitReg[adc].mNhits &lt;&lt; &quot;, Y=&quot;</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="comment">//           &lt;&lt; mFitReg[adc].mSumY &lt;&lt; &quot;, Y2=&quot; &lt;&lt; mFitReg[adc].mSumY2 &lt;&lt; &quot;, XY=&quot; &lt;&lt; mFitReg[adc].mSumXY</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">//         &lt;&lt; &quot;, Q0=&quot; &lt;&lt; mFitReg[adc].mQ0 &lt;&lt; &quot;, Q1=&quot; &lt;&lt; mFitReg[adc].mQ1;</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  }</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="comment">// register hits (MC info)</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a> &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7ca6fe4a66339e590d39198f8ed86886">mgkNHitsMC</a>) {</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>].mChannel = adc;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>].mQtot = qtot;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>].mYpos = ypos;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>].mTimebin = timebin;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="comment">//TODO link to the labels.</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>++;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="comment">//.emplace_back(adc, timebin, qtot, ypos); // TODO add label indexes into the labels container for all those labels pertaining to this hit.</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  }</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="comment">//  else{</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="comment">//      LOG(warn) &lt;&lt; &quot;no space left to store the MC information for the hit &gt;100&quot;;</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="comment">//  }</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">//  LOG(debug) &lt;&lt; &quot;added hit of : &quot;&lt;&lt;  adc&lt;&lt;&quot;:&quot;&lt;&lt; qtot&lt;&lt;&quot;:&quot;&lt;&lt; ypos&lt;&lt;&quot;:&quot;&lt;&lt; timebin; // TODO add label indexes into the labels container for all those labels pertaining to this hit.</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;}</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a90fd4c3132f561b25189db314f961f8e">TrapSimulator::calcFitreg</a>()</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;{</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="comment">// Preprocessing.</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="comment">// Detect the hits and fill the fit registers.</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="comment">// Requires 12-bit data from mADCF which means Filter()</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="comment">// has to be called before even if all filters are bypassed.</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">//??? to be clarified:</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="comment">//    LOG(debug) &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __func__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__;</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> adcMask = 0xffffffff;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordtype">bool</span> hitQual;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordtype">int</span> adcLeft, adcCentral, adcRight;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> timebin, adcch, timebin1, timebin2, qtotTemp;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  Short_t ypos, fromLeft, fromRight, found;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  std::array&lt;unsigned short, 20&gt; qTotal{}; <span class="comment">//[19 + 1]; // the last is dummy</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  std::array&lt;unsigned short, 6&gt; marked{}, qMarked{};</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> worse1, worse2;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keywordtype">int</span> debugstop = 1;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordflow">if</span> (mgStoreClusters) {</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    timebin1 = 0;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    timebin2 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a>;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="comment">// find first timebin to be looked at</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    timebin1 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca495215e5e729091082c9e718f5c5412d">TrapConfig::kTPFS</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3f04bd3c6bdf030633f83a46333c7e05">TrapConfig::kTPQS0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &lt; timebin1)</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      timebin1 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3f04bd3c6bdf030633f83a46333c7e05">TrapConfig::kTPQS0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca72add304532b133e6232b7f5c8cd0cca">TrapConfig::kTPQS1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &lt; timebin1)</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      timebin1 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca72add304532b133e6232b7f5c8cd0cca">TrapConfig::kTPQS1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="comment">// find last timebin to be looked at</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    timebin2 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee5d08b4a157f43a48a3c3b8d3627ae6">TrapConfig::kTPFE</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca86bcf58808f5d5dd9615e5dfe112182f">TrapConfig::kTPQE0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &gt; timebin2)</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      timebin2 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca86bcf58808f5d5dd9615e5dfe112182f">TrapConfig::kTPQE0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee489b298564fdb8b6752993076cd665">TrapConfig::kTPQE1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &gt; timebin2)</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      timebin2 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee489b298564fdb8b6752993076cd665">TrapConfig::kTPQE1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  }</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="comment">// reset the fit registers</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; fitreg : <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>)</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    fitreg.ClearReg();</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="comment">//  mFitReg.clear();</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].ClearHits(); <span class="comment">// do it this way as we dont want to 100 members if we only used 3 ....</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                          <span class="comment">//  for (int i=0;i&lt;mNHits;i++) LOG(info) &lt;&lt; &quot;mHits.[&quot;&lt;&lt;i &lt;&lt; &quot;].mTimebin=&quot;&lt;&lt; mHits[i].mTimebin;</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="keywordflow">for</span> (timebin = timebin1; timebin &lt; timebin2; timebin++) {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="comment">// first find the hit candidates and store the total cluster charge in qTotal array</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="comment">// in case of not hit store 0 there.</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">for</span> (adcch = 0; adcch &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>() - 2; adcch++) {</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keywordflow">if</span> (((adcMask &gt;&gt; adcch) &amp; 7) == 7) <span class="comment">//??? all 3 channels are present in case of ZS</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      {</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        adcLeft = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[adcch * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> + timebin];</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        adcCentral = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[(adcch + 1) * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> + timebin];</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        adcRight = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">mADCF</a>[(adcch + 2) * <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">mNTimeBin</a> + timebin];</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cab16bdda7b4e327d48567857d0ca885dd">TrapConfig::kTPVBY</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) == 0) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;          <span class="comment">// bypass the cluster verification</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;          hitQual = <span class="keyword">true</span>;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;          hitQual = ((adcLeft * adcRight) &lt;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                     ((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca02fc8d6dedc250bdddb91bd0a489ab11">TrapConfig::kTPVT</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) * adcCentral * adcCentral) &gt;&gt; 10));</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;          <span class="comment">// TODO PUT THIS BACK !       if (hitQual)</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;          <span class="comment">//          LOG(debug) &lt;&lt; &quot;cluster quality cut passed with &quot; &lt;&lt; adcLeft &lt;&lt; &quot;, &quot; &lt;&lt; adcCentral &lt;&lt; &quot;, &quot;</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          <span class="comment">//                    &lt;&lt; adcRight &lt;&lt; &quot; - threshold &quot; &lt;&lt; mTrapConfig-&gt;getTrapReg(TrapConfig::kTPVT, mDetector, mRobPos, mMcmPos)</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;          <span class="comment">//                  &lt;&lt; &quot; -&gt; &quot; &lt;&lt; mTrapConfig-&gt;getTrapReg(TrapConfig::kTPVT, mDetector, mRobPos, mMcmPos) * adcCentral * adcCentral;</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="comment">// The accumulated charge is with the pedestal!!!</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        qtotTemp = adcLeft + adcCentral + adcRight;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <span class="comment">/*  if ((mDebugStream) &amp;&amp; (qtotTemp &gt; 130)) {</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">    (*mDebugStream) &lt;&lt; &quot;testtree&quot;</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">        &lt;&lt; &quot;qtot=&quot; &lt;&lt; qtotTemp</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">        &lt;&lt; &quot;qleft=&quot; &lt;&lt; adcLeft</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">        &lt;&lt; &quot;qcent=&quot; &lt;&lt; adcCentral</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">        &lt;&lt; &quot;qright=&quot; &lt;&lt; adcRight</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">        &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">  } TODO figure out another way for a debugstream not using TTreeSRedirector, check what that class actually does .... */</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="comment">//TODO for now simply log it to LOG system can parse and dump to a tree if</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="comment">//TODO if i really want later.</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">if</span> ((qtotTemp &gt; 130)) {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;testtree &quot;</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;qtot=&quot;</span> &lt;&lt; qtotTemp</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; qleft=&quot;</span> &lt;&lt; adcLeft</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; qcent=&quot;</span> &lt;&lt; adcCentral</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; qright=&quot;</span> &lt;&lt; adcRight;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        }</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordflow">if</span> ((hitQual) &amp;&amp;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            (qtotTemp &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cac8beefe5f589dd2fa7330e3f09b85ddb">TrapConfig::kTPHT</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)) &amp;&amp;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            (adcLeft &lt;= adcCentral) &amp;&amp;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            (adcCentral &gt; adcRight)) {</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;          qTotal[adcch] = qtotTemp;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;          qTotal[adcch] = 0;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        qTotal[adcch] = 0; <span class="comment">//jkl</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      }</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="comment">//   if (qTotal[adcch] != 0)</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="comment">//    LOG(debug) &lt;&lt; &quot;ch &quot; &lt;&lt; setw(2) &lt;&lt; adcch &lt;&lt; &quot;   qTotal &quot; &lt;&lt; qTotal[adcch];</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    }</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    fromLeft = -1;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    adcch = 0;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    found = 0;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    marked[4] = 19; <span class="comment">// invalid channel</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    marked[5] = 19; <span class="comment">// invalid channel</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    qTotal[19] = 0;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordtype">int</span> loopcount = 0;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">while</span> ((adcch &lt; 16) &amp;&amp; (found &lt; 3)) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">if</span> (qTotal[adcch] &gt; 0) {</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        fromLeft = adcch;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        marked[2 * found + 1] = adcch;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        found++;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      }</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      adcch++;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    }</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    fromRight = -1;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    adcch = 18;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    found = 0;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordflow">while</span> ((adcch &gt; 2) &amp;&amp; (found &lt; 3)) {</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="keywordflow">if</span> (qTotal[adcch] &gt; 0) {</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        marked[2 * found] = adcch;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        found++;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        fromRight = adcch;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      }</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      adcch--;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    }</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="comment">// here mask the hit candidates in the middle, if any</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="keywordflow">if</span> ((fromLeft &gt;= 0) &amp;&amp; (fromRight &gt;= 0) &amp;&amp; (fromLeft &lt; fromRight)) {</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <span class="keywordflow">for</span> (adcch = fromLeft + 1; adcch &lt; fromRight; adcch++) {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        qTotal[adcch] = 0;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    }</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    found = 0;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordflow">for</span> (adcch = 0; adcch &lt; 19; adcch++) {</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="keywordflow">if</span> (qTotal[adcch] &gt; 0) {</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        found++;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        <span class="comment">// NOT READY</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">if</span> (found &gt; 4) <span class="comment">// sorting like in the TRAP in case of 5 or 6 candidates!</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    {</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">if</span> (marked[4] == marked[5])</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        marked[5] = 19;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <span class="keywordflow">for</span> (found = 0; found &lt; 6; found++) {</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        qMarked[found] = qTotal[marked[found]] &gt;&gt; 4;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7030620118b7ca9c704055b98548fd9e">sort6To2Worst</a>(marked[0], marked[3], marked[4], marked[1], marked[2], marked[5],</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                    qMarked[0],</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                    qMarked[3],</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                    qMarked[4],</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                    qMarked[1],</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                    qMarked[2],</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                    qMarked[5],</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                    &amp;worse1, &amp;worse2);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <span class="comment">// Now mask the two channels with the smallest charge</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <span class="keywordflow">if</span> (worse1 &lt; 19) {</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        qTotal[worse1] = 0;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <span class="comment">//LOG(debug3) &lt;&lt; &quot;Kill ch &quot; &lt;&lt; worse1;</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      }</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      <span class="keywordflow">if</span> (worse2 &lt; 19) {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        qTotal[worse2] = 0;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        <span class="comment">// LOG(debug3) &lt;&lt; &quot;Kill ch &quot; &lt;&lt; worse2;</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      }</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    }</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">for</span> (adcch = 0; adcch &lt; 19; adcch++) {</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <span class="keywordflow">if</span> (qTotal[adcch] &gt; 0) <span class="comment">// the channel is marked for processing</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      {</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        adcLeft = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(adcch, timebin);</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        adcCentral = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(adcch + 1, timebin);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        adcRight = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">getDataFiltered</a>(adcch + 2, timebin);</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="comment">// hit detected, in TRAP we have 4 units and a hit-selection, here we proceed all channels!</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <span class="comment">// subtract the pedestal TPFP, clipping instead of wrapping</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordtype">int</span> regTPFP = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cad658f0fea9a2d6b2e16f889a1a9b3b91">TrapConfig::kTPFP</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">//TODO put this together with the others as members of trapsim, which is initiliased by det,rob,mcm.</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <span class="comment">//LOG(debug) &lt;&lt; &quot;Hit found, time=&quot; &lt;&lt; timebin &lt;&lt; &quot;, adcch=&quot; &lt;&lt; adcch &lt;&lt; &quot;/&quot; &lt;&lt; adcch + 1 &lt;&lt; &quot;/&quot;</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="comment">//         &lt;&lt; adcch + 2 &lt;&lt; &quot;, adc values=&quot; &lt;&lt; adcLeft &lt;&lt; &quot;/&quot; &lt;&lt; adcCentral &lt;&lt; &quot;/&quot;</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="comment">//       &lt;&lt; adcRight &lt;&lt; &quot;, regTPFP=&quot; &lt;&lt; regTPFP &lt;&lt; &quot;, TPHT=&quot; &lt;&lt; mTrapConfig-&gt;getTrapReg(TrapConfig::kTPHT, mDetector, mRobPos, mMcmPos);</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        <span class="keywordflow">if</span> (timebin == 19 &amp;&amp; adcch == 8 &amp;&amp; adcLeft == 0 &amp;&amp; adcCentral == 107 &amp;&amp; adcRight == 89 &amp;&amp; regTPFP == 40) {</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;          <span class="comment">//LOG(info) &lt;&lt; &quot;I think about to crash&quot;;</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;          <span class="comment">//while(debugstop){</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;          <span class="comment">//   //LOG(info) &lt;&lt; &quot;debug stopped&quot;;</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;          <span class="comment">// }</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        }</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="keywordflow">if</span> (adcLeft &lt; regTPFP)</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;          adcLeft = 0;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;          adcLeft -= regTPFP;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        <span class="keywordflow">if</span> (adcCentral &lt; regTPFP)</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;          adcCentral = 0;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;          adcCentral -= regTPFP;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="keywordflow">if</span> (adcRight &lt; regTPFP)</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;          adcRight = 0;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;          adcRight -= regTPFP;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        <span class="comment">// Calculate the center of gravity</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <span class="comment">// checking for adcCentral != 0 (in case of &quot;bad&quot; configuration)</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <span class="keywordflow">if</span> (adcCentral == 0)</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        ypos = 128 * (adcRight - adcLeft) / adcCentral;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        <span class="keywordflow">if</span> (ypos &lt; 0)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;          ypos = -ypos;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="comment">// make the correction using the position LUT</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        ypos = ypos + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>((<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701c">TrapConfig::TrapReg_t</a>)(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca9d4175b77bf786f20feafa8f70b3f1b1">TrapConfig::kTPL00</a> + (ypos &amp; 0x7F)),</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                                              <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <span class="keywordflow">if</span> (adcLeft &gt; adcRight)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;          ypos = -ypos;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="comment">/*   TODO this is left in here as a ref for what was done with labels, its stored externally now figure something out.</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="comment">// add the hit to the fitregister</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        <span class="comment">//      int a=qTotal[adcch] &gt;&gt; mgkAddDigits;</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        <span class="comment">// LOG(debug) &lt;&lt; &quot;calling addHitToFitreg with :&quot; &lt;&lt; adcch &lt;&lt; &quot; :: &quot; &lt;&lt; timebin &lt;&lt; &quot; :: &quot; &lt;&lt; hex &lt;&lt; qTotal[adcch] &lt;&lt; dec &lt;&lt; &quot; :: shifted bits  :&quot; &lt;&lt; 2 &lt;&lt; &quot; :: &quot; &lt;&lt; ypos;</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <span class="comment">//  addHitToFitreg(adcch, timebin, qTotal[adcch] &gt;&gt; 2, ypos);</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af0ff6fee86376f75515470a9c5b07a63">addHitToFitreg</a>(adcch, timebin, qTotal[adcch] &gt;&gt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">mgkAddDigits</a>, ypos);</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="comment">// LOG(debug) &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot; :: added hit to fit re &quot;;</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    }</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  }</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="preprocessor">#ifdef DEBUGTRAP</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iAdc = 0; iAdc &lt; <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">FeeParam::getNadcMcm</a>(); iAdc++) {</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">if</span> (mFitReg[iAdc].mNhits != 0) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;fitreg[&quot;</span> &lt;&lt; iAdc &lt;&lt; <span class="stringliteral">&quot;]: nHits = &quot;</span> &lt;&lt; mFitReg[iAdc].mNhits &lt;&lt; <span class="stringliteral">&quot;]: sumX = &quot;</span> &lt;&lt; mFitReg[iAdc].mSumX &lt;&lt; <span class="stringliteral">&quot;, sumY = &quot;</span> &lt;&lt; mFitReg[iAdc].mSumY &lt;&lt; <span class="stringliteral">&quot;, sumX2 = &quot;</span> &lt;&lt; mFitReg[iAdc].mSumX2 &lt;&lt; <span class="stringliteral">&quot;, sumY2 = &quot;</span> &lt;&lt; mFitReg[iAdc].mSumY2 &lt;&lt; <span class="stringliteral">&quot;, sumXY = &quot;</span> &lt;&lt; mFitReg[iAdc].mSumXY;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    }</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  }</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;}</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5fd7decd6730743576be4e44d52e79c2">TrapSimulator::trackletSelection</a>()</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;{</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <span class="comment">// Select up to 4 tracklet candidates from the fit registers</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="comment">// and assign them to the CPUs.</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> adcIdx, <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, ntracks, tmp;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  std::array&lt;unsigned short, 18&gt; trackletCandch{};   <span class="comment">// store the adcch[0] and number of hits[1] for all tracklet candidates</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  std::array&lt;unsigned short, 18&gt; trackletCandhits{}; <span class="comment">// store the adcch[0] and number of hits[1] for all tracklet candidates</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  ntracks = 0;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="keywordflow">for</span> (adcIdx = 0; adcIdx &lt; 18; adcIdx++) { <span class="comment">// ADCs</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcIdx].mNhits &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3ce1407037f27d59c8b8836f4899586c">TrapConfig::kTPCL</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>)) &amp;&amp;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcIdx].mNhits + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcIdx + 1].mNhits &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca8f7106608732b4e015ed09fd700033e3">TrapConfig::kTPCT</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>))) {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      trackletCandch[ntracks] = adcIdx;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      trackletCandhits[ntracks] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcIdx].mNhits + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[adcIdx + 1].mNhits;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; ntracks &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; trackletCandch[ntracks] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; trackletCandhits[ntracks];</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      ntracks++;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    };</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  }</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ntracks; i++)</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;TRACKS: &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; trackletCandch[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; trackletCandhits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordflow">if</span> (ntracks &gt; 4) {</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="comment">// primitive sorting according to the number of hits</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; (ntracks - 1); j++) {</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      <span class="keywordflow">for</span> (i = j + 1; i &lt; ntracks; i++) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="keywordflow">if</span> ((trackletCandhits[j] &lt; trackletCandhits[i]) ||</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            ((trackletCandhits[j] == trackletCandhits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) &amp;&amp; (trackletCandch[j] &lt; trackletCandch[i]))) {</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;          <span class="comment">// swap j &amp; i</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;          tmp = trackletCandhits[j];</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;          trackletCandhits[j] = trackletCandhits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;          trackletCandhits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;          tmp = trackletCandch[j];</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;          trackletCandch[j] = trackletCandch[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;          trackletCandch[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        }</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      }</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    ntracks = 4; <span class="comment">// cut the rest, 4 is the max</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="comment">// else is not necessary to sort</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  <span class="comment">// now sort, so that the first tracklet going to CPU0 corresponds to the highest adc channel - as in the TRAP</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; (ntracks - 1); j++) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keywordflow">for</span> (i = j + 1; i &lt; ntracks; i++) {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <span class="keywordflow">if</span> (trackletCandch[j] &lt; trackletCandch[i]) {</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="comment">// swap j &amp; i</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        tmp = trackletCandhits[j];</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        trackletCandhits[j] = trackletCandhits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        trackletCandhits[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        tmp = trackletCandch[j];</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        trackletCandch[j] = trackletCandch[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        trackletCandch[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      }</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    }</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  }</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ntracks; i++)     <span class="comment">// CPUs with tracklets.</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[i] = trackletCandch[i]; <span class="comment">// pointer to the left channel with tracklet for CPU[i]</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="keywordflow">for</span> (i = ntracks; i &lt; 4; i++)     <span class="comment">// CPUs without tracklets</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[i] = 31;                <span class="comment">// pointer to the left channel with tracklet for CPU[i] = 31 (invalid)</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="comment">//LOG(debug3) &lt;&lt; &quot;-------------------------------------------- found &quot; &lt;&lt; ntracks &lt;&lt; &quot; tracklet candidates&quot;;</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  <span class="comment">//for (i = 0; i &lt; 4; i++)</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="comment">// LOG(debug3) &lt;&lt; &quot;fitPtr[&quot; &lt;&lt; i &lt;&lt; &quot;]: &quot; &lt;&lt; mFitPtr[i];</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="comment">// reject multiple tracklets</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#abb8653b0c3c43e7433053b128b4c0933">FeeParam::instance</a>()-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#afc61b4b644b5b4baeb94e98ef2401540">getRejectMultipleTracklets</a>()) {</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> counts = 0;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; (ntracks - 1); j++) {</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[j] == 31)</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <span class="keywordflow">for</span> (i = j + 1; i &lt; ntracks; i++) {</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="comment">// check if tracklets are from neighbouring ADC channels</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[j] - <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[i]) &gt; 1.)</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        <span class="comment">// check which tracklet candidate has higher amount of hits</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[j]].mNhits + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[j] + 1].mNhits) &gt;=</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]].mNhits + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] + 1].mNhits)) {</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 31;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;          counts++;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[j] = 31;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;          counts++;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        }</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      }</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    }</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="comment">/* ntracks = ntracks - counts;</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">    LOG(debug1) &lt;&lt; &quot;found &quot; &lt;&lt; ntracks &lt;&lt; &quot; tracklet candidates&quot;;</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">    for (i = 0; i &lt; 4; i++)</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">      LOG(debug1) &lt;&lt; &quot;fitPtr[&quot; &lt;&lt; i &lt;&lt; &quot;]: &quot; &lt;&lt; mFitPtr[i];</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  }</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;}</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aa87c46ea633f2c6add8082a2bec9c6ce">TrapSimulator::fitTracklet</a>()</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;{</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="comment">// Perform the actual tracklet fit based on the fit sums</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="comment">// which have been filled in the fit registers.</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="comment">//  LOG(debug) &lt;&lt; &quot;$$$$$$$$$$$$$@@@@@@@@@@@@@$$$$$$$$$$$$$$$$$$  Tracklet array size is : &quot; &lt;&lt; mTrackletArray.size();</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="comment">// parameters in fitred.asm (fit program)</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordtype">int</span> rndAdd = 0;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordtype">int</span> decPlaces = 5; <span class="comment">// must be larger than 1 or change the following code</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                     <span class="comment">// if (decPlaces &gt;  1)</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  rndAdd = (1 &lt;&lt; (decPlaces - 1)) + 1;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <span class="comment">// else if (decPlaces == 1)</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="comment">//   rndAdd = 1;</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="keywordtype">int</span> ndriftDp = 5; <span class="comment">// decimal places for drift time</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordtype">long</span> shift = ((long)1 &lt;&lt; 32);</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="comment">// calculated in fitred.asm</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="keywordtype">int</span> padrow = ((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &gt;&gt; 1) &lt;&lt; 2) | (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &gt;&gt; 2);</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordtype">int</span> yoffs = (((((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> &amp; 0x1) &lt;&lt; 2) + (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a> &amp; 0x3)) * 18) &lt;&lt; 8) -</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;              ((18 * 4 * 2 - 18 * 2 - 1) &lt;&lt; 7);</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <span class="comment">// add corrections for mis-alignment</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#abb8653b0c3c43e7433053b128b4c0933">FeeParam::instance</a>()-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#add9e13ded6462237db03656e71f0e5db">getUseMisalignCorr</a>()) {</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;using mis-alignment correction&quot;</span>;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    yoffs += (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5f3ec19dcfd027add6862beb5e66bed8">mgkDmemAddrYcorr</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  }</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  yoffs = yoffs &lt;&lt; decPlaces; <span class="comment">// holds position of ADC channel 1</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a> = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> % 6;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> scaleY = (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)((0.635 + 0.03 * layer) / (256.0 * 160.0e-4) * shift);</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> scaleD = (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)((0.635 + 0.03 * layer) / (256.0 * 140.0e-4) * shift);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="keywordtype">int</span> deflCorr = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0497f74b1d0eff1f1c1ca1653b10ff49">mgkDmemAddrDeflCorr</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="keywordtype">int</span> ndrift = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a87a1572c8fb96b7c90a08122511cd581">mgkDmemAddrNdrift</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="comment">// local variables for calculation</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordtype">long</span> mult, temp, denom;       <span class="comment">//???</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q0, q1, pid;     <span class="comment">// charges in the two windows and total charge</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nHits;         <span class="comment">// number of hits</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="keywordtype">int</span> slope, <a class="code" href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a>;            <span class="comment">// slope and offset of the tracklet</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="keywordtype">int</span> sumX, sumY, sumXY, sumX2; <span class="comment">// fit sums from fit registers</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="keywordtype">int</span> sumY2;                    <span class="comment">// not used in the current TRAP program, now used for error calculation (simulation only)</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordtype">float</span> fitError, fitSlope, fitOffset;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html">FitReg</a> *fit0, *fit1; <span class="comment">// pointers to relevant fit registers</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="comment">//  const uint32_t OneDivN[32] = {  // 2**31/N : exactly like in the TRAP, the simple division here gives the same result!</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="comment">//      0x00000000, 0x80000000, 0x40000000, 0x2AAAAAA0, 0x20000000, 0x19999990, 0x15555550, 0x12492490,</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="comment">//      0x10000000, 0x0E38E380, 0x0CCCCCC0, 0x0BA2E8B0, 0x0AAAAAA0, 0x09D89D80, 0x09249240, 0x08888880,</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="comment">//      0x08000000, 0x07878780, 0x071C71C0, 0x06BCA1A0, 0x06666660, 0x06186180, 0x05D17450, 0x0590B210,</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="comment">//      0x05555550, 0x051EB850, 0x04EC4EC0, 0x04BDA120, 0x04924920, 0x0469EE50, 0x04444440, 0x04210840};</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cpu = 0; cpu &lt; 4; cpu++) {</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[cpu] == 31) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] = 0x10001000; <span class="comment">//??? FeeParam::getTrackletEndmarker();</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      fit0 = &amp;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">mFitPtr</a>[cpu]];</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      fit1 = &amp;<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">mFitReg</a>[mFitPtr[cpu] + 1]; <span class="comment">// next channel</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      mult = 1;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      mult = mult &lt;&lt; (32 + decPlaces);</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      mult = -mult;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      <span class="comment">// time offset for fit sums</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#abf0ea7853561a9028dbbc4caeb2f8ff1">t0</a> = <a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#abb8653b0c3c43e7433053b128b4c0933">FeeParam::instance</a>()-&gt;<a class="code" href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a0b58570cf6bf26d4c64d2593b5e1601c">getUseTimeOffset</a>() ? (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5079972ea1b0ff93d546b0fe39315db9">mgkDmemAddrTimeOffset</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) : 0;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="comment">//    LOG(debug3) &lt;&lt; &quot;using time offset t0 = &quot; &lt;&lt; t0;</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <span class="comment">// Merging</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      nHits = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">mNhits</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">mNhits</a>; <span class="comment">// number of hits</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      sumX = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8b3a97090773c215d7278723767e4e6b">mSumX</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8b3a97090773c215d7278723767e4e6b">mSumX</a>;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      sumX2 = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8503e83705e9311282ee0d8125a743a0">mSumX2</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8503e83705e9311282ee0d8125a743a0">mSumX2</a>;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      denom = ((long)nHits) * ((long)sumX2) - ((long)sumX) * ((long)sumX);</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      mult = mult / denom; <span class="comment">// exactly like in the TRAP program</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      q0 = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a519dd2b96961f400b72c87f0d784b2e5">mQ0</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a519dd2b96961f400b72c87f0d784b2e5">mQ0</a>;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      q1 = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a7eae8677ceb45b6c68ca3ef9106bdbf0">mQ1</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a7eae8677ceb45b6c68ca3ef9106bdbf0">mQ1</a>;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      sumY = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a4e56a3ece8190626f36a2ca7497fe265">mSumY</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a4e56a3ece8190626f36a2ca7497fe265">mSumY</a> + 256 * fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">mNhits</a>;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      sumXY = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a6a4647b28917f5f644492fed89a60081">mSumXY</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a6a4647b28917f5f644492fed89a60081">mSumXY</a> + 256 * fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8b3a97090773c215d7278723767e4e6b">mSumX</a>;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      sumY2 = fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a2ae4d3233a386c3103a93dcf253032bd">mSumY2</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a2ae4d3233a386c3103a93dcf253032bd">mSumY2</a> + 512 * fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a4e56a3ece8190626f36a2ca7497fe265">mSumY</a> + 256 * 256 * fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">mNhits</a>;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      slope = nHits * sumXY - sumX * sumY;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      <span class="comment">//offset  = sumX2*sumY  - sumX*sumXY - t0 * sumX*sumY + t0 * nHits*sumXY;</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;      offset = sumX2 * sumY - sumX * sumXY;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      offset = offset &lt;&lt; 5;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      offset += t0 * nHits * sumXY - t0 * sumX * sumY;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      offset = offset &gt;&gt; 5;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      temp = mult * slope;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      slope = temp &gt;&gt; 32; <span class="comment">// take the upper 32 bits</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      slope = -slope;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      temp = mult * <a class="code" href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a>;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      offset = temp &gt;&gt; 32; <span class="comment">// take the upper 32 bits</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      offset = offset + yoffs;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      <span class="comment">//     LOG(debug3) &lt;&lt; &quot;slope = &quot; &lt;&lt; slope &lt;&lt; &quot;, slope * ndrift = &quot; &lt;&lt; slope * ndrift &lt;&lt; &quot;, deflCorr: &quot; &lt;&lt; deflCorr;</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      slope = ((slope * ndrift) &gt;&gt; ndriftDp) + deflCorr;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      offset = offset - (mFitPtr[cpu] &lt;&lt; (8 + decPlaces));</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      temp = slope;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      temp = temp * scaleD;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      slope = (temp &gt;&gt; 32);</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      temp = <a class="code" href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a>;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      temp = temp * scaleY;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      offset = (temp &gt;&gt; 32);</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      <span class="comment">// rounding, like in the TRAP</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      slope = (slope + rndAdd) &gt;&gt; decPlaces;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      offset = (offset + rndAdd) &gt;&gt; decPlaces;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      <span class="comment">//    LOG(debug) &lt;&lt; &quot;Det: &quot; &lt;&lt; setw(3) &lt;&lt; mDetector &lt;&lt; &quot;, ROB: &quot; &lt;&lt; mRobPos &lt;&lt; &quot;, MCM: &quot; &lt;&lt; setw(2) &lt;&lt; mMcmPos &lt;&lt; setw(-1) &lt;&lt; &quot;: deflection: &quot; &lt;&lt; slope &lt;&lt; &quot;, min: &quot; &lt;&lt; (int)mTrapConfig-&gt;getDmemUnsigned(mgkDmemAddrDeflCutStart + 2 * mFitPtr[cpu], mDetector, mRobPos, mMcmPos) &lt;&lt; &quot; max : &quot; &lt;&lt; (int)mTrapConfig-&gt;getDmemUnsigned(mgkDmemAddrDeflCutStart + 1 + 2 * mFitPtr[cpu], mDetector, mRobPos, mMcmPos);</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;      <span class="comment">//     LOG(debug3) &lt;&lt; &quot;Fit sums: x = &quot; &lt;&lt; sumX &lt;&lt; &quot;, X = &quot; &lt;&lt; sumX2 &lt;&lt; &quot;, y = &quot; &lt;&lt; sumY &lt;&lt; &quot;, Y = &quot; &lt;&lt; sumY2 &lt;&lt; &quot;, Z = &quot; &lt;&lt; sumXY &lt;&lt; &quot;, q0 = &quot; &lt;&lt; q0 &lt;&lt; &quot;, q1 = &quot; &lt;&lt; q1;</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      fitSlope = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)(nHits * sumXY - sumX * sumY) / (nHits * sumX2 - sumX * sumX);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      fitOffset = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)(sumX2 * sumY - sumX * sumXY) / (nHits * sumX2 - sumX * sumX);</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      <span class="keywordtype">float</span> sx = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)sumX;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordtype">float</span> sx2 = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)sumX2;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      <span class="keywordtype">float</span> sy = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)sumY;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      <span class="keywordtype">float</span> sy2 = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)sumY2;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      <span class="keywordtype">float</span> sxy = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a>)sumXY;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      fitError = sy2 - (sx2 * sy * sy - 2 * sx * sxy * sy + nHits * sxy * sxy) / (nHits * sx2 - sx * sx);</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      <span class="comment">//fitError = (float) sumY2 - (float) (sumY*sumY) / nHits - fitSlope * ((float) (sumXY - sumX*sumY) / nHits);</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      <span class="keywordtype">bool</span> rejected = <span class="keyword">false</span>;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <span class="comment">// deflection range table from DMEM</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="keywordflow">if</span> ((slope &lt; ((<span class="keywordtype">int</span>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae6fd3c0fd1aac9322a1edb0f97155113">mgkDmemAddrDeflCutStart</a> + 2 * mFitPtr[cpu], <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>))) ||</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;          (slope &gt; ((<a class="code" href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae6fd3c0fd1aac9322a1edb0f97155113">mgkDmemAddrDeflCutStart</a> + 1 + 2 * mFitPtr[cpu], <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>))))</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        rejected = <span class="keyword">true</span>;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="comment">//   LOG(debug) &lt;&lt; &quot;slope : &quot; &lt;&lt; slope &lt;&lt; &quot; getDmemUnsigned &quot; &lt;&lt; mTrapConfig-&gt;getDmemUnsigned(mgkDmemAddrDeflCutStart + 2 * mFitPtr[cpu], mDetector, mRobPos, mMcmPos);</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordflow">if</span> (rejected &amp;&amp; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a14d929a2688bf961e86c6ca76cba7445">getApplyCut</a>()) {</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] = 0x10001000; <span class="comment">//??? FeeParam::getTrackletEndmarker();</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <span class="keywordflow">if</span> (slope &gt; 63 || slope &lt; -64) { <span class="comment">// wrapping in TRAP!</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                                         <span class="comment">//      LOG(debug) &lt;&lt; &quot;Overflow in slope: &quot; &lt;&lt; slope &lt;&lt; &quot;, tracklet discarded!&quot;;</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] = 0x10001000;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        }</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        slope = slope &amp; 0x7F; <span class="comment">// 7 bit</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <span class="keywordflow">if</span> (offset &gt; 0xfff || offset &lt; -0xfff)</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(warning) &lt;&lt; <span class="stringliteral">&quot;Overflow in offset&quot;</span>;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        offset = offset &amp; 0x1FFF; <span class="comment">// 13 bit</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        pid = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a713352e12b1e221f945df4501fdc6d0a">getPID</a>(q0, q1);</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="comment">// if (pid &gt; 0xff)</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="comment">//     LOG(warning) &lt;&lt; &quot;Overflow in PID&quot;;</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        pid = pid &amp; 0xFF; <span class="comment">// 8 bit, exactly like in the TRAP program</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        <span class="comment">// assemble and store the tracklet word</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu] = (pid &lt;&lt; 24) | (padrow &lt;&lt; 20) | (slope &lt;&lt; 13) | offset;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <span class="comment">// calculate number of hits and MC label</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        std::array&lt;int, 3&gt; mcLabel = {-1, -1, -1};</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        <span class="keywordtype">int</span> nHits0 = 0;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keywordtype">int</span> nHits1 = 0;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> maxLabels = 30;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        std::array&lt;int, 30&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a>{}; <span class="comment">// up to 30 different labels possible</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        std::array&lt;int, 30&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a31eafbeac9256b106b6acfd78f305200">count</a>{};</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        <span class="keywordtype">int</span> nLabels = 0;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>; iHit++) {</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;          <span class="keywordflow">if</span> ((<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mChannel - mFitPtr[cpu] &lt; 0) ||</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;              (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mChannel - mFitPtr[cpu] &gt; 1))</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;          <span class="comment">// counting contributing hits</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3f04bd3c6bdf030633f83a46333c7e05">TrapConfig::kTPQS0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp;&amp;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;              <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca86bcf58808f5d5dd9615e5dfe112182f">TrapConfig::kTPQE0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>))</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            nHits0++;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin &gt;= <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca72add304532b133e6232b7f5c8cd0cca">TrapConfig::kTPQS1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>) &amp;&amp;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;              <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">getTrapReg</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee489b298564fdb8b6752993076cd665">TrapConfig::kTPQE1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>))</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;            nHits1++;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;          <span class="comment">// TODO label calculation only if there is a digitsmanager to get the labels from</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        }</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>.emplace_back((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">mMCMT</a>[cpu], <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a> * 2 + <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a> % 2, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="keywordtype">int</span> newtrackposition = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>.size() - 1;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <span class="comment">//        mTrackletArray[newtrackposition].setLabel(mcLabel);</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setNHits(fit0-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">mNhits</a> + fit1-&gt;<a class="code" href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">mNhits</a>);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setNHits0(nHits0);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setNHits1(nHits1);</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setQ0(q0);</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setQ1(q1);</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setSlope(fitSlope);</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setOffset(fitOffset);</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setError(TMath::Sqrt(<a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">TMath::Abs</a>(fitError) / nHits));</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        <span class="comment">// store cluster information (if requested)</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        <span class="keywordflow">if</span> (mgStoreClusters) {</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          std::vector&lt;float&gt; res(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>());</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;          std::vector&lt;float&gt; qtot(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>());</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTimebin = 0; iTimebin &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>(); ++iTimebin) {</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            res[iTimebin] = 0;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;            qtot[iTimebin] = 0;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;          }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a>; iHit++) {</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;            <span class="keywordtype">int</span> timebin = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mTimebin;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            <span class="comment">// check if hit contributes</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mChannel == mFitPtr[cpu]) {</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;              <span class="comment">//  for (int i=0;i&lt;mNHits;i++) LOG(info) &lt;&lt; &quot;mHits.[&quot;&lt;&lt;i &lt;&lt; &quot;].mTimebin=&quot;&lt;&lt; mHits[i].mTimebin;</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;              res[timebin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mYpos - (fitSlope * timebin + fitOffset);</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;              qtot[timebin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mQtot;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mChannel == mFitPtr[cpu] + 1) {</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;              res[timebin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mYpos + 256 - (fitSlope * timebin + fitOffset);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;              qtot[timebin] = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">mHits</a>[iHit].mQtot;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;            }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;          }</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;          <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>[newtrackposition].setClusters(res, qtot, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">getNumberOfTimeBins</a>());</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        <span class="comment">//TODO dont leave this commented out !  if (fitError &lt; 0) {</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <span class="comment">//   LOG(debug) &lt;&lt; &quot;fit slope: &quot; &lt;&lt; fitSlope &lt;&lt; &quot;, offset: &quot; &lt;&lt; fitOffset &lt;&lt; &quot;, error: &quot; &lt;&lt; TMath::Sqrt(TMath::Abs(fitError) / nHits);</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="comment">//   LOG(error) &lt;&lt; &quot;Strange fit error: &quot; &lt;&lt; fitError &lt;&lt; &quot; from Sx: &quot; &lt;&lt; sumX &lt;&lt; &quot;, Sy: &quot; &lt;&lt; sumY &lt;&lt; &quot;, Sxy: &quot; &lt;&lt; sumXY &lt;&lt; &quot;, Sx2: &quot; &lt;&lt; sumX2 &lt;&lt; &quot;, Sy2: &quot; &lt;&lt; sumY2 &lt;&lt; &quot;, nHits: &quot; &lt;&lt; nHits;</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        <span class="comment">// }</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      }</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    }</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  }</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;}</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae2a2a37ba599460efa340a552b89b169">TrapSimulator::tracklet</a>()</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;{</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <span class="comment">// Run the tracklet calculation by calling sequentially:</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="comment">// CalcFitreg(); TrackletSelection(); FitTracklet()</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="comment">// and store the tracklets</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8e8bef766a373f357d80dbddbeb7bc5">mInitialized</a>) {</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  }</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>.clear();</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a90fd4c3132f561b25189db314f961f8e">calcFitreg</a>();</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">mNHits</a> == 0) {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5fd7decd6730743576be4e44d52e79c2">trackletSelection</a>();</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aa87c46ea633f2c6add8082a2bec9c6ce">fitTracklet</a>();</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;}</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a06fb6463292a85d990519c5e76386e25">TrapSimulator::getTracklets</a>(std::vector&lt;Tracklet&gt;&amp; TrackletStore)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;{</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  <span class="comment">// simply returns the found tracklets for the O2 dpl to then do its thing.</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  TrackletStore.insert(<a class="code" href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">std::end</a>(TrackletStore), <a class="code" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27da508ea0cb1d37fd56a0a598317cde">std::begin</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>), <a class="code" href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">std::end</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">mTrackletArray</a>));</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="comment">//std::copy(mTrackletArray.begin(),mTrackletArray.end(),std::back_inserter(TrackletStore));</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;}</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">// ******************************</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">// PID section</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">// Memory area for the LUT: 0xC100 to 0xC3FF</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">// The addresses for the parameters (the order is optimized for maximum calculation speed in the MCMs):</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">// 0xC028: cor1</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">// 0xC029: nBins(sF)</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">// 0xC02A: cor0</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">// 0xC02B: TableLength</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">// Defined in TrapConfig.h</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">// The algorithm implemented in the TRAP program of the MCMs (Venelin Angelov)</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">//  1) set the read pointer to the beginning of the Parameters in DMEM</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">//  2) shift right the FitReg with the Q0 + (Q1 &lt;&lt; 16) to get Q1</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">//  3) read cor1 with rpointer++</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">//  4) start cor1*Q1</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">//  5) read nBins with rpointer++</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">//  6) start nBins*cor1*Q1</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">//  7) read cor0 with rpointer++</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">//  8) swap hi-low parts in FitReg, now is Q1 + (Q0 &lt;&lt; 16)</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">//  9) shift right to get Q0</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">// 10) start cor0*Q0</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">// 11) read TableLength</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">// 12) compare cor0*Q0 with nBins</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">// 13) if &gt;=, clip cor0*Q0 to nBins-1</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">// 14) add cor0*Q0 to nBins*cor1*Q1</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">// 15) compare the result with TableLength</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">// 16) if &gt;=, clip to TableLength-1</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">// 17) read from the LUT 8 bits</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a713352e12b1e221f945df4501fdc6d0a">TrapSimulator::getPID</a>(<span class="keywordtype">int</span> q0, <span class="keywordtype">int</span> q1)</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;{</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  <span class="comment">// return PID calculated from charges accumulated in two time windows</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> addrQ0;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> addr;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nBinsQ0 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1ae055d11c7b762b0849040b7fbda835">mgkDmemAddrLUTnbins</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>); <span class="comment">// number of bins in q0 / 4 !!</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pidTotalSize = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a927160fb41550e13ed1332388c6bd491">mgkDmemAddrLUTLength</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  <span class="keywordflow">if</span> (nBinsQ0 == 0 || pidTotalSize == 0) <span class="comment">// make sure we don&#39;t run into trouble if the value for Q0 is not configured</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    <span class="keywordflow">return</span> 0;                            <span class="comment">// Q1 not configured is ok for 1D LUT</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> corrQ0 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aa87721722de9e49122770f04c12f8f4b">mgkDmemAddrLUTcor0</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> corrQ1 = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a62c8e9909197af215a6254a603e73a77">mgkDmemAddrLUTcor1</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordflow">if</span> (corrQ0 == 0) <span class="comment">// make sure we don&#39;t run into trouble if one of the values is not configured</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  addrQ0 = corrQ0;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  addrQ0 = (((addrQ0 * q0) &gt;&gt; 16) &gt;&gt; 16); <span class="comment">// because addrQ0 = (q0 * corrQ0) &gt;&gt; 32; does not work for unknown reasons</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="keywordflow">if</span> (addrQ0 &gt;= nBinsQ0) { <span class="comment">// check for overflow</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                           <span class="comment">//    LOG(debug3) &lt;&lt; &quot;Overflow in q0: &quot; &lt;&lt; addrQ0 &lt;&lt; &quot;/4 is bigger then &quot; &lt;&lt; nBinsQ0;</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    addrQ0 = nBinsQ0 - 1;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  }</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  addr = corrQ1;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  addr = (((addr * q1) &gt;&gt; 16) &gt;&gt; 16);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  addr = addrQ0 + nBinsQ0 * addr; <span class="comment">// because addr = addrQ0 + nBinsQ0* (((corrQ1*q1)&gt;&gt;32); does not work</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  <span class="keywordflow">if</span> (addr &gt;= pidTotalSize) {</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="comment">//  LOG(debug3) &lt;&lt; &quot;Overflow in q1. Address &quot; &lt;&lt; addr &lt;&lt; &quot;/4 is bigger then &quot; &lt;&lt; pidTotalSize;</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    addr = pidTotalSize - 1;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  }</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <span class="comment">// For a LUT with 11 input and 8 output bits, the first memory address is set to  LUT[0] | (LUT[1] &lt;&lt; 8) | (LUT[2] &lt;&lt; 16) | (LUT[3] &lt;&lt; 24)</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="comment">// and so on</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d30/classuint64__t.html">result</a> = <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">mTrapConfig</a>-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">getDmemUnsigned</a>(<a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8553c5fe786aedd2fa28d24e810f1ae">mgkDmemAddrLUTStart</a> + (addr / 4), <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">mDetector</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">mRobPos</a>, <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">mMcmPos</a>);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="keywordflow">return</span> (result &gt;&gt; ((addr % 4) * 8)) &amp; 0xFF;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;}</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">// help functions, to be cleaned up</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">TrapSimulator::addUintClipping</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbits)<span class="keyword"> const</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="comment">// This function adds a and b (unsigned) and clips to</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="comment">// the specified number of bits.</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sum = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <span class="keywordflow">if</span> (nbits &lt; 32) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxv = (1 &lt;&lt; nbits) - 1;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">if</span> (sum &gt; maxv)</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      sum = maxv;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="keywordflow">if</span> ((sum &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>) || (sum &lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>))</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      sum = 0xFFFFFFFF;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordflow">return</span> sum;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;}</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a441900fc7d1ccdd54b4a7af39353caf2">TrapSimulator::sort2</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx2i,</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val2i,</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx1o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx2o,</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val1o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val2o)<span class="keyword"> const</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="comment">// sorting for tracklet selection</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <span class="keywordflow">if</span> (val1i &gt; val2i) {</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    *idx1o = idx1i;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    *idx2o = idx2i;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    *val1o = val1i;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    *val2o = val2i;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    *idx1o = idx2i;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    *idx2o = idx1i;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    *val1o = val2i;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    *val2o = val1i;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  }</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;}</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">TrapSimulator::sort3</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx2i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx3i,</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val2i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val3i,</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx1o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx2o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx3o,</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val1o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val2o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val3o)</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;{</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="comment">// sorting for tracklet selection</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;  <span class="keywordtype">int</span> sel;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <span class="keywordflow">if</span> (val1i &gt; val2i)</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    sel = 4;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    sel = 0;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  <span class="keywordflow">if</span> (val2i &gt; val3i)</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    sel = sel + 2;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  <span class="keywordflow">if</span> (val3i &gt; val1i)</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    sel = sel + 1;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  <span class="keywordflow">switch</span> (sel) {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keywordflow">case</span> 6: <span class="comment">// 1 &gt;  2  &gt;  3            =&gt; 1 2 3</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keywordflow">case</span> 0: <span class="comment">// 1 =  2  =  3            =&gt; 1 2 3 : in this case doesn&#39;t matter, but so is in hardware!</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      *idx1o = idx1i;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      *idx2o = idx2i;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      *idx3o = idx3i;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      *val1o = val1i;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      *val2o = val2i;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      *val3o = val3i;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">case</span> 4: <span class="comment">// 1 &gt;  2, 2 &lt;= 3, 3 &lt;= 1  =&gt; 1 3 2</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      *idx1o = idx1i;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      *idx2o = idx3i;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;      *idx3o = idx2i;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      *val1o = val1i;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      *val2o = val3i;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      *val3o = val2i;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    <span class="keywordflow">case</span> 2: <span class="comment">// 1 &lt;= 2, 2 &gt; 3, 3 &lt;= 1   =&gt; 2 1 3</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      *idx1o = idx2i;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      *idx2o = idx1i;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      *idx3o = idx3i;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      *val1o = val2i;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      *val2o = val1i;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      *val3o = val3i;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    <span class="keywordflow">case</span> 3: <span class="comment">// 1 &lt;= 2, 2 &gt; 3, 3  &gt; 1   =&gt; 2 3 1</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      *idx1o = idx2i;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      *idx2o = idx3i;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      *idx3o = idx1i;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      *val1o = val2i;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      *val2o = val3i;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      *val3o = val1i;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordflow">case</span> 1: <span class="comment">// 1 &lt;= 2, 2 &lt;= 3, 3 &gt; 1   =&gt; 3 2 1</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      *idx1o = idx3i;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      *idx2o = idx2i;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      *idx3o = idx1i;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      *val1o = val3i;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      *val2o = val2i;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      *val3o = val1i;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">case</span> 5: <span class="comment">// 1 &gt; 2, 2 &lt;= 3, 3 &gt;  1   =&gt; 3 1 2</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      *idx1o = idx3i;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      *idx2o = idx1i;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;      *idx3o = idx2i;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      *val1o = val3i;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      *val2o = val1i;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      *val3o = val2i;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="keywordflow">default</span>: <span class="comment">// the rest should NEVER happen!</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot;ERROR in Sort3!!!&quot;</span>;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  }</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;}</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a16df2de5f83a300b18decb3e11509d67">TrapSimulator::sort6To4</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx2i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx3i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx4i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx5i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx6i,</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val2i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val3i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val4i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val5i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val6i,</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx1o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx2o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx3o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx4o,</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val1o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val2o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val3o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> val4o)</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;{</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="comment">// sorting for tracklet selection</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx21s, idx22s, idx23s, dummy;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val21s, val22s, val23s;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx23as, idx23bs;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val23as, val23bs;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">sort3</a>(idx1i, idx2i, idx3i, val1i, val2i, val3i,</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        idx1o, &amp;idx21s, &amp;idx23as,</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        val1o, &amp;val21s, &amp;val23as);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">sort3</a>(idx4i, idx5i, idx6i, val4i, val5i, val6i,</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        idx2o, &amp;idx22s, &amp;idx23bs,</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        val2o, &amp;val22s, &amp;val23bs);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a441900fc7d1ccdd54b4a7af39353caf2">sort2</a>(idx23as, idx23bs, val23as, val23bs, &amp;idx23s, &amp;dummy, &amp;val23s, &amp;dummy);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">sort3</a>(idx21s, idx22s, idx23s, val21s, val22s, val23s,</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        idx3o, idx4o, &amp;dummy,</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        val3o, val4o, &amp;dummy);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;}</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7030620118b7ca9c704055b98548fd9e">TrapSimulator::sort6To2Worst</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx2i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx3i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx4i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx5i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx6i,</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val1i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val2i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val3i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val4i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val5i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val6i,</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx5o, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <span class="keyword">const</span> idx6o)</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;{</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="comment">// sorting for tracklet selection</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx21s, idx22s, idx23s, dummy1, dummy2, dummy3, dummy4, dummy5;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val21s, val22s, val23s;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> idx23as, idx23bs;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> val23as, val23bs;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">sort3</a>(idx1i, idx2i, idx3i, val1i, val2i, val3i,</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        &amp;dummy1, &amp;idx21s, &amp;idx23as,</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        &amp;dummy2, &amp;val21s, &amp;val23as);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">sort3</a>(idx4i, idx5i, idx6i, val4i, val5i, val6i,</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        &amp;dummy1, &amp;idx22s, &amp;idx23bs,</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        &amp;dummy2, &amp;val22s, &amp;val23bs);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a441900fc7d1ccdd54b4a7af39353caf2">sort2</a>(idx23as, idx23bs, val23as, val23bs, &amp;idx23s, idx5o, &amp;val23s, &amp;dummy1);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">sort3</a>(idx21s, idx22s, idx23s, val21s, val22s, val23s,</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        &amp;dummy1, &amp;dummy2, idx6o,</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        &amp;dummy3, &amp;dummy4, &amp;dummy5);</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;}</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8b41bb53b5da36d7858d39821d8b55c6">TrapSimulator::readPackedConfig</a>(<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html">TrapConfig</a>* cfg, <span class="keywordtype">int</span> hc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>, <span class="keywordtype">int</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a>)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;{</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="comment">// Read the packed configuration from the passed memory block</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;  <span class="comment">// To be used to retrieve the TRAP configuration from the</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  <span class="comment">// configuration as sent in the raw data.</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;Reading packed configuration&quot;</span>;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  <span class="keywordtype">int</span> det = hc / 2;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  <span class="keywordtype">int</span> idx = 0;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  <span class="keywordtype">int</span> err = 0;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  <span class="keywordtype">int</span> step, bwidth, nwords, exitFlag, bitcnt;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> caddr;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dat, msk, header, dataHi;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  <span class="keywordflow">while</span> (idx &lt; size &amp;&amp; *<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a> != 0x00000000) {</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordtype">int</span> rob = (*<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a> &gt;&gt; 28) &amp; 0x7;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="keywordtype">int</span> mcm = (*<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a> &gt;&gt; 24) &amp; 0xf;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;Config of det. &quot;</span> &lt;&lt; det &lt;&lt; <span class="stringliteral">&quot; MCM &quot;</span> &lt;&lt; rob &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; mcm &lt;&lt; <span class="stringliteral">&quot; (0x&quot;</span> &lt;&lt; std::hex &lt;&lt; *<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    data++;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keywordflow">while</span> (idx &lt; size &amp;&amp; *data != 0x00000000) {</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      header = *<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      data++;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      idx++;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;read: 0x&quot;</span> &lt;&lt; hex &lt;&lt; header;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <span class="keywordflow">if</span> (header &amp; 0x01) <span class="comment">// single data</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      {</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        dat = (header &gt;&gt; 2) &amp; 0xFFFF;    <span class="comment">// 16 bit data</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        caddr = (header &gt;&gt; 18) &amp; 0x3FFF; <span class="comment">// 14 bit address</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        <span class="keywordflow">if</span> (caddr != 0x1FFF) <span class="comment">// temp!!! because the end marker was wrong</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        {</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;          <span class="keywordflow">if</span> (header &amp; 0x02) <span class="comment">// check if &gt; 16 bits</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          {</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;            dataHi = *<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;read: 0x&quot;</span> &lt;&lt; hex &lt;&lt; dataHi;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;            data++;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            idx++;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;            err += ((dataHi ^ (dat | 1)) &amp; 0xFFFF) != 0;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            dat = (dataHi &amp; 0xFFFF0000) | dat;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;          }</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;addr=0x&quot;</span> &lt;&lt; hex &lt;&lt; caddr &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a4c2ab6b37675949ee96da2daf98c1713">getRegName</a>(cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#ad75a9ee6eb9ff23e71d87924dbadd277">getRegByAddress</a>(caddr)) &lt;&lt; <span class="stringliteral">&quot;) data=0x&quot;</span> &lt;&lt; hex &lt;&lt; dat;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;          <span class="keywordflow">if</span> (!cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a36b398b6e0084ea2d0e03b5ad931a8c8">poke</a>(caddr, dat, det, rob, mcm))</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;(single-write): non-existing address 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; caddr &lt;&lt; <span class="stringliteral">&quot; containing 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; header;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;          <span class="keywordflow">if</span> (idx &gt; size) {</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;            <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;(single-write): no more data, missing end marker&quot;</span>;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;            <span class="keywordflow">return</span> -err;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;          }</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;(single-write): address 0x&quot;</span> &lt;&lt; setw(4) &lt;&lt; std::hex &lt;&lt; caddr &lt;&lt; <span class="stringliteral">&quot; =&gt; old endmarker?&quot;</span> &lt;&lt; std::dec;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          <span class="keywordflow">return</span> err;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        }</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      }</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <span class="keywordflow">else</span> <span class="comment">// block of data</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      {</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        step = (header &gt;&gt; 1) &amp; 0x0003;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;        bwidth = ((header &gt;&gt; 3) &amp; 0x001F) + 1;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        nwords = (header &gt;&gt; 8) &amp; 0x00FF;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        caddr = (header &gt;&gt; 16) &amp; 0xFFFF;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        exitFlag = (step == 0) || (step == 3) || (nwords == 0);</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="keywordflow">if</span> (exitFlag)</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <span class="keywordflow">switch</span> (bwidth) {</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;          <span class="keywordflow">case</span> 15:</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;          <span class="keywordflow">case</span> 10:</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;          <span class="keywordflow">case</span> 7:</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;          <span class="keywordflow">case</span> 6:</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;          <span class="keywordflow">case</span> 5: {</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;            msk = (1 &lt;&lt; bwidth) - 1;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            bitcnt = 0;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;            <span class="keywordflow">while</span> (nwords &gt; 0) {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;              nwords--;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;              bitcnt -= bwidth;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;              <span class="keywordflow">if</span> (bitcnt &lt; 0) {</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                header = *<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;read 0x&quot;</span> &lt;&lt; setw(8) &lt;&lt; std::hex &lt;&lt; header &lt;&lt; std::dec;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                data++;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                idx++;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                err += (header &amp; 1);</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                header = header &gt;&gt; 1;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                bitcnt = 31 - bwidth;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;              }</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;              <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;addr=0x&quot;</span> &lt;&lt; setw(4) &lt;&lt; std::hex &lt;&lt; caddr &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a4c2ab6b37675949ee96da2daf98c1713">getRegName</a>(cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#ad75a9ee6eb9ff23e71d87924dbadd277">getRegByAddress</a>(caddr)) &lt;&lt; <span class="stringliteral">&quot;) data=0x&quot;</span> &lt;&lt; setw(8) &lt;&lt; std::hex &lt;&lt; (header &amp; msk);</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;              <span class="keywordflow">if</span> (!cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a36b398b6e0084ea2d0e03b5ad931a8c8">poke</a>(caddr, header &amp; msk, det, rob, mcm))</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;(single-write): non-existing address 0x&quot;</span> &lt;&lt; setw(4) &lt;&lt; std::hex &lt;&lt; caddr &lt;&lt; <span class="stringliteral">&quot; containing 0x&quot;</span> &lt;&lt; setw(8) &lt;&lt; std::hex &lt;&lt; header &lt;&lt; std::dec;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;              caddr += step;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;              header = header &gt;&gt; bwidth;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;              <span class="keywordflow">if</span> (idx &gt;= size) {</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;(block-write): no end marker! &quot;</span> &lt;&lt; idx &lt;&lt; <span class="stringliteral">&quot; words read&quot;</span>;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                <span class="keywordflow">return</span> -err;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;              }</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            }</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;          } <span class="comment">// end case 5-15</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;          <span class="keywordflow">case</span> 31: {</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            <span class="keywordflow">while</span> (nwords &gt; 0) {</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;              header = *<a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;              <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;read 0x&quot;</span> &lt;&lt; setw(8) &lt;&lt; std::hex &lt;&lt; header;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;              data++;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;              idx++;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;              nwords--;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;              err += (header &amp; 1);</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;              <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;addr=0x&quot;</span> &lt;&lt; hex &lt;&lt; setw(4) &lt;&lt; caddr &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a4c2ab6b37675949ee96da2daf98c1713">getRegName</a>(cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#ad75a9ee6eb9ff23e71d87924dbadd277">getRegByAddress</a>(caddr)) &lt;&lt; <span class="stringliteral">&quot;)  data=0x&quot;</span> &lt;&lt; hex &lt;&lt; setw(8) &lt;&lt; (header &gt;&gt; 1);</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;              <span class="keywordflow">if</span> (!cfg-&gt;<a class="code" href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a36b398b6e0084ea2d0e03b5ad931a8c8">poke</a>(caddr, header &gt;&gt; 1, det, rob, mcm))</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;(single-write): non-existing address 0x&quot;</span> &lt;&lt; setw(4) &lt;&lt; std::hex &lt;&lt; <span class="stringliteral">&quot; containing 0x&quot;</span> &lt;&lt; setw(8) &lt;&lt; std::hex &lt;&lt; header &lt;&lt; std::dec;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;              caddr += step;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;              <span class="keywordflow">if</span> (idx &gt;= size) {</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug3) &lt;&lt; <span class="stringliteral">&quot;no end marker! &quot;</span> &lt;&lt; idx &lt;&lt; <span class="stringliteral">&quot; words read&quot;</span>;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                <span class="keywordflow">return</span> -err;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;              }</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            }</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;          }</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          <span class="keywordflow">default</span>:</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;            <span class="keywordflow">return</span> err;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        } <span class="comment">// end switch</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;      }   <span class="comment">// end block case</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    }</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  } <span class="comment">// end while</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(debug) &lt;&lt; <span class="stringliteral">&quot;no end marker! &quot;</span> &lt;&lt; idx &lt;&lt; <span class="stringliteral">&quot; words read&quot;</span>;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <span class="keywordflow">return</span> -err; <span class="comment">// only if the max length of the block reached!</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;}</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">//calgainfactor=.47;</span></div><div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_addb70efc22337d885b5c7ded6ed7322a"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#addb70efc22337d885b5c7ded6ed7322a">o2::trd::TrapSimulator::printAdcDatHuman</a></div><div class="ttdeci">void printAdcDatHuman(std::ostream &amp;os) const</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a0497f74b1d0eff1f1c1ca1653b10ff49"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0497f74b1d0eff1f1c1ca1653b10ff49">o2::trd::TrapSimulator::mgkDmemAddrDeflCorr</a></div><div class="ttdeci">static const int mgkDmemAddrDeflCorr</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00189">TrapSimulator.h:189</a></div></div>
<div class="ttc" id="glcorearb_8h_html_abf0ea7853561a9028dbbc4caeb2f8ff1"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#abf0ea7853561a9028dbbc4caeb2f8ff1">t0</a></div><div class="ttdeci">GLuint GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat t0</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca72add304532b133e6232b7f5c8cd0cca"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca72add304532b133e6232b7f5c8cd0cca">o2::trd::TrapConfig::kTPQS1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00183">TrapConfig.h:183</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_a0b58570cf6bf26d4c64d2593b5e1601c"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a0b58570cf6bf26d4c64d2593b5e1601c">o2::trd::FeeParam::getUseTimeOffset</a></div><div class="ttdeci">bool getUseTimeOffset() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/FeeParam_8h_source.html#l00102">FeeParam.h:102</a></div></div>
<div class="ttc" id="CalOnlineGainTables_8h_html"><div class="ttname"><a href="../../d5/da9/CalOnlineGainTables_8h.html">CalOnlineGainTables.h</a></div></div>
<div class="ttc" id="namespaceo2_1_1tpc_html_a27da508ea0cb1d37fd56a0a598317cde"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a27da508ea0cb1d37fd56a0a598317cde">o2::tpc::begin</a></div><div class="ttdeci">Enum&lt; T &gt;::Iterator begin(Enum&lt; T &gt;)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d73/Defs_8h_source.html#l00126">Defs.h:126</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a36b398b6e0084ea2d0e03b5ad931a8c8"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a36b398b6e0084ea2d0e03b5ad931a8c8">o2::trd::TrapConfig::poke</a></div><div class="ttdeci">bool poke(int addr, unsigned int value, int det, int rob, int mcm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/TrapConfig_8cxx_source.html#l00578">TrapConfig.cxx:578</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca495215e5e729091082c9e718f5c5412d"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca495215e5e729091082c9e718f5c5412d">o2::trd::TrapConfig::kTPFS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00177">TrapConfig.h:177</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ae8553c5fe786aedd2fa28d24e810f1ae"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8553c5fe786aedd2fa28d24e810f1ae">o2::trd::TrapSimulator::mgkDmemAddrLUTStart</a></div><div class="ttdeci">static const int mgkDmemAddrLUTStart</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00182">TrapSimulator.h:182</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a564053e5c696233730777444a9db9035"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a564053e5c696233730777444a9db9035">o2::trd::TrapSimulator::getDataFiltered</a></div><div class="ttdeci">int getDataFiltered(int iadc, int timebin) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00069">TrapSimulator.h:69</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html">o2::trd::TrapSimulator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00040">TrapSimulator.h:40</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a8b3a97090773c215d7278723767e4e6b"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8b3a97090773c215d7278723767e4e6b">o2::trd::TrapSimulator::FitReg::mSumX</a></div><div class="ttdeci">unsigned int mSumX</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00260">TrapSimulator.h:260</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a4e97b838ac96d726227da91ec35a9650"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a4e97b838ac96d726227da91ec35a9650">nullptr</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value [n] sets TFlen for [n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char nullptr</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00044">qconfigoptions.h:44</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca1b5e518651b7c80595565500bbb840ab"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca1b5e518651b7c80595565500bbb840ab">o2::trd::TrapConfig::kFTAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00207">TrapConfig.h:207</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a713352e12b1e221f945df4501fdc6d0a"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a713352e12b1e221f945df4501fdc6d0a">o2::trd::TrapSimulator::getPID</a></div><div class="ttdeci">int getPID(int q0, int q1)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_a39c13e1ad9b1ec3f99df0d70518bc9ee"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a39c13e1ad9b1ec3f99df0d70518bc9ee">o2::trd::FeeParam::getNadcMcm</a></div><div class="ttdeci">static int getNadcMcm()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/FeeParam_8h_source.html#l00077">FeeParam.h:77</a></div></div>
<div class="ttc" id="namespaceo2_1_1trd_html_ae3fe869645d0433238249bd6b5a96d03"><div class="ttname"><a href="../../d2/d76/namespaceo2_1_1trd.html#ae3fe869645d0433238249bd6b5a96d03">o2::trd::operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;stream, const TriggerRecord &amp;trg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d81/TRD_2src_2TriggerRecord_8cxx_source.html#l00025">TriggerRecord.cxx:25</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca8f7106608732b4e015ed09fd700033e3"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca8f7106608732b4e015ed09fd700033e3">o2::trd::TrapConfig::kTPCT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00219">TrapConfig.h:219</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a14d929a2688bf961e86c6ca76cba7445"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a14d929a2688bf961e86c6ca76cba7445">o2::trd::TrapSimulator::getApplyCut</a></div><div class="ttdeci">static bool getApplyCut()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00095">TrapSimulator.h:95</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ab2fb5ac19001403d8210b239a4cc0a8b"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ab2fb5ac19001403d8210b239a4cc0a8b">layer</a></div><div class="ttdeci">GLenum GLuint GLint GLint layer</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01310">glcorearb.h:1310</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cad658f0fea9a2d6b2e16f889a1a9b3b91"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cad658f0fea9a2d6b2e16f889a1a9b3b91">o2::trd::TrapConfig::kTPFP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00215">TrapConfig.h:215</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ad862645555157689a13f2ba58c9f4fbd"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad862645555157689a13f2ba58c9f4fbd">o2::trd::TrapSimulator::mDetector</a></div><div class="ttdeci">int mDetector</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00284">TrapSimulator.h:284</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a9955fdc84f03e5982de0ea09268de98b"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a9955fdc84f03e5982de0ea09268de98b">o2::trd::TrapSimulator::mgkAddDigits</a></div><div class="ttdeci">static const int mgkAddDigits</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00203">TrapSimulator.h:203</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a5f3ec19dcfd027add6862beb5e66bed8"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5f3ec19dcfd027add6862beb5e66bed8">o2::trd::TrapSimulator::mgkDmemAddrYcorr</a></div><div class="ttdeci">static const int mgkDmemAddrYcorr</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00194">TrapSimulator.h:194</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a883bdb40748b845ff46888692c66e97a"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a883bdb40748b845ff46888692c66e97a">o2::trd::TrapSimulator::mNHits</a></div><div class="ttdeci">int mNHits</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00317">TrapSimulator.h:317</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aadb87c171f30ff3f869219fa9023283b"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aadb87c171f30ff3f869219fa9023283b">o2::trd::TrapSimulator::filterGainNextSample</a></div><div class="ttdeci">unsigned short filterGainNextSample(int adc, unsigned short value)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ac421d3becb1e3bf4a04d9ead29f98140"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac421d3becb1e3bf4a04d9ead29f98140">o2::trd::TrapSimulator::filterPedestalInit</a></div><div class="ttdeci">void filterPedestalInit(int baseline=10)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a1d54e2524f2a4afebdf0db475a916a2f"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1d54e2524f2a4afebdf0db475a916a2f">o2::trd::TrapSimulator::sort3</a></div><div class="ttdeci">void sort3(unsigned short idx1i, unsigned short idx2i, unsigned short idx3i, unsigned short val1i, unsigned short val2i, unsigned short val3i, unsigned short *const idx1o, unsigned short *const idx2o, unsigned short *const idx3o, unsigned short *const val1o, unsigned short *const val2o, unsigned short *const val3o)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca0cffdccb0c2a141e255123facb8ea982"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca0cffdccb0c2a141e255123facb8ea982">o2::trd::TrapConfig::kFGTB</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00205">TrapConfig.h:205</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a1ae055d11c7b762b0849040b7fbda835"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1ae055d11c7b762b0849040b7fbda835">o2::trd::TrapSimulator::mgkDmemAddrLUTnbins</a></div><div class="ttdeci">static const int mgkDmemAddrLUTnbins</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00180">TrapSimulator.h:180</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a429d297f1a16f56df49eb70748d94cc0"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a429d297f1a16f56df49eb70748d94cc0">o2::trd::TrapSimulator::FitReg::mNhits</a></div><div class="ttdeci">int mNhits</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00257">TrapSimulator.h:257</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a8503e83705e9311282ee0d8125a743a0"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a8503e83705e9311282ee0d8125a743a0">o2::trd::TrapSimulator::FitReg::mSumX2</a></div><div class="ttdeci">unsigned int mSumX2</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00262">TrapSimulator.h:262</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00028">GPUCommonLogger.h:28</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a8de221d59fddf3720d2afca105fab7b0"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8de221d59fddf3720d2afca105fab7b0">o2::trd::TrapSimulator::getDataRaw</a></div><div class="ttdeci">int getDataRaw(int iadc, int timebin) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00067">TrapSimulator.h:67</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a7eae8677ceb45b6c68ca3ef9106bdbf0"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a7eae8677ceb45b6c68ca3ef9106bdbf0">o2::trd::TrapSimulator::FitReg::mQ1</a></div><div class="ttdeci">unsigned int mQ1</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00259">TrapSimulator.h:259</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a0b6619b0b6971ff23ff8f2cb6c87b5f9"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0b6619b0b6971ff23ff8f2cb6c87b5f9">o2::trd::TrapSimulator::setDataPedestal</a></div><div class="ttdeci">void setDataPedestal(int iadc)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca3707dcb93c3e28e53d19a070c00a5491"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3707dcb93c3e28e53d19a070c00a5491">o2::trd::TrapConfig::kC13CPUA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00148">TrapConfig.h:148</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a43396a83bfc442bf6784258b6740ca73"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a43396a83bfc442bf6784258b6740ca73">o2::trd::TrapSimulator::getZeroSupressionMap</a></div><div class="ttdeci">int getZeroSupressionMap(int iadc) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00071">TrapSimulator.h:71</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a08a63ecf136012952fd00cfb3dcf6d35"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a08a63ecf136012952fd00cfb3dcf6d35">o2::trd::TrapSimulator::printAdcDatTxt</a></div><div class="ttdeci">void printAdcDatTxt(std::ostream &amp;os) const</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca3ce1407037f27d59c8b8836f4899586c"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3ce1407037f27d59c8b8836f4899586c">o2::trd::TrapConfig::kTPCL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00220">TrapConfig.h:220</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a541a4da5220253dab28aaf9064ccde19"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a541a4da5220253dab28aaf9064ccde19">o2::trd::TrapSimulator::mMCMT</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; mMCMT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00292">TrapSimulator.h:292</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_a764c851feacd971f907903b57e5504e3"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a764c851feacd971f907903b57e5504e3">o2::trd::FeeParam::getPadRowFromMCM</a></div><div class="ttdeci">virtual int getPadRowFromMCM(int irob, int imcm) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d67/FeeParam_8cxx_source.html#l00193">FeeParam.cxx:193</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac8729153468b5dcf13f971b21d84d4e5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a></div><div class="ttdeci">GLboolean GLboolean GLboolean GLboolean a</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a0c33960ac489c87a08d3d54f76d9f521"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0c33960ac489c87a08d3d54f76d9f521">o2::trd::TrapSimulator::printAdcDatDatx</a></div><div class="ttdeci">void printAdcDatDatx(std::ostream &amp;os, bool broadcast=kFALSE, int timeBinOffset=-1) const</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2b44c47019e9269faccc681b9a308435a35c04d36a70e284f1c4bf9548857bfba"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435a35c04d36a70e284f1c4bf9548857bfba">o2::trd::TrapSimulator::PRINTFILTERED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00047">TrapSimulator.h:47</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a5599ddbbdffa2454f147b63fcc1395e5"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5599ddbbdffa2454f147b63fcc1395e5">o2::trd::TrapSimulator::loadMCM</a></div><div class="ttdeci">bool loadMCM(int det, int rob, int mcm)</div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d76/Cartesian3D_8h_source.html#l00229">Cartesian3D.h:229</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca7429e9806b8a20f7a206cccbbba16656"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca7429e9806b8a20f7a206cccbbba16656">o2::trd::TrapConfig::kEBSF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00188">TrapConfig.h:188</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_abb8653b0c3c43e7433053b128b4c0933"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#abb8653b0c3c43e7433053b128b4c0933">o2::trd::FeeParam::instance</a></div><div class="ttdeci">static FeeParam * instance()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d67/FeeParam_8cxx_source.html#l00083">FeeParam.cxx:83</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1Tracklet_html_a5bc3cd4186795b7c06dfa11c506b4ab9"><div class="ttname"><a href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a5bc3cd4186795b7c06dfa11c506b4ab9">o2::trd::Tracklet::getdY</a></div><div class="ttdeci">int getdY() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d07/Tracklet_8cxx_source.html#l00082">Tracklet.cxx:82</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a87a1572c8fb96b7c90a08122511cd581"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a87a1572c8fb96b7c90a08122511cd581">o2::trd::TrapSimulator::mgkDmemAddrNdrift</a></div><div class="ttdeci">static const int mgkDmemAddrNdrift</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00190">TrapSimulator.h:190</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ae8e8bef766a373f357d80dbddbeb7bc5"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae8e8bef766a373f357d80dbddbeb7bc5">o2::trd::TrapSimulator::mInitialized</a></div><div class="ttdeci">bool mInitialized</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00283">TrapSimulator.h:283</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_ad08a37964429d340d966dfa679443e8f"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#ad08a37964429d340d966dfa679443e8f">int</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events int</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00025">qconfigoptions.h:25</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2b44c47019e9269faccc681b9a308435afdba17aac06cb616fbfc9cb904fc44df"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435afdba17aac06cb616fbfc9cb904fc44df">o2::trd::TrapSimulator::PRINTRAW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00046">TrapSimulator.h:46</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a16df2de5f83a300b18decb3e11509d67"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a16df2de5f83a300b18decb3e11509d67">o2::trd::TrapSimulator::sort6To4</a></div><div class="ttdeci">void sort6To4(unsigned short idx1i, unsigned short idx2i, unsigned short idx3i, unsigned short idx4i, unsigned short idx5i, unsigned short idx6i, unsigned short val1i, unsigned short val2i, unsigned short val3i, unsigned short val4i, unsigned short val5i, unsigned short val6i, unsigned short *const idx1o, unsigned short *const idx2o, unsigned short *const idx3o, unsigned short *const idx4o, unsigned short *const val1o, unsigned short *const val2o, unsigned short *const val3o, unsigned short *const val4o)</div></div>
<div class="ttc" id="glcorearb_8h_html_a8e8a78e36205bada4146dc581c95f82c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a8e8a78e36205bada4146dc581c95f82c">offset</a></div><div class="ttdeci">GLintptr offset</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00660">glcorearb.h:660</a></div></div>
<div class="ttc" id="FeeParam_8h_html"><div class="ttname"><a href="../../d2/d36/FeeParam_8h.html">FeeParam.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a308939ec2bc6885d2fea9709cd52c771"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a308939ec2bc6885d2fea9709cd52c771">o2::trd::TrapSimulator::printFitRegXml</a></div><div class="ttdeci">void printFitRegXml(std::ostream &amp;os) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00251">TrapSimulator.cxx:251</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_add9e13ded6462237db03656e71f0e5db"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#add9e13ded6462237db03656e71f0e5db">o2::trd::FeeParam::getUseMisalignCorr</a></div><div class="ttdeci">bool getUseMisalignCorr() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/FeeParam_8h_source.html#l00100">FeeParam.h:100</a></div></div>
<div class="ttc" id="namespaceo2_1_1framework_html"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html">o2::framework</a></div><div class="ttdoc">A header which contains some meta-data generated by Data Sampling. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d62/DataFormats_2Detectors_2ITSMFT_2common_2include_2DataFormatsITSMFT_2Cluster_8h_source.html#l00198">Cluster.h:198</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cae0519f54d493015c6b2174c514e98cea"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cae0519f54d493015c6b2174c514e98cea">o2::trd::TrapConfig::kFGF0</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00233">TrapConfig.h:233</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cacf25bd83a078d5ade10a368c0ba55a76"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cacf25bd83a078d5ade10a368c0ba55a76">o2::trd::TrapConfig::kFPNP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00202">TrapConfig.h:202</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ab1bf1549b0c5345273f35721f89cd137"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab1bf1549b0c5345273f35721f89cd137">o2::trd::TrapSimulator::mADCF</a></div><div class="ttdeci">std::vector&lt; int &gt; mADCF</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00290">TrapSimulator.h:290</a></div></div>
<div class="ttc" id="namespaceo2_1_1its_1_1math__utils_html_a0430deee85a5676223120d355c147f0e"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a0430deee85a5676223120d355c147f0e">o2::its::math_utils::x2</a></div><div class="ttdeci">const float3 float float x2</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00041">MathUtils.h:41</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a49191c2a5da8323782ebbed11f550270"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a49191c2a5da8323782ebbed11f550270">o2::trd::TrapConfig::getDmemUnsigned</a></div><div class="ttdeci">unsigned int getDmemUnsigned(int addr, int det, int rob, int mcm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/TrapConfig_8cxx_source.html#l00646">TrapConfig.cxx:646</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a66e709054640516f525d051bcc545833"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a66e709054640516f525d051bcc545833">o2::trd::TrapSimulator::getRobPos</a></div><div class="ttdeci">int getRobPos() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00110">TrapSimulator.h:110</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aee16770e6f7230958845149a413fb112a6ac5214e376c5367275b8567fbe95233"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aee16770e6f7230958845149a413fb112a6ac5214e376c5367275b8567fbe95233">o2::trd::TrapSimulator::PLOTHITS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00051">TrapSimulator.h:51</a></div></div>
<div class="ttc" id="classshort_html"><div class="ttname"><a href="../../dc/d10/classshort.html">short</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_add9f151789fcdaa9d7d2a6d7ef017a41"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#add9f151789fcdaa9d7d2a6d7ef017a41">o2::trd::TrapSimulator::mNTimeBin</a></div><div class="ttdeci">int mNTimeBin</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00288">TrapSimulator.h:288</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a346b92ba59949838973d07c9aa042c06"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a346b92ba59949838973d07c9aa042c06">o2::trd::TrapSimulator::filterPedestal</a></div><div class="ttdeci">void filterPedestal()</div></div>
<div class="ttc" id="glcorearb_8h_html_ae1838b9db98fcca9cd79d66954101c9f"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ae1838b9db98fcca9cd79d66954101c9f">mask</a></div><div class="ttdeci">GLint GLuint mask</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00291">glcorearb.h:291</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a3d1e3edfcf61ca2d831883e1afbad89e"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a></div><div class="ttdeci">GLsizeiptr size</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00659">glcorearb.h:659</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ab5cf186d3d19eaeb26a32a391df91d6e"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab5cf186d3d19eaeb26a32a391df91d6e">o2::trd::TrapSimulator::mRow</a></div><div class="ttdeci">int mRow</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00287">TrapSimulator.h:287</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2336f3806e4c9361fc60a99779c3aa7e"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2336f3806e4c9361fc60a99779c3aa7e">o2::trd::TrapSimulator::produceRawStream</a></div><div class="ttdeci">int produceRawStream(unsigned int *buf, int bufsize, unsigned int iEv=0) const</div></div>
<div class="ttc" id="namespaceo2_1_1trd_html_ade2e479ac957ba3a33e97e58d78ad654"><div class="ttname"><a href="../../d2/d76/namespaceo2_1_1trd.html#ade2e479ac957ba3a33e97e58d78ad654">o2::trd::kTimeBins</a></div><div class="ttdeci">constexpr int kTimeBins</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/TRDCommonParam_8h_source.html#l00023">TRDCommonParam.h:23</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7a4a6fe5ae668d51cb620ed129ee8b9b"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4a6fe5ae668d51cb620ed129ee8b9b">o2::trd::TrapSimulator::filter</a></div><div class="ttdeci">void filter()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html">o2::trd::TrapSimulator::FitReg</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00252">TrapSimulator.h:252</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a6a4647b28917f5f644492fed89a60081"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a6a4647b28917f5f644492fed89a60081">o2::trd::TrapSimulator::FitReg::mSumXY</a></div><div class="ttdeci">int mSumXY</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00264">TrapSimulator.h:264</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7144ec188a3bc2a34efc4b32e3fb9ae9"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7144ec188a3bc2a34efc4b32e3fb9ae9">o2::trd::TrapSimulator::addUintClipping</a></div><div class="ttdeci">unsigned int addUintClipping(unsigned int a, unsigned int b, unsigned int nbits) const</div></div>
<div class="ttc" id="TrapConfigHandler_8h_html"><div class="ttname"><a href="../../de/d00/TrapConfigHandler_8h.html">TrapConfigHandler.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701caee489b298564fdb8b6752993076cd665"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee489b298564fdb8b6752993076cd665">o2::trd::TrapConfig::kTPQE1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00184">TrapConfig.h:184</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aa87c46ea633f2c6add8082a2bec9c6ce"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aa87c46ea633f2c6add8082a2bec9c6ce">o2::trd::TrapSimulator::fitTracklet</a></div><div class="ttdeci">void fitTracklet()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a4f8cb9c7f57384b64d3f2968353f9ecf"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4f8cb9c7f57384b64d3f2968353f9ecf">o2::trd::TrapSimulator::cfdat</a></div><div class="ttdeci">static std::ostream &amp; cfdat(std::ostream &amp;os)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00154">TrapSimulator.cxx:154</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a90fd4c3132f561b25189db314f961f8e"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a90fd4c3132f561b25189db314f961f8e">o2::trd::TrapSimulator::calcFitreg</a></div><div class="ttdeci">void calcFitreg()</div></div>
<div class="ttc" id="Detectors_2TRD_2base_2include_2TRDBase_2Digit_8h_html"><div class="ttname"><a href="../../d7/da5/Detectors_2TRD_2base_2include_2TRDBase_2Digit_8h.html">Digit.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701caeaae9cf6d3f38913266f574fb6a29a1a"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caeaae9cf6d3f38913266f574fb6a29a1a">o2::trd::TrapConfig::kFTLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00209">TrapConfig.h:209</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ac0643caade69acefa61f32ad9f777d2e"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac0643caade69acefa61f32ad9f777d2e">o2::trd::TrapSimulator::mFitPtr</a></div><div class="ttdeci">std::array&lt; int, mgkNCPU &gt; mFitPtr</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00296">TrapSimulator.h:296</a></div></div>
<div class="ttc" id="glcorearb_8h_html_af48031a37b713afa3b0d0d7d29653d7c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a></div><div class="ttdeci">GLuint GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat t1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca012d413eed496a374564b79f45c3758c"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca012d413eed496a374564b79f45c3758c">o2::trd::TrapConfig::kFTBY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00199">TrapConfig.h:199</a></div></div>
<div class="ttc" id="TrapSimulator_8h_html"><div class="ttname"><a href="../../d7/d42/TrapSimulator_8h.html">TrapSimulator.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_acf8fab4c5bb838407815ddc4ee9f2f68"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#acf8fab4c5bb838407815ddc4ee9f2f68">o2::trd::TrapSimulator::getNumberOfTimeBins</a></div><div class="ttdeci">const int getNumberOfTimeBins() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00115">TrapSimulator.h:115</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a44d5bc016820a806cf08cf6653b58441"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a44d5bc016820a806cf08cf6653b58441">bufSize</a></div><div class="ttdeci">GLuint GLsizei bufSize</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00790">glcorearb.h:790</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca982ce69965a304892d53c5088c067751"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca982ce69965a304892d53c5088c067751">o2::trd::TrapConfig::kFPTC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00201">TrapConfig.h:201</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a432111147038972f06e049e18a837002"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a432111147038972f06e049e18a837002">end</a></div><div class="ttdeci">GLuint GLuint end</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00469">glcorearb.h:469</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca356ea49ce887ba20538e93d27c502220"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca356ea49ce887ba20538e93d27c502220">o2::trd::TrapConfig::kEBIS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00192">TrapConfig.h:192</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7dd0c69979dbf8b50d6bcd5969763def"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7dd0c69979dbf8b50d6bcd5969763def">o2::trd::TrapSimulator::draw</a></div><div class="ttdeci">void draw(int choice, int index)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca3d5ce4e5e5690c78fe97cbdcae17418d"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3d5ce4e5e5690c78fe97cbdcae17418d">o2::trd::TrapConfig::kFGA0</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00254">TrapConfig.h:254</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ae2a2a37ba599460efa340a552b89b169"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae2a2a37ba599460efa340a552b89b169">o2::trd::TrapSimulator::tracklet</a></div><div class="ttdeci">void tracklet()</div></div>
<div class="ttc" id="glcorearb_8h_html_a9371a1f53f8067997cd15aaf657c62d0"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a9371a1f53f8067997cd15aaf657c62d0">label</a></div><div class="ttdeci">GLuint GLsizei const GLchar * label</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l02519">glcorearb.h:2519</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_adb893e88e76a746845bcd65742b10f7c"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#adb893e88e76a746845bcd65742b10f7c">o2::trd::TrapSimulator::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00118">TrapSimulator.cxx:118</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aee16770e6f7230958845149a413fb112a81e9ef527e98d0c9e11bb4f52d8d484a"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aee16770e6f7230958845149a413fb112a81e9ef527e98d0c9e11bb4f52d8d484a">o2::trd::TrapSimulator::PLOTRAW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00050">TrapSimulator.h:50</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a0be64977d102366d4e6ed04595bbb198"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a0be64977d102366d4e6ed04595bbb198">o2::trd::TrapSimulator::mADCR</a></div><div class="ttdeci">std::vector&lt; int &gt; mADCR</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00289">TrapSimulator.h:289</a></div></div>
<div class="ttc" id="TrapConfig_8h_html"><div class="ttname"><a href="../../d8/dbb/TrapConfig_8h.html">TrapConfig.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a920f63bd22ec25a962a0119501126dd5"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a920f63bd22ec25a962a0119501126dd5">o2::trd::TrapSimulator::mgkFPshifts</a></div><div class="ttdeci">static const std::array&lt; unsigned short, 4 &gt; mgkFPshifts</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00208">TrapSimulator.h:208</a></div></div>
<div class="ttc" id="TRDGeometry_8h_html"><div class="ttname"><a href="../../dd/d07/TRDGeometry_8h.html">TRDGeometry.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a40c7c0070b27fbeb80eba351a77985a3"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a40c7c0070b27fbeb80eba351a77985a3">o2::trd::TrapSimulator::getDetector</a></div><div class="ttdeci">int getDetector() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00109">TrapSimulator.h:109</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aab1dc98efdf1f426f53df1bb9688cd15"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aab1dc98efdf1f426f53df1bb9688cd15">o2::trd::TrapSimulator::noiseTest</a></div><div class="ttdeci">void noiseTest(int nsamples, int mean, int sigma, int inputGain=1, int inputTail=2)</div></div>
<div class="ttc" id="namespaceo2_1_1trd_html_a74b648440ce4e942f21911868a934b75"><div class="ttname"><a href="../../d2/d76/namespaceo2_1_1trd.html#a74b648440ce4e942f21911868a934b75">o2::trd::ArrayADC</a></div><div class="ttdeci">std::array&lt; ADC_t, kTimeBins &gt; ArrayADC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/da5/Detectors_2TRD_2base_2include_2TRDBase_2Digit_8h_source.html#l00029">Digit.h:29</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a5079972ea1b0ff93d546b0fe39315db9"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5079972ea1b0ff93d546b0fe39315db9">o2::trd::TrapSimulator::mgkDmemAddrTimeOffset</a></div><div class="ttdeci">static const int mgkDmemAddrTimeOffset</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00193">TrapSimulator.h:193</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca4fb238065019006598da2057da7146a7"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca4fb238065019006598da2057da7146a7">o2::trd::TrapConfig::kFGBY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00198">TrapConfig.h:198</a></div></div>
<div class="ttc" id="namespaceo2_1_1its_1_1math__utils_html_a48d1d55da7e44710eb682e4ac2d7c86d"><div class="ttname"><a href="../../d2/dc1/namespaceo2_1_1its_1_1math__utils.html#a48d1d55da7e44710eb682e4ac2d7c86d">o2::its::math_utils::x3</a></div><div class="ttdeci">const float3 float float float float x3</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d3e/MathUtils_8h_source.html#l00041">MathUtils.h:41</a></div></div>
<div class="ttc" id="TRDSimParam_8h_html"><div class="ttname"><a href="../../d9/df4/TRDSimParam_8h.html">TRDSimParam.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a4c4a1f9409e651a51dcf4c185b1cacba"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4c4a1f9409e651a51dcf4c185b1cacba">o2::trd::TrapSimulator::mgkMaxTracklets</a></div><div class="ttdeci">static const int mgkMaxTracklets</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00195">TrapSimulator.h:195</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2b44c47019e9269faccc681b9a308435ac3b6aed3ed2ba6de27c165559f4c547d"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435ac3b6aed3ed2ba6de27c165559f4c547d">o2::trd::TrapSimulator::PRINTDETECTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00048">TrapSimulator.h:48</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="../../d6/d30/classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_a8d916c06dc405aa0ab66b5ecffc7513e"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a8d916c06dc405aa0ab66b5ecffc7513e">o2::trd::FeeParam::getNcol</a></div><div class="ttdeci">static int getNcol()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/FeeParam_8h_source.html#l00078">FeeParam.h:78</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_afc61b4b644b5b4baeb94e98ef2401540"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#afc61b4b644b5b4baeb94e98ef2401540">o2::trd::FeeParam::getRejectMultipleTracklets</a></div><div class="ttdeci">bool getRejectMultipleTracklets() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/FeeParam_8h_source.html#l00098">FeeParam.h:98</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a441900fc7d1ccdd54b4a7af39353caf2"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a441900fc7d1ccdd54b4a7af39353caf2">o2::trd::TrapSimulator::sort2</a></div><div class="ttdeci">void sort2(unsigned short idx1i, unsigned short idx2i, unsigned short val1i, unsigned short val2i, unsigned short *const idx1o, unsigned short *const idx2o, unsigned short *const val1o, unsigned short *const val2o) const</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aec699535dbbf95308ea0f65723685d8d"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aec699535dbbf95308ea0f65723685d8d">o2::trd::TrapSimulator::produceTrackletStream</a></div><div class="ttdeci">int produceTrackletStream(unsigned int *buf, int bufsize)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a519dd2b96961f400b72c87f0d784b2e5"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a519dd2b96961f400b72c87f0d784b2e5">o2::trd::TrapSimulator::FitReg::mQ0</a></div><div class="ttdeci">unsigned int mQ0</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00258">TrapSimulator.h:258</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ac082c9fbcfa73ad165aa00b85346b156"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ac082c9fbcfa73ad165aa00b85346b156">o2::trd::TrapSimulator::printTrackletsXml</a></div><div class="ttdeci">void printTrackletsXml(std::ostream &amp;os) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00300">TrapSimulator.cxx:300</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a6eba317e3cf44d6d26c04a5a8f197dcb"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a></div><div class="ttdeci">GLboolean GLboolean GLboolean b</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_af419c1e8b835ae86a0cf72529a2797b8"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af419c1e8b835ae86a0cf72529a2797b8">o2::trd::TrapSimulator::setNTimebins</a></div><div class="ttdeci">void setNTimebins(int ntimebins)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_a27c61087a425cd5d1c3ceae04c9507ce"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#a27c61087a425cd5d1c3ceae04c9507ce">o2::trd::FeeParam::getRAWversion</a></div><div class="ttdeci">int getRAWversion() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/FeeParam_8h_source.html#l00106">FeeParam.h:106</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ae6fd3c0fd1aac9322a1edb0f97155113"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ae6fd3c0fd1aac9322a1edb0f97155113">o2::trd::TrapSimulator::mgkDmemAddrDeflCutStart</a></div><div class="ttdeci">static const int mgkDmemAddrDeflCutStart</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00191">TrapSimulator.h:191</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a667c406f12bf04f78c37a2ac2424d81b"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a667c406f12bf04f78c37a2ac2424d81b">o2::trd::TrapSimulator::filterTailInit</a></div><div class="ttdeci">void filterTailInit(int baseline=-1)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701caee5d08b4a157f43a48a3c3b8d3627ae6"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caee5d08b4a157f43a48a3c3b8d3627ae6">o2::trd::TrapConfig::kTPFE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00178">TrapConfig.h:178</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a33fbb47cb82273b01051db44898ea961"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a33fbb47cb82273b01051db44898ea961">o2::trd::TrapSimulator::mRobPos</a></div><div class="ttdeci">int mRobPos</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00285">TrapSimulator.h:285</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701c"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701c">o2::trd::TrapConfig::TrapReg_t</a></div><div class="ttdeci">TrapReg_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00055">TrapConfig.h:55</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701caf235cf7cec62783f3671d81d7869ab3e"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701caf235cf7cec62783f3671d81d7869ab3e">o2::trd::TrapConfig::kFPBY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00197">TrapConfig.h:197</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a4c2ab6b37675949ee96da2daf98c1713"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a4c2ab6b37675949ee96da2daf98c1713">o2::trd::TrapConfig::getRegName</a></div><div class="ttdeci">std::string getRegName(TrapReg_t reg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00524">TrapConfig.h:524</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a321ff419cd5252e54cf95e64dc6687ee"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a321ff419cd5252e54cf95e64dc6687ee">result</a></div><div class="ttdeci">GLuint64EXT * result</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05662">glcorearb.h:5662</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1MCTruthContainer_html"><div class="ttname"><a href="../../dc/daa/classo2_1_1dataformats_1_1MCTruthContainer.html">o2::dataformats::MCTruthContainer</a></div><div class="ttdoc">A container to hold and manage MC truth information/labels. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/ClusterNative_8h_source.html#l00029">ClusterNative.h:29</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ad8a8baf08bc0399738960c9259571911"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ad8a8baf08bc0399738960c9259571911">buf</a></div><div class="ttdeci">GLenum GLuint GLenum GLsizei const GLchar * buf</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l02514">glcorearb.h:2514</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_af38f59778a92ac6d4aa7b1eeec5c5ed2"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#af38f59778a92ac6d4aa7b1eeec5c5ed2">float</a></div><div class="ttdeci">Visualize clusters only Timeframe settings float</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00022">qconfigoptions.h:22</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7ca6fe4a66339e590d39198f8ed86886"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7ca6fe4a66339e590d39198f8ed86886">o2::trd::TrapSimulator::mgkNHitsMC</a></div><div class="ttdeci">static const int mgkNHitsMC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00206">TrapSimulator.h:206</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aee16770e6f7230958845149a413fb112aab06ad7e83b258677ccdc0eb757987fc"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aee16770e6f7230958845149a413fb112aab06ad7e83b258677ccdc0eb757987fc">o2::trd::TrapSimulator::PLOTTRACKLETS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00052">TrapSimulator.h:52</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a5fd7decd6730743576be4e44d52e79c2"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a5fd7decd6730743576be4e44d52e79c2">o2::trd::TrapSimulator::trackletSelection</a></div><div class="ttdeci">void trackletSelection()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a196f08afe62709431d88edff5fcbcdae"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a196f08afe62709431d88edff5fcbcdae">o2::trd::TrapSimulator::mHits</a></div><div class="ttdeci">std::array&lt; Hit, mgkNHitsMC &gt; mHits</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00231">TrapSimulator.h:231</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cab16bdda7b4e327d48567857d0ca885dd"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cab16bdda7b4e327d48567857d0ca885dd">o2::trd::TrapConfig::kTPVBY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00218">TrapConfig.h:218</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca9447f8cd1926f2cb5c2d48a66e24f7ef"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca9447f8cd1926f2cb5c2d48a66e24f7ef">o2::trd::TrapConfig::kFTLL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00208">TrapConfig.h:208</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a654248d39a677b189958ba1bb69574bf"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a654248d39a677b189958ba1bb69574bf">o2::trd::TrapSimulator::setData</a></div><div class="ttdeci">void setData(int iadc, const std::vector&lt; int &gt; &amp;adc)</div></div>
<div class="ttc" id="glcorearb_8h_html_afa0fb1b5e976920c0abeff2dca3ed774"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a></div><div class="ttdeci">GLfloat GLfloat GLfloat GLfloat h</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01976">glcorearb.h:1976</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a8e6eb448ada40e689e83ff5780f70eb0"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e6eb448ada40e689e83ff5780f70eb0">o2::trd::TrapSimulator::filterTail</a></div><div class="ttdeci">void filterTail()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ad0ce7d9382bb7a29c7eea6b241e67688"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad0ce7d9382bb7a29c7eea6b241e67688">o2::trd::TrapSimulator::init</a></div><div class="ttdeci">void init(TrapConfig *trapconfig, int det, int rob, int mcm)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00079">TrapSimulator.cxx:79</a></div></div>
<div class="ttc" id="MCCompLabel_8h_html"><div class="ttname"><a href="../../d7/dcd/MCCompLabel_8h.html">MCCompLabel.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a927160fb41550e13ed1332388c6bd491"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a927160fb41550e13ed1332388c6bd491">o2::trd::TrapSimulator::mgkDmemAddrLUTLength</a></div><div class="ttdeci">static const int mgkDmemAddrLUTLength</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00184">TrapSimulator.h:184</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca9d4175b77bf786f20feafa8f70b3f1b1"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca9d4175b77bf786f20feafa8f70b3f1b1">o2::trd::TrapConfig::kTPL00</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00357">TrapConfig.h:357</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a56289b031f21dc2129b4c54f7dbccf7a"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a56289b031f21dc2129b4c54f7dbccf7a">o2::trd::TrapSimulator::printPidLutHuman</a></div><div class="ttdeci">void printPidLutHuman()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a8f3a3fdb5260c675584a5fae1401f3e7"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8f3a3fdb5260c675584a5fae1401f3e7">o2::trd::TrapSimulator::filterTailNextSample</a></div><div class="ttdeci">unsigned short filterTailNextSample(int adc, unsigned short value)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1Tracklet_html"><div class="ttname"><a href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html">o2::trd::Tracklet</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dac/TRD_2base_2include_2TRDBase_2Tracklet_8h_source.html#l00046">Tracklet.h:46</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cac39e3d9f1b5abb49ce46ac175dbd8dd9"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cac39e3d9f1b5abb49ce46ac175dbd8dd9">o2::trd::TrapConfig::kC15CPUA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00150">TrapConfig.h:150</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a366b5827275974d0739979a59d933b0a"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a366b5827275974d0739979a59d933b0a">o2::trd::TrapSimulator::mFeeParam</a></div><div class="ttdeci">FeeParam * mFeeParam</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00301">TrapSimulator.h:301</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2f493935228ccca8731a1773c8f55b48"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2f493935228ccca8731a1773c8f55b48">o2::trd::TrapSimulator::raw</a></div><div class="ttdeci">static std::ostream &amp; raw(std::ostream &amp;os)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00163">TrapSimulator.cxx:163</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2b97ce24f11538c45b895385fb3eebc7"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b97ce24f11538c45b895385fb3eebc7">o2::trd::TrapSimulator::zeroSupressionMapping</a></div><div class="ttdeci">void zeroSupressionMapping()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca02fc8d6dedc250bdddb91bd0a489ab11"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca02fc8d6dedc250bdddb91bd0a489ab11">o2::trd::TrapConfig::kTPVT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00217">TrapConfig.h:217</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca86bcf58808f5d5dd9615e5dfe112182f"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca86bcf58808f5d5dd9615e5dfe112182f">o2::trd::TrapConfig::kTPQE0</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00182">TrapConfig.h:182</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1Tracklet_html_a552396834c4e331e3fd0c3c4971316d7"><div class="ttname"><a href="../../d2/d70/classo2_1_1trd_1_1Tracklet.html#a552396834c4e331e3fd0c3c4971316d7">o2::trd::Tracklet::getY</a></div><div class="ttdeci">float getY() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d07/Tracklet_8cxx_source.html#l00112">Tracklet.cxx:112</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_acc2760558000045ec0803d60d4d01c98"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#acc2760558000045ec0803d60d4d01c98">e</a></div><div class="ttdeci">Run track merging Number of iterations to Number of iterations to Number of initial iterations excluded from const char e</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00140">qconfigoptions.h:140</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a06fb6463292a85d990519c5e76386e25"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a06fb6463292a85d990519c5e76386e25">o2::trd::TrapSimulator::getTracklets</a></div><div class="ttdeci">void getTracklets(std::vector&lt; Tracklet &gt; &amp;TrackletStore)</div></div>
<div class="ttc" id="glcorearb_8h_html_a57f14e05b1900f16a2da82ade47d0c6d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a></div><div class="ttdeci">GLuint index</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_af5f285a4defaffaa7ed6a4a9fccf0381"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af5f285a4defaffaa7ed6a4a9fccf0381">o2::trd::TrapSimulator::getHit</a></div><div class="ttdeci">bool getHit(int index, int &amp;channel, int &amp;timebin, int &amp;qtot, int &amp;ypos, float &amp;y, int &amp;label) const</div></div>
<div class="ttc" id="namespaceo2_1_1framework_html_ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#ac2569e9658701f4fc5b687da9dacb739abefe0c00d6dfe8c719309ff450205215">o2::framework::Abs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc2/BasicOps_8h_source.html#l00031">BasicOps.h:31</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00403">glcorearb.h:403</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a67a37ea3fb4a681e383db89e6d3130d5"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a67a37ea3fb4a681e383db89e6d3130d5">o2::trd::TrapSimulator::getMcmPos</a></div><div class="ttdeci">int getMcmPos() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00111">TrapSimulator.h:111</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a19814d027d13a233552ccec6068049b6"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a19814d027d13a233552ccec6068049b6">o2::trd::TrapSimulator::printAdcDatXml</a></div><div class="ttdeci">void printAdcDatXml(std::ostream &amp;os) const</div></div>
<div class="ttc" id="glcorearb_8h_html_a49825216c96caaeb09237b36651181c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a49825216c96caaeb09237b36651181c5">x1</a></div><div class="ttdeci">GLuint GLfloat GLfloat GLfloat x1</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="namespaceo2_1_1trd_html"><div class="ttname"><a href="../../d2/d76/namespaceo2_1_1trd.html">o2::trd</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbc/SimTraits_8h_source.html#l00104">SimTraits.h:104</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a74d80fd479c0f6d0153c709949a089ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00270">glcorearb.h:270</a></div></div>
<div class="ttc" id="glcorearb_8h_html_af5ef68ee1b33850ea6254115a25d0a85"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#af5ef68ee1b33850ea6254115a25d0a85">value</a></div><div class="ttdeci">GLsizei const GLfloat * value</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00819">glcorearb.h:819</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a1fddd7e328dc7fe2e26c4cadfd822212"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1fddd7e328dc7fe2e26c4cadfd822212">o2::trd::TrapSimulator::mgkFormatIndex</a></div><div class="ttdeci">static const int mgkFormatIndex</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00201">TrapSimulator.h:201</a></div></div>
<div class="ttc" id="MCTruthContainer_8h_html"><div class="ttname"><a href="../../db/d14/MCTruthContainer_8h.html">MCTruthContainer.h</a></div><div class="ttdoc">Definition of a container to keep Monte Carlo truth external to simulation objects. </div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cae59830e75d7da507eeab9de7d76a5ca0"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cae59830e75d7da507eeab9de7d76a5ca0">o2::trd::TrapConfig::kFGTA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00204">TrapConfig.h:204</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7d1f60f2bda1bb26757798f99a5b9a54"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7d1f60f2bda1bb26757798f99a5b9a54">o2::trd::TrapSimulator::mZSMap</a></div><div class="ttdeci">std::vector&lt; int &gt; mZSMap</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00294">TrapSimulator.h:294</a></div></div>
<div class="ttc" id="TRD_2base_2include_2TRDBase_2Tracklet_8h_html"><div class="ttname"><a href="../../de/dac/TRD_2base_2include_2TRDBase_2Tracklet_8h.html">Tracklet.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a963c75e9fe77ae60f801b4a41ed7f34a"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a963c75e9fe77ae60f801b4a41ed7f34a">o2::trd::TrapConfig::getTrapReg</a></div><div class="ttdeci">int getTrapReg(TrapReg_t reg, int det=-1, int rob=-1, int mcm=-1)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/TrapConfig_8cxx_source.html#l00533">TrapConfig.cxx:533</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a8e4b528379c2d5083c0f0030d71fbc23"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8e4b528379c2d5083c0f0030d71fbc23">o2::trd::TrapSimulator::mMcmPos</a></div><div class="ttdeci">int mMcmPos</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00286">TrapSimulator.h:286</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ad154df9ec0a4685b0697595a6fd956a1"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ad154df9ec0a4685b0697595a6fd956a1">o2::trd::TrapSimulator::mTrapConfig</a></div><div class="ttdeci">TrapConfig * mTrapConfig</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00302">TrapSimulator.h:302</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a3246f5ecddb2cb86186e13a75a5a15a8"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a3246f5ecddb2cb86186e13a75a5a15a8">o2::trd::TrapConfig::printDatx</a></div><div class="ttdeci">void printDatx(std::ostream &amp;os, unsigned int addr, unsigned int data, int rob, int mcm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/TrapConfig_8cxx_source.html#l00751">TrapConfig.cxx:751</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a1418e4ed28a4b349a0e882f44cd0cc77"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a1418e4ed28a4b349a0e882f44cd0cc77">o2::trd::TrapSimulator::filterGainInit</a></div><div class="ttdeci">void filterGainInit()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca3f04bd3c6bdf030633f83a46333c7e05"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca3f04bd3c6bdf030633f83a46333c7e05">o2::trd::TrapConfig::kTPQS0</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00181">TrapConfig.h:181</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca7deacfee172519d6db9ea5de268ce963"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca7deacfee172519d6db9ea5de268ce963">o2::trd::TrapConfig::kEBIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00193">TrapConfig.h:193</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a8b41bb53b5da36d7858d39821d8b55c6"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a8b41bb53b5da36d7858d39821d8b55c6">o2::trd::TrapSimulator::readPackedConfig</a></div><div class="ttdeci">static bool readPackedConfig(TrapConfig *cfg, int hc, unsigned int *data, int size)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_ab760960646a634eb6caf71b755af5ef1"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#ab760960646a634eb6caf71b755af5ef1">o2::trd::TrapSimulator::mInternalFilterRegisters</a></div><div class="ttdeci">std::array&lt; FilterReg, NOfAdcPerMcm &gt; mInternalFilterRegisters</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00315">TrapSimulator.h:315</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca45811b3142d540e70f4aed144773b44f"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca45811b3142d540e70f4aed144773b44f">o2::trd::TrapConfig::kEBIN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00195">TrapConfig.h:195</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701ca54e4f503b6cbdcb8f69fcf18a4b57ae8"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701ca54e4f503b6cbdcb8f69fcf18a4b57ae8">o2::trd::TrapConfig::kEBIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00194">TrapConfig.h:194</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a8922a680b00df660c57f47c1971d04c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a></div><div class="ttdeci">GLboolean * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00298">glcorearb.h:298</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a69867079534b8c6ad96aeb33a906d54c"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a69867079534b8c6ad96aeb33a906d54c">o2::trd::TrapSimulator::print</a></div><div class="ttdeci">void print(int choice) const</div></div>
<div class="ttc" id="qconfigoptions_8h_html_a9fb99aa34f76f957d3f57fed6946e901"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a9fb99aa34f76f957d3f57fed6946e901">false</a></div><div class="ttdeci">false</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00016">qconfigoptions.h:16</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1FeeParam_html_af1241df8d091fa4ea0d0d7c8cfc45cd4"><div class="ttname"><a href="../../db/d0c/classo2_1_1trd_1_1FeeParam.html#af1241df8d091fa4ea0d0d7c8cfc45cd4">o2::trd::FeeParam::getPadColFromADC</a></div><div class="ttdeci">virtual int getPadColFromADC(int irob, int imcm, int iadc) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d67/FeeParam_8cxx_source.html#l00203">FeeParam.cxx:203</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7de0cebed187eadb245acff124de2244"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7de0cebed187eadb245acff124de2244">o2::trd::TrapSimulator::text</a></div><div class="ttdeci">static std::ostream &amp; text(std::ostream &amp;os)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00146">TrapSimulator.cxx:146</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a2ae4d3233a386c3103a93dcf253032bd"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a2ae4d3233a386c3103a93dcf253032bd">o2::trd::TrapSimulator::FitReg::mSumY2</a></div><div class="ttdeci">unsigned int mSumY2</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00263">TrapSimulator.h:263</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_ad75a9ee6eb9ff23e71d87924dbadd277"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#ad75a9ee6eb9ff23e71d87924dbadd277">o2::trd::TrapConfig::getRegByAddress</a></div><div class="ttdeci">TrapReg_t getRegByAddress(int address)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/TrapConfig_8cxx_source.html#l00694">TrapConfig.cxx:694</a></div></div>
<div class="ttc" id="TRDCommonParam_8h_html"><div class="ttname"><a href="../../da/d32/TRDCommonParam_8h.html">TRDCommonParam.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7a4c6fa94ecfa59d430b940f1200f4c7"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7a4c6fa94ecfa59d430b940f1200f4c7">o2::trd::TrapSimulator::checkInitialized</a></div><div class="ttdeci">bool checkInitialized() const</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_af7943e58db355976579f0e31fc841606"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af7943e58db355976579f0e31fc841606">o2::trd::TrapSimulator::setDataByPad</a></div><div class="ttdeci">void setDataByPad(std::vector&lt; o2::trd::Digit &gt; &amp;padrowdata, o2::dataformats::MCTruthContainer&lt; MCLabel &gt; &amp;labels, int padrowoffset)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a62c8e9909197af215a6254a603e73a77"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a62c8e9909197af215a6254a603e73a77">o2::trd::TrapSimulator::mgkDmemAddrLUTcor1</a></div><div class="ttdeci">static const int mgkDmemAddrLUTcor1</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00179">TrapSimulator.h:179</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html">o2::trd::TrapConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00034">TrapConfig.h:34</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a2b44c47019e9269faccc681b9a308435aefbf1ef46b9c47fbff3490178306645c"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a2b44c47019e9269faccc681b9a308435aefbf1ef46b9c47fbff3490178306645c">o2::trd::TrapSimulator::PRINTFOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00049">TrapSimulator.h:49</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a22bb2529802a879684bd30e7ac515037"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a22bb2529802a879684bd30e7ac515037">o2::trd::TrapSimulator::mTrackletArray</a></div><div class="ttdeci">std::vector&lt; Tracklet &gt; mTrackletArray</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00293">TrapSimulator.h:293</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapConfig_html_a04f19fde89b38c9eb174d488f1e5701cac8beefe5f589dd2fa7330e3f09b85ddb"><div class="ttname"><a href="../../d7/dae/classo2_1_1trd_1_1TrapConfig.html#a04f19fde89b38c9eb174d488f1e5701cac8beefe5f589dd2fa7330e3f09b85ddb">o2::trd::TrapConfig::kTPHT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbb/TrapConfig_8h_source.html#l00216">TrapConfig.h:216</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7f7c4095ae9dde2ec6402a2238b2f765"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7f7c4095ae9dde2ec6402a2238b2f765">o2::trd::TrapSimulator::filterGain</a></div><div class="ttdeci">void filterGain()</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_af0fb5026985126c43e800e4ced0c8621"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af0fb5026985126c43e800e4ced0c8621">o2::trd::TrapSimulator::getCol</a></div><div class="ttdeci">int getCol(int iadc)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a14d524b4525db37961daec35c0bf814e"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a14d524b4525db37961daec35c0bf814e">o2::trd::TrapSimulator::filterPedestalNextSample</a></div><div class="ttdeci">unsigned short filterPedestalNextSample(int adc, int timebin, unsigned short value)</div></div>
<div class="ttc" id="glcorearb_8h_html_a31eafbeac9256b106b6acfd78f305200"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a31eafbeac9256b106b6acfd78f305200">count</a></div><div class="ttdeci">GLint GLsizei count</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00399">glcorearb.h:399</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_af0ff6fee86376f75515470a9c5b07a63"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#af0ff6fee86376f75515470a9c5b07a63">o2::trd::TrapSimulator::addHitToFitreg</a></div><div class="ttdeci">void addHitToFitreg(int adc, unsigned short timebin, unsigned short qtot, short ypos)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_1_1FitReg_html_a4e56a3ece8190626f36a2ca7497fe265"><div class="ttname"><a href="../../df/dad/classo2_1_1trd_1_1TrapSimulator_1_1FitReg.html#a4e56a3ece8190626f36a2ca7497fe265">o2::trd::TrapSimulator::FitReg::mSumY</a></div><div class="ttdeci">int mSumY</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00261">TrapSimulator.h:261</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a7030620118b7ca9c704055b98548fd9e"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a7030620118b7ca9c704055b98548fd9e">o2::trd::TrapSimulator::sort6To2Worst</a></div><div class="ttdeci">void sort6To2Worst(unsigned short idx1i, unsigned short idx2i, unsigned short idx3i, unsigned short idx4i, unsigned short idx5i, unsigned short idx6i, unsigned short val1i, unsigned short val2i, unsigned short val3i, unsigned short val4i, unsigned short val5i, unsigned short val6i, unsigned short *const idx5o, unsigned short *const idx6o)</div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_aa87721722de9e49122770f04c12f8f4b"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#aa87721722de9e49122770f04c12f8f4b">o2::trd::TrapSimulator::mgkDmemAddrLUTcor0</a></div><div class="ttdeci">static const int mgkDmemAddrLUTcor0</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00178">TrapSimulator.h:178</a></div></div>
<div class="ttc" id="TRD_2simulation_2include_2TRDSimulation_2Digitizer_8h_html"><div class="ttname"><a href="../../d4/dae/TRD_2simulation_2include_2TRDSimulation_2Digitizer_8h.html">Digitizer.h</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a646a24ae678eae95859873f0faeb4928"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a646a24ae678eae95859873f0faeb4928">o2::trd::TrapSimulator::mFitReg</a></div><div class="ttdeci">std::array&lt; FitReg, 25 &gt; mFitReg</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/TrapSimulator_8h_source.html#l00277">TrapSimulator.h:277</a></div></div>
<div class="ttc" id="classo2_1_1trd_1_1TrapSimulator_html_a4a9489306cb5a03e7d87378a80efdf2d"><div class="ttname"><a href="../../d4/dfa/classo2_1_1trd_1_1TrapSimulator.html#a4a9489306cb5a03e7d87378a80efdf2d">o2::trd::TrapSimulator::TrapSimulator</a></div><div class="ttdeci">TrapSimulator()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/deb/TrapSimulator_8cxx_source.html#l00064">TrapSimulator.cxx:64</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_69dd0583e11051991bf4c0cf23c50933.html">TRD</a></li><li class="navelem"><a class="el" href="../../dir_5cb2a8e9fdbe67a11efb4176f60bf3d6.html">simulation</a></li><li class="navelem"><a class="el" href="../../dir_41d98617f9e68bb8925b5f8794afb89b.html">src</a></li><li class="navelem"><a class="el" href="../../da/deb/TrapSimulator_8cxx.html">TrapSimulator.cxx</a></li>
    <li class="footer">Generated on Thu Jun 4 2020 09:30:32 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
